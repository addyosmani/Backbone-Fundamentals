<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Developing Backbone.js Applications – backbone-fundamentals</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
  <meta name="viewport" content="width=device-width">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>
	<h1>Developing Backbone.js Applications</h1>
	<h3>By Addy Osmani (<a href="https://twitter.com/addyosmani">@addyosmani</a>)</h3>
</p>
<div style="width:500px">

<iframe src="http://ghbtns.com/github-btn.html?user=addyosmani&repo=backbone-fundamentals&type=watch&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="110px" height="20px"></iframe>

 <iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.1333103182.html#_=1333404284780&amp;count=horizontal&amp;id=twitter-widget-0&amp;lang=en&amp;original_referer=http%3A%2F%2Faddyosmani.github.com%2Fbackbone-fundamentals%2F&amp;size=m&amp;text=Developing%20Backbone.js%20Applications&amp;url=https%3A%2F%2Fgithub.com%2Faddyosmani%2Fbackbone-fundamentals&amp;via=addyosmani" class="twitter-share-button twitter-count-horizontal" style="width: 107px; height: 20px; " title="Twitter Tweet Button"></iframe>
<script id="twitter-wjs" src="//platform.twitter.com/widgets.js"></script><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  <p>&nbsp;<br></p>
</div>

<p>Available free for open-source reading below or for purchase via the <a href="http://shop.oreilly.com/product/0636920025344.do">O'Reilly store</a>. <a href="https://github.com/addyosmani/backbone-fundamentals/"></br>Pull requests</a> and comments always welcome.</p>
<p><img src="img/oreilly.jpg"/></p>

<a href="http://shop.oreilly.com/product/0636920025344/ReviewSubmit.do?sortby=publicationDate?pageId=0636920025344.IP"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://addyosmani.github.com/backbone-fundamentals/img/helpful.png" alt="Was this helpful? We'd love you to write a review."></a>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#prelude" id="toc-prelude">Prelude</a></li>
<li><a href="#target-audience" id="toc-target-audience">Target
Audience</a></li>
<li><a href="#acknowledgements"
id="toc-acknowledgements">Acknowledgements</a></li>
<li><a href="#credits" id="toc-credits">Credits</a></li>
<li><a href="#target-version" id="toc-target-version">Target
Version</a></li>
<li><a href="#reading" id="toc-reading">Reading</a></li>
<li><a href="#introduction" id="toc-introduction">Introduction</a>
<ul>
<li><a href="#what-is-mvc-in-modern-web-development"
id="toc-what-is-mvc-in-modern-web-development">What Is MVC in Modern Web
Development?</a></li>
<li><a href="#what-is-backbone.js" id="toc-what-is-backbone.js">What is
Backbone.js?</a></li>
<li><a href="#modern-javascript-application-architecture"
id="toc-modern-javascript-application-architecture">Modern JavaScript
Application Architecture</a></li>
<li><a href="#when-to-use-backbone.js-today"
id="toc-when-to-use-backbone.js-today">When to Use Backbone.js
Today</a></li>
<li><a href="#setting-expectations"
id="toc-setting-expectations">Setting Expectations</a></li>
</ul></li>
<li><a href="#fundamentals" id="toc-fundamentals">Fundamentals</a>
<ul>
<li><a href="#mvc-and-modern-architecture"
id="toc-mvc-and-modern-architecture">MVC and Modern Architecture</a>
<ul>
<li><a href="#classical-mvc-vs-modern-implementations"
id="toc-classical-mvc-vs-modern-implementations">Classical MVC vs Modern
Implementations</a></li>
<li><a href="#modern-web-context" id="toc-modern-web-context">Modern Web
Context</a></li>
<li><a href="#client-side-architecture"
id="toc-client-side-architecture">Client-Side Architecture</a></li>
<li><a href="#modern-best-practices"
id="toc-modern-best-practices">Modern Best Practices</a></li>
<li><a href="#summary" id="toc-summary">Summary</a></li>
</ul></li>
</ul></li>
<li><a href="#backbone-basics" id="toc-backbone-basics">Backbone
Basics</a>
<ul>
<li><a href="#getting-set-up" id="toc-getting-set-up">Getting set
up</a></li>
<li><a href="#models" id="toc-models">Models</a></li>
<li><a href="#views" id="toc-views">Views</a></li>
<li><a href="#collections" id="toc-collections">Collections</a></li>
<li><a href="#restful-persistence" id="toc-restful-persistence">RESTful
Persistence</a></li>
<li><a href="#events" id="toc-events">Events</a></li>
<li><a href="#routers" id="toc-routers">Routers</a></li>
<li><a href="#backbones-sync-api" id="toc-backbones-sync-api">Backbone’s
Sync API</a></li>
<li><a href="#dependencies" id="toc-dependencies">Dependencies</a></li>
<li><a href="#summary-1" id="toc-summary-1">Summary</a></li>
</ul></li>
<li><a href="#exercise-1-todos---your-first-backbone.js-app"
id="toc-exercise-1-todos---your-first-backbone.js-app">Exercise 1: Todos
- Your First Backbone.js App</a>
<ul>
<li><a href="#static-html" id="toc-static-html">Static HTML</a></li>
<li><a href="#todo-model" id="toc-todo-model">Todo model</a></li>
<li><a href="#todo-collection" id="toc-todo-collection">Todo
collection</a></li>
<li><a href="#application-view" id="toc-application-view">Application
View</a></li>
<li><a href="#individual-todo-view"
id="toc-individual-todo-view">Individual Todo View</a></li>
<li><a href="#startup" id="toc-startup">Startup</a></li>
<li><a href="#in-action" id="toc-in-action">In action</a></li>
<li><a href="#completing-deleting-todos"
id="toc-completing-deleting-todos">Completing &amp; deleting
todos</a></li>
<li><a href="#todo-routing" id="toc-todo-routing">Todo routing</a></li>
<li><a href="#summary-2" id="toc-summary-2">Summary</a></li>
</ul></li>
<li><a
href="#exercise-2-book-library---your-first-restful-backbone.js-app"
id="toc-exercise-2-book-library---your-first-restful-backbone.js-app">Exercise
2: Book Library - Your First RESTful Backbone.js App</a>
<ul>
<li><a href="#summary-3" id="toc-summary-3">Summary</a></li>
</ul></li>
<li><a href="#backbone-extensions" id="toc-backbone-extensions">Backbone
Extensions</a>
<ul>
<li><a href="#marionettejs-backbone.marionette"
id="toc-marionettejs-backbone.marionette">MarionetteJS
(Backbone.Marionette)</a>
<ul>
<li><a href="#boilerplate-rendering-code"
id="toc-boilerplate-rendering-code">Boilerplate Rendering Code</a></li>
<li><a href="#reducing-boilerplate-with-marionette.itemview"
id="toc-reducing-boilerplate-with-marionette.itemview">Reducing
Boilerplate With Marionette.ItemView</a></li>
<li><a href="#memory-management" id="toc-memory-management">Memory
Management</a></li>
<li><a href="#region-management" id="toc-region-management">Region
Management</a></li>
<li><a href="#marionette-todo-app"
id="toc-marionette-todo-app">Marionette Todo app</a></li>
<li><a
href="#is-the-marionette-implementation-of-the-todo-app-more-maintainable"
id="toc-is-the-marionette-implementation-of-the-todo-app-more-maintainable">Is
the Marionette implementation of the Todo app more
maintainable?</a></li>
<li><a href="#marionette-and-flexibility"
id="toc-marionette-and-flexibility">Marionette And Flexibility</a></li>
<li><a href="#and-so-much-more" id="toc-and-so-much-more">And So Much
More</a></li>
</ul></li>
<li><a href="#thorax" id="toc-thorax">Thorax</a>
<ul>
<li><a href="#hello-world" id="toc-hello-world">Hello World</a></li>
<li><a href="#embedding-child-views"
id="toc-embedding-child-views">Embedding child views</a></li>
<li><a href="#view-helpers" id="toc-view-helpers">View helpers</a></li>
<li><a href="#collection-helper" id="toc-collection-helper">collection
helper</a></li>
<li><a href="#custom-html-data-attributes"
id="toc-custom-html-data-attributes">Custom HTML data
attributes</a></li>
<li><a href="#thorax-resources" id="toc-thorax-resources">Thorax
Resources</a></li>
</ul></li>
</ul></li>
<li><a href="#common-problems-solutions"
id="toc-common-problems-solutions">Common Problems &amp;
Solutions</a></li>
<li><a href="#modular-development" id="toc-modular-development">Modular
Development</a>
<ul>
<li><a href="#introduction-1"
id="toc-introduction-1">Introduction</a></li>
<li><a href="#organizing-modules-with-requirejs-and-amd"
id="toc-organizing-modules-with-requirejs-and-amd">Organizing modules
with RequireJS and AMD</a>
<ul>
<li><a href="#maintainability-problems-with-multiple-script-files"
id="toc-maintainability-problems-with-multiple-script-files">Maintainability
problems with multiple script files</a></li>
<li><a href="#need-for-better-dependency-management"
id="toc-need-for-better-dependency-management">Need for better
dependency management</a></li>
<li><a href="#asynchronous-module-definition-amd"
id="toc-asynchronous-module-definition-amd">Asynchronous Module
Definition (AMD)</a></li>
<li><a href="#writing-amd-modules-with-requirejs"
id="toc-writing-amd-modules-with-requirejs">Writing AMD modules with
RequireJS</a></li>
<li><a href="#getting-started-with-requirejs"
id="toc-getting-started-with-requirejs">Getting Started with
RequireJS</a></li>
<li><a href="#require.js-and-backbone-examples"
id="toc-require.js-and-backbone-examples">Require.js and Backbone
Examples</a></li>
<li><a
href="#keeping-your-templates-external-using-requirejs-and-the-text-plugin"
id="toc-keeping-your-templates-external-using-requirejs-and-the-text-plugin">Keeping
Your Templates External Using RequireJS And The Text Plugin</a></li>
<li><a
href="#optimizing-backbone-apps-for-production-with-the-requirejs-optimizer"
id="toc-optimizing-backbone-apps-for-production-with-the-requirejs-optimizer">Optimizing
Backbone apps for production with the RequireJS Optimizer</a></li>
</ul></li>
</ul></li>
<li><a href="#exercise-3-your-first-modular-backbone-requirejs-app"
id="toc-exercise-3-your-first-modular-backbone-requirejs-app">Exercise
3: Your First Modular Backbone + RequireJS App</a>
<ul>
<li><a href="#overview" id="toc-overview">Overview</a></li>
<li><a href="#markup" id="toc-markup">Markup</a></li>
<li><a href="#configuration-options"
id="toc-configuration-options">Configuration options</a></li>
<li><a href="#modularizing-our-models-views-and-collections"
id="toc-modularizing-our-models-views-and-collections">Modularizing our
models, views and collections</a></li>
<li><a href="#route-based-module-loading"
id="toc-route-based-module-loading">Route-based module loading</a>
<ul>
<li><a href="#json-based-module-configuration"
id="toc-json-based-module-configuration">JSON-based module
configuration</a></li>
<li><a href="#module-loader-router" id="toc-module-loader-router">Module
loader Router</a></li>
<li><a href="#using-nodejs-to-handle-pushstate"
id="toc-using-nodejs-to-handle-pushstate">Using NodeJS to handle
pushState</a></li>
</ul></li>
<li><a href="#an-asset-package-alternative-for-dependency-management"
id="toc-an-asset-package-alternative-for-dependency-management">An asset
package alternative for dependency management</a></li>
</ul></li>
<li><a href="#paginating-backbone.js-requests-collections"
id="toc-paginating-backbone.js-requests-collections">Paginating
Backbone.js Requests &amp; Collections</a>
<ul>
<li><a href="#introduction-2" id="toc-introduction-2">Introduction</a>
<ul>
<li><a href="#backbone.paginator"
id="toc-backbone.paginator">Backbone.Paginator</a></li>
<li><a href="#live-examples" id="toc-live-examples">Live
Examples</a></li>
</ul></li>
<li><a href="#gotchas" id="toc-gotchas">Gotchas!</a></li>
<li><a href="#gotchas-1" id="toc-gotchas-1">Gotchas!</a>
<ul>
<li><a href="#plugins" id="toc-plugins">Plugins</a></li>
<li><a href="#bootstrapping"
id="toc-bootstrapping">Bootstrapping</a></li>
<li><a href="#styling" id="toc-styling">Styling</a></li>
<li><a href="#conclusions" id="toc-conclusions">Conclusions</a></li>
</ul></li>
</ul></li>
<li><a href="#backbone-boilerplate-and-grunt-bbb"
id="toc-backbone-boilerplate-and-grunt-bbb">Backbone Boilerplate And
Grunt-BBB</a>
<ul>
<li><a href="#getting-started" id="toc-getting-started">Getting
Started</a>
<ul>
<li><a href="#backbone-boilerplate-and-grunt-bbb-1"
id="toc-backbone-boilerplate-and-grunt-bbb-1">Backbone Boilerplate and
Grunt-BBB</a></li>
</ul></li>
<li><a href="#creating-a-new-project"
id="toc-creating-a-new-project">Creating a new project</a>
<ul>
<li><a href="#index.html" id="toc-index.html">index.html</a></li>
<li><a href="#config.js" id="toc-config.js">config.js</a></li>
<li><a href="#main.js" id="toc-main.js">main.js</a></li>
<li><a href="#app.js" id="toc-app.js">app.js</a></li>
<li><a href="#creating-backbone-boilerplate-modules"
id="toc-creating-backbone-boilerplate-modules">Creating Backbone
Boilerplate Modules</a></li>
<li><a href="#router.js" id="toc-router.js">router.js</a></li>
</ul></li>
<li><a href="#other-useful-tools-projects"
id="toc-other-useful-tools-projects">Other Useful Tools &amp;
Projects</a>
<ul>
<li><a href="#yeoman" id="toc-yeoman">Yeoman</a></li>
<li><a href="#backbone-devtools" id="toc-backbone-devtools">Backbone
DevTools</a></li>
</ul></li>
<li><a href="#conclusions-1" id="toc-conclusions-1">Conclusions</a></li>
</ul></li>
<li><a href="#backbone-jquery-mobile"
id="toc-backbone-jquery-mobile">Backbone &amp; jQuery Mobile</a>
<ul>
<li><a href="#mobile-app-development-with-jquery-mobile"
id="toc-mobile-app-development-with-jquery-mobile">Mobile app
development with jQuery Mobile</a></li>
<li><a href="#basic-backbone-app-setup-for-jquery-mobile"
id="toc-basic-backbone-app-setup-for-jquery-mobile">Basic Backbone app
setup for jQuery Mobile</a></li>
<li><a href="#workflow-with-backbone-and-jquerymobile"
id="toc-workflow-with-backbone-and-jquerymobile">Workflow with Backbone
and jQueryMobile</a></li>
<li><a href="#applying-advanced-jqm-techniques-to-backbone"
id="toc-applying-advanced-jqm-techniques-to-backbone">Applying advanced
jQM techniques to Backbone</a></li>
</ul></li>
<li><a href="#unit-testing" id="toc-unit-testing">Unit Testing</a></li>
<li><a href="#jasmine" id="toc-jasmine">Jasmine</a>
<ul>
<li><a href="#behavior-driven-development"
id="toc-behavior-driven-development">Behavior-Driven
Development</a></li>
<li><a href="#suites-specs-spies" id="toc-suites-specs-spies">Suites,
Specs, &amp; Spies</a></li>
<li><a href="#beforeeach-and-aftereach"
id="toc-beforeeach-and-aftereach">beforeEach() and afterEach()</a></li>
<li><a href="#shared-scope" id="toc-shared-scope">Shared scope</a></li>
<li><a href="#getting-set-up-1" id="toc-getting-set-up-1">Getting set
up</a></li>
<li><a href="#tdd-with-backbone" id="toc-tdd-with-backbone">TDD With
Backbone</a></li>
<li><a href="#models-1" id="toc-models-1">Models</a></li>
<li><a href="#collections-1" id="toc-collections-1">Collections</a></li>
<li><a href="#views-1" id="toc-views-1">Views</a>
<ul>
<li><a href="#view-testing" id="toc-view-testing">View testing</a></li>
</ul></li>
<li><a href="#conclusions-2" id="toc-conclusions-2">Conclusions</a></li>
<li><a href="#exercise" id="toc-exercise">Exercise</a></li>
<li><a href="#further-reading" id="toc-further-reading">Further
reading</a></li>
</ul></li>
<li><a href="#qunit" id="toc-qunit">QUnit</a>
<ul>
<li><a href="#introduction-3"
id="toc-introduction-3">Introduction</a></li>
<li><a href="#getting-setup" id="toc-getting-setup">Getting
Setup</a></li>
<li><a href="#assertions" id="toc-assertions">Assertions</a></li>
<li><a href="#adding-structure-to-assertions"
id="toc-adding-structure-to-assertions">Adding structure to
assertions</a></li>
<li><a href="#assertion-examples" id="toc-assertion-examples">Assertion
examples</a>
<ul>
<li><a
href="#equal---a-comparison-assertion.-it-passes-if-actual-expected"
id="toc-equal---a-comparison-assertion.-it-passes-if-actual-expected">equal
- a comparison assertion. It passes if actual == expected</a></li>
<li><a
href="#notequal---a-comparison-assertion.-it-passes-if-actual-expected"
id="toc-notequal---a-comparison-assertion.-it-passes-if-actual-expected">notEqual
- a comparison assertion. It passes if actual != expected</a></li>
<li><a
href="#strictequal---a-comparison-assertion.-it-passes-if-actual-expected"
id="toc-strictequal---a-comparison-assertion.-it-passes-if-actual-expected">strictEqual
- a comparison assertion. It passes if actual === expected</a></li>
<li><a
href="#notstrictequal---a-comparison-assertion.-it-passes-if-actual-expected"
id="toc-notstrictequal---a-comparison-assertion.-it-passes-if-actual-expected">notStrictEqual
- a comparison assertion. It passes if actual !== expected</a></li>
<li><a
href="#deepequal---a-recursive-comparison-assertion.-unlike-strictequal-it-works-on-objects-arrays-and-primitives."
id="toc-deepequal---a-recursive-comparison-assertion.-unlike-strictequal-it-works-on-objects-arrays-and-primitives.">deepEqual
- a recursive comparison assertion. Unlike strictEqual(), it works on
objects, arrays and primitives.</a></li>
<li><a
href="#notdeepequal---a-comparison-assertion.-this-returns-the-opposite-of-deepequal"
id="toc-notdeepequal---a-comparison-assertion.-this-returns-the-opposite-of-deepequal">notDeepEqual
- a comparison assertion. This returns the opposite of
deepEqual</a></li>
<li><a
href="#raises---an-assertion-which-tests-if-a-callback-throws-any-exceptions"
id="toc-raises---an-assertion-which-tests-if-a-callback-throws-any-exceptions">raises
- an assertion which tests if a callback throws any exceptions</a></li>
</ul></li>
<li><a href="#fixtures" id="toc-fixtures">Fixtures</a>
<ul>
<li><a href="#fixtures-example" id="toc-fixtures-example">Fixtures
example:</a></li>
</ul></li>
<li><a href="#asynchronous-code" id="toc-asynchronous-code">Asynchronous
code</a></li>
</ul></li>
<li><a href="#sinonjs" id="toc-sinonjs">SinonJS</a>
<ul>
<li><a href="#what-is-sinonjs" id="toc-what-is-sinonjs">What is
SinonJS?</a></li>
<li><a href="#stubs-and-mocks" id="toc-stubs-and-mocks">Stubs and
mocks</a>
<ul>
<li><a href="#stubs" id="toc-stubs">Stubs</a></li>
<li><a href="#mocks" id="toc-mocks">Mocks</a></li>
</ul></li>
<li><a href="#exercise-1" id="toc-exercise-1">Exercise</a>
<ul>
<li><a href="#models-2" id="toc-models-2">Models</a></li>
<li><a href="#collections-2" id="toc-collections-2">Collections</a></li>
<li><a href="#views-2" id="toc-views-2">Views</a></li>
<li><a href="#app" id="toc-app">App</a></li>
</ul></li>
<li><a href="#further-reading-resources"
id="toc-further-reading-resources">Further Reading &amp;
Resources</a></li>
</ul></li>
<li><a href="#resources" id="toc-resources">Resources</a>
<ul>
<li><a href="#books-courses" id="toc-books-courses">Books &amp;
Courses</a></li>
<li><a href="#extensionslibraries"
id="toc-extensionslibraries">Extensions/Libraries</a></li>
</ul></li>
<li><a href="#conclusions-3" id="toc-conclusions-3">Conclusions</a></li>
<li><a href="#appendix" id="toc-appendix">Appendix</a>
<ul>
<li><a href="#a-simple-javascript-mvc-implementation"
id="toc-a-simple-javascript-mvc-implementation">A Simple JavaScript MVC
Implementation</a>
<ul>
<li><a href="#event-system" id="toc-event-system">Event System</a></li>
<li><a href="#models-3" id="toc-models-3">Models</a></li>
<li><a href="#views-3" id="toc-views-3">Views</a></li>
<li><a href="#controllers" id="toc-controllers">Controllers</a></li>
<li><a href="#practical-usage" id="toc-practical-usage">Practical
Usage</a></li>
</ul></li>
<li><a href="#mvp" id="toc-mvp">MVP</a>
<ul>
<li><a href="#models-views-presenters"
id="toc-models-views-presenters">Models, Views &amp; Presenters</a></li>
</ul></li>
<li><a href="#mvp-or-mvc" id="toc-mvp-or-mvc">MVP or MVC?</a></li>
<li><a href="#mvc-mvp-and-backbone.js"
id="toc-mvc-mvp-and-backbone.js">MVC, MVP and Backbone.js</a></li>
<li><a href="#namespacing" id="toc-namespacing">Namespacing</a></li>
<li><a href="#backbone-dependency-details"
id="toc-backbone-dependency-details">Backbone Dependency Details</a>
<ul>
<li><a href="#dom-manipulation" id="toc-dom-manipulation">DOM
Manipulation</a></li>
<li><a href="#utilities" id="toc-utilities">Utilities</a></li>
<li><a href="#restful-persistence-1"
id="toc-restful-persistence-1">RESTful persistence</a></li>
<li><a href="#routing" id="toc-routing">Routing</a></li>
</ul></li>
<li><a href="#backbone-vs.-other-libraries-and-frameworks"
id="toc-backbone-vs.-other-libraries-and-frameworks">Backbone Vs. Other
Libraries And Frameworks</a></li>
</ul></li>
</ul>
</nav>
<h2 id="prelude">Prelude</h2>
<p><img src="img/logo.jpg" /></p>
<p>Not so long ago, “data-rich web application” was an oxymoron. Today,
these applications are everywhere and you need to know how to build
them.</p>
<p>Traditionally, web applications left the heavy-lifting of data to
servers that pushed HTML to the browser in complete page loads. The use
of client-side JavaScript was limited to improving the user experience.
Now this relationship has been inverted - client applications pull raw
data from the server and render it into the browser when and where it is
needed.</p>
<p>Think of the Ajax shopping cart which doesn’t require a refresh on
the page when adding an item to your basket. Initially, jQuery became
the go-to library for this paradigm. Its nature was to make Ajax
requests then update text on the page and so on. However, this pattern
with jQuery revealed that we have implicit model data on the client
side. With the server no longer being the only place that knows about
our item count, it was a hint that there was a natural tension and pull
of this evolution.</p>
<p>The rise of arbitrary code on the client-side which can talk to the
server however it sees fit has meant an increase in client-side
complexity. Good architecture on the client has gone from an
afterthought to essential - you can’t just hack together some jQuery
code and expect it to scale as your application grows. Most likely, you
would end up with a nightmarish tangle of UI callbacks entwined with
business logic, destined to be discarded by the poor soul who inherits
your code.</p>
<p>Thankfully, there are a growing number of JavaScript libraries that
can help improve the structure and maintainability of your code, making
it easier to build ambitious interfaces without a great deal of effort.
<a href="http://backbonejs.org">Backbone.js</a> has quickly become one
of the most popular open-source solutions to these issues and in this
book we will take you through an in-depth walkthrough of it.</p>
<p>Begin with the fundamentals, work your way through the exercises, and
learn how to build an application that is both cleanly organized and
maintainable. If you are a developer looking to write code that can be
more easily read, structured, and extended - this guide can help.</p>
<p>Improving developer education is important to me, which is why this
book is released under a Creative Commons
Attribution-NonCommercial-ShareAlike 3.0 Unported <a
href="http://creativecommons.org/licenses/by-nc-sa/3.0/">license</a>.
This means you can purchase or grab a copy of the book for <a
href="http://addyosmani.github.com/backbone-fundamentals/">free</a> or
help to further <a
href="https://github.com/addyosmani/backbone-fundamentals/">improve</a>
it. Corrections to existing material are always welcome and I hope that
together we can provide the community with an up-to-date resource that
is of help.</p>
<p>My extended thanks go out to <a
href="https://github.com/jashkenas">Jeremy Ashkenas</a> and <a
href="http://www.documentcloud.org">DocumentCloud</a> for creating
Backbone.js and <a
href="https://github.com/addyosmani/backbone-fundamentals/contributors">these</a>
members of the community for their assistance making this project far
better than I could have imagined.</p>
<h2 id="target-audience">Target Audience</h2>
<p>This book is targeted at novice to intermediate developers wishing to
learn how to better structure their client-side code. An understanding
of JavaScript fundamentals is required to get the most out of it,
however we have tried to provide a basic description of these concepts
where possible.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>I am indebted to the fantastic work done by the technical reviewers
who helped review and improve this book. Their knowledge, energy, and
passion have helped shape it into a better learning resource and they
continue to serve as a source of inspiration. Thanks go out to:</p>
<ul>
<li><a href="https://github.com/dcmaf">Marc Friedman</a></li>
<li><a href="https://github.com/derickbailey">Derick Bailey</a></li>
<li><a href="https://github.com/jashkenas">Jeremy Ashkenas</a></li>
<li><a href="https://github.com/samuelclay">Samuel Clay</a></li>
<li><a href="http://github.com/wibblymat">Mat Scales</a></li>
<li><a href="https://github.com/alexgraul">Alex Graul</a></li>
<li><a href="https://github.com/g6scheme">Dusan Gledovic</a></li>
<li><a href="https://github.com/sindresorhus">Sindre Sorhus</a></li>
</ul>
<p>I would also like to thank my loving family for their patience and
support while I worked on this book, as well as my brilliant editor Mary
Treseler.</p>
<h2 id="credits">Credits</h2>
<p>None of this work would have been possible without the time and
effort invested by the other developers and authors in the community who
helped contribute to it. I would like to extend my thanks to:</p>
<ul>
<li>Derick and Marc (once again)</li>
<li><a href="https://github.com/eastridge">Ryan Eastridge</a></li>
<li><a href="https://github.com/jackfranklin">Jack Franklin</a></li>
<li><a href="https://github.com/raDiesle">David Amend</a></li>
<li><a href="https://github.com/mdb">Mike Ball</a></li>
<li>Will Sulzer</li>
<li><a href="https://github.com/ugisozols">Uģis Ozols</a></li>
<li><a href="https://github.com/Ekengren">Björn Ekengren</a></li>
</ul>
<p>as well as our other excellent <a
href="https://github.com/addyosmani/backbone-fundamentals/graphs/contributors">contributors</a>
that made this project possible.</p>
<h2 id="target-version">Target Version</h2>
<p>Developing Backbone.js Applications targets Backbone.js 1.1.x (and
Underscore 1.6.x) and will actively attempt to stay up to date with more
recent versions of these libraries. Where possible, if you find using a
newer version of Backbone breaks an example, please consult the official
guide to <a href="http://backbonejs.org/#upgrading">upgrading</a> as it
contains instructions for how to work around breaking changes.
StackOverflow also contains many excellent examples of how other users
are handling updating their code.</p>
<h2 id="reading">Reading</h2>
<p>I assume your level of knowledge about JavaScript goes beyond the
basics and as such certain topics such as object literals are skipped.
If you need to learn more about the language, I am happy to suggest:</p>
<ul>
<li><a href="http://eloquentjavascript.net/">Eloquent
JavaScript</a></li>
<li><a
href="http://shop.oreilly.com/product/9780596805531.do">JavaScript: The
Definitive Guide</a> by David Flanagan (O’Reilly)</li>
<li><a
href="http://www.informit.com/store/effective-javascript-68-specific-ways-to-harness-the-9780321812186">Effective
JavaScript</a> by David Herman (Pearson)</li>
<li><a
href="http://shop.oreilly.com/product/9780596517748.do">JavaScript: The
Good Parts</a> by Douglas Crockford (O’Reilly)</li>
<li><a
href="http://www.amazon.com/Object-Oriented-Javascript-Stoyan-Stefanov/dp/1847194141">Object-Oriented
JavaScript</a> by Stoyan Stefanov (Packt Publishing)</li>
</ul>
<h1 id="introduction">Introduction</h1>
<p>Frank Lloyd Wright once said “You can’t make an architect. You can
however open the doors and windows toward the light as you see it.” In
this book, I hope to shed some light on how to improve the structure of
your web applications, opening doors to what will hopefully be more
maintainable, readable applications in your future.</p>
<p>The goal of all architecture is to build something well; in our case,
to craft code that is enduring and delights both ourselves and the
developers who will maintain our code long after we are gone. We all
want our architecture to be simple, yet beautiful.</p>
<p>While modern web development has evolved significantly with
frameworks like React, Vue, and Angular becoming popular choices for new
projects, understanding Backbone.js remains valuable as it teaches
fundamental concepts about application architecture and state management
that are still relevant today.</p>
<h3 id="what-is-mvc-in-modern-web-development">What Is MVC in Modern Web
Development?</h3>
<p>The Model-View-Controller (MVC) pattern, while evolved in modern
frameworks, remains an important architectural concept. Today’s
frameworks often implement variations of this pattern:</p>
<ul>
<li>Models manage application data and business logic</li>
<li>Views handle the user interface and presentation</li>
<li>Controllers (or similar concepts) manage user input and application
flow</li>
</ul>
<p>Modern frameworks have evolved these concepts: - React uses a
component-based architecture with state management - Vue combines
template-based views with reactive data models - Angular implements a
more traditional MVC-like pattern with additional features</p>
<p>Backbone.js implements its own interpretation of MVC, which we’ll
explore in detail.</p>
<h3 id="what-is-backbone.js">What is Backbone.js?</h3>
<p><img src="img/backbonejsorg.jpg" /></p>
<p>Backbone.js (current version 1.5.0) is a lightweight JavaScript
library that adds structure to client-side code. While newer frameworks
may be more popular for new projects, Backbone.js offers several
advantages:</p>
<ul>
<li>Minimal size (only 13kb minified)</li>
<li>Simple, understandable source code</li>
<li>Flexible architecture that plays well with other libraries</li>
<li>Strong focus on data modeling and state management</li>
<li>RESTful API integration</li>
<li>Excellent documentation and mature ecosystem</li>
</ul>
<p>Backbone.js is particularly valuable for: * Understanding fundamental
concepts of structured JavaScript applications * Maintaining or
upgrading legacy applications * Building lightweight applications where
minimal framework overhead is desired * Learning about event-driven
architecture and data binding</p>
<h3 id="modern-javascript-application-architecture">Modern JavaScript
Application Architecture</h3>
<p>Today’s web applications often follow these architectural
principles:</p>
<ol type="1">
<li>Component-Based Architecture
<ul>
<li>Modular, reusable pieces of UI and logic</li>
<li>Clear separation of concerns</li>
<li>Encapsulated state management</li>
</ul></li>
<li>State Management
<ul>
<li>Centralized state stores (like Redux, inspired by Backbone’s
concepts)</li>
<li>Unidirectional data flow</li>
<li>Predictable state updates</li>
</ul></li>
<li>API Integration
<ul>
<li>RESTful or GraphQL APIs</li>
<li>Real-time updates with WebSocket</li>
<li>Asynchronous data handling with Promises/async-await</li>
</ul></li>
<li>Build and Development Tools
<ul>
<li>Modern build systems (Webpack, Vite)</li>
<li>ES6+ JavaScript features</li>
<li>TypeScript for type safety</li>
</ul></li>
</ol>
<p>Backbone.js influenced many of these modern practices, particularly
in areas of: - Event-driven architecture - Model-View separation -
RESTful API integration - Client-side routing</p>
<h3 id="when-to-use-backbone.js-today">When to Use Backbone.js
Today</h3>
<p>While new projects might benefit from modern frameworks, Backbone.js
remains relevant in several scenarios:</p>
<ol type="1">
<li>Legacy Application Maintenance
<ul>
<li>Understanding and maintaining existing Backbone.js applications</li>
<li>Gradually migrating to newer technologies</li>
</ul></li>
<li>Lightweight Applications
<ul>
<li>When minimal framework overhead is desired</li>
<li>For embedded widgets or microsites</li>
</ul></li>
<li>Learning Purposes
<ul>
<li>Understanding fundamental concepts of structured JavaScript
applications</li>
<li>Learning about event-driven architecture</li>
</ul></li>
<li>Integration with Other Libraries
<ul>
<li>As part of a larger application using multiple technologies</li>
<li>When flexibility in architecture is required</li>
</ul></li>
</ol>
<h3 id="setting-expectations">Setting Expectations</h3>
<p>This book will: 1. Teach fundamental concepts of structured
JavaScript applications 2. Show how to build applications using
Backbone.js 3. Demonstrate modern JavaScript practices within
Backbone.js 4. Explain how concepts from Backbone.js influence modern
frameworks</p>
<p>The chapters will cover:</p>
<p><i>Chapter 2, Fundamentals</i>, explores MVC pattern history and
modern implementations.</p>
<p><i>Chapter 3, Backbone Basics</i>, covers core Backbone.js features
with modern JavaScript syntax.</p>
<p><i>Chapter 4, Exercise 1: Todos</i>, builds a Todo application using
current best practices.</p>
<p><i>Chapter 5, Exercise 2: Book Library</i>, creates a RESTful
application with modern API integration.</p>
<p><i>Chapter 6, Backbone Extensions</i>, explores useful extensions and
modern alternatives.</p>
<p><i>Chapter 7, Common Problems and Solutions</i>, addresses current
development challenges.</p>
<p><i>Chapter 8, Modular Development</i>, covers modern module systems
and build tools.</p>
<p><i>Chapter 9, Exercise 3: Modular Todo App</i>, rebuilds the Todo app
using modern tooling.</p>
<p><i>Chapter 10, Pagination</i>, implements modern data handling
patterns.</p>
<p><i>Chapter 11, Build Tools</i>, explores current build systems and
deployment.</p>
<p><i>Chapter 12, Mobile Applications</i>, covers responsive design and
mobile considerations.</p>
<p><i>Chapter 13-15, Testing</i>, covers modern testing practices with
Jasmine, QUnit, and SinonJS.</p>
<p><i>Chapter 16, Resources</i>, provides updated learning
resources.</p>
<p><i>Chapter 17, Conclusions</i>, reflects on Backbone.js in modern web
development.</p>
<p><i>Chapter 18, Appendix</i>, includes additional patterns and
architectural considerations.</p>
<h1 id="fundamentals">Fundamentals</h1>
<p>Design patterns remain fundamental to modern web development, helping
us create maintainable and scalable applications. While the JavaScript
ecosystem has evolved significantly, understanding these patterns is
crucial as they form the foundation of many modern frameworks and
libraries.</p>
<h2 id="mvc-and-modern-architecture">MVC and Modern Architecture</h2>
<p>The Model-View-Controller (MVC) pattern, originally designed by
Trygve Reenskaug in 1979, has evolved significantly in the web
development context. Today, we see various interpretations and
adaptations of MVC across different frameworks:</p>
<ul>
<li>React uses a component-based architecture with unidirectional data
flow</li>
<li>Vue combines reactive data models with template-based views</li>
<li>Angular implements a more traditional MVC structure with additional
features</li>
<li>Backbone.js offers its own interpretation focusing on events and
data binding</li>
</ul>
<h3 id="classical-mvc-vs-modern-implementations">Classical MVC vs Modern
Implementations</h3>
<p>Classical MVC was designed for desktop applications with a clear
separation between: * Models (data and business logic) * Views (user
interface) * Controllers (user input handling)</p>
<p>Modern web frameworks have adapted these concepts to better suit web
applications:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Classical MVC-style code</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> UserModel <span class="op">=</span> {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> { <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;&#39;</span> }<span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>() { <span class="co">/* ... */</span> }</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> UserView <span class="op">=</span> {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">render</span>() { <span class="co">/* ... */</span> }<span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>() { <span class="co">/* ... */</span> }</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> UserController <span class="op">=</span> {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">handleInput</span>() { <span class="co">/* ... */</span> }<span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateModel</span>() { <span class="co">/* ... */</span> }</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Modern Backbone.js approach</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> User <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;&#39;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validate</span>(attrs) {</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">email</span>) {</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Email is required&quot;</span><span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> UserView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>(<span class="fu">$</span>(<span class="st">&#39;#user-template&#39;</span>)<span class="op">.</span><span class="fu">html</span>())<span class="op">,</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;input .email&#39;</span><span class="op">:</span> <span class="st">&#39;updateEmail&#39;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">render</span>() {</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">template</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">toJSON</span>()))<span class="op">;</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateEmail</span>(e) {</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;email&#39;</span><span class="op">,</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="modern-web-context">Modern Web Context</h3>
<p>Today’s web applications often need to handle:</p>
<ol type="1">
<li>Complex State Management</li>
</ol>
<div class="sourceCode" id="cb2"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Backbone&#39;s event-driven state management</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> TodoApp <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">todos</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">filter</span><span class="op">:</span> <span class="st">&#39;all&#39;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> app <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoApp</span>()<span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;change:filter&#39;</span><span class="op">,</span> (model<span class="op">,</span> value) <span class="kw">=&gt;</span> {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update UI based on filter</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<ol start="2" type="1">
<li>Asynchronous Operations</li>
</ol>
<div class="sourceCode" id="cb3"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Modern async with Backbone</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> Tasks <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/api/tasks&#39;</span><span class="op">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> <span class="fu">fetchActive</span>() {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">fetch</span>({</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                <span class="dt">data</span><span class="op">:</span> { <span class="dt">status</span><span class="op">:</span> <span class="st">&#39;active&#39;</span> }</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (error) {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;Failed to fetch tasks:&#39;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<ol start="3" type="1">
<li>Real-time Updates</li>
</ol>
<div class="sourceCode" id="cb4"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> LiveFeed <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">initialize</span>() {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">websocket</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">WebSocket</span>(<span class="st">&#39;ws://api.example.com/feed&#39;</span>)<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">websocket</span><span class="op">.</span><span class="at">onmessage</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleUpdate</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">handleUpdate</span>(<span class="bu">event</span>) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> data <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="bu">event</span><span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">set</span>(data)<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="client-side-architecture">Client-Side Architecture</h3>
<p>Modern single-page applications (SPAs) require careful consideration
of:</p>
<ol type="1">
<li>Routing</li>
</ol>
<div class="sourceCode" id="cb5"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> AppRouter <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">routes</span><span class="op">:</span> {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;&#39;</span><span class="op">:</span> <span class="st">&#39;home&#39;</span><span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;users/:id&#39;</span><span class="op">:</span> <span class="st">&#39;showUser&#39;</span><span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;*notFound&#39;</span><span class="op">:</span> <span class="st">&#39;handle404&#39;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> <span class="fu">showUser</span>(id) {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">new</span> <span class="fu">User</span>({ id })<span class="op">.</span><span class="fu">fetch</span>()<span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> <span class="fu">UserView</span>({ <span class="dt">model</span><span class="op">:</span> user })<span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (error) {</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">handle404</span>()<span class="op">;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<ol start="2" type="1">
<li>State Management</li>
</ol>
<div class="sourceCode" id="cb6"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> AppState <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">localStorage</span><span class="op">:</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">LocalStorage</span>(<span class="st">&#39;app-state&#39;</span>)<span class="op">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;light&#39;</span><span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">language</span><span class="op">:</span> <span class="st">&#39;en&#39;</span><span class="op">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">lastVisited</span><span class="op">:</span> <span class="kw">null</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<ol start="3" type="1">
<li>Data Synchronization</li>
</ol>
<div class="sourceCode" id="cb7"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> SyncedModel <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">sync</span><span class="op">:</span> <span class="kw">async</span> <span class="kw">function</span>(method<span class="op">,</span> model<span class="op">,</span> options) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Custom sync logic</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> Backbone<span class="op">.</span><span class="at">sync</span><span class="op">.</span><span class="fu">call</span>(<span class="kw">this</span><span class="op">,</span> method<span class="op">,</span> model<span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Post-sync operations</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="modern-best-practices">Modern Best Practices</h3>
<p>When using Backbone.js in modern applications:</p>
<ol type="1">
<li>Use ES6+ Features</li>
</ol>
<div class="sourceCode" id="cb8"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Use classes instead of Backbone.Model.extend</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User <span class="kw">extends</span> Backbone<span class="op">.</span><span class="at">Model</span> {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">get</span> <span class="fu">fullName</span>() {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;firstName&#39;</span>)<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;lastName&#39;</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> <span class="fu">save</span>() {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">await</span> <span class="kw">super</span><span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;savedSuccessfully&#39;</span>)<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (error) {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;saveError&#39;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="2" type="1">
<li>Implement Type Safety</li>
</ol>
<div class="sourceCode" id="cb9"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Using JSDoc for better IDE support</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@typedef</span><span class="co"> </span><span class="do">{Object}</span><span class="co"> </span><span class="do">UserAttributes</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@property</span><span class="co"> </span><span class="cv">{string}</span><span class="co"> firstName</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@property</span><span class="co"> </span><span class="cv">{string}</span><span class="co"> lastName</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@property</span><span class="co"> </span><span class="cv">{string}</span><span class="co"> email</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@extends</span><span class="co"> </span><span class="cv">{Backbone.Model&lt;UserAttributes&gt;}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TypedUser <span class="kw">extends</span> Backbone<span class="op">.</span><span class="at">Model</span> {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">defaults</span>() {</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;&#39;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="3" type="1">
<li>Use Modern Build Tools</li>
</ol>
<div class="sourceCode" id="cb10"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// webpack.config.js</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">entry</span><span class="op">:</span> <span class="st">&#39;./src/app.js&#39;</span><span class="op">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">output</span><span class="op">:</span> {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">filename</span><span class="op">:</span> <span class="st">&#39;bundle.js&#39;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">module</span><span class="op">:</span> {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rules</span><span class="op">:</span> [</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                <span class="dt">test</span><span class="op">:</span> <span class="ss">/</span><span class="sc">\.</span><span class="ss">js</span><span class="sc">$</span><span class="ss">/</span><span class="op">,</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">use</span><span class="op">:</span> <span class="st">&#39;babel-loader&#39;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 id="summary">Summary</h3>
<p>While modern frameworks may have different approaches to structuring
applications, the fundamental principles of MVC remain relevant:</p>
<ul>
<li>Separation of concerns</li>
<li>Data management</li>
<li>UI updates</li>
<li>Event handling</li>
</ul>
<p>Backbone.js implements these principles in a lightweight, flexible
way that can still be valuable in modern web development, especially
when:</p>
<ul>
<li>Building lightweight applications</li>
<li>Maintaining legacy systems</li>
<li>Learning fundamental architectural concepts</li>
<li>Needing flexible, event-driven architecture</li>
</ul>
<p>Understanding these fundamentals helps developers make better
architectural decisions, regardless of the framework they choose to
use.</p>
<h1 id="backbone-basics">Backbone Basics</h1>
<p>In this section, you’ll learn the essentials of Backbone’s models,
views, collections, events, and routers. This isn’t by any means a
replacement for the official documentation, but it will help you
understand many of the core concepts behind Backbone before you start
building applications using it.</p>
<h3 id="getting-set-up">Getting set up</h3>
<p>Before we dive into more code examples, let’s define some boilerplate
markup you can use to specify the dependencies Backbone requires. This
boilerplate can be reused in many ways with little to no alteration and
will allow you to run code from examples with ease.</p>
<p>You can paste the following into your text editor of choice,
replacing the commented line between the script tags with the JavaScript
from any given example:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>HTML<span class="dt">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;UTF-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Title<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;http://underscorejs.org/underscore-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;http://backbonejs.org/backbone-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Your code goes here</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>You can then save and run the file in your browser of choice, such as
Chrome or Firefox. Alternatively, if you prefer working with an online
code editor, <a href="http://jsfiddle.net/jnf8B/">jsFiddle</a> and <a
href="http://jsbin.com/iwiwox/1/edit">jsBin</a> versions of this
boilerplate are also available.</p>
<p>Most examples can also be run directly from within the console in
your browser’s developer tools, assuming you’ve loaded the boilerplate
HTML page so that Backbone and its dependencies are available for
use.</p>
<p>For Chrome, you can open up the DevTools via the Chrome menu in the
top right hand corner: select “Tools &gt; Developer Tools” or
alternatively use the Control + Shift + I shortcut on Windows/Linux or
Command + Option + I on Mac.</p>
<p><img src="img/devtools.png" /></p>
<p>Next, switch to the Console tab, from where you can enter in and run
any piece of JavaScript code by hitting the return key. You can also use
the Console as a multi-line editor using the Shift + Enter shortcut on
Windows/Linux, or Ctrl + Enter shortcut on Mac to move from the end of
one line to the start of another.</p>
<h2 id="models">Models</h2>
<p>Backbone models contain data for an application as well as the logic
around this data. For example, we can use a model to represent the
concept of a todo item including its attributes like title (todo
content) and completed (current state of the todo).</p>
<p>Models can be created by extending <code>Backbone.Model</code> as
follows:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">// We can then create our own concrete instance of a (Todo) model</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">// with no values at all:</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo1 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Following logs: {}</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(todo1))<span class="op">;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">// or with some arbitrary data:</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Check the attributes of both model instances in the console.&#39;</span><span class="op">,</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Following logs: {&quot;title&quot;:&quot;Check the attributes of both model instances in the console.&quot;,&quot;completed&quot;:true}</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(todo2))<span class="op">;</span></span></code></pre></div>
<h4 id="initialization">Initialization</h4>
<p>The <code>initialize()</code> method is called when a new instance of
a model is created. Its use is optional; however you’ll see why it’s
good practice to use it below.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;This model has been initialized.&#39;</span>)<span class="op">;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Logs: This model has been initialized.</span></span></code></pre></div>
<p><strong>Default values</strong></p>
<p>There are times when you want your model to have a set of default
values (e.g., in a scenario where a complete set of data isn’t provided
by the user). This can be set using a property called
<code>defaults</code> in your model.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default todo attribute values</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Now we can create our concrete instance of the model</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">// with default values as follows:</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo1 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Following logs: {&quot;title&quot;:&quot;&quot;,&quot;completed&quot;:false}</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(todo1))<span class="op">;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Or we could instantiate it with some of the attributes (e.g., with custom title):</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Check attributes of the logged models in the console.&#39;</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Following logs: {&quot;title&quot;:&quot;Check attributes of the logged models in the console.&quot;,&quot;completed&quot;:false}</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(todo2))<span class="op">;</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Or override all of the default attributes:</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo3 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;This todo is done, so take no action on this one.&#39;</span><span class="op">,</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Following logs: {&quot;title&quot;:&quot;This todo is done, so take no action on this one.&quot;,&quot;completed&quot;:true} </span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(todo3))<span class="op">;</span></span></code></pre></div>
<h4 id="getters-setters">Getters &amp; Setters</h4>
<p><strong>Model.get()</strong></p>
<p><code>Model.get()</code> provides easy access to a model’s
attributes.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default todo attribute values</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo1 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo1<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span> <span class="co">// empty string</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo1<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>))<span class="op">;</span> <span class="co">// false</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Retrieved with model&#39;s get() method.&quot;</span><span class="op">,</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo2<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span> <span class="co">// Retrieved with model&#39;s get() method.</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo2<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>))<span class="op">;</span> <span class="co">// true</span></span></code></pre></div>
<p>If you need to read or clone all of a model’s data attributes, use
its <code>toJSON()</code> method. This method returns a copy of the
attributes as an object (not a JSON string despite its name). (When
<code>JSON.stringify()</code> is passed an object with a
<code>toJSON()</code> method, it stringifies the return value of
<code>toJSON()</code> instead of the original object. The examples in
the previous section took advantage of this feature when they called
<code>JSON.stringify()</code> to log model instances.)</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default todo attribute values</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo1 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo1Attributes <span class="op">=</span> todo1<span class="op">.</span><span class="fu">toJSON</span>()<span class="op">;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Following logs: {&quot;title&quot;:&quot;&quot;,&quot;completed&quot;:false} </span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo1Attributes)<span class="op">;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Try these examples and check results in console.&quot;</span><span class="op">,</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">// logs: {&quot;title&quot;:&quot;Try these examples and check results in console.&quot;,&quot;completed&quot;:true}</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo2<span class="op">.</span><span class="fu">toJSON</span>())<span class="op">;</span></span></code></pre></div>
<p><strong>Model.set()</strong></p>
<p><code>Model.set()</code> sets a hash containing one or more
attributes on the model. When any of these attributes alter the state of
the model, a “change” event is triggered on it. Change events for each
attribute are also triggered and can be bound to
(e.g. <code>change:name</code>, <code>change:age</code>).</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default todo attribute values</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Setting the value of attributes via instantiation</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Set through instantiation.&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Todo title: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span> <span class="co">// Todo title: Set through instantiation.</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Completed: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>))<span class="op">;</span> <span class="co">// Completed: false</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Set single attribute value at a time through Model.set():</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;title&quot;</span><span class="op">,</span> <span class="st">&quot;Title attribute set through Model.set().&quot;</span>)<span class="op">;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Todo title: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span> <span class="co">// Todo title: Title attribute set through Model.set().</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Completed: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>))<span class="op">;</span> <span class="co">// Completed: false</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Set map of attributes through Model.set():</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>({</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Both attributes set through Model.set().&quot;</span><span class="op">,</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Todo title: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span> <span class="co">// Todo title: Both attributes set through Model.set().</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Completed: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>))<span class="op">;</span> <span class="co">// Completed: true</span></span></code></pre></div>
<p><strong>Direct access</strong></p>
<p>Models expose an <code>.attributes</code> attribute which represents
an internal hash containing the state of that model. This is generally
in the form of a JSON object similar to the model data you might find on
the server but can take other forms.</p>
<p>Setting values through the <code>.attributes</code> attribute on a
model bypasses triggers bound to the model.</p>
<p>Passing <code>{silent:true}</code> on set doesn’t delay individual
<code>"change:attr"</code> events. Instead they are silenced
entirely:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Person <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>()<span class="op">;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Person<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;change:name&quot;</span><span class="op">,</span> <span class="kw">function</span>() { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Name changed&#39;</span>)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>Person<span class="op">.</span><span class="fu">set</span>({<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Andrew&#39;</span>})<span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">// log entry: Name changed</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>Person<span class="op">.</span><span class="fu">set</span>({<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Jeremy&#39;</span>}<span class="op">,</span> {<span class="dt">silent</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">// no log entry</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(Person<span class="op">.</span><span class="fu">hasChanged</span>(<span class="st">&quot;name&quot;</span>))<span class="op">;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">// true: change was recorded</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(Person<span class="op">.</span><span class="fu">hasChanged</span>(<span class="kw">null</span>))<span class="op">;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">// true: something (anything) has changed</span></span></code></pre></div>
<p>Remember where possible it is best practice to use
<code>Model.set()</code>, or direct instantiation as explained
earlier.</p>
<h4 id="listening-for-changes-to-your-model">Listening for changes to
your model</h4>
<p>If you want to receive a notification when a Backbone model changes
you can bind a listener to the model for its change event. A convenient
place to add listeners is in the <code>initialize()</code> function as
shown below:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default todo attribute values</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;This model has been initialized.&#39;</span>)<span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;- Values for this model have changed.&#39;</span>)<span class="op">;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;The listener is triggered whenever an attribute value changes.&#39;</span>)<span class="op">;</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Title has changed: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;completed&#39;</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Completed has changed: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>))<span class="op">;</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>({</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Changing more than one attribute at the same time only triggers the listener once.&#39;</span><span class="op">,</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Above logs:</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co">// This model has been initialized.</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="co">// - Values for this model have changed.</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Title has changed: The listener is triggered whenever an attribute value changes.</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co">// - Values for this model have changed.</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co">// Completed has changed: true</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="co">// - Values for this model have changed.</span></span></code></pre></div>
<p>You can also listen for changes to individual attributes in a
Backbone model. In the following example, we log a message whenever a
specific attribute (the title of our Todo model) is altered.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default todo attribute values</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;This model has been initialized.&#39;</span>)<span class="op">;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;change:title&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Title value for this model has changed.&#39;</span>)<span class="op">;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">setTitle</span><span class="op">:</span> <span class="kw">function</span>(newTitle){</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">set</span>({ <span class="dt">title</span><span class="op">:</span> newTitle })<span class="op">;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Both of the following changes trigger the listener:</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;Check what</span><span class="sc">\&#39;</span><span class="st">s logged.&#39;</span>)<span class="op">;</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">setTitle</span>(<span class="st">&#39;Go fishing on Sunday.&#39;</span>)<span class="op">;</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">// But, this change type is not observed, so no listener is triggered:</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;completed&#39;</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Todo set as completed: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>))<span class="op">;</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Above logs:</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co">// This model has been initialized.</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Title value for this model has changed.</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co">// Title value for this model has changed.</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="co">// Todo set as completed: true</span></span></code></pre></div>
<h4 id="validation">Validation</h4>
<p>Backbone supports model validation through
<code>model.validate()</code>, which allows checking the attribute
values for a model prior to setting them. By default, validation occurs
when the model is persisted using the <code>save()</code> method or when
<code>set()</code> is called if <code>{validate:true}</code> is passed
as an argument.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Person <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>({<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Jeremy&#39;</span>})<span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Validate the model name</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>Person<span class="op">.</span><span class="at">validate</span> <span class="op">=</span> <span class="kw">function</span>(attrs) {</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">name</span>) {</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&#39;I need your name&#39;</span><span class="op">;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Change the name</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>Person<span class="op">.</span><span class="fu">set</span>({<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Samuel&#39;</span>})<span class="op">;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(Person<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;name&#39;</span>))<span class="op">;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">// &#39;Samuel&#39;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove the name attribute, force validation</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>Person<span class="op">.</span><span class="fu">unset</span>(<span class="st">&#39;name&#39;</span><span class="op">,</span> {<span class="dt">validate</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">// false</span></span></code></pre></div>
<p>Above, we also use the <code>unset()</code> method, which removes an
attribute by deleting it from the internal model attributes hash.</p>
<p>Validation functions can be as simple or complex as necessary. If the
attributes provided are valid, nothing should be returned from
<code>.validate()</code>. If they are invalid, an error value should be
returned instead.</p>
<p>Should an error be returned:</p>
<ul>
<li>An <code>invalid</code> event will be triggered, setting the
<code>validationError</code> property on the model with the value which
is returned by this method.</li>
<li><code>.save()</code> will not continue and the attributes of the
model will not be modified on the server.</li>
</ul>
<p>A more complete validation example can be seen below:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">validate</span><span class="op">:</span> <span class="kw">function</span>(attributes){</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(attributes<span class="op">.</span><span class="at">title</span> <span class="op">===</span> <span class="kw">undefined</span>){</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;Remember to set a title for your todo.&quot;</span><span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;This model has been initialized.&#39;</span>)<span class="op">;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;invalid&quot;</span><span class="op">,</span> <span class="kw">function</span>(model<span class="op">,</span> error){</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(error)<span class="op">;</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;completed&#39;</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> {<span class="dt">validate</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span> <span class="co">// logs: Remember to set a title for your todo.</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;completed: &#39;</span> <span class="op">+</span> myTodo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>))<span class="op">;</span> <span class="co">// completed: false</span></span></code></pre></div>
<p><strong>Note</strong>: the <code>attributes</code> object passed to
the <code>validate</code> function represents what the attributes would
be after completing the current <code>set()</code> or
<code>save()</code>. This object is distinct from the current attributes
of the model and from the parameters passed to the operation. Since it
is created by shallow copy, it is not possible to change any Number,
String, or Boolean attribute of the input within the function, but it
<em>is</em> possible to change attributes in nested objects.</p>
<p>An example of this (by <span class="citation"
data-cites="fivetanley">@fivetanley</span>) is available <a
href="http://jsfiddle.net/2NdDY/270/">here</a>.</p>
<p>Note also, that validation on initialization is possible but of
limited use, as the object being constructed is internally marked
invalid but nevertheless passed back to the caller (continuing the above
example):</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> emptyTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>(<span class="kw">null</span><span class="op">,</span> {<span class="dt">validate</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(emptyTodo<span class="op">.</span><span class="at">validationError</span>)<span class="op">;</span></span></code></pre></div>
<h2 id="views">Views</h2>
<p>Views in Backbone don’t contain the HTML markup for your application;
they contain the logic behind the presentation of the model’s data to
the user. This is usually achieved using JavaScript templating (e.g.,
Underscore Microtemplates, Mustache, jQuery-tmpl, etc.). A view’s
<code>render()</code> method can be bound to a model’s
<code>change()</code> event, enabling the view to instantly reflect
model changes without requiring a full page refresh.</p>
<h4 id="creating-new-views">Creating new views</h4>
<p>Creating a new view is relatively straightforward and similar to
creating new models. To create a new View, simply extend
<code>Backbone.View</code>. We introduced the sample TodoView below in
the previous chapter; now let’s take a closer look at how it works:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">tagName</span><span class="op">:</span>  <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cache the template function for a single item.</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">todoTpl</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>( <span class="st">&quot;An example template&quot;</span> )<span class="op">,</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;dblclick label&#39;</span><span class="op">:</span> <span class="st">&#39;edit&#39;</span><span class="op">,</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;keypress .edit&#39;</span><span class="op">:</span> <span class="st">&#39;updateOnEnter&#39;</span><span class="op">,</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;blur .edit&#39;</span><span class="op">:</span>   <span class="st">&#39;close&#39;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span> (options) {</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// In Backbone 1.1.0, if you want to access passed options in</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// your view, you will need to save them as follows:</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">options</span> <span class="op">=</span> options <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Re-render the title of the todo item.</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>( <span class="kw">this</span><span class="op">.</span><span class="fu">todoTpl</span>( <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span> ) )<span class="op">;</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">input</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.edit&#39;</span>)<span class="op">;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">edit</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// executed when todo label is double clicked</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">close</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// executed when todo loses focus</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">updateOnEnter</span><span class="op">:</span> <span class="kw">function</span>( e ) {</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// executed on each keypress when in todo edit mode,</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// but we&#39;ll wait for enter to get in action</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todoView <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoView</span>()<span class="op">;</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="co">// log reference to a DOM element that corresponds to the view instance</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todoView<span class="op">.</span><span class="at">el</span>)<span class="op">;</span> <span class="co">// logs &lt;li&gt;&lt;/li&gt;</span></span></code></pre></div>
<h4 id="what-is-el">What is <code>el</code>?</h4>
<p>The central property of a view is <code>el</code> (the value logged
in the last statement of the example). What is <code>el</code> and how
is it defined?</p>
<p><code>el</code> is basically a reference to a DOM element and all
views must have one. Views can use <code>el</code> to compose their
element’s content and then insert it into the DOM all at once, which
makes for faster rendering because the browser performs the minimum
required number of reflows and repaints.</p>
<p>There are two ways to associate a DOM element with a view: a new
element can be created for the view and subsequently added to the DOM or
a reference can be made to an element which already exists in the
page.</p>
<p>If you want to create a new element for your view, set any
combination of the following properties on the view:
<code>tagName</code>, <code>id</code>, and <code>className</code>. A new
element will be created for you by the library and a reference to it
will be available at the <code>el</code> property. If nothing is
specified <code>tagName</code> defaults to <code>div</code>.</p>
<p>In the example above, <code>tagName</code> is set to ‘li’, resulting
in creation of an li element. The following example creates a ul element
with id and class attributes:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">tagName</span><span class="op">:</span> <span class="st">&#39;ul&#39;</span><span class="op">,</span> <span class="co">// required, but defaults to &#39;div&#39; if not set</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">className</span><span class="op">:</span> <span class="st">&#39;container&#39;</span><span class="op">,</span> <span class="co">// optional, you can assign multiple classes to </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                          <span class="co">// this property like so: &#39;container homepage&#39;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="st">&#39;todos&#39;</span> <span class="co">// optional</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todosView <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodosView</span>()<span class="op">;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todosView<span class="op">.</span><span class="at">el</span>)<span class="op">;</span> <span class="co">// logs &lt;ul id=&quot;todos&quot; class=&quot;container&quot;&gt;&lt;/ul&gt;</span></span></code></pre></div>
<p>The above code creates the DOM element below but doesn’t append it to
the DOM.</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">ul</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;todos&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;container&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span></code></pre></div>
<p>If the element already exists in the page, you can set
<code>el</code> as a CSS selector that matches the element.</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>el<span class="op">:</span> <span class="st">&#39;#footer&#39;</span></span></code></pre></div>
<p>Alternatively, you can set <code>el</code> to an existing element
when creating the view:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todosView <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodosView</span>({<span class="dt">el</span><span class="op">:</span> <span class="fu">$</span>(<span class="st">&#39;#footer&#39;</span>)})<span class="op">;</span></span></code></pre></div>
<p>Note: When declaring a View, <code>options</code>, <code>el</code>,
<code>tagName</code>, <code>id</code> and <code>className</code> may be
defined as functions, if you want their values to be determined at
runtime.</p>
<p><strong>$el and $()</strong></p>
<p>View logic often needs to invoke jQuery or Zepto functions on the
<code>el</code> element and elements nested within it. Backbone makes it
easy to do so by defining the <code>$el</code> property and
<code>$()</code> function. The <code>view.$el</code> property is
equivalent to <code>$(view.el)</code> and <code>view.$(selector)</code>
is equivalent to <code>$(view.el).find(selector)</code>. In our TodoView
example’s render method, we see <code>this.$el</code> used to set the
HTML of the element and <code>this.$()</code> used to find subelements
of class ‘edit’.</p>
<p><strong>setElement</strong></p>
<p>If you need to apply an existing Backbone view to a different DOM
element <code>setElement</code> can be used for this purpose. Overriding
this.el needs to both change the DOM reference and re-bind events to the
new element (and unbind from the old).</p>
<p><code>setElement</code> will create a cached <code>$el</code>
reference for you, moving the delegated events for a view from the old
element to the new one.</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">// We create two DOM elements representing buttons</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">// which could easily be containers or something else</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> button1 <span class="op">=</span> <span class="fu">$</span>(<span class="st">&#39;&lt;button&gt;&lt;/button&gt;&#39;</span>)<span class="op">;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> button2 <span class="op">=</span> <span class="fu">$</span>(<span class="st">&#39;&lt;button&gt;&lt;/button&gt;&#39;</span>)<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a new view</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> View <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">click</span><span class="op">:</span> <span class="kw">function</span>(e) {</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(view<span class="op">.</span><span class="at">el</span> <span class="op">===</span> e<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a new instance of the view, applying it</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">// to button1</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> view <span class="op">=</span> <span class="kw">new</span> <span class="fu">View</span>({<span class="dt">el</span><span class="op">:</span> button1})<span class="op">;</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply the view to button2 using setElement</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>view<span class="op">.</span><span class="fu">setElement</span>(button2)<span class="op">;</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>button1<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;click&#39;</span>)<span class="op">;</span> </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>button2<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;click&#39;</span>)<span class="op">;</span> <span class="co">// returns true</span></span></code></pre></div>
<p>The “el” property represents the markup portion of the view that will
be rendered; to get the view to actually render to the page, you need to
add it as a new element or append it to an existing element.</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">// We can also provide raw markup to setElement</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">// as follows (just to demonstrate it can be done):</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> view <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>view<span class="op">.</span><span class="fu">setElement</span>(<span class="st">&#39;&lt;p&gt;&lt;a&gt;&lt;b&gt;test&lt;/b&gt;&lt;/a&gt;&lt;/p&gt;&#39;</span>)<span class="op">;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(view<span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;a b&#39;</span>)<span class="op">.</span><span class="fu">html</span>())<span class="op">;</span> <span class="co">// outputs &quot;test&quot;</span></span></code></pre></div>
<p><strong>Understanding <code>render()</code></strong></p>
<p><code>render()</code> is an optional function that defines the logic
for rendering a template. We’ll use Underscore’s micro-templating in
these examples, but remember you can use other templating frameworks if
you prefer. Our example will reference the following HTML markup:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">&quot;en&quot;</span><span class="dt">&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;utf-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;description&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;&quot;</span><span class="dt">&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;todo&quot;</span><span class="dt">&gt;</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;item-template&quot;</span><span class="dt">&gt;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div<span class="op">&gt;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>input id<span class="op">=</span><span class="st">&quot;todo_complete&quot;</span> type<span class="op">=</span><span class="st">&quot;checkbox&quot;</span> <span class="op">&lt;%=</span> completed <span class="op">?</span> <span class="st">&#39;checked=&quot;checked&quot;&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span> <span class="op">%&gt;&gt;</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;%=</span> title <span class="op">%&gt;</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;jquery-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;underscore-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;backbone-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;example.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>The <code>_.template</code> method in Underscore compiles JavaScript
templates into functions which can be evaluated for rendering. In the
TodoView, I’m passing the markup from the template with id
<code>item-template</code> to <code>_.template()</code> to be compiled
and stored in the todoTpl property when the view is created.</p>
<p>The <code>render()</code> method uses this template by passing it the
<code>toJSON()</code> encoding of the attributes of the model associated
with the view. The template returns its markup after using the model’s
title and completed flag to evaluate the expressions containing them. I
then set this markup as the HTML content of the <code>el</code> DOM
element using the <code>$el</code> property.</p>
<p>Presto! This populates the template, giving you a data-complete set
of markup in just a few short lines of code.</p>
<p>A common Backbone convention is to return <code>this</code> at the
end of <code>render()</code>. This is useful for a number of reasons,
including:</p>
<ul>
<li>Making views easily reusable in other parent views.</li>
<li>Creating a list of elements without rendering and painting each of
them individually, only to be drawn once the entire list is
populated.</li>
</ul>
<p>Let’s try to implement the latter of these. The <code>render</code>
method of a simple ListView which doesn’t use an ItemView for each item
could be written:</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ListView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compile a template for this view. In this case &#39;...&#39;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// is a placeholder for a template such as </span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// $(&quot;#list_template&quot;).html() </span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>(…)<span class="op">,</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">template</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span>))<span class="op">;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Simple enough. Let’s now assume a decision is made to construct the
items using an ItemView to provide enhanced behaviour to our list. The
ItemView could be written:</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ItemView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">events</span><span class="op">:</span> {}<span class="op">,</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">template</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span>))<span class="op">;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Note the usage of <code>return this;</code> at the end of
<code>render</code>. This common pattern enables us to reuse the view as
a sub-view. We can also use it to pre-render the view prior to
rendering. Using this requires that we make a change to our ListView’s
<code>render</code> method as follows:</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ListView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Assume our model exposes the items we will</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// display in our list</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> items <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;items&#39;</span>)<span class="op">;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Loop through each of our items using the Underscore</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// _.each iterator</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    _<span class="op">.</span><span class="fu">each</span>(items<span class="op">,</span> <span class="kw">function</span>(item){</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Create a new instance of the ItemView, passing </span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// it a specific model item</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> itemView <span class="op">=</span> <span class="kw">new</span> <span class="fu">ItemView</span>({ <span class="dt">model</span><span class="op">:</span> item })<span class="op">;</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">// The itemView&#39;s DOM element is appended after it</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">// has been rendered. Here, the &#39;return this&#39; is helpful</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>      <span class="co">// as the itemView renders its model. Later, we ask for </span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">// its output (&quot;el&quot;)</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">append</span>( itemView<span class="op">.</span><span class="fu">render</span>()<span class="op">.</span><span class="at">el</span> )<span class="op">;</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>The <code>events</code> hash</strong></p>
<p>The Backbone <code>events</code> hash allows us to attach event
listeners to either <code>el</code>-relative custom selectors, or
directly to <code>el</code> if no selector is provided. An event takes
the form of a key-value pair
<code>'eventName selector': 'callbackFunction'</code> and a number of
DOM event-types are supported, including <code>click</code>,
<code>submit</code>, <code>mouseover</code>, <code>dblclick</code> and
more.</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">// A sample view</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">tagName</span><span class="op">:</span>  <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// with an events hash containing DOM events</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// specific to an item:</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;click .toggle&#39;</span><span class="op">:</span> <span class="st">&#39;toggleCompleted&#39;</span><span class="op">,</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;dblclick label&#39;</span><span class="op">:</span> <span class="st">&#39;edit&#39;</span><span class="op">,</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;keypress .edit&#39;</span><span class="op">:</span> <span class="st">&#39;updateOnEnter&#39;</span><span class="op">,</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;click .destroy&#39;</span><span class="op">:</span> <span class="st">&#39;clear&#39;</span><span class="op">,</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;blur .edit&#39;</span><span class="op">:</span> <span class="st">&#39;close&#39;</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span></code></pre></div>
<p>What isn’t instantly obvious is that while Backbone uses jQuery’s
<code>.delegate()</code> underneath, it goes further by extending it so
that <code>this</code> always refers to the current view object within
callback functions. The only thing to really keep in mind is that any
string callback supplied to the events attribute must have a
corresponding function with the same name within the scope of your
view.</p>
<p>The declarative, delegated jQuery events means that you don’t have to
worry about whether a particular element has been rendered to the DOM
yet or not. Usually with jQuery you have to worry about “presence or
absence in the DOM” all the time when binding events.</p>
<p>In our TodoView example, the edit callback is invoked when the user
double-clicks a label element within the <code>el</code> element,
updateOnEnter is called for each keypress in an element with class
‘edit’, and close executes when an element with class ‘edit’ loses
focus. Each of these callback functions can use <code>this</code> to
refer to the TodoView object.</p>
<p>Note that you can also bind methods yourself using
<code>_.bind(this.viewEvent, this)</code>, which is effectively what the
value in each event’s key-value pair is doing. Below we use
<code>_.bind</code> to re-render our view when a model changes.</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">bind</span>(<span class="st">&#39;change&#39;</span><span class="op">,</span> _<span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span><span class="op">.</span><span class="at">render</span><span class="op">,</span> <span class="kw">this</span>))<span class="op">;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><code>_.bind</code> only works on one method at a time, but
effectively binds a function to an object so that anytime the function
is called the value of <code>this</code> will be the object.
<code>_.bind</code> also supports passing in arguments to the function
in order to fill them in advance - a technique known as <a
href="http://benalman.com/news/2012/09/partial-application-in-javascript/">partial
application</a>.</p>
<h2 id="collections">Collections</h2>
<p>Collections are sets of Models and are created by extending
<code>Backbone.Collection</code>.</p>
<p>Normally, when creating a collection you’ll also want to define a
property specifying the type of model that your collection will contain,
along with any instance properties required.</p>
<p>In the following example, we create a TodoCollection that will
contain our Todo models:</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosCollection <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Todo</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({<span class="dt">title</span><span class="op">:</span><span class="st">&#39;Read the whole book&#39;</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span>})<span class="op">;</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">// pass array of models on collection instantiation</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodosCollection</span>([myTodo])<span class="op">;</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Collection size: &quot;</span> <span class="op">+</span> todos<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="co">// Collection size: 1</span></span></code></pre></div>
<h4 id="adding-and-removing-models">Adding and Removing Models</h4>
<p>The preceding example populated the collection using an array of
models when it was instantiated. After a collection has been created,
models can be added and removed using the <code>add()</code> and
<code>remove()</code> methods:</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosCollection <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Todo</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> a <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({ <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Go to Jamaica.&#39;</span>})<span class="op">,</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({ <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Go to China.&#39;</span>})<span class="op">,</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({ <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Go to Disneyland.&#39;</span>})<span class="op">;</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodosCollection</span>([a<span class="op">,</span>b])<span class="op">;</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Collection size: &quot;</span> <span class="op">+</span> todos<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Logs: Collection size: 2</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">add</span>(c)<span class="op">;</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Collection size: &quot;</span> <span class="op">+</span> todos<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Logs: Collection size: 3</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">remove</span>([a<span class="op">,</span>b])<span class="op">;</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Collection size: &quot;</span> <span class="op">+</span> todos<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co">// Logs: Collection size: 1</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">remove</span>(c)<span class="op">;</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Collection size: &quot;</span> <span class="op">+</span> todos<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Logs: Collection size: 0</span></span></code></pre></div>
<p>Note that <code>add()</code> and <code>remove()</code> accept both
individual models and lists of models.</p>
<p>Also note that when using <code>add()</code> on a collection, passing
<code>{merge: true}</code> causes duplicate models to have their
attributes merged in to the existing models, instead of being
ignored.</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> items <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>items<span class="op">.</span><span class="fu">add</span>([{ <span class="dt">id</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Dog&quot;</span> <span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">3</span>}<span class="op">,</span> { <span class="dt">id</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;cat&quot;</span> <span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">2</span>}])<span class="op">;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>items<span class="op">.</span><span class="fu">add</span>([{ <span class="dt">id</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Bear&quot;</span> }]<span class="op">,</span> {<span class="dt">merge</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>items<span class="op">.</span><span class="fu">add</span>([{ <span class="dt">id</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;lion&quot;</span> }])<span class="op">;</span> <span class="co">// merge: false</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(items<span class="op">.</span><span class="fu">toJSON</span>()))<span class="op">;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">// [{&quot;id&quot;:1,&quot;name&quot;:&quot;Bear&quot;,&quot;age&quot;:3},{&quot;id&quot;:2,&quot;name&quot;:&quot;cat&quot;,&quot;age&quot;:2}]</span></span></code></pre></div>
<h4 id="retrieving-models">Retrieving Models</h4>
<p>There are a few different ways to retrieve a model from a collection.
The most straight-forward is to use <code>Collection.get()</code> which
accepts a single id as follows:</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({<span class="dt">title</span><span class="op">:</span><span class="st">&#39;Read the whole book&#39;</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span>})<span class="op">;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">// pass array of models on collection instantiation</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodosCollection</span>([myTodo])<span class="op">;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo2 <span class="op">=</span> todos<span class="op">.</span><span class="fu">get</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Models, as objects, are passed by reference</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo2 <span class="op">===</span> myTodo)<span class="op">;</span> <span class="co">// true</span></span></code></pre></div>
<p>In client-server applications, collections contain models obtained
from the server. Anytime you’re exchanging data between the client and a
server, you will need a way to uniquely identify models. In Backbone,
this is done using the <code>id</code>, <code>cid</code>, and
<code>idAttribute</code> properties.</p>
<p>Each model in Backbone has an <code>id</code>, which is a unique
identifier that is either an integer or string (e.g., a UUID). Models
also have a <code>cid</code> (client id) which is automatically
generated by Backbone when the model is created. Either identifier can
be used to retrieve a model from a collection.</p>
<p>The main difference between them is that the <code>cid</code> is
generated by Backbone; it is helpful when you don’t have a true id -
this may be the case if your model has yet to be saved to the server or
you aren’t saving it to a database.</p>
<p>The <code>idAttribute</code> is the identifying attribute name of the
model returned from the server (i.e. the <code>id</code> in your
database). This tells Backbone which data field from the server should
be used to populate the <code>id</code> property (think of it as a
mapper). By default, it assumes <code>id</code>, but this can be
customized as needed. For instance, if your server sets a unique
attribute on your model named “userId” then you would set
<code>idAttribute</code> to “userId” in your model definition.</p>
<p>The value of a model’s idAttribute should be set by the server when
the model is saved. After this point you shouldn’t need to set it
manually, unless further control is required.</p>
<p>Internally, <code>Backbone.Collection</code> contains an array of
models enumerated by their <code>id</code> property, if the model
instances happen to have one. When <code>collection.get(id)</code> is
called, this array is checked for existence of the model instance with
the corresponding <code>id</code>.</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">// extends the previous example</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todoCid <span class="op">=</span> todos<span class="op">.</span><span class="fu">get</span>(todo2<span class="op">.</span><span class="at">cid</span>)<span class="op">;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">// As mentioned in previous example, </span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">// models are passed by reference</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todoCid <span class="op">===</span> myTodo)<span class="op">;</span> <span class="co">// true</span></span></code></pre></div>
<h4 id="listening-for-events">Listening for events</h4>
<p>As collections represent a group of items, we can listen for
<code>add</code> and <code>remove</code> events which occur when models
are added to or removed from a collection. Here’s an example:</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosCollection <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>()<span class="op">;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;add&quot;</span><span class="op">,</span> <span class="kw">function</span>(todo) {</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;I should &quot;</span> <span class="op">+</span> todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;title&quot;</span>) <span class="op">+</span> <span class="st">&quot;. Have I done it before? &quot;</span>  <span class="op">+</span> (todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;completed&quot;</span>) <span class="op">?</span> <span class="st">&#39;Yeah!&#39;</span><span class="op">:</span> <span class="st">&#39;No.&#39;</span> ))<span class="op">;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">add</span>([</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Jamaica&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to China&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Disneyland&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">// The above logs:</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">// I should go to Jamaica. Have I done it before? No.</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">// I should go to China. Have I done it before? No.</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">// I should go to Disneyland. Have I done it before? Yeah!</span></span></code></pre></div>
<p>In addition, we’re also able to bind to a <code>change</code> event
to listen for changes to any of the models in the collection.</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosCollection <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>()<span class="op">;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">// log a message if a model in the collection changes</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;change:title&quot;</span><span class="op">,</span> <span class="kw">function</span>(model) {</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Changed my mind! I should &quot;</span> <span class="op">+</span> model<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">add</span>([</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Jamaica.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="dv">3</span> }<span class="op">,</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodo <span class="op">=</span> TodosCollection<span class="op">.</span><span class="fu">get</span>(<span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;go fishing&#39;</span>)<span class="op">;</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Logs: Changed my mind! I should go fishing</span></span></code></pre></div>
<p>jQuery-style event maps of the form
<code>obj.on({click: action})</code> can also be used. These can be
clearer than needing three separate calls to <code>.on</code> and should
align better with the events hash used in Views:</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Buy some cookies&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">on</span>({</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>   <span class="st">&#39;change:title&#39;</span> <span class="op">:</span> titleChanged<span class="op">,</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>   <span class="st">&#39;change:completed&#39;</span> <span class="op">:</span> stateChanged</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">titleChanged</span>(){</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;The title was changed!&#39;</span>)<span class="op">;</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">stateChanged</span>(){</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;The state was changed!&#39;</span>)<span class="op">;</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>myTodo<span class="op">.</span><span class="fu">set</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Get the groceries&#39;</span>})<span class="op">;</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co">// The title was changed! </span></span></code></pre></div>
<p>Backbone events also support a <a
href="http://backbonejs.org/#Events-once">once()</a> method, which
ensures that a callback only fires one time when a notification arrives.
It is similar to Node’s <a
href="http://nodejs.org/api/events.html#events_emitter_once_event_listener">once</a>,
or jQuery’s <a href="http://api.jquery.com/one/">one</a>. This is
particularly useful for when you want to say “the next time something
happens, do this”.</p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Define an object with two counters</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoCounter <span class="op">=</span> { <span class="dt">counterA</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">counterB</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Mix in Backbone Events</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(TodoCounter<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Increment counterA, triggering an event</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> incrA <span class="op">=</span> <span class="kw">function</span>(){ </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  TodoCounter<span class="op">.</span><span class="at">counterA</span> <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span> </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This triggering will not </span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// produce any effect on the counters</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  TodoCounter<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;event&#39;</span>)<span class="op">;</span> </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Increment counterB</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> incrB <span class="op">=</span> <span class="kw">function</span>(){ </span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  TodoCounter<span class="op">.</span><span class="at">counterB</span> <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span> </span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Use once rather than having to explicitly unbind</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co">// our event listener</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>TodoCounter<span class="op">.</span><span class="fu">once</span>(<span class="st">&#39;event&#39;</span><span class="op">,</span> incrA)<span class="op">;</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>TodoCounter<span class="op">.</span><span class="fu">once</span>(<span class="st">&#39;event&#39;</span><span class="op">,</span> incrB)<span class="op">;</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Trigger the event for the first time</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>TodoCounter<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;event&#39;</span>)<span class="op">;</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Check out output</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(TodoCounter<span class="op">.</span><span class="at">counterA</span> <span class="op">===</span> <span class="dv">1</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(TodoCounter<span class="op">.</span><span class="at">counterB</span> <span class="op">===</span> <span class="dv">1</span>)<span class="op">;</span> <span class="co">// true</span></span></code></pre></div>
<p><code>counterA</code> and <code>counterB</code> should only have been
incremented once.</p>
<h4 id="resettingrefreshing-collections">Resetting/Refreshing
Collections</h4>
<p>Rather than adding or removing models individually, you might want to
update an entire collection at once. <code>Collection.set()</code> takes
an array of models and performs the necessary add, remove, and change
operations required to update the collection.</p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosCollection <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>()<span class="op">;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">add</span>([</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Jamaica.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to China.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">id</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Disneyland.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co">// we can listen for add/change/remove events</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;add&quot;</span><span class="op">,</span> <span class="kw">function</span>(model) {</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Added &quot;</span> <span class="op">+</span> model<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;remove&quot;</span><span class="op">,</span> <span class="kw">function</span>(model) {</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Removed &quot;</span> <span class="op">+</span> model<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;change:completed&quot;</span><span class="op">,</span> <span class="kw">function</span>(model) {</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Completed &quot;</span> <span class="op">+</span> model<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">set</span>([</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Jamaica.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to China.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">id</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Disney World.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Above logs:</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Completed go to Jamaica.</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Removed go to Disneyland.</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="co">// Added go to Disney World.</span></span></code></pre></div>
<p>If you need to simply replace the entire content of the collection
then <code>Collection.reset()</code> can be used:</p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosCollection <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>()<span class="op">;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">// we can listen for reset events</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;reset&quot;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Collection reset.&quot;</span>)<span class="op">;</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">add</span>([</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Jamaica.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to China.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Disneyland.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Collection size: &#39;</span> <span class="op">+</span> TodosCollection<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="co">// Collection size: 3</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>TodosCollection<span class="op">.</span><span class="fu">reset</span>([</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Cuba.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Above logs &#39;Collection reset.&#39;</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Collection size: &#39;</span> <span class="op">+</span> TodosCollection<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="co">// Collection size: 1</span></span></code></pre></div>
<p>Another useful tip is to use <code>reset</code> with no arguments to
clear out a collection completely. This is handy when dynamically
loading a new page of results where you want to blank out the current
page of results.</p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>myCollection<span class="op">.</span><span class="fu">reset</span>()<span class="op">;</span></span></code></pre></div>
<p>Note that using <code>Collection.reset()</code> doesn’t fire any
<code>add</code> or <code>remove</code> events. A <code>reset</code>
event is fired instead as shown in the previous example. The reason you
might want to use this is to perform super-optimized rendering in
extreme cases where individual events are too expensive.</p>
<p>Also note that listening to a <a
href="http://backbonejs.org/#Collection-reset">reset</a> event, the list
of previous models is available in <code>options.previousModels</code>,
for convenience.</p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>()<span class="op">;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>([todo])</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;reset&#39;</span><span class="op">,</span> <span class="kw">function</span>(todos<span class="op">,</span> options) {</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(options<span class="op">.</span><span class="at">previousModels</span>)<span class="op">;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>([todo])<span class="op">;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(options<span class="op">.</span><span class="at">previousModels</span>[<span class="dv">0</span>] <span class="op">===</span> todo)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">reset</span>([])<span class="op">;</span></span></code></pre></div>
<p>The <code>set()</code> method available for Collections can also be
used for “smart” updating of sets of models. This method attempts to
perform smart updating of a collection using a specified list of models.
When a model in this list isn’t present in the collection, it is added.
If it’s present, its attributes will be merged. Models which are present
in the collection but not in the list are removed.</p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a model of type &#39;Beatle&#39; with a &#39;job&#39; attribute</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Beatle <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">job</span><span class="op">:</span> <span class="st">&#39;musician&#39;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Create models for each member of the Beatles</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> john <span class="op">=</span> <span class="kw">new</span> <span class="fu">Beatle</span>({ <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;John&#39;</span><span class="op">,</span> <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Lennon&#39;</span>})<span class="op">;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> paul <span class="op">=</span> <span class="kw">new</span> <span class="fu">Beatle</span>({ <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;Paul&#39;</span><span class="op">,</span> <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;McCartney&#39;</span>})<span class="op">;</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> george <span class="op">=</span> <span class="kw">new</span> <span class="fu">Beatle</span>({ <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;George&#39;</span><span class="op">,</span> <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Harrison&#39;</span>})<span class="op">;</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ringo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Beatle</span>({ <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;Ringo&#39;</span><span class="op">,</span> <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Starr&#39;</span>})<span class="op">;</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a collection using our models</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> theBeatles <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>([john<span class="op">,</span> paul<span class="op">,</span> george<span class="op">,</span> ringo])<span class="op">;</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a separate model for Pete Best</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pete <span class="op">=</span> <span class="kw">new</span> <span class="fu">Beatle</span>({ <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;Pete&#39;</span><span class="op">,</span> <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Best&#39;</span>})<span class="op">;</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Update the collection</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>theBeatles<span class="op">.</span><span class="fu">set</span>([john<span class="op">,</span> paul<span class="op">,</span> george<span class="op">,</span> pete])<span class="op">;</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Fires a `remove` event for &#39;Ringo&#39;, and an `add` event for &#39;Pete&#39;.</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Updates any of John, Paul and Georges&#39;s attributes that may have</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="co">// changed over the years.</span></span></code></pre></div>
<h4 id="underscore-utility-functions">Underscore utility functions</h4>
<p>Backbone takes full advantage of its hard dependency on Underscore by
making many of its utilities directly available on collections:</p>
<p><strong><code>forEach</code>: iterate over collections</strong></p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>()<span class="op">;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">add</span>([</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Belgium.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to China.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Austria.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">// iterate over models in the collection</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(model){</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(model<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Above logs:</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co">// go to Belgium.</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co">// go to China.</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co">// go to Austria.</span></span></code></pre></div>
<p><strong><code>sortBy()</code>: sort a collection on a specific
attribute</strong></p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">// sort collection</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> sortedByAlphabet <span class="op">=</span> todos<span class="op">.</span><span class="fu">sortBy</span>(<span class="kw">function</span> (todo) {</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;title&quot;</span>)<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;- Now sorted: &quot;</span>)<span class="op">;</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>sortedByAlphabet<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(model){</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(model<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Above logs:</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co">// - Now sorted:</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">// go to Austria.</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co">// go to Belgium.</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">// go to China.</span></span></code></pre></div>
<p><strong><code>map()</code>: iterate through a collection, mapping
each value through a transformation function</strong></p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> count <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todos<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(model){</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> count<span class="op">++</span> <span class="op">+</span> <span class="st">&quot;. &quot;</span> <span class="op">+</span> model<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>)<span class="op">;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Above logs:</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">//1. go to Belgium.</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">//2. go to China.</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">//3. go to Austria.</span></span></code></pre></div>
<p><strong><code>min()</code>/<code>max()</code>: retrieve item with the
min or max value of an attribute</strong></p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">max</span>(<span class="kw">function</span>(model){</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> model<span class="op">.</span><span class="at">id</span><span class="op">;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="at">id</span><span class="op">;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">min</span>(<span class="kw">function</span>(model){</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> model<span class="op">.</span><span class="at">id</span><span class="op">;</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="at">id</span><span class="op">;</span></span></code></pre></div>
<p><strong><code>pluck()</code>: extract a specific
attribute</strong></p>
<div class="sourceCode" id="cb55"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> captions <span class="op">=</span> todos<span class="op">.</span><span class="fu">pluck</span>(<span class="st">&#39;caption&#39;</span>)<span class="op">;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co">// returns list of captions</span></span></code></pre></div>
<p><strong><code>filter()</code>: filter a collection</strong></p>
<p><em>Filter by an array of model IDs</em></p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todos <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Todo<span class="op">,</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">filterById</span><span class="op">:</span> <span class="kw">function</span>(ids){</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span>(c) { </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> _<span class="op">.</span><span class="fu">contains</span>(ids<span class="op">,</span> c<span class="op">.</span><span class="at">id</span>)<span class="op">;</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong><code>indexOf()</code>: return the index of a particular item
within a collection</strong></p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> people <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>people<span class="op">.</span><span class="at">comparator</span> <span class="op">=</span> <span class="kw">function</span>(a<span class="op">,</span> b) {</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;name&#39;</span>) <span class="op">&lt;</span> b<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;name&#39;</span>) <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> tom <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>({<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Tom&#39;</span>})<span class="op">;</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> rob <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>({<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Rob&#39;</span>})<span class="op">;</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> tim <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>({<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Tim&#39;</span>})<span class="op">;</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>people<span class="op">.</span><span class="fu">add</span>(tom)<span class="op">;</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>people<span class="op">.</span><span class="fu">add</span>(rob)<span class="op">;</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>people<span class="op">.</span><span class="fu">add</span>(tim)<span class="op">;</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(people<span class="op">.</span><span class="fu">indexOf</span>(rob) <span class="op">===</span> <span class="dv">0</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(people<span class="op">.</span><span class="fu">indexOf</span>(tim) <span class="op">===</span> <span class="dv">1</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(people<span class="op">.</span><span class="fu">indexOf</span>(tom) <span class="op">===</span> <span class="dv">2</span>)<span class="op">;</span> <span class="co">// true</span></span></code></pre></div>
<p><strong><code>any()</code>: confirm if any of the values in a
collection pass an iterator truth test</strong></p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">any</span>(<span class="kw">function</span>(model){</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> model<span class="op">.</span><span class="at">id</span> <span class="op">===</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">// or</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">some</span>(<span class="kw">function</span>(model){</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> model<span class="op">.</span><span class="at">id</span> <span class="op">===</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong><code>size()</code>: return the size of a
collection</strong></p>
<div class="sourceCode" id="cb59"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">size</span>()<span class="op">;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">// equivalent to</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="at">length</span><span class="op">;</span></span></code></pre></div>
<p><strong><code>isEmpty()</code>: determine whether a collection is
empty</strong></p>
<div class="sourceCode" id="cb60"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> isEmpty <span class="op">=</span> todos<span class="op">.</span><span class="fu">isEmpty</span>()<span class="op">;</span></span></code></pre></div>
<p><strong><code>groupBy()</code>: group a collection into groups of
like items</strong></p>
<div class="sourceCode" id="cb61"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>()<span class="op">;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">add</span>([</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Belgium.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to China.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Austria.&#39;</span><span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">// create groups of completed and incomplete models</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> byCompleted <span class="op">=</span> todos<span class="op">.</span><span class="fu">groupBy</span>(<span class="st">&#39;completed&#39;</span>)<span class="op">;</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> completed <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>(byCompleted[<span class="kw">true</span>])<span class="op">;</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(completed<span class="op">.</span><span class="fu">pluck</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co">// logs: [&quot;go to Austria.&quot;]</span></span></code></pre></div>
<p>In addition, several of the Underscore operations on objects are
available as methods on Models.</p>
<p><strong><code>pick()</code>: extract a set of attributes from a
model</strong></p>
<div class="sourceCode" id="cb62"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Austria.&#39;</span>})<span class="op">;</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo<span class="op">.</span><span class="fu">pick</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co">// logs {title: &quot;go to Austria&quot;}</span></span></code></pre></div>
<p><strong><code>omit()</code>: extract all attributes from a model
except those listed</strong></p>
<div class="sourceCode" id="cb63"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Austria.&#39;</span>})<span class="op">;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo<span class="op">.</span><span class="fu">omit</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">// logs {completed: false}</span></span></code></pre></div>
<p><strong><code>keys()</code> and <code>values()</code>: get lists of
attribute names and values</strong></p>
<div class="sourceCode" id="cb64"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Austria.&#39;</span>})<span class="op">;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo<span class="op">.</span><span class="fu">keys</span>())<span class="op">;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co">// logs: [&quot;title&quot;, &quot;completed&quot;]</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo<span class="op">.</span><span class="fu">values</span>())<span class="op">;</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co">//logs: [&quot;go to Austria.&quot;, false]</span></span></code></pre></div>
<p><strong><code>pairs()</code>: get list of attributes as [key, value]
pairs</strong></p>
<div class="sourceCode" id="cb65"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Austria.&#39;</span>})<span class="op">;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pairs <span class="op">=</span> todo<span class="op">.</span><span class="fu">pairs</span>()<span class="op">;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(pairs[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">// logs: [&quot;title&quot;, &quot;go to Austria.&quot;]</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(pairs[<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">// logs: [&quot;completed&quot;, false]</span></span></code></pre></div>
<p><strong><code>invert()</code>: create object in which the values are
keys and the attributes are values</strong></p>
<div class="sourceCode" id="cb66"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;go to Austria.&#39;</span>})<span class="op">;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo<span class="op">.</span><span class="fu">invert</span>())<span class="op">;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co">// logs: {&#39;go to Austria.&#39;: &#39;title&#39;, &#39;false&#39;: &#39;completed&#39;}</span></span></code></pre></div>
<p>The complete list of what Underscore can do can be found in its
official <a href="http://underscorejs.org/">documentation</a>.</p>
<h4 id="chainable-api">Chainable API</h4>
<p>Speaking of utility methods, another bit of sugar in Backbone is its
support for Underscore’s <code>chain()</code> method. Chaining is a
common idiom in object-oriented languages; a chain is a sequence of
method calls on the same object that are performed in a single
statement. While Backbone makes Underscore’s array manipulation
operations available as methods of Collection objects, they cannot be
directly chained since they return arrays rather than the original
Collection.</p>
<p>Fortunately, the inclusion of Underscore’s <code>chain()</code>
method enables you to chain calls to these methods on Collections.</p>
<p>The <code>chain()</code> method returns an object that has all of the
Underscore array operations attached as methods which return that
object. The chain ends with a call to the <code>value()</code> method
which simply returns the resulting array value. In case you haven’t seen
it before, the chainable API looks like this:</p>
<div class="sourceCode" id="cb67"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> collection <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>([</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Tim&#39;</span><span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">5</span> }<span class="op">,</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Ida&#39;</span><span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">26</span> }<span class="op">,</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Rob&#39;</span><span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">55</span> }</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> filteredNames <span class="op">=</span> collection<span class="op">.</span><span class="fu">chain</span>() <span class="co">// start chain, returns wrapper around collection&#39;s models</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span>(item) { <span class="cf">return</span> item<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;age&#39;</span>) <span class="op">&gt;</span> <span class="dv">10</span><span class="op">;</span> }) <span class="co">// returns wrapped array excluding Tim</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(item) { <span class="cf">return</span> item<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;name&#39;</span>)<span class="op">;</span> }) <span class="co">// returns wrapped array containing remaining names</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">value</span>()<span class="op">;</span> <span class="co">// terminates the chain and returns the resulting array</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(filteredNames)<span class="op">;</span> <span class="co">// logs: [&#39;Ida&#39;, &#39;Rob&#39;]</span></span></code></pre></div>
<p>Some of the Backbone-specific methods do return <code>this</code>,
which means they can be chained as well:</p>
<div class="sourceCode" id="cb68"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> collection <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Collection</span>()<span class="op">;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>collection</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span>({ <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;John&#39;</span><span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">23</span> })</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span>({ <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Harry&#39;</span><span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">33</span> })</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span>({ <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Steve&#39;</span><span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">41</span> })<span class="op">;</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> names <span class="op">=</span> collection<span class="op">.</span><span class="fu">pluck</span>(<span class="st">&#39;name&#39;</span>)<span class="op">;</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(names)<span class="op">;</span> <span class="co">// logs: [&#39;John&#39;, &#39;Harry&#39;, &#39;Steve&#39;]</span></span></code></pre></div>
<h2 id="restful-persistence">RESTful Persistence</h2>
<p>Thus far, all of our example data has been created in the browser.
For most single page applications, the models are derived from a data
store residing on a server. This is an area in which Backbone
dramatically simplifies the code you need to write to perform RESTful
synchronization with a server through a simple API on its models and
collections.</p>
<p><strong>Fetching models from the server</strong></p>
<p><code>Collections.fetch()</code> retrieves a set of models from the
server in the form of a JSON array by sending an HTTP GET request to the
URL specified by the collection’s <code>url</code> property (which may
be a function). When this data is received, a <code>set()</code> will be
executed to update the collection.</p>
<div class="sourceCode" id="cb69"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosCollection <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Todo<span class="op">,</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/todos&#39;</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodosCollection</span>()<span class="op">;</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">fetch</span>()<span class="op">;</span> <span class="co">// sends HTTP GET to /todos</span></span></code></pre></div>
<p><strong>Saving models to the server</strong></p>
<p>While Backbone can retrieve an entire collection of models from the
server at once, updates to models are performed individually using the
model’s <code>save()</code> method. When <code>save()</code> is called
on a model that was fetched from the server, it constructs a URL by
appending the model’s id to the collection’s URL and sends an HTTP PUT
to the server. If the model is a new instance that was created in the
browser (i.e. it doesn’t have an id) then an HTTP POST is sent to the
collection’s URL. <code>Collections.create()</code> can be used to
create a new model, add it to the collection, and send it to the server
in a single method call.</p>
<div class="sourceCode" id="cb70"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosCollection <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Todo<span class="op">,</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/todos&#39;</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodosCollection</span>()<span class="op">;</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">fetch</span>()<span class="op">;</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo2 <span class="op">=</span> todos<span class="op">.</span><span class="fu">get</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>todo2<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;go fishing&#39;</span>)<span class="op">;</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>todo2<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span> <span class="co">// sends HTTP PUT to /todos/2</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">create</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Try out code samples&#39;</span>})<span class="op">;</span> <span class="co">// sends HTTP POST to /todos and adds to collection</span></span></code></pre></div>
<p>As mentioned earlier, a model’s <code>validate()</code> method is
called automatically by <code>save()</code> and will trigger an
<code>invalid</code> event on the model if validation fails.</p>
<p><strong>Deleting models from the server</strong></p>
<p>A model can be removed from the containing collection and the server
by calling its <code>destroy()</code> method. Unlike
<code>Collection.remove()</code> which only removes a model from a
collection, <code>Model.destroy()</code> will also send an HTTP DELETE
to the collection’s URL.</p>
<div class="sourceCode" id="cb71"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodosCollection <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Todo<span class="op">,</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/todos&#39;</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodosCollection</span>()<span class="op">;</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>todos<span class="op">.</span><span class="fu">fetch</span>()<span class="op">;</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo2 <span class="op">=</span> todos<span class="op">.</span><span class="fu">get</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>todo2<span class="op">.</span><span class="fu">destroy</span>()<span class="op">;</span> <span class="co">// sends HTTP DELETE to /todos/2 and removes from collection</span></span></code></pre></div>
<p>Calling <code>destroy</code> on a Model will return
<code>false</code> if the model <code>isNew</code>:</p>
<div class="sourceCode" id="cb72"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>()<span class="op">;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(todo<span class="op">.</span><span class="fu">destroy</span>())<span class="op">;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co">// false</span></span></code></pre></div>
<p><strong>Options</strong></p>
<p>Each RESTful API method accepts a variety of options. Most
importantly, all methods accept success and error callbacks which can be
used to customize the handling of server responses.</p>
<p>Specifying the <code>{patch: true}</code> option to
<code>Model.save()</code> will cause it to use HTTP PATCH to send only
the changed attributes (i.e. partial updates) to the server instead of
the entire model;
i.e. <code>model.save(attrs, {patch: true})</code>:</p>
<div class="sourceCode" id="cb73"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Save partial using PATCH</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>model<span class="op">.</span><span class="fu">clear</span>()<span class="op">.</span><span class="fu">set</span>({<span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">a</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">d</span><span class="op">:</span> <span class="dv">4</span>})<span class="op">;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>model<span class="op">.</span><span class="fu">save</span>({<span class="dt">b</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">d</span><span class="op">:</span> <span class="dv">4</span>}<span class="op">,</span> {<span class="dt">patch</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">this</span><span class="op">.</span><span class="at">syncArgs</span><span class="op">.</span><span class="at">method</span>)<span class="op">;</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co">// &#39;patch&#39;</span></span></code></pre></div>
<p>Similarly, passing the <code>{reset: true}</code> option to
<code>Collection.fetch()</code> will result in the collection being
updated using <code>reset()</code> rather than <code>set()</code>.</p>
<p>See the Backbone.js documentation for full descriptions of the
supported options.</p>
<h2 id="events">Events</h2>
<p>Events are a basic inversion of control. Instead of having one
function call another by name, the second function is registered as a
handler to be called when a specific event occurs.</p>
<p>The part of your application that has to know how to call the other
part of your app has been inverted. This is the core thing that makes it
possible for your business logic to not have to know about how your user
interface works and is the most powerful thing about the Backbone Events
system.</p>
<p>Mastering events is one of the quickest ways to become more
productive with Backbone, so let’s take a closer look at Backbone’s
event model.</p>
<p><code>Backbone.Events</code> is mixed into the other Backbone
“classes”, including:</p>
<ul>
<li>Backbone</li>
<li>Backbone.Model</li>
<li>Backbone.Collection</li>
<li>Backbone.Router</li>
<li>Backbone.History</li>
<li>Backbone.View</li>
</ul>
<p>Note that <code>Backbone.Events</code> is mixed into the
<code>Backbone</code> object. Since <code>Backbone</code> is globally
visible, it can be used as a simple event bus:</p>
<div class="sourceCode" id="cb74"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;event&#39;</span><span class="op">,</span> <span class="kw">function</span>() {<span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Handled Backbone event&#39;</span>)<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;event&#39;</span>)<span class="op">;</span> <span class="co">// logs: Handled Backbone event</span></span></code></pre></div>
<h4 id="on-off-and-trigger">on(), off(), and trigger()</h4>
<p><code>Backbone.Events</code> can give any object the ability to bind
and trigger custom events. We can mix this module into any object easily
and there isn’t a requirement for events to be declared before being
bound to a callback handler.</p>
<p>Example:</p>
<div class="sourceCode" id="cb75"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ourObject <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Mixin</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(ourObject<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Add a custom event</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;dance&#39;</span><span class="op">,</span> <span class="kw">function</span>(msg){</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;We triggered &#39;</span> <span class="op">+</span> msg)<span class="op">;</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Trigger the custom event</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;dance&#39;</span><span class="op">,</span> <span class="st">&#39;our event&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>If you’re familiar with jQuery custom events or the concept of
Publish/Subscribe, <code>Backbone.Events</code> provides a system that
is very similar with <code>on</code> being analogous to
<code>subscribe</code> and <code>trigger</code> being similar to
<code>publish</code>.</p>
<p><code>on</code> binds a callback function to an object, as we’ve done
with <code>dance</code> in the above example. The callback is invoked
whenever the event is triggered.</p>
<p>The official Backbone.js documentation recommends namespacing event
names using colons if you end up using quite a few of these on your
page. e.g.:</p>
<div class="sourceCode" id="cb76"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ourObject <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Mixin</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(ourObject<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dancing</span> (msg) { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;We started &quot;</span> <span class="op">+</span> msg)<span class="op">;</span> }</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Add namespaced custom events</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;dance:tap&quot;</span><span class="op">,</span> dancing)<span class="op">;</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;dance:break&quot;</span><span class="op">,</span> dancing)<span class="op">;</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Trigger the custom events</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance:tap&quot;</span><span class="op">,</span> <span class="st">&quot;tap dancing. Yeah!&quot;</span>)<span class="op">;</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance:break&quot;</span><span class="op">,</span> <span class="st">&quot;break dancing. Yeah!&quot;</span>)<span class="op">;</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="co">// This one triggers nothing as no listener listens for it</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance&quot;</span><span class="op">,</span> <span class="st">&quot;break dancing. Yeah!&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>A special <code>all</code> event is made available in case you would
like notifications for every event that occurs on the object (e.g., if
you would like to screen events in a single location). The
<code>all</code> event can be used as follows:</p>
<div class="sourceCode" id="cb77"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ourObject <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Mixin</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(ourObject<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dancing</span> (msg) { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;We started &quot;</span> <span class="op">+</span> msg)<span class="op">;</span> }</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;all&quot;</span><span class="op">,</span> <span class="kw">function</span>(eventName){</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;The name of the event passed was &quot;</span> <span class="op">+</span> eventName)<span class="op">;</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co">// This time each event will be caught with a catch &#39;all&#39; event listener</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance:tap&quot;</span><span class="op">,</span> <span class="st">&quot;tap dancing. Yeah!&quot;</span>)<span class="op">;</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance:break&quot;</span><span class="op">,</span> <span class="st">&quot;break dancing. Yeah!&quot;</span>)<span class="op">;</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance&quot;</span><span class="op">,</span> <span class="st">&quot;break dancing. Yeah!&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p><code>off</code> removes callback functions that were previously
bound to an object. Going back to our Publish/Subscribe comparison,
think of it as an <code>unsubscribe</code> for custom events.</p>
<p>To remove the <code>dance</code> event we previously bound to
<code>ourObject</code>, we would simply do:</p>
<div class="sourceCode" id="cb78"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ourObject <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Mixin</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(ourObject<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dancing</span> (msg) { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;We &quot;</span> <span class="op">+</span> msg)<span class="op">;</span> }</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Add namespaced custom events</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;dance:tap&quot;</span><span class="op">,</span> dancing)<span class="op">;</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;dance:break&quot;</span><span class="op">,</span> dancing)<span class="op">;</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Trigger the custom events. Each will be caught and acted upon.</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance:tap&quot;</span><span class="op">,</span> <span class="st">&quot;started tap dancing. Yeah!&quot;</span>)<span class="op">;</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance:break&quot;</span><span class="op">,</span> <span class="st">&quot;started break dancing. Yeah!&quot;</span>)<span class="op">;</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Removes event bound to the object</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">off</span>(<span class="st">&quot;dance:tap&quot;</span>)<span class="op">;</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Trigger the custom events again, but one is logged.</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance:tap&quot;</span><span class="op">,</span> <span class="st">&quot;stopped tap dancing.&quot;</span>)<span class="op">;</span> <span class="co">// won&#39;t be logged as it&#39;s not listened for</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance:break&quot;</span><span class="op">,</span> <span class="st">&quot;break dancing. Yeah!&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>To remove all callbacks for the event we pass an event name (e.g.,
<code>move</code>) to the <code>off()</code> method on the object the
event is bound to. If we wish to remove a specific callback, we can pass
that callback as the second parameter:</p>
<div class="sourceCode" id="cb79"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ourObject <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Mixin</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(ourObject<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dancing</span> (msg) { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;We are dancing. &quot;</span> <span class="op">+</span> msg)<span class="op">;</span> }</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">jumping</span> (msg) { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;We are jumping. &quot;</span> <span class="op">+</span> msg)<span class="op">;</span> }</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Add two listeners to the same event</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;move&quot;</span><span class="op">,</span> dancing)<span class="op">;</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;move&quot;</span><span class="op">,</span> jumping)<span class="op">;</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Trigger the events. Both listeners are called.</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;move&quot;</span><span class="op">,</span> <span class="st">&quot;Yeah!&quot;</span>)<span class="op">;</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Removes specified listener</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">off</span>(<span class="st">&quot;move&quot;</span><span class="op">,</span> dancing)<span class="op">;</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Trigger the events again. One listener left.</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;move&quot;</span><span class="op">,</span> <span class="st">&quot;Yeah, jump, jump!&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Finally, as we have seen in our previous examples,
<code>trigger</code> triggers a callback for a specified event (or a
space-separated list of events). e.g.:</p>
<div class="sourceCode" id="cb80"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ourObject <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Mixin</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(ourObject<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">doAction</span> (msg) { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;We are &quot;</span> <span class="op">+</span> msg)<span class="op">;</span> }</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Add event listeners</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;dance&quot;</span><span class="op">,</span> doAction)<span class="op">;</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;jump&quot;</span><span class="op">,</span> doAction)<span class="op">;</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;skip&quot;</span><span class="op">,</span> doAction)<span class="op">;</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Single event</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance&quot;</span><span class="op">,</span> <span class="st">&#39;just dancing.&#39;</span>)<span class="op">;</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Multiple events</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance jump skip&quot;</span><span class="op">,</span> <span class="st">&#39;very tired from so much action.&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p><code>trigger</code> can pass multiple arguments to the callback
function:</p>
<div class="sourceCode" id="cb81"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ourObject <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Mixin</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(ourObject<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">doAction</span> (action<span class="op">,</span> duration) {</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;We are &quot;</span> <span class="op">+</span> action <span class="op">+</span> <span class="st">&#39; for &#39;</span> <span class="op">+</span> duration )<span class="op">;</span> </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Add event listeners</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;dance&quot;</span><span class="op">,</span> doAction)<span class="op">;</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;jump&quot;</span><span class="op">,</span> doAction)<span class="op">;</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;skip&quot;</span><span class="op">,</span> doAction)<span class="op">;</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Passing multiple arguments to single event</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance&quot;</span><span class="op">,</span> <span class="st">&#39;dancing&#39;</span><span class="op">,</span> <span class="st">&quot;5 minutes&quot;</span>)<span class="op">;</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Passing multiple arguments to multiple events</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>ourObject<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;dance jump skip&quot;</span><span class="op">,</span> <span class="st">&#39;on fire&#39;</span><span class="op">,</span> <span class="st">&quot;15 minutes&quot;</span>)<span class="op">;</span></span></code></pre></div>
<h4 id="listento-and-stoplistening">listenTo() and stopListening()</h4>
<p>While <code>on()</code> and <code>off()</code> add callbacks directly
to an observed object, <code>listenTo()</code> tells an object to listen
for events on another object, allowing the listener to keep track of the
events for which it is listening. <code>stopListening()</code> can
subsequently be called on the listener to tell it to stop listening for
events:</p>
<div class="sourceCode" id="cb82"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> a <span class="op">=</span> _<span class="op">.</span><span class="fu">extend</span>({}<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> b <span class="op">=</span> _<span class="op">.</span><span class="fu">extend</span>({}<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> c <span class="op">=</span> _<span class="op">.</span><span class="fu">extend</span>({}<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co">// add listeners to A for events on B and C</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>a<span class="op">.</span><span class="fu">listenTo</span>(b<span class="op">,</span> <span class="st">&#39;anything&#39;</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>){ <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;anything happened&quot;</span>)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>a<span class="op">.</span><span class="fu">listenTo</span>(c<span class="op">,</span> <span class="st">&#39;everything&#39;</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>){ <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;everything happened&quot;</span>)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co">// trigger an event</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;anything&#39;</span>)<span class="op">;</span> <span class="co">// logs: anything happened</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="co">// stop listening</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>a<span class="op">.</span><span class="fu">stopListening</span>()<span class="op">;</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co">// A does not receive these events</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;anything&#39;</span>)<span class="op">;</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>c<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;everything&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p><code>stopListening()</code> can also be used to selectively stop
listening based on the event, model, or callback handler.</p>
<p>If you use <code>on</code> and <code>off</code> and remove views and
their corresponding models at the same time, there are generally no
problems. But a problem arises when you remove a view that had
registered to be notified about events on a model, but you don’t remove
the model or call <code>off</code> to remove the view’s event handler.
Since the model has a reference to the view’s callback function, the
JavaScript garbage collector cannot remove the view from memory. This is
called a “ghost view” and is a form of memory leak which is common since
the models generally tend to outlive the corresponding views during an
application’s lifecycle. For details on the topic and a solution, check
this <a
href="http://lostechies.com/derickbailey/2011/09/15/zombies-run-managing-page-transitions-in-backbone-apps/">excellent
article</a> by Derick Bailey.</p>
<p>Practically, every <code>on</code> called on an object also requires
an <code>off</code> to be called in order for the garbage collector to
do its job. <code>listenTo()</code> changes that, allowing Views to bind
to Model notifications and unbind from all of them with just one call -
<code>stopListening()</code>.</p>
<p>The default implementation of <code>View.remove()</code> makes a call
to <code>stopListening()</code>, ensuring that any listeners bound using
<code>listenTo()</code> are unbound before the view is destroyed.</p>
<div class="sourceCode" id="cb83"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> view <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">View</span>()<span class="op">;</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> b <span class="op">=</span> _<span class="op">.</span><span class="fu">extend</span>({}<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>view<span class="op">.</span><span class="fu">listenTo</span>(b<span class="op">,</span> <span class="st">&#39;all&#39;</span><span class="op">,</span> <span class="kw">function</span>(){ <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">true</span>)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;anything&#39;</span>)<span class="op">;</span>  <span class="co">// logs: true</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>view<span class="op">.</span><span class="fu">listenTo</span>(b<span class="op">,</span> <span class="st">&#39;all&#39;</span><span class="op">,</span> <span class="kw">function</span>(){ <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">false</span>)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>view<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span> <span class="co">// stopListening() implicitly called</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;anything&#39;</span>)<span class="op">;</span>  <span class="co">// does not log anything</span></span></code></pre></div>
<h4 id="events-and-views">Events and Views</h4>
<p>Within a View, there are two types of events you can listen for: DOM
events and events triggered using the Event API. It is important to
understand the differences in how views bind to these events and the
context in which their callbacks are invoked.</p>
<p>DOM events can be bound to using the View’s <code>events</code>
property or using <code>jQuery.on()</code>. Within callbacks bound using
the <code>events</code> property, <code>this</code> refers to the View
object; whereas any callbacks bound directly using jQuery will have
<code>this</code> set to the handling DOM element by jQuery. All DOM
event callbacks are passed an <code>event</code> object by jQuery. See
<code>delegateEvents()</code> in the Backbone documentation for
additional details.</p>
<p>Event API events are bound as described in this section. If the event
is bound using <code>on()</code> on the observed object, a context
parameter can be passed as the third argument. If the event is bound
using <code>listenTo()</code> then within the callback <code>this</code>
refers to the listener. The arguments passed to Event API callbacks
depends on the type of event. See the Catalog of Events in the Backbone
documentation for details.</p>
<p>The following example illustrates these differences:</p>
<div class="sourceCode" id="cb84"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;todo&quot;</span><span class="dt">&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&#39;checkbox&#39;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb85"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> View <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">el</span><span class="op">:</span> <span class="st">&#39;#todo&#39;</span><span class="op">,</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// bind to DOM event using events property</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;click [type=&quot;checkbox&quot;]&#39;</span><span class="op">:</span> <span class="st">&#39;clicked&#39;</span><span class="op">,</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind to DOM event using jQuery</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">click</span>(<span class="kw">this</span><span class="op">.</span><span class="at">jqueryClicked</span>)<span class="op">;</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind to API event</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;apiEvent&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">callback</span>)<span class="op">;</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// &#39;this&#39; is view</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clicked</span><span class="op">:</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;events handler for &quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">el</span><span class="op">.</span><span class="at">outerHTML</span>)<span class="op">;</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;apiEvent&#39;</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">type</span>)<span class="op">;</span></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// &#39;this&#39; is handling DOM element</span></span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">jqueryClicked</span><span class="op">:</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;jQuery handler for &quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">outerHTML</span>)<span class="op">;</span></span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">callback</span><span class="op">:</span> <span class="kw">function</span>(eventType) {</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;event type was &quot;</span> <span class="op">+</span> eventType)<span class="op">;</span></span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> view <span class="op">=</span> <span class="kw">new</span> <span class="fu">View</span>()<span class="op">;</span></span></code></pre></div>
<h2 id="routers">Routers</h2>
<p>In Backbone, routers provide a way for you to connect URLs (either
hash fragments, or real) to parts of your application. Any piece of your
application that you want to be bookmarkable, shareable, and
back-button-able, needs a URL.</p>
<p>Some examples of routes using the hash mark may be seen below:</p>
<div class="sourceCode" id="cb86"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>http<span class="op">:</span><span class="co">//example.com/#about</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>http<span class="op">:</span><span class="co">//example.com/#search/seasonal-horns/page2</span></span></code></pre></div>
<p>An application will usually have at least one route mapping a URL
route to a function that determines what happens when a user reaches
that route. This relationship is defined as follows:</p>
<div class="sourceCode" id="cb87"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;route&#39;</span> <span class="op">:</span> <span class="st">&#39;mappedFunction&#39;</span></span></code></pre></div>
<p>Let’s define our first router by extending
<code>Backbone.Router</code>. For the purposes of this guide, we’re
going to continue pretending we’re creating a complex todo application
(something like a personal organizer/planner) that requires a complex
TodoRouter.</p>
<p>Note the inline comments in the code example below as they continue
our lesson on routers.</p>
<div class="sourceCode" id="cb88"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoRouter <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* define the route and function maps for this router */</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">routes</span><span class="op">:</span> {</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;about&quot;</span> <span class="op">:</span> <span class="st">&quot;showAbout&quot;</span><span class="op">,</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Sample usage: http://example.com/#about */</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;todo/:id&quot;</span> <span class="op">:</span> <span class="st">&quot;getTodo&quot;</span><span class="op">,</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* This is an example of using a &quot;:param&quot; variable which allows us to match</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co">        any of the components between two URL slashes */</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Sample usage: http://example.com/#todo/5 */</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;search/:query&quot;</span> <span class="op">:</span> <span class="st">&quot;searchTodos&quot;</span><span class="op">,</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* We can also define multiple routes that are bound to the same map function,</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="co">        in this case searchTodos(). Note below how we&#39;re optionally passing in a</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="co">        reference to a page number if one is supplied */</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Sample usage: http://example.com/#search/job */</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;search/:query/p:page&quot;</span> <span class="op">:</span> <span class="st">&quot;searchTodos&quot;</span><span class="op">,</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* As we can see, URLs may contain as many &quot;:param&quot;s as we wish */</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Sample usage: http://example.com/#search/job/p1 */</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;todos/:id/download/*documentPath&quot;</span> <span class="op">:</span> <span class="st">&quot;downloadDocument&quot;</span><span class="op">,</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* This is an example of using a *splat. Splats are able to match any number of</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="co">        URL components and can be combined with &quot;:param&quot;s*/</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Sample usage: http://example.com/#todos/5/download/files/Meeting_schedule.doc */</span></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* If you wish to use splats for anything beyond default routing, it&#39;s probably a good</span></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a><span class="co">        idea to leave them at the end of a URL otherwise you may need to apply regular</span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a><span class="co">        expression parsing on your fragment */</span></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;*other&quot;</span>    <span class="op">:</span> <span class="st">&quot;defaultRoute&quot;</span><span class="op">,</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* This is a default route that also uses a *splat. Consider the</span></span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a><span class="co">        default route a wildcard for URLs that are either not matched or where</span></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a><span class="co">        the user has incorrectly typed in a route path manually */</span></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Sample usage: http://example.com/# &lt;anything&gt; */</span></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;optional(/:item)&quot;</span><span class="op">:</span> <span class="st">&quot;optionalItem&quot;</span><span class="op">,</span></span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;named/optional/(y:z)&quot;</span><span class="op">:</span> <span class="st">&quot;namedOptionalItem&quot;</span></span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Router URLs also support optional parts via parentheses, without having</span></span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a><span class="co">           to use a regex.  */</span></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">showAbout</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">getTodo</span><span class="op">:</span> <span class="kw">function</span>(id){</span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*</span></span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a><span class="co">        Note that the id matched in the above route will be passed to this function</span></span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a><span class="co">        */</span></span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;You are trying to reach todo &quot;</span> <span class="op">+</span> id)<span class="op">;</span></span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">searchTodos</span><span class="op">:</span> <span class="kw">function</span>(query<span class="op">,</span> page){</span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> page_number <span class="op">=</span> page <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Page number: &quot;</span> <span class="op">+</span> page_number <span class="op">+</span> <span class="st">&quot; of the results for todos containing the word: &quot;</span> <span class="op">+</span> query)<span class="op">;</span></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a>    <span class="dt">downloadDocument</span><span class="op">:</span> <span class="kw">function</span>(id<span class="op">,</span> path){</span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaultRoute</span><span class="op">:</span> <span class="kw">function</span>(other){</span>
<span id="cb88-62"><a href="#cb88-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Invalid. You attempted to reach:&#39;</span> <span class="op">+</span> other)<span class="op">;</span></span>
<span id="cb88-63"><a href="#cb88-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb88-64"><a href="#cb88-64" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb88-65"><a href="#cb88-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-66"><a href="#cb88-66" aria-hidden="true" tabindex="-1"></a><span class="co">/* Now that we have a router setup, we need to instantiate it */</span></span>
<span id="cb88-67"><a href="#cb88-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-68"><a href="#cb88-68" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodoRouter <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoRouter</span>()<span class="op">;</span></span></code></pre></div>
<p>Backbone offers an opt-in for HTML5 pushState support via
<code>window.history.pushState</code>. This permits you to define routes
such as http://backbonejs.org/just/an/example. This will be supported
with automatic degradation when a user’s browser doesn’t support
pushState. Note that it is vastly preferred if you’re capable of also
supporting pushState on the server side, although it is a little more
difficult to implement.</p>
<p><strong>Is there a limit to the number of routers I should be
using?</strong></p>
<p>Andrew de Andrade has pointed out that DocumentCloud, the creators of
Backbone, usually only use a single router in most of their
applications. You’re very likely to not require more than one or two
routers in your own projects; the majority of your application routing
can be kept organized in a single router without it getting
unwieldy.</p>
<h4 id="backbone.history">Backbone.history</h4>
<p>Next, we need to initialize <code>Backbone.history</code> as it
handles <code>hashchange</code> events in our application. This will
automatically handle routes that have been defined and trigger callbacks
when they’ve been accessed.</p>
<p>The <code>Backbone.history.start()</code> method will simply tell
Backbone that it’s okay to begin monitoring all <code>hashchange</code>
events as follows:</p>
<div class="sourceCode" id="cb89"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoRouter <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* define the route and function maps for this router */</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">routes</span><span class="op">:</span> {</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;about&quot;</span> <span class="op">:</span> <span class="st">&quot;showAbout&quot;</span><span class="op">,</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;search/:query&quot;</span> <span class="op">:</span> <span class="st">&quot;searchTodos&quot;</span><span class="op">,</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;search/:query/p:page&quot;</span> <span class="op">:</span> <span class="st">&quot;searchTodos&quot;</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">showAbout</span><span class="op">:</span> <span class="kw">function</span>(){}<span class="op">,</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">searchTodos</span><span class="op">:</span> <span class="kw">function</span>(query<span class="op">,</span> page){</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> page_number <span class="op">=</span> page <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Page number: &quot;</span> <span class="op">+</span> page_number <span class="op">+</span> <span class="st">&quot; of the results for todos containing the word: &quot;</span> <span class="op">+</span> query)<span class="op">;</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodoRouter <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoRouter</span>()<span class="op">;</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">start</span>()<span class="op">;</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Go to and check console:</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a><span class="co">// http://localhost/#search/job/p3   logs: Page number: 3 of the results for todos containing the word: job</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="co">// http://localhost/#search/job      logs: Page number: 1 of the results for todos containing the word: job </span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a><span class="co">// etc.</span></span></code></pre></div>
<p>Note: To run the last example, you’ll need to create a local
development environment and test project, which we will cover later on
in the book.</p>
<p>If you would like to update the URL to reflect the application state
at a particular point, you can use the router’s <code>.navigate()</code>
method. By default, it simply updates your URL fragment without
triggering the <code>hashchange</code> event:</p>
<div class="sourceCode" id="cb90"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Let&#39;s imagine we would like a specific fragment (edit) once a user opens a single todo</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoRouter <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">routes</span><span class="op">:</span> {</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;todo/:id&quot;</span><span class="op">:</span> <span class="st">&quot;viewTodo&quot;</span><span class="op">,</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;todo/:id/edit&quot;</span><span class="op">:</span> <span class="st">&quot;editTodo&quot;</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... other routes</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">viewTodo</span><span class="op">:</span> <span class="kw">function</span>(id){</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;View todo requested.&quot;</span>)<span class="op">;</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">navigate</span>(<span class="st">&quot;todo/&quot;</span> <span class="op">+</span> id <span class="op">+</span> <span class="st">&#39;/edit&#39;</span>)<span class="op">;</span> <span class="co">// updates the fragment for us, but doesn&#39;t trigger the route</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">editTodo</span><span class="op">:</span> <span class="kw">function</span>(id) {</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Edit todo opened.&quot;</span>)<span class="op">;</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodoRouter <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoRouter</span>()<span class="op">;</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">start</span>()<span class="op">;</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Go to: http://localhost/#todo/4</span></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a><span class="co">// URL is updated to: http://localhost/#todo/4/edit</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a><span class="co">// but editTodo() function is not invoked even though location we end up is mapped to it.</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a><span class="co">// logs: View todo requested.</span></span></code></pre></div>
<p>It is also possible for <code>Router.navigate()</code> to trigger the
route along with updating the URL fragment by passing the
<code>trigger:true</code> option.</p>
<p>Note: This usage is discouraged. The recommended usage is the one
described above which creates a bookmarkable URL when your application
transitions to a specific state.</p>
<div class="sourceCode" id="cb91"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoRouter <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">routes</span><span class="op">:</span> {</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;todo/:id&quot;</span><span class="op">:</span> <span class="st">&quot;viewTodo&quot;</span><span class="op">,</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;todo/:id/edit&quot;</span><span class="op">:</span> <span class="st">&quot;editTodo&quot;</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... other routes</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">viewTodo</span><span class="op">:</span> <span class="kw">function</span>(id){</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;View todo requested.&quot;</span>)<span class="op">;</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">navigate</span>(<span class="st">&quot;todo/&quot;</span> <span class="op">+</span> id <span class="op">+</span> <span class="st">&#39;/edit&#39;</span><span class="op">,</span> {<span class="dt">trigger</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span> <span class="co">// updates the fragment and triggers the route as well</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">editTodo</span><span class="op">:</span> <span class="kw">function</span>(id) {</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Edit todo opened.&quot;</span>)<span class="op">;</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodoRouter <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoRouter</span>()<span class="op">;</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">start</span>()<span class="op">;</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Go to: http://localhost/#todo/4</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a><span class="co">// URL is updated to: http://localhost/#todo/4/edit</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a><span class="co">// and this time editTodo() function is invoked.</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a><span class="co">// logs:</span></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a><span class="co">// View todo requested.</span></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Edit todo opened.</span></span></code></pre></div>
<p>A “route” event is also triggered on the router in addition to being
fired on Backbone.history.</p>
<div class="sourceCode" id="cb92"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;route&#39;</span><span class="op">,</span> onRoute)<span class="op">;</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Trigger &#39;route&#39; event on router instance.</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;route&#39;</span><span class="op">,</span> <span class="kw">function</span>(name<span class="op">,</span> args) {</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(name <span class="op">===</span> <span class="st">&#39;routeEvent&#39;</span>)<span class="op">;</span> </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>location<span class="op">.</span><span class="fu">replace</span>(<span class="st">&#39;http://example.com#route-event/x&#39;</span>)<span class="op">;</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">checkUrl</span>()<span class="op">;</span></span></code></pre></div>
<h2 id="backbones-sync-api">Backbone’s Sync API</h2>
<p>We previously discussed how Backbone supports RESTful persistence via
its <code>fetch()</code> and <code>create()</code> methods on
Collections and <code>save()</code>, and <code>destroy()</code> methods
on Models. Now we are going to take a closer look at Backbone’s sync
method which underlies these operations.</p>
<p>The Backbone.sync method is an integral part of Backbone.js. It
assumes a jQuery-like <code>$.ajax()</code> method, so HTTP parameters
are organized based on jQuery’s API. Since some legacy servers may not
support JSON-formatted requests and HTTP PUT and DELETE operations,
Backbone can be configured to emulate these capabilities using the two
configuration variables shown below with their default values:</p>
<div class="sourceCode" id="cb93"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">emulateHTTP</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span> <span class="co">// set to true if server cannot handle HTTP PUT or HTTP DELETE</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">emulateJSON</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span> <span class="co">// set to true if server cannot handle application/json requests</span></span></code></pre></div>
<p>The inline Backbone.emulateHTTP option should be set to true if
extended HTTP methods are not supported by the server. The
Backbone.emulateJSON option should be set to true if the server does not
understand the MIME type for JSON.</p>
<div class="sourceCode" id="cb94"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Overwriting jQuery ajax method - no actual request will be made</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ajaxSettings<span class="op">;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>$<span class="op">.</span><span class="at">ajax</span> <span class="op">=</span> <span class="kw">function</span> (ajaxRequest) {</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    ajaxSettings <span class="op">=</span> ajaxRequest<span class="op">;</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a new library collection</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Library <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url</span> <span class="op">:</span> <span class="kw">function</span>() { <span class="cf">return</span> <span class="st">&#39;/library&#39;</span><span class="op">;</span> }</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Define attributes for our model</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> attrs <span class="op">=</span> {</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span>  <span class="op">:</span> <span class="st">&quot;The Tempest&quot;</span><span class="op">,</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">author</span> <span class="op">:</span> <span class="st">&quot;Bill Shakespeare&quot;</span><span class="op">,</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">length</span> <span class="op">:</span> <span class="dv">123</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a new Library instance</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> library <span class="op">=</span> <span class="kw">new</span> Library<span class="op">;</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a new instance of a model within our collection</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>library<span class="op">.</span><span class="fu">create</span>(attrs<span class="op">,</span> {<span class="dt">wait</span><span class="op">:</span> <span class="kw">false</span>})<span class="op">;</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Update with just emulateHTTP</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>library<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">save</span>({<span class="dt">id</span><span class="op">:</span> <span class="st">&#39;2-the-tempest&#39;</span><span class="op">,</span> <span class="dt">author</span><span class="op">:</span> <span class="st">&#39;Tim Shakespeare&#39;</span>}<span class="op">,</span> {</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">emulateHTTP</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Check the ajaxSettings being used for our request</span></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(ajaxSettings<span class="op">.</span><span class="at">url</span> <span class="op">===</span> <span class="st">&#39;/library/2-the-tempest&#39;</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(ajaxSettings<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">&#39;POST&#39;</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(ajaxSettings<span class="op">.</span><span class="at">contentType</span> <span class="op">===</span> <span class="st">&#39;application/json&#39;</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a><span class="co">// Parse the data for the request to confirm it is as expected</span></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> data <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(ajaxSettings<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(data<span class="op">.</span><span class="at">id</span> <span class="op">===</span> <span class="st">&#39;2-the-tempest&#39;</span>)<span class="op">;</span>  <span class="co">// true</span></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(data<span class="op">.</span><span class="at">author</span> <span class="op">===</span> <span class="st">&#39;Tim Shakespeare&#39;</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">123</span>)<span class="op">;</span> <span class="co">// true</span></span></code></pre></div>
<p>Similarly, we could just update using <code>emulateJSON</code>:</p>
<div class="sourceCode" id="cb95"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>library<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">save</span>({<span class="dt">id</span><span class="op">:</span> <span class="st">&#39;2-the-tempest&#39;</span><span class="op">,</span> <span class="dt">author</span><span class="op">:</span> <span class="st">&#39;Tim Shakespeare&#39;</span>}<span class="op">,</span> {</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">emulateJSON</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(ajaxSettings<span class="op">.</span><span class="at">url</span> <span class="op">===</span> <span class="st">&#39;/library/2-the-tempest&#39;</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(ajaxSettings<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">&#39;PUT&#39;</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(ajaxSettings<span class="op">.</span><span class="at">contentType</span> <span class="op">===</span><span class="st">&#39;application/x-www-form-urlencoded&#39;</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> data <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(ajaxSettings<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">model</span>)<span class="op">;</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(data<span class="op">.</span><span class="at">id</span> <span class="op">===</span> <span class="st">&#39;2-the-tempest&#39;</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(data<span class="op">.</span><span class="at">author</span> <span class="op">===</span><span class="st">&#39;Tim Shakespeare&#39;</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(data<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">123</span>)<span class="op">;</span> <span class="co">// true</span></span></code></pre></div>
<p><code>Backbone.sync</code> is called every time Backbone tries to
read, save, or delete models. It uses jQuery or Zepto’s
<code>$.ajax()</code> implementations to make these RESTful requests,
however this can be overridden as per your needs.</p>
<p><strong>Overriding Backbone.sync</strong></p>
<p>The <code>sync</code> function may be overridden globally as
Backbone.sync, or at a finer-grained level, by adding a sync function to
a Backbone collection or to an individual model.</p>
<p>Since all persistence is handled by the Backbone.sync function, an
alternative persistence layer can be used by simply overriding
Backbone.sync with a function that has the same signature:</p>
<div class="sourceCode" id="cb96"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">sync</span> <span class="op">=</span> <span class="kw">function</span>(method<span class="op">,</span> model<span class="op">,</span> options) {</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>The methodMap below is used by the standard sync implementation to
map the method parameter to an HTTP operation and illustrates the type
of action required by each method argument:</p>
<div class="sourceCode" id="cb97"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> methodMap <span class="op">=</span> {</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;create&#39;</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;update&#39;</span><span class="op">:</span> <span class="st">&#39;PUT&#39;</span><span class="op">,</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;patch&#39;</span><span class="op">:</span>  <span class="st">&#39;PATCH&#39;</span><span class="op">,</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;delete&#39;</span><span class="op">:</span> <span class="st">&#39;DELETE&#39;</span><span class="op">,</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;read&#39;</span><span class="op">:</span>   <span class="st">&#39;GET&#39;</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>If we wanted to replace the standard <code>sync</code> implementation
with one that simply logged the calls to sync, we could do this:</p>
<div class="sourceCode" id="cb98"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> id_counter <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">sync</span> <span class="op">=</span> <span class="kw">function</span>(method<span class="op">,</span> model) {</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;I&#39;ve been passed &quot;</span> <span class="op">+</span> method <span class="op">+</span> <span class="st">&quot; with &quot;</span> <span class="op">+</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(model))<span class="op">;</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(method <span class="op">===</span> <span class="st">&#39;create&#39;</span>){ model<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;id&#39;</span><span class="op">,</span> id_counter<span class="op">++</span>)<span class="op">;</span> }</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Note that we assign a unique id to any created models.</p>
<p>The Backbone.sync method is intended to be overridden to support
other persistence backends. The built-in method is tailored to a certain
breed of RESTful JSON APIs - Backbone was originally extracted from a
Ruby on Rails application, which uses HTTP methods like PUT in the same
way.</p>
<p>The sync method is called with three parameters:</p>
<ul>
<li>method: One of create, update, patch, delete, or read</li>
<li>model: The Backbone model object</li>
<li>options: May include success and error methods</li>
</ul>
<p>Implementing a new sync method can use the following pattern:</p>
<div class="sourceCode" id="cb99"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">sync</span> <span class="op">=</span> <span class="kw">function</span>(method<span class="op">,</span> model<span class="op">,</span> options) {</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">success</span>(result) {</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handle successful results from MyAPI</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (options<span class="op">.</span><span class="at">success</span>) {</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>      options<span class="op">.</span><span class="fu">success</span>(result)<span class="op">;</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">error</span>(result) {</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handle error results from MyAPI</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (options<span class="op">.</span><span class="at">error</span>) {</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>      options<span class="op">.</span><span class="fu">error</span>(result)<span class="op">;</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>  options <span class="op">||</span> (options <span class="op">=</span> {})<span class="op">;</span></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span> (method) {</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&#39;create&#39;</span><span class="op">:</span></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> MyAPI<span class="op">.</span><span class="fu">create</span>(model<span class="op">,</span> success<span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&#39;update&#39;</span><span class="op">:</span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> MyAPI<span class="op">.</span><span class="fu">update</span>(model<span class="op">,</span> success<span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&#39;patch&#39;</span><span class="op">:</span></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> MyAPI<span class="op">.</span><span class="fu">patch</span>(model<span class="op">,</span> success<span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&#39;delete&#39;</span><span class="op">:</span></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> MyAPI<span class="op">.</span><span class="fu">destroy</span>(model<span class="op">,</span> success<span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&#39;read&#39;</span><span class="op">:</span></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (model<span class="op">.</span><span class="at">cid</span>) {</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> MyAPI<span class="op">.</span><span class="fu">find</span>(model<span class="op">,</span> success<span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> MyAPI<span class="op">.</span><span class="fu">findAll</span>(model<span class="op">,</span> success<span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>This pattern delegates API calls to a new object (MyAPI), which could
be a Backbone-style class that supports events. This can be safely
tested separately, and potentially used with libraries other than
Backbone.</p>
<p>There are quite a few sync implementations out there. The following
examples are all available on GitHub:</p>
<ul>
<li>Backbone localStorage: persists to the browser’s local storage</li>
<li>Backbone offline: supports working offline</li>
<li>Backbone Redis: uses Redis key-value store</li>
<li>backbone-parse: integrates Backbone with Parse.com</li>
<li>backbone-websql: stores data to WebSQL</li>
<li>Backbone Caching Sync: uses local storage as cache for other sync
implementations</li>
</ul>
<h2 id="dependencies">Dependencies</h2>
<p>The official Backbone.js <a
href="http://backbonejs.org/">documentation</a> states:</p>
<blockquote>
<p>Backbone’s only hard dependency is either Underscore.js ( &gt;=
1.4.3) or Lo-Dash. For RESTful persistence, history support via
Backbone.Router and DOM manipulation with Backbone.View, include
json2.js, and either jQuery ( &gt;= 1.7.0) or Zepto.</p>
</blockquote>
<p>What this translates to is that if you require working with anything
beyond models, you will need to include a DOM manipulation library such
as jQuery or Zepto. Underscore is primarily used for its utility methods
(which Backbone relies upon heavily) and json2.js for legacy browser
JSON support if Backbone.sync is used.</p>
<h2 id="summary-1">Summary</h2>
<p>In this chapter we have introduced you to the components you will be
using to build applications with Backbone: Models, Views, Collections,
and Routers. We’ve also explored the Events mix-in that Backbone uses to
enhance all components with publish-subscribe capabilities and seen how
it can be used with arbitrary objects. Finally, we saw how Backbone
leverages the Underscore.js and jQuery/Zepto APIs to add rich
manipulation and persistence features to Backbone Collections and
Models.</p>
<p>Backbone has many operations and options beyond those we have covered
here and is always evolving, so be sure to visit the official <a
href="http://backbonejs.org/">documentation</a> for more details and the
latest features. In the next chapter you will start to get your hands
dirty as we walk you through the implementation of your first Backbone
application.</p>
<h1 id="exercise-1-todos---your-first-backbone.js-app">Exercise 1: Todos
- Your First Backbone.js App</h1>
<p>Now that we’ve covered fundamentals, let’s write our first
Backbone.js application. We’ll build the Backbone Todo List application
exhibited on <a href="http://todomvc.com">TodoMVC.com</a>. Building a
Todo List is a great way to learn Backbone’s conventions. It’s a
relatively simple application, yet technical challenges surrounding
binding, persisting model data, routing, and template rendering provide
opportunities to illustrate some core Backbone features.</p>
<p><img src="img/todos_a.png" /></p>
<p>Let’s consider the application’s architecture at a high level. We’ll
need:</p>
<ul>
<li>a <code>Todo</code> model to describe individual todo items</li>
<li>a <code>TodoList</code> collection to store and persist todos</li>
<li>a way of creating todos</li>
<li>a way to display a listing of todos</li>
<li>a way to edit existing todos</li>
<li>a way to mark a todo as completed</li>
<li>a way to delete todos</li>
<li>a way to filter the items that have been completed or are
remaining</li>
</ul>
<p>Essentially, these features are classic <a
href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a>
methods. Let’s get started!</p>
<h2 id="static-html">Static HTML</h2>
<p>We’ll place all of our HTML in a single file named index.html.</p>
<h4 id="header-and-scripts">Header and Scripts</h4>
<p>First, we’ll set up the header and the basic application
dependencies: <a href="http://jquery.com">jQuery</a>, <a
href="http://underscorejs.org">Underscore</a>, Backbone.js and the <a
href="https://github.com/jeromegn/Backbone.localStorage">Backbone
LocalStorage adapter</a>.</p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">&quot;en&quot;</span><span class="dt">&gt;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;utf-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> http-equiv</span><span class="op">=</span><span class="st">&quot;X-UA-Compatible&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;IE=edge,chrome=1&quot;</span><span class="dt">&gt;</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Backbone.js • TodoMVC<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;assets/index.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;item-template&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;stats-template&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/jquery.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/underscore-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/backbone-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/backbone.localStorage.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/models/todo.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/collections/todos.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/views/todos.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/views/app.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/routers/router.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/app.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>In addition to the aforementioned dependencies, note that a few other
application-specific files are also loaded. These are organized into
folders representing their application responsibilities: models, views,
collections, and routers. An app.js file is present to house central
initialization code.</p>
<p>Note: If you want to follow along, create a directory structure as
demonstrated in index.html:</p>
<ol type="1">
<li>Place the index.html in a top-level directory.</li>
<li>Download jQuery, Underscore, Backbone, and Backbone LocalStorage
from their respective web sites and place them under js/lib</li>
<li>Create the directories js/models, js/collections, js/views, and
js/routers</li>
</ol>
<p>You will also need <a
href="https://raw.githubusercontent.com/tastejs/todomvc/gh-pages/examples/backbone/node_modules/todomvc-app-css/index.css">index.css</a>,
which should live in an assets directory. And remember that you can see
a demo of the final application at <a
href="http://todomvc.com">TodoMVC.com</a>.</p>
<p>We will be creating the application JavaScript files during the
tutorial. Don’t worry about the two ‘text/template’ script elements - we
will replace those soon!</p>
<h4 id="application-html">Application HTML</h4>
<p>Now let’s populate the body of index.html. We’ll need an
<code>&lt;input&gt;</code> for creating new todos, a
<code>&lt;ul id="todo-list" /&gt;</code> for listing the actual todos,
and a footer where we can later insert statistics and links for
performing operations such as clearing completed todos. We’ll add the
following markup immediately inside our body tag before the script
elements:</p>
<div class="sourceCode" id="cb101"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">section</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;todoapp&quot;</span><span class="dt">&gt;</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">header</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;header&quot;</span><span class="dt">&gt;</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>todos<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;new-todo&quot;</span><span class="ot"> placeholder</span><span class="op">=</span><span class="st">&quot;What needs to be done?&quot;</span><span class="ot"> autofocus</span><span class="dt">&gt;</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">header</span><span class="dt">&gt;</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">section</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;main&quot;</span><span class="dt">&gt;</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;toggle-all&quot;</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;checkbox&quot;</span><span class="dt">&gt;</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;toggle-all&quot;</span><span class="dt">&gt;</span>Mark all as complete<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">ul</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;todo-list&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">section</span><span class="dt">&gt;</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">footer</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;footer&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">footer</span><span class="dt">&gt;</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">section</span><span class="dt">&gt;</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;info&quot;</span><span class="dt">&gt;</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Double-click to edit a todo<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Written by <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;https://github.com/addyosmani&quot;</span><span class="dt">&gt;</span>Addy Osmani<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Part of <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;http://todomvc.com&quot;</span><span class="dt">&gt;</span>TodoMVC<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<h4 id="templates">Templates</h4>
<p>To complete index.html, we need to add the templates which we will
use to dynamically create HTML by injecting model data into their
placeholders. One way of including templates in the page is by using
custom script tags. These don’t get evaluated by the browser, which just
interprets them as plain text. Underscore micro-templating can then
access the templates, rendering fragments of HTML.</p>
<p>We’ll start by filling in the #item-template which will be used to
display individual todo items.</p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- index.html --&gt;</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;item-template&quot;</span><span class="dt">&gt;</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div <span class="kw">class</span><span class="op">=</span><span class="st">&quot;view&quot;</span><span class="op">&gt;</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>input <span class="kw">class</span><span class="op">=</span><span class="st">&quot;toggle&quot;</span> type<span class="op">=</span><span class="st">&quot;checkbox&quot;</span> <span class="op">&lt;%=</span> completed <span class="op">?</span> <span class="st">&#39;checked&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span> <span class="op">%&gt;&gt;</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>label<span class="op">&gt;&lt;%=</span> title <span class="op">%&gt;&lt;/</span>label<span class="op">&gt;</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>button <span class="kw">class</span><span class="op">=</span><span class="st">&quot;destroy&quot;</span><span class="op">&gt;&lt;/</span>button<span class="op">&gt;</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>input <span class="kw">class</span><span class="op">=</span><span class="st">&quot;edit&quot;</span> value<span class="op">=</span><span class="st">&quot;&lt;%= title %&gt;&quot;</span><span class="op">&gt;</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>The template tags in the above markup, such as <code>&lt;%=</code>
and <code>&lt;%-</code>, are specific to Underscore.js and are
documented on the Underscore site. In your own applications, you have a
choice of template libraries, such as Mustache or Handlebars. Use
whichever you prefer, Backbone doesn’t mind.</p>
<p>We also need to define the #stats-template template which we will use
to populate the footer.</p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- index.html --&gt;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;stats-template&quot;</span><span class="dt">&gt;</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>span <span class="kw">class</span><span class="op">=</span><span class="st">&quot;todo-count&quot;</span><span class="op">&gt;&lt;</span>strong<span class="op">&gt;&lt;%=</span> remaining <span class="op">%&gt;&lt;/</span>strong<span class="op">&gt;</span> <span class="op">&lt;%=</span> remaining <span class="op">===</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">&#39;item&#39;</span> <span class="op">:</span> <span class="st">&#39;items&#39;</span> <span class="op">%&gt;</span> left<span class="op">&lt;/</span>span<span class="op">&gt;</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>ul <span class="kw">class</span><span class="op">=</span><span class="st">&quot;filters&quot;</span><span class="op">&gt;</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>li<span class="op">&gt;</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>a <span class="kw">class</span><span class="op">=</span><span class="st">&quot;selected&quot;</span> href<span class="op">=</span><span class="st">&quot;#/&quot;</span><span class="op">&gt;</span>All<span class="op">&lt;/</span>a<span class="op">&gt;</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>li<span class="op">&gt;</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>a href<span class="op">=</span><span class="st">&quot;#/active&quot;</span><span class="op">&gt;</span>Active<span class="op">&lt;/</span>a<span class="op">&gt;</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>li<span class="op">&gt;</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>a href<span class="op">=</span><span class="st">&quot;#/completed&quot;</span><span class="op">&gt;</span>Completed<span class="op">&lt;/</span>a<span class="op">&gt;</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>ul<span class="op">&gt;</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;%</span> <span class="cf">if</span> (completed) { <span class="op">%&gt;</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>button <span class="kw">class</span><span class="op">=</span><span class="st">&quot;clear-completed&quot;</span><span class="op">&gt;</span>Clear <span class="fu">completed</span> (<span class="op">&lt;%=</span> completed <span class="op">%&gt;</span>)<span class="op">&lt;/</span>button<span class="op">&gt;</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;%</span> } <span class="op">%&gt;</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>The #stats-template displays the number of remaining incomplete items
and contains a list of hyperlinks which will be used to perform actions
when we implement our router. It also contains a button which can be
used to clear all of the completed items.</p>
<p>Now that we have all the HTML that we will need, we’ll start
implementing our application by returning to the fundamentals: a Todo
model.</p>
<h2 id="todo-model">Todo model</h2>
<p>The <code>Todo</code> model is remarkably straightforward. First, a
todo has two attributes: a <code>title</code> stores a todo item’s title
and a <code>completed</code> status indicates if it’s complete. These
attributes are passed as defaults, as shown below:</p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// js/models/todo.js</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Todo Model</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ----------</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Our basic **Todo** model has `title` and `completed` attributes.</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="at">Todo</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Default attributes ensure that each todo created has `title` and `completed` keys.</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Toggle the `completed` state of this todo item.</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">toggle</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">save</span>({</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">completed</span><span class="op">:</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>)</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<p>Second, the Todo model has a <code>toggle()</code> method through
which a Todo item’s completion status can be set and simultaneously
persisted.</p>
<h2 id="todo-collection">Todo collection</h2>
<p>Next, a <code>TodoList</code> collection is used to group our models.
The collection uses the LocalStorage adapter to override Backbone’s
default <code>sync()</code> operation with one that will persist our
Todo records to HTML5 Local Storage. Through local storage, they’re
saved between page requests.</p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// js/collections/todos.js</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Todo Collection</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ---------------</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The collection of todos is backed by *localStorage* instead of a remote</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// server.</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> TodoList <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reference to this collection&#39;s model.</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> app<span class="op">.</span><span class="at">Todo</span><span class="op">,</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Save all of the todo items under the `&quot;todos-backbone&quot;` namespace.</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">localStorage</span><span class="op">:</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">LocalStorage</span>(<span class="st">&#39;todos-backbone&#39;</span>)<span class="op">,</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Filter down the list of all todo items that are finished.</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span>( todo ) {</span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>)<span class="op">;</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Filter down the list to only todo items that are still not finished.</span></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">remaining</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">without</span><span class="op">.</span><span class="fu">apply</span>( <span class="kw">this</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">completed</span>() )<span class="op">;</span></span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We keep the Todos in sequential order, despite being saved by unordered</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// GUID in the database. This generates the next order number for new items.</span></span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">nextOrder</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ( <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">length</span> ) {</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">last</span>()<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;order&#39;</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Todos are sorted by their original insertion order.</span></span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">comparator</span><span class="op">:</span> <span class="kw">function</span>( todo ) {</span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;order&#39;</span>)<span class="op">;</span></span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb105-45"><a href="#cb105-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-46"><a href="#cb105-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create our global collection of **Todos**.</span></span>
<span id="cb105-47"><a href="#cb105-47" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="at">Todos</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoList</span>()<span class="op">;</span></span></code></pre></div>
<p>The collection’s <code>completed()</code> and
<code>remaining()</code> methods return an array of finished and
unfinished todos, respectively.</p>
<p>A <code>nextOrder()</code> method implements a sequence generator
while a <code>comparator()</code> sorts items by their insertion
order.</p>
<p><em>Note</em>: <code>this.filter</code>, <code>this.without</code>
and <code>this.last</code> are Underscore methods that are mixed in to
Backbone.Collection so that the reader knows how to find out more about
them.</p>
<h2 id="application-view">Application View</h2>
<p>Let’s examine the core application logic which resides in the views.
Each view supports functionality such as edit-in-place, and therefore
contains a fair amount of logic. To help organize this logic, we’ll use
the element controller pattern. The element controller pattern consists
of two views: one controls a collection of items while the other deals
with each individual item.</p>
<p>In our case, an <code>AppView</code> will handle the creation of new
todos and rendering of the initial todo list. Instances of
<code>TodoView</code> will be associated with each individual Todo
record. Todo instances can handle editing, updating, and destroying
their associated todo.</p>
<p>To keep things short and simple, we won’t be implementing all of the
application’s features in this tutorial, we’ll just cover enough to get
you started. Even so, there is a lot for us to cover in
<code>AppView</code>, so we’ll split our discussion into two
sections.</p>
<div class="sourceCode" id="cb106"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// js/views/app.js</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The Application</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ---------------</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Our overall **AppView** is the top-level piece of UI.</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="at">AppView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Instead of generating a new element, bind to the existing skeleton of</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// the App already present in the HTML.</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">el</span><span class="op">:</span> <span class="st">&#39;.todoapp&#39;</span><span class="op">,</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our template for the line of statistics at the bottom of the app.</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">statsTemplate</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>( <span class="fu">$</span>(<span class="st">&#39;#stats-template&#39;</span>)<span class="op">.</span><span class="fu">html</span>() )<span class="op">,</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// At initialization we bind to the relevant events on the `Todos`</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// collection, when items are added or changed.</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">allCheckbox</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.toggle-all&#39;</span>)[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$input</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.new-todo&#39;</span>)<span class="op">;</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$footer</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.footer&#39;</span>)<span class="op">;</span></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$main</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.main&#39;</span>)<span class="op">;</span></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(app<span class="op">.</span><span class="at">Todos</span><span class="op">,</span> <span class="st">&#39;add&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">addOne</span>)<span class="op">;</span></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(app<span class="op">.</span><span class="at">Todos</span><span class="op">,</span> <span class="st">&#39;reset&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">addAll</span>)<span class="op">;</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add a single todo item to the list by creating a view for it, and</span></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// appending its element to the `&lt;ul&gt;`.</span></span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">addOne</span><span class="op">:</span> <span class="kw">function</span>( todo ) {</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> view <span class="op">=</span> <span class="kw">new</span> app<span class="op">.</span><span class="fu">TodoView</span>({ <span class="dt">model</span><span class="op">:</span> todo })<span class="op">;</span></span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">$</span>(<span class="st">&#39;.todo-list&#39;</span>)<span class="op">.</span><span class="fu">append</span>( view<span class="op">.</span><span class="fu">render</span>()<span class="op">.</span><span class="at">el</span> )<span class="op">;</span></span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add all items in the **Todos** collection at once.</span></span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">addAll</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.todo-list&#39;</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">each</span>(<span class="kw">this</span><span class="op">.</span><span class="at">addOne</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<p>A few notable features are present in our initial version of AppView,
including a <code>statsTemplate</code>, an <code>initialize</code>
method that’s implicitly called on instantiation, and several
view-specific methods.</p>
<p>An <code>el</code> (element) property stores a selector targeting the
DOM element with an ID of <code>todoapp</code>. In the case of our
application, <code>el</code> refers to the matching
<code>&lt;section id="todoapp" /&gt;</code> element in index.html.</p>
<p>The call to _.template uses Underscore’s micro-templating to
construct a statsTemplate object from our #stats-template. We will use
this template later when we render our view.</p>
<p>Now let’s take a look at the <code>initialize</code> function. First,
it’s using jQuery to cache the elements it will be using into local
properties (recall that <code>this.$()</code> finds elements relative to
<code>this.$el</code>). Then it’s binding to two events on the Todos
collection: <code>add</code> and <code>reset</code>. Since we’re
delegating handling of updates and deletes to the <code>TodoView</code>
view, we don’t need to worry about those here. The two pieces of logic
are:</p>
<ul>
<li><p>When an <code>add</code> event is fired the <code>addOne()</code>
method is called and passed the new model. <code>addOne()</code> creates
an instance of TodoView view, renders it, and appends the resulting
element to our Todo list.</p></li>
<li><p>When a <code>reset</code> event occurs (i.e., we update the
collection in bulk as happens when the Todos are loaded from Local
Storage), <code>addAll()</code> is called, which iterates over all of
the Todos currently in our collection and fires <code>addOne()</code>
for each item.</p></li>
</ul>
<p>Note that we were able to use <code>this</code> within
<code>addAll()</code> to refer to the view because
<code>listenTo()</code> implicitly set the callback’s context to the
view when it created the binding.</p>
<p>Now, let’s add some more logic to complete our AppView!</p>
<div class="sourceCode" id="cb107"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// js/views/app.js</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The Application</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ---------------</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Our overall **AppView** is the top-level piece of UI.</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="at">AppView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Instead of generating a new element, bind to the existing skeleton of</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// the App already present in the HTML.</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">el</span><span class="op">:</span> <span class="st">&#39;.todoapp&#39;</span><span class="op">,</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our template for the line of statistics at the bottom of the app.</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">statsTemplate</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>( <span class="fu">$</span>(<span class="st">&#39;#stats-template&#39;</span>)<span class="op">.</span><span class="fu">html</span>() )<span class="op">,</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Delegated events for creating new items, and clearing completed ones.</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;keypress .new-todo&#39;</span><span class="op">:</span> <span class="st">&#39;createOnEnter&#39;</span><span class="op">,</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;click .clear-completed&#39;</span><span class="op">:</span> <span class="st">&#39;clearCompleted&#39;</span><span class="op">,</span></span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;click .toggle-all&#39;</span><span class="op">:</span> <span class="st">&#39;toggleAllComplete&#39;</span></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// At initialization we bind to the relevant events on the `Todos`</span></span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// collection, when items are added or changed. Kick things off by</span></span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// loading any preexisting todos that might be saved in *localStorage*.</span></span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">allCheckbox</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.toggle-all&#39;</span>)[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$input</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.new-todo&#39;</span>)<span class="op">;</span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$footer</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.footer&#39;</span>)<span class="op">;</span></span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$main</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.main&#39;</span>)<span class="op">;</span></span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-36"><a href="#cb107-36" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(app<span class="op">.</span><span class="at">Todos</span><span class="op">,</span> <span class="st">&#39;add&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">addOne</span>)<span class="op">;</span></span>
<span id="cb107-37"><a href="#cb107-37" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(app<span class="op">.</span><span class="at">Todos</span><span class="op">,</span> <span class="st">&#39;reset&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">addAll</span>)<span class="op">;</span></span>
<span id="cb107-38"><a href="#cb107-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-39"><a href="#cb107-39" aria-hidden="true" tabindex="-1"></a>      <span class="co">// New</span></span>
<span id="cb107-40"><a href="#cb107-40" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(app<span class="op">.</span><span class="at">Todos</span><span class="op">,</span> <span class="st">&#39;change:completed&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">filterOne</span>)<span class="op">;</span></span>
<span id="cb107-41"><a href="#cb107-41" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(app<span class="op">.</span><span class="at">Todos</span><span class="op">,</span><span class="st">&#39;filter&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">filterAll</span>)<span class="op">;</span></span>
<span id="cb107-42"><a href="#cb107-42" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(app<span class="op">.</span><span class="at">Todos</span><span class="op">,</span> <span class="st">&#39;all&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb107-43"><a href="#cb107-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-44"><a href="#cb107-44" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">fetch</span>()<span class="op">;</span></span>
<span id="cb107-45"><a href="#cb107-45" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-46"><a href="#cb107-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-47"><a href="#cb107-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New</span></span>
<span id="cb107-48"><a href="#cb107-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Re-rendering the App just means refreshing the statistics -- the rest</span></span>
<span id="cb107-49"><a href="#cb107-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">// of the app doesn&#39;t change.</span></span>
<span id="cb107-50"><a href="#cb107-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb107-51"><a href="#cb107-51" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> completed <span class="op">=</span> app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">completed</span>()<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb107-52"><a href="#cb107-52" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> remaining <span class="op">=</span> app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">remaining</span>()<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb107-53"><a href="#cb107-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-54"><a href="#cb107-54" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ( app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="at">length</span> ) {</span>
<span id="cb107-55"><a href="#cb107-55" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$main</span><span class="op">.</span><span class="fu">show</span>()<span class="op">;</span></span>
<span id="cb107-56"><a href="#cb107-56" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$footer</span><span class="op">.</span><span class="fu">show</span>()<span class="op">;</span></span>
<span id="cb107-57"><a href="#cb107-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-58"><a href="#cb107-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$footer</span><span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">statsTemplate</span>({</span>
<span id="cb107-59"><a href="#cb107-59" aria-hidden="true" tabindex="-1"></a>          <span class="dt">completed</span><span class="op">:</span> completed<span class="op">,</span></span>
<span id="cb107-60"><a href="#cb107-60" aria-hidden="true" tabindex="-1"></a>          <span class="dt">remaining</span><span class="op">:</span> remaining</span>
<span id="cb107-61"><a href="#cb107-61" aria-hidden="true" tabindex="-1"></a>        }))<span class="op">;</span></span>
<span id="cb107-62"><a href="#cb107-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-63"><a href="#cb107-63" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.filters li a&#39;</span>)</span>
<span id="cb107-64"><a href="#cb107-64" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">removeClass</span>(<span class="st">&#39;selected&#39;</span>)</span>
<span id="cb107-65"><a href="#cb107-65" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">filter</span>(<span class="st">&#39;[href=&quot;#/&#39;</span> <span class="op">+</span> ( app<span class="op">.</span><span class="at">TodoFilter</span> <span class="op">||</span> <span class="st">&#39;&#39;</span> ) <span class="op">+</span> <span class="st">&#39;&quot;]&#39;</span>)</span>
<span id="cb107-66"><a href="#cb107-66" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">addClass</span>(<span class="st">&#39;selected&#39;</span>)<span class="op">;</span></span>
<span id="cb107-67"><a href="#cb107-67" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb107-68"><a href="#cb107-68" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$main</span><span class="op">.</span><span class="fu">hide</span>()<span class="op">;</span></span>
<span id="cb107-69"><a href="#cb107-69" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$footer</span><span class="op">.</span><span class="fu">hide</span>()<span class="op">;</span></span>
<span id="cb107-70"><a href="#cb107-70" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb107-71"><a href="#cb107-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-72"><a href="#cb107-72" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">allCheckbox</span><span class="op">.</span><span class="at">checked</span> <span class="op">=</span> <span class="op">!</span>remaining<span class="op">;</span></span>
<span id="cb107-73"><a href="#cb107-73" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-74"><a href="#cb107-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-75"><a href="#cb107-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add a single todo item to the list by creating a view for it, and</span></span>
<span id="cb107-76"><a href="#cb107-76" aria-hidden="true" tabindex="-1"></a>    <span class="co">// appending its element to the `&lt;ul&gt;`.</span></span>
<span id="cb107-77"><a href="#cb107-77" aria-hidden="true" tabindex="-1"></a>    <span class="dt">addOne</span><span class="op">:</span> <span class="kw">function</span>( todo ) {</span>
<span id="cb107-78"><a href="#cb107-78" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> view <span class="op">=</span> <span class="kw">new</span> app<span class="op">.</span><span class="fu">TodoView</span>({ <span class="dt">model</span><span class="op">:</span> todo })<span class="op">;</span></span>
<span id="cb107-79"><a href="#cb107-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">$</span>(<span class="st">&#39;.todo-list&#39;</span>)<span class="op">.</span><span class="fu">append</span>( view<span class="op">.</span><span class="fu">render</span>()<span class="op">.</span><span class="at">el</span> )<span class="op">;</span></span>
<span id="cb107-80"><a href="#cb107-80" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-81"><a href="#cb107-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-82"><a href="#cb107-82" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add all items in the **Todos** collection at once.</span></span>
<span id="cb107-83"><a href="#cb107-83" aria-hidden="true" tabindex="-1"></a>    <span class="dt">addAll</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb107-84"><a href="#cb107-84" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.todo-list&#39;</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb107-85"><a href="#cb107-85" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">each</span>(<span class="kw">this</span><span class="op">.</span><span class="at">addOne</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb107-86"><a href="#cb107-86" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-87"><a href="#cb107-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-88"><a href="#cb107-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New</span></span>
<span id="cb107-89"><a href="#cb107-89" aria-hidden="true" tabindex="-1"></a>    <span class="dt">filterOne</span> <span class="op">:</span> <span class="kw">function</span> (todo) {</span>
<span id="cb107-90"><a href="#cb107-90" aria-hidden="true" tabindex="-1"></a>      todo<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;visible&#39;</span>)<span class="op">;</span></span>
<span id="cb107-91"><a href="#cb107-91" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-92"><a href="#cb107-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-93"><a href="#cb107-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New</span></span>
<span id="cb107-94"><a href="#cb107-94" aria-hidden="true" tabindex="-1"></a>    <span class="dt">filterAll</span> <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb107-95"><a href="#cb107-95" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">each</span>(<span class="kw">this</span><span class="op">.</span><span class="at">filterOne</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb107-96"><a href="#cb107-96" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-97"><a href="#cb107-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-98"><a href="#cb107-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-99"><a href="#cb107-99" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New</span></span>
<span id="cb107-100"><a href="#cb107-100" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Generate the attributes for a new Todo item.</span></span>
<span id="cb107-101"><a href="#cb107-101" aria-hidden="true" tabindex="-1"></a>    <span class="dt">newAttributes</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb107-102"><a href="#cb107-102" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb107-103"><a href="#cb107-103" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">$input</span><span class="op">.</span><span class="fu">val</span>()<span class="op">.</span><span class="fu">trim</span>()<span class="op">,</span></span>
<span id="cb107-104"><a href="#cb107-104" aria-hidden="true" tabindex="-1"></a>        <span class="dt">order</span><span class="op">:</span> app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">nextOrder</span>()<span class="op">,</span></span>
<span id="cb107-105"><a href="#cb107-105" aria-hidden="true" tabindex="-1"></a>        <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb107-106"><a href="#cb107-106" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb107-107"><a href="#cb107-107" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-108"><a href="#cb107-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-109"><a href="#cb107-109" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New</span></span>
<span id="cb107-110"><a href="#cb107-110" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If you hit return in the main input field, create new Todo model,</span></span>
<span id="cb107-111"><a href="#cb107-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">// persisting it to localStorage.</span></span>
<span id="cb107-112"><a href="#cb107-112" aria-hidden="true" tabindex="-1"></a>    <span class="dt">createOnEnter</span><span class="op">:</span> <span class="kw">function</span>( <span class="bu">event</span> ) {</span>
<span id="cb107-113"><a href="#cb107-113" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ( <span class="bu">event</span><span class="op">.</span><span class="at">which</span> <span class="op">!==</span> ENTER_KEY <span class="op">||</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">$input</span><span class="op">.</span><span class="fu">val</span>()<span class="op">.</span><span class="fu">trim</span>() ) {</span>
<span id="cb107-114"><a href="#cb107-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb107-115"><a href="#cb107-115" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb107-116"><a href="#cb107-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-117"><a href="#cb107-117" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">create</span>( <span class="kw">this</span><span class="op">.</span><span class="fu">newAttributes</span>() )<span class="op">;</span></span>
<span id="cb107-118"><a href="#cb107-118" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$input</span><span class="op">.</span><span class="fu">val</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb107-119"><a href="#cb107-119" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-120"><a href="#cb107-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-121"><a href="#cb107-121" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New</span></span>
<span id="cb107-122"><a href="#cb107-122" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clear all completed todo items, destroying their models.</span></span>
<span id="cb107-123"><a href="#cb107-123" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clearCompleted</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb107-124"><a href="#cb107-124" aria-hidden="true" tabindex="-1"></a>      _<span class="op">.</span><span class="fu">invoke</span>(app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">completed</span>()<span class="op">,</span> <span class="st">&#39;destroy&#39;</span>)<span class="op">;</span></span>
<span id="cb107-125"><a href="#cb107-125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb107-126"><a href="#cb107-126" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb107-127"><a href="#cb107-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-128"><a href="#cb107-128" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New</span></span>
<span id="cb107-129"><a href="#cb107-129" aria-hidden="true" tabindex="-1"></a>    <span class="dt">toggleAllComplete</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb107-130"><a href="#cb107-130" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> completed <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">allCheckbox</span><span class="op">.</span><span class="at">checked</span><span class="op">;</span></span>
<span id="cb107-131"><a href="#cb107-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-132"><a href="#cb107-132" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>( todo ) {</span>
<span id="cb107-133"><a href="#cb107-133" aria-hidden="true" tabindex="-1"></a>        todo<span class="op">.</span><span class="fu">save</span>({</span>
<span id="cb107-134"><a href="#cb107-134" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;completed&#39;</span><span class="op">:</span> completed</span>
<span id="cb107-135"><a href="#cb107-135" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb107-136"><a href="#cb107-136" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb107-137"><a href="#cb107-137" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb107-138"><a href="#cb107-138" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<p>We have added the logic for creating new todos, editing them, and
filtering them based on their completed status.</p>
<ul>
<li>events: We’ve defined an <code>events</code> hash containing
declarative callbacks for our DOM events. It binds those events to the
following methods:
<ul>
<li><code>createOnEnter()</code>: Creates a new Todo model and persists
it in localStorage when a user hits enter inside the
<code>&lt;input/&gt;</code> field. Also resets the main
<code>&lt;input/&gt;</code> field value to prepare it for the next
entry. The model is populated by newAttributes(), which returns an
object literal composed of the title, order, and completed state of the
new item. Note that <code>this</code> is referring to the view and not
the DOM element since the callback was bound using the
<code>events</code> hash.</li>
<li><code>clearCompleted()</code>: Removes the items in the todo list
that have been marked as completed when the user clicks the
clear-completed checkbox (this checkbox will be in the footer populated
by the #stats-template).</li>
<li><code>toggleAllComplete()</code>: Allows a user to mark all of the
items in the todo list as completed by clicking the toggle-all
checkbox.</li>
</ul></li>
<li><code>initialize()</code>: We’ve bound callbacks to several
additional events:
<ul>
<li>We’ve bound a <code>filterOne()</code> callback on the Todos
collection for a <code>change:completed</code> event. This listens for
changes to the completed flag for any model in the collection. The
affected todo is passed to the callback which triggers a custom
<code>visible</code> event on the model.</li>
<li>We’ve bound a <code>filterAll()</code> callback for a
<code>filter</code> event, which works a little similar to addOne() and
addAll(). Its responsibility is to toggle which todo items are visible
based on the filter currently selected in the UI (all, completed or
remaining) via calls to filterOne().</li>
<li>We’ve used the special <code>all</code> event to bind any event
triggered on the Todos collection to the view’s render method (discussed
below).</li>
</ul></li>
</ul>
<p>The <code>initialize()</code> method completes by fetching the
previously saved todos from localStorage.</p>
<ul>
<li><code>render()</code>: Several things are happening in our
<code>render()</code> method:
<ul>
<li>The #main and #footer sections are displayed or hidden depending on
whether there are any todos in the collection.</li>
<li>The footer is populated with the HTML produced by instantiating the
statsTemplate with the number of completed and remaining todo
items.</li>
<li>The HTML produced by the preceding step contains a list of filter
links. The value of <code>app.TodoFilter</code>, which will be set by
our router, is being used to apply the class ‘selected’ to the link
corresponding to the currently selected filter. This will result in
conditional CSS styling being applied to that filter.</li>
<li>The allCheckbox is updated based on whether there are remaining
todos.</li>
</ul></li>
</ul>
<h2 id="individual-todo-view">Individual Todo View</h2>
<p>Now let’s look at the <code>TodoView</code> view. This will be in
charge of individual Todo records, making sure the view updates when the
todo does. To enable this functionality, we will add event listeners to
the view that listen for events on an individual todo’s HTML
representation.</p>
<div class="sourceCode" id="cb108"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// js/views/todos.js</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Todo Item View</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --------------</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The DOM element for a todo item...</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="at">TodoView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//... is a list tag.</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tagName</span><span class="op">:</span> <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cache the template function for a single item.</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>( <span class="fu">$</span>(<span class="st">&#39;#item-template&#39;</span>)<span class="op">.</span><span class="fu">html</span>() )<span class="op">,</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The DOM events specific to an item.</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;dblclick label&#39;</span><span class="op">:</span> <span class="st">&#39;edit&#39;</span><span class="op">,</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;keypress .edit&#39;</span><span class="op">:</span> <span class="st">&#39;updateOnEnter&#39;</span><span class="op">,</span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;blur .edit&#39;</span><span class="op">:</span> <span class="st">&#39;close&#39;</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The TodoView listens for changes to its model, re-rendering. Since there&#39;s</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a one-to-one correspondence between a **Todo** and a **TodoView** in this</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// app, we set a direct reference on the model for convenience.</span></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Re-renders the titles of the todo item.</span></span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>( <span class="kw">this</span><span class="op">.</span><span class="fu">template</span>( <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span> ) )<span class="op">;</span></span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$input</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.edit&#39;</span>)<span class="op">;</span></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Switch this view into `&quot;editing&quot;` mode, displaying the input field.</span></span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">edit</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">addClass</span>(<span class="st">&#39;editing&#39;</span>)<span class="op">;</span></span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$input</span><span class="op">.</span><span class="fu">focus</span>()<span class="op">;</span></span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Close the `&quot;editing&quot;` mode, saving changes to the todo.</span></span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">close</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> value <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">$input</span><span class="op">.</span><span class="fu">val</span>()<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ( value ) {</span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">save</span>({ <span class="dt">title</span><span class="op">:</span> value })<span class="op">;</span></span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">removeClass</span>(<span class="st">&#39;editing&#39;</span>)<span class="op">;</span></span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If you hit `enter`, we&#39;re through editing the item.</span></span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">updateOnEnter</span><span class="op">:</span> <span class="kw">function</span>( e ) {</span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ( e<span class="op">.</span><span class="at">which</span> <span class="op">===</span> ENTER_KEY ) {</span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<p>In the <code>initialize()</code> constructor, we set up a listener
that monitors a todo model’s <code>change</code> event. As a result,
when the todo gets updated, the application will re-render the view and
visually reflect its changes. Note that the model passed in the
arguments hash by our AppView is automatically available to us as
<code>this.model</code>.</p>
<p>In the <code>render()</code> method, we render our Underscore.js
<code>#item-template</code>, which was previously compiled into
this.template using Underscore’s <code>_.template()</code> method. This
returns an HTML fragment that replaces the content of the view’s element
(an li element was implicitly created for us based on the
<code>tagName</code> property). In other words, the rendered template is
now present under <code>this.el</code> and can be appended to the todo
list in the user interface. <code>render()</code> finishes by caching
the input element within the instantiated template into
<code>this.$input</code>.</p>
<p>Our events hash includes three callbacks:</p>
<ul>
<li><code>edit()</code>: changes the current view into editing mode when
a user double-clicks on an existing item in the todo list. This allows
them to change the existing value of the item’s title attribute.</li>
<li><code>updateOnEnter()</code>: checks that the user has hit the
return/enter key and executes the close() function.</li>
<li><code>close()</code>: trims the value of the current text in our
<code>&lt;input/&gt;</code> field, ensuring that we don’t process it
further if it does not contain any text (e.g. ’’). If a valid value has
been provided, we save the changes to the current todo model and close
editing mode by removing the corresponding CSS class.</li>
</ul>
<h2 id="startup">Startup</h2>
<p>So now we have two views: <code>AppView</code> and
<code>TodoView</code>. The former needs to be instantiated on page load
so its code gets executed. This can be accomplished through jQuery’s
<code>ready()</code> utility, which will execute a function when the DOM
is loaded.</p>
<div class="sourceCode" id="cb109"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// js/app.js</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ENTER_KEY <span class="op">=</span> <span class="dv">13</span><span class="op">;</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="kw">function</span>() {</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Kick things off by creating the **App**.</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> app<span class="op">.</span><span class="fu">AppView</span>()<span class="op">;</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<h2 id="in-action">In action</h2>
<p>Let’s pause and ensure that the work we’ve done so far functions as
intended.</p>
<p>If you are following along, open
<code>file://*path*/index.html</code> in your browser and monitor its
console. If all is well, you shouldn’t see any JavaScript errors other
than regarding the router.js file that we haven’t created yet. The todo
list should be blank as we haven’t yet created any todos. Plus, there is
some additional work we’ll need to do before the user interface fully
functions.</p>
<p>However, a few things can be tested through the JavaScript
console.</p>
<p>In the console, add a new todo item:
<code>app.Todos.create({ title: 'My first Todo item'});</code> and hit
return.</p>
<p><img src="img/todos_d.png" /></p>
<p>If all is functioning properly, this should log the new todo we’ve
just added to the todos collection. The newly created todo is also saved
to Local Storage and will be available on page refresh.</p>
<p><code>app.Todos.create()</code> executes a collection method
(<code>Collection.create(attributes, [options])</code>) which
instantiates a new model item of the type passed into the collection
definition, in our case <code>app.Todo</code>:</p>
<div class="sourceCode" id="cb110"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// from our js/collections/todos.js</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> TodoList <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">model</span><span class="op">:</span> app<span class="op">.</span><span class="at">Todo</span> <span class="co">// the model type used by collection.create() to instantiate new model in the collection</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  )}<span class="op">;</span></span></code></pre></div>
<p>Run the following in the console to check it out:</p>
<div class="sourceCode" id="cb111"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> secondTodo <span class="op">=</span> app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">create</span>({ <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;My second Todo item&#39;</span>})<span class="op">;</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>secondTodo <span class="kw">instanceof</span> app<span class="op">.</span><span class="at">Todo</span> <span class="co">// returns true</span></span></code></pre></div>
<p>Now refresh the page and we should be able to see the fruits of our
labour.</p>
<p>The todos added through the console should still appear in the list
since they are populated from the Local Storage. Also, we should be able
to create a new todo by typing a title and pressing enter.</p>
<p><img src="img/todos_b.png" /></p>
<p>Excellent, we’re making great progress, but what about completing and
deleting todos?</p>
<h2 id="completing-deleting-todos">Completing &amp; deleting todos</h2>
<p>The next part of our tutorial is going to cover completing and
deleting todos. These two actions are specific to each Todo item, so we
need to add this functionality to the TodoView view. We will do so by
adding <code>togglecompleted()</code> and <code>clear()</code> methods
along with corresponding entries in the <code>events</code> hash.</p>
<div class="sourceCode" id="cb112"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// js/views/todos.js</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Todo Item View</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --------------</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The DOM element for a todo item...</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="at">TodoView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//... is a list tag.</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tagName</span><span class="op">:</span> <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cache the template function for a single item.</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>( <span class="fu">$</span>(<span class="st">&#39;#item-template&#39;</span>)<span class="op">.</span><span class="fu">html</span>() )<span class="op">,</span></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The DOM events specific to an item.</span></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;click .toggle&#39;</span><span class="op">:</span> <span class="st">&#39;toggleCompleted&#39;</span><span class="op">,</span> <span class="co">// NEW</span></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;dblclick label&#39;</span><span class="op">:</span> <span class="st">&#39;edit&#39;</span><span class="op">,</span></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;click .destroy&#39;</span><span class="op">:</span> <span class="st">&#39;clear&#39;</span><span class="op">,</span>           <span class="co">// NEW</span></span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;keypress .edit&#39;</span><span class="op">:</span> <span class="st">&#39;updateOnEnter&#39;</span><span class="op">,</span></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;blur .edit&#39;</span><span class="op">:</span> <span class="st">&#39;close&#39;</span></span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The TodoView listens for changes to its model, re-rendering. Since there&#39;s</span></span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a one-to-one correspondence between a **Todo** and a **TodoView** in this</span></span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// app, we set a direct reference on the model for convenience.</span></span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;destroy&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">remove</span>)<span class="op">;</span>        <span class="co">// NEW</span></span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;visible&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">toggleVisible</span>)<span class="op">;</span> <span class="co">// NEW</span></span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb112-35"><a href="#cb112-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-36"><a href="#cb112-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Re-render the titles of the todo item.</span></span>
<span id="cb112-37"><a href="#cb112-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb112-38"><a href="#cb112-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>( <span class="kw">this</span><span class="op">.</span><span class="fu">template</span>( <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span> ) )<span class="op">;</span></span>
<span id="cb112-39"><a href="#cb112-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-40"><a href="#cb112-40" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">toggleClass</span>( <span class="st">&#39;completed&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>) )<span class="op">;</span> <span class="co">// NEW</span></span>
<span id="cb112-41"><a href="#cb112-41" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">toggleVisible</span>()<span class="op">;</span>                                             <span class="co">// NEW</span></span>
<span id="cb112-42"><a href="#cb112-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-43"><a href="#cb112-43" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$input</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.edit&#39;</span>)<span class="op">;</span></span>
<span id="cb112-44"><a href="#cb112-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb112-45"><a href="#cb112-45" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb112-46"><a href="#cb112-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-47"><a href="#cb112-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NEW - Toggles visibility of item</span></span>
<span id="cb112-48"><a href="#cb112-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">toggleVisible</span> <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb112-49"><a href="#cb112-49" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">toggleClass</span>( <span class="st">&#39;hidden&#39;</span><span class="op">,</span>  <span class="kw">this</span><span class="op">.</span><span class="fu">isHidden</span>())<span class="op">;</span></span>
<span id="cb112-50"><a href="#cb112-50" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb112-51"><a href="#cb112-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-52"><a href="#cb112-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NEW - Determines if item should be hidden</span></span>
<span id="cb112-53"><a href="#cb112-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">isHidden</span> <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb112-54"><a href="#cb112-54" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> isCompleted <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>)<span class="op">;</span></span>
<span id="cb112-55"><a href="#cb112-55" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> ( <span class="co">// hidden cases only</span></span>
<span id="cb112-56"><a href="#cb112-56" aria-hidden="true" tabindex="-1"></a>        (<span class="op">!</span>isCompleted <span class="op">&amp;&amp;</span> app<span class="op">.</span><span class="at">TodoFilter</span> <span class="op">===</span> <span class="st">&#39;completed&#39;</span>)</span>
<span id="cb112-57"><a href="#cb112-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">||</span> (isCompleted <span class="op">&amp;&amp;</span> app<span class="op">.</span><span class="at">TodoFilter</span> <span class="op">===</span> <span class="st">&#39;active&#39;</span>)</span>
<span id="cb112-58"><a href="#cb112-58" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb112-59"><a href="#cb112-59" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb112-60"><a href="#cb112-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-61"><a href="#cb112-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NEW - Toggle the `&quot;completed&quot;` state of the model.</span></span>
<span id="cb112-62"><a href="#cb112-62" aria-hidden="true" tabindex="-1"></a>    <span class="dt">togglecompleted</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb112-63"><a href="#cb112-63" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">toggle</span>()<span class="op">;</span></span>
<span id="cb112-64"><a href="#cb112-64" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb112-65"><a href="#cb112-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-66"><a href="#cb112-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Switch this view into `&quot;editing&quot;` mode, displaying the input field.</span></span>
<span id="cb112-67"><a href="#cb112-67" aria-hidden="true" tabindex="-1"></a>    <span class="dt">edit</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb112-68"><a href="#cb112-68" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">addClass</span>(<span class="st">&#39;editing&#39;</span>)<span class="op">;</span></span>
<span id="cb112-69"><a href="#cb112-69" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$input</span><span class="op">.</span><span class="fu">focus</span>()<span class="op">;</span></span>
<span id="cb112-70"><a href="#cb112-70" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb112-71"><a href="#cb112-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-72"><a href="#cb112-72" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Close the `&quot;editing&quot;` mode, saving changes to the todo.</span></span>
<span id="cb112-73"><a href="#cb112-73" aria-hidden="true" tabindex="-1"></a>    <span class="dt">close</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb112-74"><a href="#cb112-74" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> value <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">$input</span><span class="op">.</span><span class="fu">val</span>()<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb112-75"><a href="#cb112-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-76"><a href="#cb112-76" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ( value ) {</span>
<span id="cb112-77"><a href="#cb112-77" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">save</span>({ <span class="dt">title</span><span class="op">:</span> value })<span class="op">;</span></span>
<span id="cb112-78"><a href="#cb112-78" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb112-79"><a href="#cb112-79" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span> <span class="co">// NEW</span></span>
<span id="cb112-80"><a href="#cb112-80" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb112-81"><a href="#cb112-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-82"><a href="#cb112-82" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">removeClass</span>(<span class="st">&#39;editing&#39;</span>)<span class="op">;</span></span>
<span id="cb112-83"><a href="#cb112-83" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb112-84"><a href="#cb112-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-85"><a href="#cb112-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If you hit `enter`, we&#39;re through editing the item.</span></span>
<span id="cb112-86"><a href="#cb112-86" aria-hidden="true" tabindex="-1"></a>    <span class="dt">updateOnEnter</span><span class="op">:</span> <span class="kw">function</span>( e ) {</span>
<span id="cb112-87"><a href="#cb112-87" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ( e<span class="op">.</span><span class="at">which</span> <span class="op">===</span> ENTER_KEY ) {</span>
<span id="cb112-88"><a href="#cb112-88" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb112-89"><a href="#cb112-89" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb112-90"><a href="#cb112-90" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb112-91"><a href="#cb112-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-92"><a href="#cb112-92" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NEW - Remove the item, destroy the model from *localStorage* and delete its view.</span></span>
<span id="cb112-93"><a href="#cb112-93" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clear</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb112-94"><a href="#cb112-94" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">destroy</span>()<span class="op">;</span></span>
<span id="cb112-95"><a href="#cb112-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-96"><a href="#cb112-96" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<p>The key part of this is the two event handlers we’ve added, a
togglecompleted event on the todo’s checkbox, and a click event on the
todo’s <code>&lt;button class="destroy" /&gt;</code> button.</p>
<p>Let’s look at the events that occur when we click the checkbox for a
todo item:</p>
<ol type="1">
<li>The <code>togglecompleted()</code> function is invoked which calls
<code>toggle()</code> on the todo model.</li>
<li><code>toggle()</code> toggles the completed status of the todo and
calls <code>save()</code> on the model.</li>
<li>The save generates a <code>change</code> event on the model which is
bound to our TodoView’s <code>render()</code> method. We’ve added a
statement in <code>render()</code> which toggles the completed class on
the element depending on the model’s completed state. The associated CSS
changes the color of the title text and strikes a line through it when
the todo is completed.</li>
<li>The save also results in a <code>change:completed</code> event on
the model which is handled by the AppView’s <code>filterOne()</code>
method. If we look back at the AppView, we see that filterOne() will
trigger a <code>visible</code> event on the model. This is used in
conjunction with the filtering in our routes and collections so that we
only display an item if its completed state falls in line with the
current filter. In our update to the TodoView, we bound the model’s
visible event to the <code>toggleVisible()</code> method. This method
uses the new <code>isHidden()</code> method to determine if the todo
should be visible and updates it accordingly.</li>
</ol>
<p>Now let’s look at what happens when we click on a todo’s destroy
button:</p>
<ol type="1">
<li>The <code>clear()</code> method is invoked which calls
<code>destroy()</code> on the todo model.</li>
<li>The todo is deleted from local storage and a <code>destroy</code>
event is triggered.</li>
<li>In our update to the TodoView, we bound the model’s
<code>destroy</code> event to the view’s inherited <code>remove()</code>
method. This method deletes the view and automatically removes the
associated element from the DOM. Since we used <code>listenTo()</code>
to bind the view’s listeners to its model, <code>remove()</code> also
unbinds the listening callbacks from the model ensuring that a memory
leak does not occur.</li>
<li><code>destroy()</code> also removes the model from the Todos
collection, which triggers a <code>remove</code> event on the
collection.</li>
<li>Since the AppView has its <code>render()</code> method bound to
<code>all</code> events on the Todos collection, that view is rendered
and the stats in the footer are updated.</li>
</ol>
<p>That’s all there is to it!</p>
<p>If you want to see an example of those, see the <a
href="https://github.com/tastejs/todomvc/tree/gh-pages/examples/backbone">complete
source</a>.</p>
<h2 id="todo-routing">Todo routing</h2>
<p>Finally, we move on to routing, which will allow us to easily filter
the list of items that are active as well as those which have been
completed. We’ll be supporting the following routes:</p>
<pre><code>#/ (all - default)
#/active
#/completed</code></pre>
<p><img src="img/todos_e.png" /></p>
<p>When the route changes, the todo list will be filtered on a model
level and the selected class on the filter links in the footer will be
toggled as described above. When an item is updated while a filter is
active it will be updated accordingly (e.g., if the filter is active and
the item is checked, it will be hidden). The active filter is persisted
on reload.</p>
<div class="sourceCode" id="cb114"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// js/routers/router.js</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Todo Router</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ----------</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Workspace <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">routes</span><span class="op">:</span>{</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;*filter&#39;</span><span class="op">:</span> <span class="st">&#39;setFilter&#39;</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">setFilter</span><span class="op">:</span> <span class="kw">function</span>( param ) {</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Set the current filter to be used</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (param) {</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>        param <span class="op">=</span> param<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">TodoFilter</span> <span class="op">=</span> param <span class="op">||</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Trigger a collection filter event, causing hiding/unhiding</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">// of Todo view items</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;filter&#39;</span>)<span class="op">;</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="at">TodoRouter</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Workspace</span>()<span class="op">;</span></span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>  Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">start</span>()<span class="op">;</span></span></code></pre></div>
<p>Our router uses a *splat to set up a default route which passes the
string after ‘#/’ in the URL to <code>setFilter()</code> which sets
<code>app.TodoFilter</code> to that string.</p>
<p>As we can see in the line <code>app.Todos.trigger('filter')</code>,
once the filter has been set, we simply trigger ‘filter’ on our Todos
collection to toggle which items are visible and which are hidden.
Recall that our AppView’s <code>filterAll()</code> method is bound to
the collection’s filter event and that any event on the collection will
cause the AppView to re-render.</p>
<p>Finally, we create an instance of our router and call
<code>Backbone.history.start()</code> to route the initial URL during
page load.</p>
<h2 id="summary-2">Summary</h2>
<p>We’ve now built our first complete Backbone.js application. The
latest version of the full app can be viewed online at any time and the
sources are readily available via <a
href="http://www.todomvc.com">TodoMVC</a>.</p>
<p>Later on in the book, we’ll learn how to further modularize this
application using RequireJS, swap out our persistence layer to a
database back-end, and finally unit test the application with a few
different testing frameworks.</p>
<h1
id="exercise-2-book-library---your-first-restful-backbone.js-app">Exercise
2: Book Library - Your First RESTful Backbone.js App</h1>
<p>While our first application gave us a good taste of how Backbone.js
applications are made, most real-world applications will want to
communicate with a back-end of some sort. Let’s reinforce what we have
already learned with another example, but this time we will also create
a RESTful API for our application to talk to.</p>
<p>In this exercise, we will build a library application for managing
digital books using Backbone. For each book, we will store the title,
author, date of release, and some keywords. We’ll also show a picture of
the cover.</p>
<p>##Setting up</p>
<p>First, we need to create a folder structure for our project. To keep
the front-end and back-end separate, we will create a folder called
<em>site</em> for our client in the project root. Within it, we will
create css, img, and js directories.</p>
<p>As with the last example, we will split our JavaScript files by their
function, so under the js directory create folders named lib, models,
collections, and views. Your directory hierarchy should look like
this:</p>
<pre><code>site/
    css/
    img/
    js/
        collections/
        lib/
        models/
        views/</code></pre>
<p>Download the Backbone, Underscore, and jQuery libraries and copy them
to your js/lib folder. We need a placeholder image for the book covers.
Save this image to your site/img folder:</p>
<p><img src="img/placeholder.png" /></p>
<p>Just like before we need to load all of our dependencies in the
site/index.html file:</p>
<div class="sourceCode" id="cb116"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">&quot;en&quot;</span><span class="dt">&gt;</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;UTF-8&quot;</span><span class="dt">/&gt;</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Backbone.js Library<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;css/screen.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/jquery.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/underscore-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/backbone-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/models/book.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/collections/library.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/views/book.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/views/library.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/app.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>We should also add in the HTML for the user interface. We’ll want a
form for adding a new book, so add the following immediately inside the
<code>body</code> element:</p>
<div class="sourceCode" id="cb117"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;books&quot;</span><span class="dt">&gt;</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">form</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;addBook&quot;</span><span class="ot"> action</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="dt">&gt;</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;coverImage&quot;</span><span class="dt">&gt;</span>CoverImage: <span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;coverImage&quot;</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;file&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;title&quot;</span><span class="dt">&gt;</span>Title: <span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;title&quot;</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;author&quot;</span><span class="dt">&gt;</span>Author: <span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;author&quot;</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;releaseDate&quot;</span><span class="dt">&gt;</span>Release date: <span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;releaseDate&quot;</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;keywords&quot;</span><span class="dt">&gt;</span>Keywords: <span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;keywords&quot;</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">button</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;add&quot;</span><span class="dt">&gt;</span>Add<span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">form</span><span class="dt">&gt;</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>and we’ll need a template for displaying each book which should be
placed before the <code>script</code> tags:</p>
<div class="sourceCode" id="cb118"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;bookTemplate&quot;</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="dt">&gt;</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>img src<span class="op">=</span><span class="st">&quot;&lt;%= coverImage %&gt;&quot;</span><span class="op">/&gt;</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>ul<span class="op">&gt;</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>li<span class="op">&gt;&lt;%=</span> title <span class="op">%&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>li<span class="op">&gt;&lt;%=</span> author <span class="op">%&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>li<span class="op">&gt;&lt;%=</span> releaseDate <span class="op">%&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>li<span class="op">&gt;&lt;%=</span> keywords <span class="op">%&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>ul<span class="op">&gt;</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>button <span class="kw">class</span><span class="op">=</span><span class="st">&quot;delete&quot;</span><span class="op">&gt;</span>Delete<span class="op">&lt;/</span>button<span class="op">&gt;</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>To see what this will look like with some data in it, go ahead and
add a manually filled-in book to the <em>books</em> div.</p>
<div class="sourceCode" id="cb119"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;bookContainer&quot;</span><span class="dt">&gt;</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">img</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;img/placeholder.png&quot;</span><span class="dt">/&gt;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Title<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Author<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Release Date<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Keywords<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;delete&quot;</span><span class="dt">&gt;</span>Delete<span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Open this file in a browser and it should look something like
this:</p>
<p><img src="img/chapter5-1.png" /></p>
<p>Not so great. This is not a CSS tutorial, but we still need to do
some formatting. Create a file named screen.css in your site/css
folder:</p>
<div class="sourceCode" id="cb120"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background-color</span>: <span class="cn">#eee</span><span class="op">;</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="fu">.bookContainer</span> {</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">outline</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#aaa</span><span class="op">;</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">width</span>: <span class="dv">350</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">height</span>: <span class="dv">130</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background-color</span>: <span class="cn">#fff</span><span class="op">;</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">float</span>: <span class="dv">left</span><span class="op">;</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span>: <span class="dv">5</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a><span class="fu">.bookContainer</span> img {</span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">float</span>: <span class="dv">left</span><span class="op">;</span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span>: <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a><span class="fu">.bookContainer</span> ul {</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">list-style-type</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin-bottom</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a><span class="fu">.bookContainer</span> button {</span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">float</span>: <span class="dv">right</span><span class="op">;</span></span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span>: <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a><span class="pp">#addBook</span> label {</span>
<span id="cb120-30"><a href="#cb120-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">width</span>: <span class="dv">100</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-31"><a href="#cb120-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin-right</span>: <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-32"><a href="#cb120-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">text-align</span>: <span class="dv">right</span><span class="op">;</span></span>
<span id="cb120-33"><a href="#cb120-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">line-height</span>: <span class="dv">25</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-34"><a href="#cb120-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-35"><a href="#cb120-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-36"><a href="#cb120-36" aria-hidden="true" tabindex="-1"></a><span class="pp">#addBook</span> label<span class="op">,</span> <span class="pp">#addBook</span> input {</span>
<span id="cb120-37"><a href="#cb120-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span>: <span class="dv">block</span><span class="op">;</span></span>
<span id="cb120-38"><a href="#cb120-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin-bottom</span>: <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-39"><a href="#cb120-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">float</span>: <span class="dv">left</span><span class="op">;</span></span>
<span id="cb120-40"><a href="#cb120-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-41"><a href="#cb120-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-42"><a href="#cb120-42" aria-hidden="true" tabindex="-1"></a><span class="pp">#addBook</span> label<span class="ex">[for</span><span class="op">=</span><span class="st">&quot;title&quot;</span><span class="ex">]</span><span class="op">,</span> <span class="pp">#addBook</span> label<span class="ex">[for</span><span class="op">=</span><span class="st">&quot;releaseDate&quot;</span><span class="ex">]</span> {</span>
<span id="cb120-43"><a href="#cb120-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">clear</span>: <span class="dv">both</span><span class="op">;</span></span>
<span id="cb120-44"><a href="#cb120-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-45"><a href="#cb120-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-46"><a href="#cb120-46" aria-hidden="true" tabindex="-1"></a><span class="pp">#addBook</span> button {</span>
<span id="cb120-47"><a href="#cb120-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span>: <span class="dv">block</span><span class="op">;</span></span>
<span id="cb120-48"><a href="#cb120-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span>: <span class="dv">5</span><span class="dt">px</span> <span class="dv">20</span><span class="dt">px</span> <span class="dv">10</span><span class="dt">px</span> <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-49"><a href="#cb120-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">float</span>: <span class="dv">right</span><span class="op">;</span></span>
<span id="cb120-50"><a href="#cb120-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">clear</span>: <span class="dv">both</span><span class="op">;</span></span>
<span id="cb120-51"><a href="#cb120-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-52"><a href="#cb120-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-53"><a href="#cb120-53" aria-hidden="true" tabindex="-1"></a><span class="pp">#addBook</span> div {</span>
<span id="cb120-54"><a href="#cb120-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">width</span>: <span class="dv">550</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb120-55"><a href="#cb120-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-56"><a href="#cb120-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-57"><a href="#cb120-57" aria-hidden="true" tabindex="-1"></a><span class="pp">#addBook</span> div<span class="in">:after</span> {</span>
<span id="cb120-58"><a href="#cb120-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">content</span>: <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb120-59"><a href="#cb120-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span>: <span class="dv">block</span><span class="op">;</span></span>
<span id="cb120-60"><a href="#cb120-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">height</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb120-61"><a href="#cb120-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">visibility</span>: <span class="dv">hidden</span><span class="op">;</span></span>
<span id="cb120-62"><a href="#cb120-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">clear</span>: <span class="dv">both</span><span class="op">;</span></span>
<span id="cb120-63"><a href="#cb120-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-size</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb120-64"><a href="#cb120-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">line-height</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb120-65"><a href="#cb120-65" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now it looks a bit better:</p>
<p><img src="img/chapter5-2.png" /></p>
<p>So this is what we want the final result to look like, but with more
books. Go ahead and copy the bookContainer div a few more times if you
would like to see what it looks like. Now, we are ready to start
developing the actual application.</p>
<h4 id="creating-the-model-collection-views-and-app">Creating the Model,
Collection, Views, and App</h4>
<p>First, we’ll need a model of a book and a collection to hold the
list. These are both very simple, with the model only declaring some
defaults:</p>
<div class="sourceCode" id="cb121"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">// site/js/models/book.js</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="at">Book</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">coverImage</span><span class="op">:</span> <span class="st">&#39;img/placeholder.png&#39;</span><span class="op">,</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;No title&#39;</span><span class="op">,</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">author</span><span class="op">:</span> <span class="st">&#39;Unknown&#39;</span><span class="op">,</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">releaseDate</span><span class="op">:</span> <span class="st">&#39;Unknown&#39;</span><span class="op">,</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">keywords</span><span class="op">:</span> <span class="st">&#39;None&#39;</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb122"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">// site/js/collections/library.js</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="at">Library</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> app<span class="op">.</span><span class="at">Book</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Next, in order to display books we’ll need a view:</p>
<div class="sourceCode" id="cb123"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">// site/js/views/book.js</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="at">BookView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tagName</span><span class="op">:</span> <span class="st">&#39;div&#39;</span><span class="op">,</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">className</span><span class="op">:</span> <span class="st">&#39;bookContainer&#39;</span><span class="op">,</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>( <span class="fu">$</span>( <span class="st">&#39;#bookTemplate&#39;</span> )<span class="op">.</span><span class="fu">html</span>() )<span class="op">,</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">//this.el is what we defined in tagName. use $el to get access to jQuery html() function</span></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>( <span class="kw">this</span><span class="op">.</span><span class="fu">template</span>( <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span> ) )<span class="op">;</span></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>We’ll also need a view for the list itself:</p>
<div class="sourceCode" id="cb124"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co">// site/js/views/library.js</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="at">LibraryView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">el</span><span class="op">:</span> <span class="st">&#39;#books&#39;</span><span class="op">,</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>( initialBooks ) {</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">collection</span> <span class="op">=</span> <span class="kw">new</span> app<span class="op">.</span><span class="fu">Library</span>( initialBooks )<span class="op">;</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// render library by rendering each book in its collection</span></span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>( item ) {</span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">renderBook</span>( item )<span class="op">;</span></span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span> <span class="kw">this</span> )<span class="op">;</span></span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// render a book by creating a BookView and appending the</span></span>
<span id="cb124-21"><a href="#cb124-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// element it renders to the library&#39;s element</span></span>
<span id="cb124-22"><a href="#cb124-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">renderBook</span><span class="op">:</span> <span class="kw">function</span>( item ) {</span>
<span id="cb124-23"><a href="#cb124-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> bookView <span class="op">=</span> <span class="kw">new</span> app<span class="op">.</span><span class="fu">BookView</span>({</span>
<span id="cb124-24"><a href="#cb124-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">model</span><span class="op">:</span> item</span>
<span id="cb124-25"><a href="#cb124-25" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb124-26"><a href="#cb124-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">append</span>( bookView<span class="op">.</span><span class="fu">render</span>()<span class="op">.</span><span class="at">el</span> )<span class="op">;</span></span>
<span id="cb124-27"><a href="#cb124-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb124-28"><a href="#cb124-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Note that in the initialize function, we accept an array of data that
we pass to the app.Library constructor. We’ll use this to populate our
collection with some sample data so that we can see everything is
working correctly. Finally, we have the entry point for our code, along
with the sample data:</p>
<div class="sourceCode" id="cb125"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co">// site/js/app.js</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="kw">function</span>() {</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> books <span class="op">=</span> [</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;JavaScript: The Good Parts&#39;</span><span class="op">,</span> <span class="dt">author</span><span class="op">:</span> <span class="st">&#39;Douglas Crockford&#39;</span><span class="op">,</span> <span class="dt">releaseDate</span><span class="op">:</span> <span class="st">&#39;2008&#39;</span><span class="op">,</span> <span class="dt">keywords</span><span class="op">:</span> <span class="st">&#39;JavaScript Programming&#39;</span> }<span class="op">,</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;The Little Book on CoffeeScript&#39;</span><span class="op">,</span> <span class="dt">author</span><span class="op">:</span> <span class="st">&#39;Alex MacCaw&#39;</span><span class="op">,</span> <span class="dt">releaseDate</span><span class="op">:</span> <span class="st">&#39;2012&#39;</span><span class="op">,</span> <span class="dt">keywords</span><span class="op">:</span> <span class="st">&#39;CoffeeScript Programming&#39;</span> }<span class="op">,</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Scala for the Impatient&#39;</span><span class="op">,</span> <span class="dt">author</span><span class="op">:</span> <span class="st">&#39;Cay S. Horstmann&#39;</span><span class="op">,</span> <span class="dt">releaseDate</span><span class="op">:</span> <span class="st">&#39;2012&#39;</span><span class="op">,</span> <span class="dt">keywords</span><span class="op">:</span> <span class="st">&#39;Scala Programming&#39;</span> }<span class="op">,</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;American Psycho&#39;</span><span class="op">,</span> <span class="dt">author</span><span class="op">:</span> <span class="st">&#39;Bret Easton Ellis&#39;</span><span class="op">,</span> <span class="dt">releaseDate</span><span class="op">:</span> <span class="st">&#39;1991&#39;</span><span class="op">,</span> <span class="dt">keywords</span><span class="op">:</span> <span class="st">&#39;Novel Splatter&#39;</span> }<span class="op">,</span></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Eloquent JavaScript&#39;</span><span class="op">,</span> <span class="dt">author</span><span class="op">:</span> <span class="st">&#39;Marijn Haverbeke&#39;</span><span class="op">,</span> <span class="dt">releaseDate</span><span class="op">:</span> <span class="st">&#39;2011&#39;</span><span class="op">,</span> <span class="dt">keywords</span><span class="op">:</span> <span class="st">&#39;JavaScript Programming&#39;</span> }</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> app<span class="op">.</span><span class="fu">LibraryView</span>( books )<span class="op">;</span></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Our app just passes the sample data to a new instance of
app.LibraryView that it creates. Since the <code>initialize()</code>
constructor in LibraryView invokes the view’s <code>render()</code>
method, all the books in the library will be displayed. Since we are
passing our entry point as a callback to jQuery (in the form of its $
alias), the function will execute when the DOM is ready.</p>
<p>If you view index.html in a browser, you should see something like
this:</p>
<p><img src="img/chapter5-3.png" /></p>
<p>This is a complete Backbone application, though it doesn’t yet do
anything interesting.</p>
<p>##Wiring in the interface</p>
<p>Now, we’ll add some functionality to the useless form at the top and
the delete buttons on each book.</p>
<p>###Adding models</p>
<p>When the user clicks the add button, we want to take the data in the
form and use it to create a new model. In the LibraryView, we need to
add an event handler for the click event:</p>
<div class="sourceCode" id="cb126"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>events<span class="op">:</span>{</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;click #add&#39;</span><span class="op">:</span><span class="st">&#39;addBook&#39;</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>addBook<span class="op">:</span> <span class="kw">function</span>( e ) {</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> formData <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>( <span class="st">&#39;#addBook div&#39;</span> )<span class="op">.</span><span class="fu">children</span>( <span class="st">&#39;input&#39;</span> )<span class="op">.</span><span class="fu">each</span>( <span class="kw">function</span>( i<span class="op">,</span> el ) {</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>( <span class="fu">$</span>( el )<span class="op">.</span><span class="fu">val</span>() <span class="op">!==</span> <span class="st">&#39;&#39;</span> )</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>            formData[ el<span class="op">.</span><span class="at">id</span> ] <span class="op">=</span> <span class="fu">$</span>( el )<span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">add</span>( <span class="kw">new</span> app<span class="op">.</span><span class="fu">Book</span>( formData ) )<span class="op">;</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span></code></pre></div>
<p>We select all the input elements of the form that have a value and
iterate over them using jQuery’s each. Since we used the same names for
ids in our form as the keys on our Book model, we can simply store them
directly in the formData object. We then create a new Book from the data
and add it to the collection. We skip fields without a value so that the
defaults will be applied.</p>
<p>Backbone passes an event object as a parameter to the event-handling
function. This is useful for us in this case since we don’t want the
form to actually submit and reload the page. Adding a call to
<code>preventDefault</code> on the event in the <code>addBook</code>
function takes care of this for us.</p>
<p>Now, we just need to make the view render again when a new model is
added. To do this, we put</p>
<div class="sourceCode" id="cb127"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>( <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">,</span> <span class="st">&#39;add&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">renderBook</span> )<span class="op">;</span></span></code></pre></div>
<p>in the initialize function of LibraryView.</p>
<p>Now, you should be ready to take the application for a spin.</p>
<p><img src="img/chapter5-4.png" /></p>
<p>You may notice that the file input for the cover image isn’t working,
but that is left as an exercise to the reader.</p>
<p>###Removing models</p>
<p>Next, we need to wire up the delete button. Set up the event handler
in the BookView:</p>
<div class="sourceCode" id="cb128"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>    events<span class="op">:</span> {</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;click .delete&#39;</span><span class="op">:</span> <span class="st">&#39;deleteBook&#39;</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    deleteBook<span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Delete model</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">destroy</span>()<span class="op">;</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Delete view</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span></code></pre></div>
<p>You should now be able to add and remove books from the library.</p>
<p>##Creating the back-end</p>
<p>Now, we need to make a small detour and set up a server with a REST
api. Since this is a JavaScript book, we will use JavaScript to create
the server using node.js. If you are more comfortable in setting up a
REST server in another language, this is the API you need to conform
to:</p>
<pre><code>url             HTTP Method  Operation
/api/books      GET          Get an array of all books
/api/books/:id  GET          Get the book with id of :id
/api/books      POST         Add a new book and return the book with an id attribute added
/api/books/:id  PUT          Update the book with id of :id
/api/books/:id  DELETE       Delete the book with id of :id</code></pre>
<p>The outline for this section looks like this:</p>
<ul>
<li>Install node.js, npm, and MongoDB</li>
<li>Install node modules</li>
<li>Create a simple web server</li>
<li>Connect to the database</li>
<li>Create the REST API</li>
</ul>
<p>###Install node.js, npm, and MongoDB</p>
<p>Download and install node.js from nodejs.org. The node package
manager (npm) will be installed as well.</p>
<p>Download, install, and run MongoDB from mongodb.org (you need Mongo
to be running to store data in a Mongo database). There are detailed
installation guides <a
href="http://docs.mongodb.org/manual/installation/">on the
website</a>.</p>
<p>###Install node modules</p>
<p>Create a file called <code>package.json</code> in the root of your
project. It should look like</p>
<div class="sourceCode" id="cb130"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;backbone-library&quot;</span><span class="op">,</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;version&quot;</span><span class="op">:</span> <span class="st">&quot;0.0.1&quot;</span><span class="op">,</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;description&quot;</span><span class="op">:</span> <span class="st">&quot;A simple library application using Backbone&quot;</span><span class="op">,</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dependencies&quot;</span><span class="op">:</span> {</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;express&quot;</span><span class="op">:</span> <span class="st">&quot;~3.1.0&quot;</span><span class="op">,</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;path&quot;</span><span class="op">:</span> <span class="st">&quot;~0.4.9&quot;</span><span class="op">,</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;mongoose&quot;</span><span class="op">:</span> <span class="st">&quot;~3.5.5&quot;</span><span class="op">,</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;body-parser&quot;</span><span class="op">:</span> <span class="st">&quot;~1.9.1&quot;</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Amongst other things, this file tells npm what the dependencies are
for our project. On the command line, from the root of your project,
type:</p>
<div class="sourceCode" id="cb131"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span></code></pre></div>
<p>You should see npm fetch the dependencies that we listed in our
package.json and save them within a folder called node_modules.</p>
<p>Your folder structure should look something like this:</p>
<pre><code>node_modules/
  .bin/
  body-parser/
  express/
  mongoose/
  path/
site/
  css/
  img/
  js/
  index.html
package.json</code></pre>
<p>###Create a simple web server</p>
<p>Create a file named server.js in the project root containing the
following code:</p>
<div class="sourceCode" id="cb133"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Module dependencies.</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> application_root <span class="op">=</span> <span class="bu">__dirname</span><span class="op">,</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>    express <span class="op">=</span> <span class="pp">require</span>( <span class="st">&#39;express&#39;</span> )<span class="op">,</span> <span class="co">//Web framework</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>    bodyParser <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;body-parser&#39;</span>)<span class="op">,</span> <span class="co">//Parser for reading request body</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> <span class="pp">require</span>( <span class="st">&#39;path&#39;</span> )<span class="op">,</span> <span class="co">//Utilities for dealing with file paths</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    mongoose <span class="op">=</span> <span class="pp">require</span>( <span class="st">&#39;mongoose&#39;</span> )<span class="op">;</span> <span class="co">//MongoDB integration</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="co">//Create server</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="co">//Where to serve static content</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>( express<span class="op">.</span><span class="fu">static</span>( path<span class="op">.</span><span class="fu">join</span>( application_root<span class="op">,</span><span class="st">&#39;../&#39;</span><span class="op">,</span> <span class="st">&#39;site&#39;</span>) ) )<span class="op">;</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="fu">bodyParser</span>())<span class="op">;</span></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a><span class="co">//Start server</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> port <span class="op">=</span> <span class="dv">4711</span><span class="op">;</span></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>( port<span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Express server listening on port %d in %s mode&#39;</span><span class="op">,</span> port<span class="op">,</span> app<span class="op">.</span><span class="at">settings</span><span class="op">.</span><span class="at">env</span> )<span class="op">;</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>We start off by loading the modules required for this project:
Express for creating the HTTP server, Path for dealing with file paths,
and mongoose for connecting with the database. We then create an Express
server and configure it using an anonymous function. This is a pretty
standard configuration and for our application we don’t actually need
the methodOverride part. It is used for issuing PUT and DELETE HTTP
requests directly from a form, since forms normally only support GET and
POST. Finally, we start the server by running the listen function. The
port number used, in this case 4711, could be any free port on your
system. I simply used 4711 since it is unlikely to have been used by
anything else. We are now ready to run our first server:</p>
<div class="sourceCode" id="cb134"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>node server<span class="op">.</span><span class="at">js</span></span></code></pre></div>
<p>If you open a browser on http://localhost:4711 you should see
something like this:</p>
<p><img src="img/chapter5-5.png" /></p>
<p>This is where we left off in Part 2, but we are now running on a
server instead of directly from the files. Great job! We can now start
defining routes (URLs) that the server should react to. This will be our
REST API. Routes are defined by using app followed by one of the HTTP
verbs get, put, post, and delete, which corresponds to Create, Read,
Update and Delete. Let us go back to server.js and define a simple
route:</p>
<div class="sourceCode" id="cb135"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Routes</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>( <span class="st">&#39;/api&#39;</span><span class="op">,</span> <span class="kw">function</span>( request<span class="op">,</span> response ) {</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    response<span class="op">.</span><span class="fu">send</span>( <span class="st">&#39;Library API is running&#39;</span> )<span class="op">;</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The get function takes a URL as the first parameter and a function as
the second. The function will be called with request and response
objects. Now, you can restart node and go to our specified URL:</p>
<p><img src="img/chapter5-6.png" /></p>
<p>###Connect to the database</p>
<p>Fantastic. Now, since we want to store our data in MongoDB, we need
to define a schema. Add this to server.js:</p>
<div class="sourceCode" id="cb136"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Connect to database</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>mongoose<span class="op">.</span><span class="fu">connect</span>( <span class="st">&#39;mongodb://localhost/library_database&#39;</span> )<span class="op">;</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co">//Schemas</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Book <span class="op">=</span> <span class="kw">new</span> mongoose<span class="op">.</span><span class="fu">Schema</span>({</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">author</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">releaseDate</span><span class="op">:</span> <span class="bu">Date</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="co">//Models</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> BookModel <span class="op">=</span> mongoose<span class="op">.</span><span class="fu">model</span>( <span class="st">&#39;Book&#39;</span><span class="op">,</span> Book )<span class="op">;</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Configure server</span></span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">configure</span>( <span class="kw">function</span>() {</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//parses request body and populates request.body</span></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>    app<span class="op">.</span><span class="fu">use</span>( express<span class="op">.</span><span class="fu">bodyParser</span>() )<span class="op">;</span></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">//checks request.body for HTTP method overrides</span></span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a>    app<span class="op">.</span><span class="fu">use</span>( express<span class="op">.</span><span class="fu">methodOverride</span>() )<span class="op">;</span></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">//perform route lookup based on url and HTTP method</span></span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a>    app<span class="op">.</span><span class="fu">use</span>( app<span class="op">.</span><span class="at">router</span> )<span class="op">;</span></span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Where to serve static content</span></span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>    app<span class="op">.</span><span class="fu">use</span>( express<span class="op">.</span><span class="fu">static</span>( path<span class="op">.</span><span class="fu">join</span>( application_root<span class="op">,</span> <span class="st">&#39;../&#39;</span><span class="op">,</span> <span class="st">&#39;site&#39;</span>) ) )<span class="op">;</span></span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Show all errors in development</span></span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>    app<span class="op">.</span><span class="fu">use</span>( express<span class="op">.</span><span class="fu">errorHandler</span>({ <span class="dt">dumpExceptions</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">showStack</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>As you can see, schema definitions are quite straight forward. They
can be more advanced, but this will do for us. I also extracted a model
(BookModel) from Mongo. This is what we will be working with. Next up,
we define a GET operation for the REST API that will return all
books:</p>
<div class="sourceCode" id="cb137"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Get a list of all books</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>( <span class="st">&#39;/api/books&#39;</span><span class="op">,</span> <span class="kw">function</span>( request<span class="op">,</span> response ) {</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> BookModel<span class="op">.</span><span class="fu">find</span>( <span class="kw">function</span>( err<span class="op">,</span> books ) {</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>( <span class="op">!</span>err ) {</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response<span class="op">.</span><span class="fu">send</span>( books )<span class="op">;</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( err )<span class="op">;</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The find function of Model is defined like this:
<code>function find (conditions, fields, options, callback)</code> – but
since we want a function that returns all books we only need the
callback parameter. The callback will be called with an error object and
an array of found objects. If there was no error, we return the array of
objects to the client using the <code>send</code> function of the
response object. Otherwise, we log the error to the console.</p>
<p>To test our API, we need to do a little typing in a JavaScript
console. Restart node and go to localhost:4711 in your browser. Open up
the JavaScript console. If you are using Google Chrome, go to
View-&gt;Developer-&gt;JavaScript Console. If you are using Firefox,
install Firebug and go to View-&gt;Firebug. Most other browsers will
have a similar console. In the console type the following:</p>
<div class="sourceCode" id="cb138"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>jQuery<span class="op">.</span><span class="fu">get</span>( <span class="st">&#39;/api/books/&#39;</span><span class="op">,</span> <span class="kw">function</span>( data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR ) {</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Get response:&#39;</span> )<span class="op">;</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( data )<span class="op">;</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( textStatus )<span class="op">;</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( jqXHR )<span class="op">;</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>…and press enter and you should get something like this:</p>
<p><img src="img/chapter5-7.png" /></p>
<p>Here I used jQuery to make the call to our REST API, since it was
already loaded on the page. The returned array is obviously empty, since
we have not put anything into the database yet. Let’s go and create a
POST route that enables adding new items in server.js:</p>
<div class="sourceCode" id="cb139"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Insert a new book</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">post</span>( <span class="st">&#39;/api/books&#39;</span><span class="op">,</span> <span class="kw">function</span>( request<span class="op">,</span> response ) {</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> book <span class="op">=</span> <span class="kw">new</span> <span class="fu">BookModel</span>({</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">title</span><span class="op">,</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">author</span><span class="op">:</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">author</span><span class="op">,</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">releaseDate</span><span class="op">:</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">releaseDate</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> book<span class="op">.</span><span class="fu">save</span>( <span class="kw">function</span>( err ) {</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>( <span class="op">!</span>err ) {</span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;created&#39;</span> )<span class="op">;</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response<span class="op">.</span><span class="fu">send</span>( book )<span class="op">;</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( err )<span class="op">;</span></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>We start by creating a new BookModel, passing an object with title,
author, and releaseDate attributes. The data are collected from
request.body. This means that anyone calling this operation in the API
needs to supply a JSON object containing the title, author, and
releaseDate attributes. Actually, the caller can omit any or all
attributes since we have not made any of them mandatory.</p>
<p>We then call the save function on the BookModel passing in a callback
in the same way as with the previous get route. Finally, we return the
saved BookModel. The reason we return the BookModel and not just
“success” or similar string is that when the BookModel is saved it will
get an _id attribute from MongoDB, which the client needs when updating
or deleting a specific book. Let’s try it out again. Restart node and go
back to the console and type:</p>
<div class="sourceCode" id="cb140"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>jQuery<span class="op">.</span><span class="fu">post</span>( <span class="st">&#39;/api/books&#39;</span><span class="op">,</span> {</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;title&#39;</span><span class="op">:</span> <span class="st">&#39;JavaScript the good parts&#39;</span><span class="op">,</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;author&#39;</span><span class="op">:</span> <span class="st">&#39;Douglas Crockford&#39;</span><span class="op">,</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;releaseDate&#39;</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>( <span class="dv">2008</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span> )<span class="op">.</span><span class="fu">getTime</span>()</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> <span class="kw">function</span>(data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR) {</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Post response:&#39;</span> )<span class="op">;</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( data )<span class="op">;</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( textStatus )<span class="op">;</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( jqXHR )<span class="op">;</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>..and then</p>
<div class="sourceCode" id="cb141"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>jQuery<span class="op">.</span><span class="fu">get</span>( <span class="st">&#39;/api/books/&#39;</span><span class="op">,</span> <span class="kw">function</span>( data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR ) {</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Get response:&#39;</span> )<span class="op">;</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( data )<span class="op">;</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( textStatus )<span class="op">;</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( jqXHR )<span class="op">;</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>You should now get a one-element array back from our server. You may
wonder about this line:</p>
<div class="sourceCode" id="cb142"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;releaseDate&#39;</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2008</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">getTime</span>()</span></code></pre></div>
<p>MongoDB expects dates in UNIX time format (milliseconds from the
start of Jan 1st 1970 UTC), so we have to convert dates before posting.
The object we get back, however, contains a JavaScript Date object. Also
note the _id attribute of the returned object.</p>
<p><img src="img/chapter5-8.png" /></p>
<p>Let’s move on to creating a GET request that retrieves a single book
in server.js:</p>
<div class="sourceCode" id="cb143"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Get a single book by id</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>( <span class="st">&#39;/api/books/:id&#39;</span><span class="op">,</span> <span class="kw">function</span>( request<span class="op">,</span> response ) {</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> BookModel<span class="op">.</span><span class="fu">findById</span>( request<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> <span class="kw">function</span>( err<span class="op">,</span> book ) {</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>( <span class="op">!</span>err ) {</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response<span class="op">.</span><span class="fu">send</span>( book )<span class="op">;</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( err )<span class="op">;</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Here, we use colon notation (:id) to tell Express that this part of
the route is dynamic. We also use the <code>findById</code> function on
BookModel to get a single result. If you restart node, you can get a
single book by adding the id previously returned to the URL like
this:</p>
<div class="sourceCode" id="cb144"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>jQuery<span class="op">.</span><span class="fu">get</span>( <span class="st">&#39;/api/books/4f95a8cb1baa9b8a1b000006&#39;</span><span class="op">,</span> <span class="kw">function</span>( data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR ) {</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Get response:&#39;</span> )<span class="op">;</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( data )<span class="op">;</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( textStatus )<span class="op">;</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( jqXHR )<span class="op">;</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Let’s create the PUT (update) function next:</p>
<div class="sourceCode" id="cb145"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Update a book</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">put</span>( <span class="st">&#39;/api/books/:id&#39;</span><span class="op">,</span> <span class="kw">function</span>( request<span class="op">,</span> response ) {</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Updating book &#39;</span> <span class="op">+</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">title</span> )<span class="op">;</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> BookModel<span class="op">.</span><span class="fu">findById</span>( request<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> <span class="kw">function</span>( err<span class="op">,</span> book ) {</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>        book<span class="op">.</span><span class="at">title</span> <span class="op">=</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">title</span><span class="op">;</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>        book<span class="op">.</span><span class="at">author</span> <span class="op">=</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">author</span><span class="op">;</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>        book<span class="op">.</span><span class="at">releaseDate</span> <span class="op">=</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">releaseDate</span><span class="op">;</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> book<span class="op">.</span><span class="fu">save</span>( <span class="kw">function</span>( err ) {</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>( <span class="op">!</span>err ) {</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>                <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;book updated&#39;</span> )<span class="op">;</span></span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> response<span class="op">.</span><span class="fu">send</span>( book )<span class="op">;</span></span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>                <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( err )<span class="op">;</span></span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This is a little larger than previous ones, but is also pretty
straight forward – we find a book by id, update its properties, save it,
and send it back to the client.</p>
<p>To test this, we need to use the more general jQuery ajax function.
Again, in these examples, you will need to replace the id property with
one that matches an item in your own database:</p>
<div class="sourceCode" id="cb146"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>jQuery<span class="op">.</span><span class="fu">ajax</span>({</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/api/books/4f95a8cb1baa9b8a1b000006&#39;</span><span class="op">,</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;PUT&#39;</span><span class="op">,</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;title&#39;</span><span class="op">:</span> <span class="st">&#39;JavaScript The good parts&#39;</span><span class="op">,</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;author&#39;</span><span class="op">:</span> <span class="st">&#39;The Legendary Douglas Crockford&#39;</span><span class="op">,</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;releaseDate&#39;</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>( <span class="dv">2008</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span> )<span class="op">.</span><span class="fu">getTime</span>()</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">success</span><span class="op">:</span> <span class="kw">function</span>( data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR ) {</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Put response:&#39;</span> )<span class="op">;</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( data )<span class="op">;</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( textStatus )<span class="op">;</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( jqXHR )<span class="op">;</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Finally, we create the delete route:</p>
<div class="sourceCode" id="cb147"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Delete a book</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">delete</span>( <span class="st">&#39;/api/books/:id&#39;</span><span class="op">,</span> <span class="kw">function</span>( request<span class="op">,</span> response ) {</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Deleting book with id: &#39;</span> <span class="op">+</span> request<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span> )<span class="op">;</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> BookModel<span class="op">.</span><span class="fu">findById</span>( request<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> <span class="kw">function</span>( err<span class="op">,</span> book ) {</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> book<span class="op">.</span><span class="fu">remove</span>( <span class="kw">function</span>( err ) {</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>( <span class="op">!</span>err ) {</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>                <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Book removed&#39;</span> )<span class="op">;</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> response<span class="op">.</span><span class="fu">send</span>( <span class="st">&#39;&#39;</span> )<span class="op">;</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>                <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( err )<span class="op">;</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>…and try it out:</p>
<div class="sourceCode" id="cb148"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>jQuery<span class="op">.</span><span class="fu">ajax</span>({</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/api/books/4f95a5251baa9b8a1b000001&#39;</span><span class="op">,</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;DELETE&#39;</span><span class="op">,</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">success</span><span class="op">:</span> <span class="kw">function</span>( data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR ) {</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Delete response:&#39;</span> )<span class="op">;</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( data )<span class="op">;</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( textStatus )<span class="op">;</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( jqXHR )<span class="op">;</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>So now our REST API is complete – we have support for all four HTTP
verbs. What’s next? Well, until now I have left out the keywords part of
our books. This is a bit more complicated since a book could have
several keywords and we don’t want to represent them as a string, but
rather an array of strings. To do that, we need another schema. Add a
Keywords schema right above our Book schema:</p>
<div class="sourceCode" id="cb149"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Schemas</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Keywords <span class="op">=</span> <span class="kw">new</span> mongoose<span class="op">.</span><span class="fu">Schema</span>({</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">keyword</span><span class="op">:</span> <span class="bu">String</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>To add a sub schema to an existing schema, we use brackets notation
like so:</p>
<div class="sourceCode" id="cb150"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Book <span class="op">=</span> <span class="kw">new</span> mongoose<span class="op">.</span><span class="fu">Schema</span>({</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">author</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">releaseDate</span><span class="op">:</span> <span class="bu">Date</span><span class="op">,</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">keywords</span><span class="op">:</span> [ Keywords ]                       <span class="co">// NEW</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Also update POST and PUT:</p>
<div class="sourceCode" id="cb151"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Insert a new book</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">post</span>( <span class="st">&#39;/api/books&#39;</span><span class="op">,</span> <span class="kw">function</span>( request<span class="op">,</span> response ) {</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> book <span class="op">=</span> <span class="kw">new</span> <span class="fu">BookModel</span>({</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">title</span><span class="op">,</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">author</span><span class="op">:</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">author</span><span class="op">,</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">releaseDate</span><span class="op">:</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">releaseDate</span><span class="op">,</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">keywords</span><span class="op">:</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">keywords</span>       <span class="co">// NEW</span></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>    book<span class="op">.</span><span class="fu">save</span>( <span class="kw">function</span>( err ) {</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>( <span class="op">!</span>err ) {</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;created&#39;</span> )<span class="op">;</span></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response<span class="op">.</span><span class="fu">send</span>( book )<span class="op">;</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( err )<span class="op">;</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a><span class="co">//Update a book</span></span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">put</span>( <span class="st">&#39;/api/books/:id&#39;</span><span class="op">,</span> <span class="kw">function</span>( request<span class="op">,</span> response ) {</span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Updating book &#39;</span> <span class="op">+</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">title</span> )<span class="op">;</span></span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> BookModel<span class="op">.</span><span class="fu">findById</span>( request<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> <span class="kw">function</span>( err<span class="op">,</span> book ) {</span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>        book<span class="op">.</span><span class="at">title</span> <span class="op">=</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">title</span><span class="op">;</span></span>
<span id="cb151-24"><a href="#cb151-24" aria-hidden="true" tabindex="-1"></a>        book<span class="op">.</span><span class="at">author</span> <span class="op">=</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">author</span><span class="op">;</span></span>
<span id="cb151-25"><a href="#cb151-25" aria-hidden="true" tabindex="-1"></a>        book<span class="op">.</span><span class="at">releaseDate</span> <span class="op">=</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">releaseDate</span><span class="op">;</span></span>
<span id="cb151-26"><a href="#cb151-26" aria-hidden="true" tabindex="-1"></a>        book<span class="op">.</span><span class="at">keywords</span> <span class="op">=</span> request<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">keywords</span><span class="op">;</span> <span class="co">// NEW</span></span>
<span id="cb151-27"><a href="#cb151-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-28"><a href="#cb151-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> book<span class="op">.</span><span class="fu">save</span>( <span class="kw">function</span>( err ) {</span>
<span id="cb151-29"><a href="#cb151-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>( <span class="op">!</span>err ) {</span>
<span id="cb151-30"><a href="#cb151-30" aria-hidden="true" tabindex="-1"></a>                <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;book updated&#39;</span> )<span class="op">;</span></span>
<span id="cb151-31"><a href="#cb151-31" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb151-32"><a href="#cb151-32" aria-hidden="true" tabindex="-1"></a>                <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( err )<span class="op">;</span></span>
<span id="cb151-33"><a href="#cb151-33" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb151-34"><a href="#cb151-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response<span class="op">.</span><span class="fu">send</span>( book )<span class="op">;</span></span>
<span id="cb151-35"><a href="#cb151-35" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb151-36"><a href="#cb151-36" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb151-37"><a href="#cb151-37" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>There we are, that should be all we need, now we can try it out in
the console:</p>
<div class="sourceCode" id="cb152"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>jQuery<span class="op">.</span><span class="fu">post</span>( <span class="st">&#39;/api/books&#39;</span><span class="op">,</span> {</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;title&#39;</span><span class="op">:</span> <span class="st">&#39;Secrets of the JavaScript Ninja&#39;</span><span class="op">,</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;author&#39;</span><span class="op">:</span> <span class="st">&#39;John Resig&#39;</span><span class="op">,</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;releaseDate&#39;</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>( <span class="dv">2008</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">12</span> )<span class="op">.</span><span class="fu">getTime</span>()<span class="op">,</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;keywords&#39;</span><span class="op">:</span>[</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>        { <span class="st">&#39;keyword&#39;</span><span class="op">:</span> <span class="st">&#39;JavaScript&#39;</span> }<span class="op">,</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>        { <span class="st">&#39;keyword&#39;</span><span class="op">:</span> <span class="st">&#39;Reference&#39;</span> }</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> <span class="kw">function</span>( data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR ) {</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( <span class="st">&#39;Post response:&#39;</span> )<span class="op">;</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( data )<span class="op">;</span></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>( textStatus )<span class="op">;</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">dir</span>( jqXHR )<span class="op">;</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>You now have a fully functional REST server that we can hook into
from our front-end.</p>
<p>##Talking to the server</p>
<p>In this part, we will cover connecting our Backbone application to
the server through the REST API.</p>
<p>As we mentioned in chapter 3 <em>Backbone Basics</em>, we can
retrieve models from a server using <code>collection.fetch()</code> by
setting <code>collection.url</code> to be the URL of the API endpoint.
Let’s update the Library collection to do that now:</p>
<div class="sourceCode" id="cb153"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="at">Library</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> app<span class="op">.</span><span class="at">Book</span><span class="op">,</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/api/books&#39;</span>     <span class="co">// NEW</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This results in the default implementation of Backbone.sync assuming
that the API looks like this:</p>
<pre><code>url             HTTP Method  Operation
/api/books      GET          Get an array of all books
/api/books/:id  GET          Get the book with id of :id
/api/books      POST         Add a new book and return the book with an id attribute added
/api/books/:id  PUT          Update the book with id of :id
/api/books/:id  DELETE       Delete the book with id of :id</code></pre>
<p>To have our application retrieve the Book models from the server on
page load, we need to update the LibraryView. The Backbone documentation
recommends inserting all models when the page is generated on the server
side, rather than fetching them from the client side once the page is
loaded. Since this chapter is trying to give you a more complete picture
of how to communicate with a server, we will go ahead and ignore that
recommendation. Go to the LibraryView declaration and update the
initialize function as follows:</p>
<div class="sourceCode" id="cb155"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>initialize<span class="op">:</span> <span class="kw">function</span>() {                    <span class="co">// UPDATED</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">collection</span> <span class="op">=</span> <span class="kw">new</span> app<span class="op">.</span><span class="fu">Library</span>()<span class="op">;</span>    <span class="co">// UPDATED</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">fetch</span>({<span class="dt">reset</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span>   <span class="co">// NEW</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>( <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">,</span> <span class="st">&#39;add&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">renderBook</span> )<span class="op">;</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>( <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">,</span> <span class="st">&#39;reset&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span> )<span class="op">;</span> <span class="co">// NEW</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span></code></pre></div>
<p>Now that we are populating our Library from the database using
<code>this.collection.fetch()</code>, the <code>initialize()</code>
function no longer takes a set of sample data as an argument and doesn’t
pass anything to the app.Library constructor. You can now remove the
sample data from site/js/app.js, which should reduce it to a single
statement which creates the LibraryView:</p>
<div class="sourceCode" id="cb156"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">// site/js/app.js</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="kw">function</span>() {</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> app<span class="op">.</span><span class="fu">LibraryView</span>()<span class="op">;</span>  <span class="co">// UPDATED</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>We have also added a listener on the reset event. We need to do this
since the models are fetched asynchronously after the page is rendered.
When the fetch completes, Backbone fires the reset event, as requested
by the <code>reset: true</code> option, and our listener re-renders the
view. If you reload the page now, you should see all books that are
stored on the server:</p>
<p><img src="img/chapter5-9.png" /></p>
<p>As you can see, the date and keywords look a bit weird. The date
delivered from the server is converted into a JavaScript Date object and
when applied to the underscore template, it will use the toString()
function to display it. There isn’t very good support for formatting
dates in JavaScript so we will use the dateFormat jQuery plugin to fix
this. Go ahead and download it from <a
href="http://github.com/phstc/jquery-dateFormat">here</a> and put it in
your site/js/lib folder. Update the book template so that the date is
displayed with:</p>
<div class="sourceCode" id="cb157"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span><span class="er">&lt;</span>%= $.format.date( new Date( releaseDate ), &#39;MMMM yyyy&#39; ) %&gt;<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span></code></pre></div>
<p>and add a script element for the plugin</p>
<div class="sourceCode" id="cb158"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/jquery-dateFormat-1.0.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Now, the date on the page should look a bit better. How about the
keywords? Since we are receiving the keywords in an array we need to
execute some code that generates a string of separated keywords. To do
that, we can omit the equals character in the template tag which will
let us execute code that doesn’t display anything:</p>
<div class="sourceCode" id="cb159"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span><span class="er">&lt;</span>% _.each( keywords, function( keyobj ) {%&gt; <span class="er">&lt;</span>%= keyobj.keyword %&gt;<span class="er">&lt;</span>% } ); %&gt;<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Here I iterate over the keywords array using the Underscore
<code>each</code> function and print out every single keyword. Note that
I display the keyword using the &lt;%= tag. This will display the
keywords with spaces between them.</p>
<p>Reloading the page again should look quite decent:</p>
<p><img src="img/chapter5-10.png" /></p>
<p>Now go ahead and delete a book and then reload the page: Tadaa! the
deleted book is back! Not cool, why is this? This happens because when
we get the BookModels from the server they have an _id attribute (notice
the underscore), but Backbone expects an id attribute (no underscore).
Since no id attribute is present, Backbone sees this model as new and
deleting a new model doesn’t need any synchronization.</p>
<p>To fix this, we can use the parse function of Backbone.Model. The
parse function lets you edit the server response before it is passed to
the Model constructor. Add a parse method to the Book model:</p>
<div class="sourceCode" id="cb160"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>parse<span class="op">:</span> <span class="kw">function</span>( response ) {</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>    response<span class="op">.</span><span class="at">id</span> <span class="op">=</span> response<span class="op">.</span><span class="at">_id</span><span class="op">;</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">;</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Simply copy the value of _id to the needed id attribute. If you
reload the page, you will see that models are actually deleted on the
server when you press the delete button.</p>
<p>Another, simpler way of making Backbone recognize _id as its unique
identifier is to set the idAttribute of the model to _id.</p>
<p>If you now try to add a new book using the form, you’ll notice that
it is a similar story to delete – models won’t get persisted on the
server. This is because Backbone.Collection.add doesn’t automatically
sync, but it is easy to fix. In the LibraryView, we find in
<code>views/library.js</code> change the line reading:</p>
<div class="sourceCode" id="cb161"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">add</span>( <span class="kw">new</span> <span class="fu">Book</span>( formData ) )<span class="op">;</span></span></code></pre></div>
<p>…to:</p>
<div class="sourceCode" id="cb162"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">create</span>( formData )<span class="op">;</span></span></code></pre></div>
<p>Now, newly created books will get persisted. Actually, they probably
won’t if you enter a date. The server expects a date in UNIX timestamp
format (milliseconds since Jan 1, 1970). Also, any keywords you enter
won’t be stored since the server expects an array of objects with the
attribute ‘keyword’.</p>
<p>We’ll start by fixing the date issue. We don’t really want the users
to manually enter a date in a specific format, so we’ll use the standard
datepicker from jQuery UI. Go ahead and create a custom jQuery UI
download containing datepicker from <a
href="http://jqueryui.com/download/">here</a>. Add the css theme to
site/css/ and the JavaScript to site/js/lib. Link to them in
index.html:</p>
<div class="sourceCode" id="cb163"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;css/cupertino/jquery-ui-1.10.0.custom.css&quot;</span><span class="dt">&gt;</span></span></code></pre></div>
<p>“cupertino” is the name of the style I chose when downloading jQuery
UI.</p>
<p>The JavaScript file must be loaded after jQuery.</p>
<div class="sourceCode" id="cb164"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/jquery.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;js/lib/jquery-ui-1.10.0.custom.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Now in app.js, bind a datepicker to our releaseDate field:</p>
<div class="sourceCode" id="cb165"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> app <span class="op">=</span> app <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="kw">function</span>() {</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>( <span class="st">&#39;#releaseDate&#39;</span> )<span class="op">.</span><span class="fu">datepicker</span>()<span class="op">;</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> app<span class="op">.</span><span class="fu">LibraryView</span>()<span class="op">;</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>You should now be able to pick a date when clicking in the
releaseDate field:</p>
<p><img src="img/chapter5-11.png" /></p>
<p>Finally, we have to make sure that the form input is properly
transformed into our storage format. Change the addBook function in
LibraryView to:</p>
<div class="sourceCode" id="cb166"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>addBook<span class="op">:</span> <span class="kw">function</span>( e ) {</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> formData <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>( <span class="st">&#39;#addBook div&#39;</span> )<span class="op">.</span><span class="fu">children</span>( <span class="st">&#39;input&#39;</span> )<span class="op">.</span><span class="fu">each</span>( <span class="kw">function</span>( i<span class="op">,</span> el ) {</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>( <span class="fu">$</span>( el )<span class="op">.</span><span class="fu">val</span>() <span class="op">!=</span> <span class="st">&#39;&#39;</span> )</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>( el<span class="op">.</span><span class="at">id</span> <span class="op">===</span> <span class="st">&#39;keywords&#39;</span> ) {</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>                formData[ el<span class="op">.</span><span class="at">id</span> ] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>                _<span class="op">.</span><span class="fu">each</span>( <span class="fu">$</span>( el )<span class="op">.</span><span class="fu">val</span>()<span class="op">.</span><span class="fu">split</span>( <span class="st">&#39; &#39;</span> )<span class="op">,</span> <span class="kw">function</span>( keyword ) {</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>                    formData[ el<span class="op">.</span><span class="at">id</span> ]<span class="op">.</span><span class="fu">push</span>({ <span class="st">&#39;keyword&#39;</span><span class="op">:</span> keyword })<span class="op">;</span></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>                })<span class="op">;</span></span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> <span class="cf">if</span>( el<span class="op">.</span><span class="at">id</span> <span class="op">===</span> <span class="st">&#39;releaseDate&#39;</span> ) {</span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>                formData[ el<span class="op">.</span><span class="at">id</span> ] <span class="op">=</span> <span class="fu">$</span>( <span class="st">&#39;#releaseDate&#39;</span> )<span class="op">.</span><span class="fu">datepicker</span>( <span class="st">&#39;getDate&#39;</span> )<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a>                formData[ el<span class="op">.</span><span class="at">id</span> ] <span class="op">=</span> <span class="fu">$</span>( el )<span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Clear input field value</span></span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">$</span>( el )<span class="op">.</span><span class="fu">val</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">create</span>( formData )<span class="op">;</span></span>
<span id="cb166-25"><a href="#cb166-25" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span></code></pre></div>
<p>Our change adds two checks to the form input fields. First, we’re
checking if the current element is the keywords input field, in which
case we’re splitting the string on each space and creating an array of
keyword objects.</p>
<p>Then we’re checking if the current element is the releaseDate input
field, in which case we’re calling <code>datePicker(“getDate”)</code>
which returns a Date object. We then use the <code>getTime</code>
function on that to get the time in milliseconds.</p>
<p>Now, you should be able to add new books with both a release date and
keywords!</p>
<p><img src="img/chapter5-12.png" /></p>
<h3 id="summary-3">Summary</h3>
<p>In this chapter, we made our application persistent by binding it to
a server using a REST API. We also looked at some problems that might
occur when serializing and deserializing data and their solutions. We
looked at the dateFormat and the datepicker jQuery plugins and how to do
some more advanced things in our Underscore templates. The code is
available <a
href="https://github.com/addyosmani/backbone-fundamentals/tree/gh-pages/practicals/exercise-2">here</a>.</p>
<h1 id="backbone-extensions">Backbone Extensions</h1>
<p>Backbone is flexible, simple, and powerful. However, you may find
that the complexity of the application you are working on requires more
than what it provides out of the box. There are certain concerns which
it just doesn’t address directly as one of its goals is to be
minimalist.</p>
<p>Take for example Views, which provide a default <code>render</code>
method which does nothing and produces no real results when called,
despite most implementations using it to generate the HTML that the view
manages. Also, Models and Collections have no built-in way of handling
nested hierarchies - if you require this functionality, you need to
write it yourself or use a plugin.</p>
<p>In these cases, there are many existing Backbone plugins which can
provide advanced solutions for large-scale Backbone apps. A fairly
complete list of plugins and frameworks available can be found on the
Backbone <a
href="https://github.com/documentcloud/backbone/wiki/Extensions%2C-Plugins%2C-Resources">wiki</a>.
Using these add-ons, there is enough for applications of most sizes to
be completed successfully.</p>
<p>In this section of the book we will look at two popular Backbone
add-ons: MarionetteJS and Thorax.</p>
<h2 id="marionettejs-backbone.marionette">MarionetteJS
(Backbone.Marionette)</h2>
<p><em>By Derick Bailey &amp; Addy Osmani</em></p>
<p>As we’ve seen, Backbone provides a great set of building blocks for
our JavaScript applications. It gives us the core constructs that are
needed to build small to mid-sized apps, organize jQuery DOM events, or
create single page apps that support mobile devices and large scale
enterprise needs. But Backbone is not a complete framework, it’s a
library - a set of building blocks that leaves much of the application
design, architecture, and scalability to the developer, including memory
management, view management, and more.</p>
<p><a href="http://marionettejs.com">MarionetteJS</a> (a.k.a.
Backbone.Marionette) provides many of the features that the non-trivial
application developer needs, above what Backbone itself provides. It is
a composite application library that aims to simplify the construction
of large scale applications. It does this by providing a collection of
common design and implementation patterns found in the applications that
the creator, <a href="http://lostechies.com/derickbailey/">Derick
Bailey</a>, and many other <a
href="https://github.com/marionettejs/backbone.marionette/graphs/contributors">contributors</a>
have been using to build Backbone apps.</p>
<p>Marionette’s key benefits include:</p>
<ul>
<li>Scaling applications out with modular, event driven
architecture</li>
<li>Sensible defaults, such as using Underscore templates for view
rendering</li>
<li>Easy to modify to make it work with your application’s specific
needs</li>
<li>Reducing boilerplate for views, with specialized view types</li>
<li>Build on a modular architecture with an Application and modules that
attach to it</li>
<li>Compose your application’s visuals at runtime, with Region and
Layout</li>
<li>Nested views and layouts within visual regions</li>
<li>Built-in memory management and zombie killing in views, regions, and
layouts</li>
<li>Built-in event clean up with the EventBinder</li>
<li>Event-driven architecture with the EventAggregator</li>
<li>Flexible, “as-needed” architecture allowing you to pick and choose
what you need</li>
<li>And much, much more</li>
</ul>
<p>Marionette follows a similar philosophy to Backbone in that it
provides a suite of components that can be used independently of each
other, or used together to create significant advantages for us as
developers. But it steps above the structural components of Backbone and
provides an application layer, with more than a dozen components and
building blocks.</p>
<p>Marionette’s components range greatly in the features they provide,
but they all work together to create a composite application layer that
can both reduce boilerplate code and provide a much needed application
structure. Its core components include various and specialized view
types that take the boilerplate out of rendering common Backbone.Model
and Backbone.Collection scenarios; an Application object and Module
architecture to scale applications across sub-applications, features and
files; integration of a command pattern, event aggregator, and
request/response mechanism; and many more object types that can be
extended in a myriad of ways to create an architecture that facilitates
an application’s specific needs.</p>
<p>In spite of the large number of constructs that Marionette provides,
though, you’re not required to use all of it just because you want to
use some of it. Much like Backbone itself, you can pick and choose which
features you want to use and when. This allows you to work with other
Backbone frameworks and plugins very easily. It also means that you are
not required to engage in an all-or-nothing migration to begin using
Marionette.</p>
<h3 id="boilerplate-rendering-code">Boilerplate Rendering Code</h3>
<p>Consider the code that it typically requires to render a view with
Backbone and Underscore template. We need a template to render, which
can be placed in the DOM directly, and we need the JavaScript that
defines a view that uses the template and populates it with data from a
model.</p>
<pre><code>&lt;script type=&quot;text/html&quot; id=&quot;my-view-template&quot;&gt;
  &lt;div class=&quot;row&quot;&gt;
    &lt;label&gt;First Name:&lt;/label&gt;
    &lt;span&gt;&lt;%= firstName %&gt;&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class=&quot;row&quot;&gt;
    &lt;label&gt;Last Name:&lt;/label&gt;
    &lt;span&gt;&lt;%= lastName %&gt;&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class=&quot;row&quot;&gt;
    &lt;label&gt;Email:&lt;/label&gt;
    &lt;span&gt;&lt;%= email %&gt;&lt;/span&gt;
  &lt;/div&gt;
&lt;/script&gt;</code></pre>
<div class="sourceCode" id="cb168"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> <span class="fu">$</span>(<span class="st">&#39;#my-view-template&#39;</span>)<span class="op">.</span><span class="fu">html</span>()<span class="op">,</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// compile the Underscore.js template</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> compiledTemplate <span class="op">=</span> _<span class="op">.</span><span class="fu">template</span>(<span class="kw">this</span><span class="op">.</span><span class="at">template</span>)<span class="op">;</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// render the template with the model data</span></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> data <span class="op">=</span> _<span class="op">.</span><span class="fu">clone</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span>)<span class="op">;</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> html <span class="op">=</span> <span class="fu">compiledTemplate</span>(data)<span class="op">;</span></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// populate the view with the rendered html</span></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(html)<span class="op">;</span></span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Once this is in place, you need to create an instance of your view
and pass your model into it. Then you can take the view’s
<code>el</code> and append it to the DOM in order to display the
view.</p>
<div class="sourceCode" id="cb169"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Person <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;firstName&quot;</span><span class="op">:</span> <span class="st">&quot;Jeremy&quot;</span><span class="op">,</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;lastName&quot;</span><span class="op">:</span> <span class="st">&quot;Ashkenas&quot;</span><span class="op">,</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;email&quot;</span><span class="op">:</span>    <span class="st">&quot;jeremy@example.com&quot;</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Derick <span class="op">=</span> <span class="kw">new</span> <span class="fu">Person</span>({</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;Derick&#39;</span><span class="op">,</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Bailey&#39;</span><span class="op">,</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;derickbailey@example.com&#39;</span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myView <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyView</span>({</span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Derick</span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a>myView<span class="op">.</span><span class="fu">setElement</span>(<span class="st">&quot;#content&quot;</span>)<span class="op">;</span></span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a>myView<span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span></code></pre></div>
<p>This is a standard set up for defining, building, rendering, and
displaying a view with Backbone. This is also what we call “boilerplate
code” - code that is repeated over and over and over again, across every
project and every implementation with the same functionality. It gets to
be tedious and repetitious very quickly.</p>
<p>Enter Marionette’s <code>ItemView</code> - a simple way to reduce the
boilerplate of defining a view.</p>
<h3 id="reducing-boilerplate-with-marionette.itemview">Reducing
Boilerplate With Marionette.ItemView</h3>
<p>All of Marionette’s view types - with the exception of
<code>Marionette.View</code> - include a built-in <code>render</code>
method that handles the core rendering logic for you. We can take
advantage of this by changing the <code>MyView</code> instance to
inherit from one of these rather than <code>Backbone.View</code>.
Instead of having to provide our own <code>render</code> method for the
view, we can let Marionette render it for us. We’ll still use the same
Underscore.js template and rendering mechanism, but the implementation
of this is hidden behind the scenes. Thus, we can reduce the amount of
code needed for this view.</p>
<div class="sourceCode" id="cb170"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyView <span class="op">=</span> Marionette<span class="op">.</span><span class="at">ItemView</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> <span class="st">&#39;#my-view-template&#39;</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>And that’s it - that’s all you need to get the exact same behaviour
as the previous view implementation. Just replace
<code>Backbone.View.extend</code> with
<code>Marionette.ItemView.extend</code>, then get rid of the
<code>render</code> method. You can still create the view instance with
a <code>model</code>, call the <code>render</code> method on the view
instance, and display the view in the DOM the same way that we did
before. But the view definition has been reduced to a single line of
configuration for the template.</p>
<h3 id="memory-management">Memory Management</h3>
<p>In addition to the reduction of code needed to define a view,
Marionette includes some advanced memory management in all of its views,
making the job of cleaning up a view instance and its event handlers
easy.</p>
<p>Consider the following view implementation:</p>
<div class="sourceCode" id="cb171"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ZombieView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> <span class="st">&#39;#my-view-template&#39;</span><span class="op">,</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// bind the model change to re-render this view</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This alert is going to demonstrate a problem</span></span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alert</span>(<span class="st">&#39;We`re rendering the view&#39;</span>)<span class="op">;</span></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>If we create two instances of this view using the same variable name
for both instances, and then change a value in the model, how many times
will we see the alert box?</p>
<div class="sourceCode" id="cb172"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Derick <span class="op">=</span> <span class="kw">new</span> <span class="fu">Person</span>({</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;Derick&#39;</span><span class="op">,</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Bailey&#39;</span><span class="op">,</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;derick@example.com&#39;</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a><span class="co">// create the first view instance</span></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> zombieView <span class="op">=</span> <span class="kw">new</span> <span class="fu">ZombieView</span>({</span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Derick</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a><span class="co">// create a second view instance, re-using</span></span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a><span class="co">// the same variable name to store it</span></span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a>zombieView <span class="op">=</span> <span class="kw">new</span> <span class="fu">ZombieView</span>({</span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Derick</span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb172-19"><a href="#cb172-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-20"><a href="#cb172-20" aria-hidden="true" tabindex="-1"></a>Derick<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;email&#39;</span><span class="op">,</span> <span class="st">&#39;derickbailey@example.com&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Since we’re re-using the same <code>zombieView</code> variable for
both instances, the first instance of the view will fall out of scope
immediately after the second is created. This allows the JavaScript
garbage collector to come along and clean it up, which should mean the
first view instance is no longer active and no longer going to respond
to the model’s “change” event.</p>
<p>But when we run this code, we end up with the alert box showing up
twice!</p>
<p>The problem is caused by the model event binding in the view’s
<code>initialize</code> method. Whenever we pass
<code>this.render</code> as the callback method to the model’s
<code>on</code> event binding, the model itself is being given a direct
reference to the view instance. Since the model is now holding a
reference to the view instance, replacing the <code>zombieView</code>
variable with a new view instance is not going to let the original view
fall out of scope. The model still has a reference, therefore the view
is still in scope.</p>
<p>Since the original view is still in scope, and the second view
instance is also in scope, changing data on the model will cause both
view instances to respond.</p>
<p>Fixing this is easy, though. You just need to call
<code>stopListening</code> when the view is done with its work and ready
to be closed. To do this, add a <code>close</code> method to the
view.</p>
<div class="sourceCode" id="cb173"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ZombieView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> <span class="st">&#39;#my-view-template&#39;</span><span class="op">,</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// bind the model change to re-render this view</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">close</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// unbind the events that this view is listening to</span></span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">stopListening</span>()<span class="op">;</span></span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This alert is going to demonstrate a problem</span></span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alert</span>(<span class="st">&#39;We`re rendering the view&#39;</span>)<span class="op">;</span></span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Then call <code>close</code> on the first instance when it is no
longer needed, and only one view instance will remain alive. For more
information about the <code>listenTo</code> and
<code>stopListening</code> functions, see the earlier Backbone Basics
chapter and Derick’s post on <a
href="http://lostechies.com/derickbailey/2013/02/06/managing-events-as-relationships-not-just-references/">Managing
Events As Relationships, Not Just Resources</a>.</p>
<div class="sourceCode" id="cb174"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Jeremy <span class="op">=</span> <span class="kw">new</span> <span class="fu">Person</span>({</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;Jeremy&#39;</span><span class="op">,</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Ashkenas&#39;</span><span class="op">,</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;jeremy@example.com&#39;</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="co">// create the first view instance</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> zombieView <span class="op">=</span> <span class="kw">new</span> <span class="fu">ZombieView</span>({</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Jeremy</span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a>zombieView<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span> <span class="co">// double-tap the zombie</span></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a><span class="co">// create a second view instance, re-using</span></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="co">// the same variable name to store it</span></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a>zombieView <span class="op">=</span> <span class="kw">new</span> <span class="fu">ZombieView</span>({</span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Jeremy</span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb174-18"><a href="#cb174-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-19"><a href="#cb174-19" aria-hidden="true" tabindex="-1"></a>Jeremy<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;email&#39;</span><span class="op">,</span> <span class="st">&#39;jeremyashkenas@example.com&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Now we only see one alert box when this code runs.</p>
<p>Rather than having to manually remove these event handlers, though,
we can let Marionette do it for us.</p>
<div class="sourceCode" id="cb175"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ZombieView <span class="op">=</span> Marionette<span class="op">.</span><span class="at">ItemView</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> <span class="st">&#39;#my-view-template&#39;</span><span class="op">,</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// bind the model change to re-render this view</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This alert is going to demonstrate a problem</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alert</span>(<span class="st">&#39;We`re rendering the view&#39;</span>)<span class="op">;</span></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Notice in this case we are using a method called
<code>listenTo</code>. This method comes from Backbone.Events, and is
available in all objects that mix in Backbone.Events - including most
Marionette objects. The <code>listenTo</code> method signature is
similar to that of the <code>on</code> method, with the exception of
passing the object that triggers the event as the first parameter.</p>
<p>Marionette’s views also provide a <code>close</code> event, in which
the event bindings that are set up with the <code>listenTo</code> are
automatically removed. This means we no longer need to define a
<code>close</code> method directly, and when we use the
<code>listenTo</code> method, we know that our events will be removed
and our views will not turn into zombies.</p>
<p>But how do we automate the call to <code>close</code> on a view, in
the real application? When and where do we call that? Enter the
<code>Marionette.Region</code> - an object that manages the lifecycle of
an individual view.</p>
<h3 id="region-management">Region Management</h3>
<p>After a view is created, it typically needs to be placed in the DOM
so that it becomes visible. This is usually done with a jQuery selector
and setting the <code>html()</code> of the resulting object:</p>
<div class="sourceCode" id="cb176"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Joe <span class="op">=</span> <span class="kw">new</span> <span class="fu">Person</span>({</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;Joe&#39;</span><span class="op">,</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Bob&#39;</span><span class="op">,</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;joebob@example.com&#39;</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myView <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyView</span>({</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> Joe</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>myView<span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="co">// show the view in the DOM</span></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="st">&#39;#content&#39;</span>)<span class="op">.</span><span class="fu">html</span>(myView<span class="op">.</span><span class="at">el</span>)</span></code></pre></div>
<p>This, again, is boilerplate code. We shouldn’t have to manually call
<code>render</code> and manually select the DOM elements to show the
view. Furthermore, this code doesn’t lend itself to closing any previous
view instance that might be attached to the DOM element we want to
populate. And we’ve seen the danger of zombie views already.</p>
<p>To solve these problems, Marionette provides a <code>Region</code>
object - an object that manages the lifecycle of individual views,
displayed in a particular DOM element.</p>
<div class="sourceCode" id="cb177"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co">// create a region instance, telling it which DOM element to manage</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myRegion <span class="op">=</span> <span class="kw">new</span> Marionette<span class="op">.</span><span class="fu">Region</span>({</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">el</span><span class="op">:</span> <span class="st">&#39;#content&#39;</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="co">// show a view in the region</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> view1 <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyView</span>({ <span class="co">/* ... */</span> })<span class="op">;</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>myRegion<span class="op">.</span><span class="fu">show</span>(view1)<span class="op">;</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a><span class="co">// somewhere else in the code,</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="co">// show a different view</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> view2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyView</span>({ <span class="co">/* ... */</span> })<span class="op">;</span></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a>myRegion<span class="op">.</span><span class="fu">show</span>(view2)<span class="op">;</span></span></code></pre></div>
<p>There are several things to note, here. First, we’re telling the
region what DOM element to manage by specifying an <code>el</code> in
the region instance. Second, we’re no longer calling the
<code>render</code> method on our views. And lastly, we’re not calling
<code>close</code> on our view, either, though this is getting called
for us.</p>
<p>When we use a region to manage the lifecycle of our views, and
display the views in the DOM, the region itself handles these concerns.
By passing a view instance into the <code>show</code> method of the
region, it will call the render method on the view for us. It will then
take the resulting <code>el</code> of the view and populate the DOM
element.</p>
<p>The next time we call the <code>show</code> method of the region, the
region remembers that it is currently displaying a view. The region
calls the <code>close</code> method on the view, removes it from the
DOM, and then proceeds to run the render &amp; display code for the new
view that was passed in.</p>
<p>Since the region handles calling <code>close</code> for us, and we’re
using the <code>listenTo</code> event binder in our view instance, we no
longer have to worry about zombie views in our application.</p>
<p>Regions are not limited to just Marionette views, though. Any valid
Backbone.View can be managed by a Marionette.Region. If your view
happens to have a <code>close</code> method, it will be called when the
view is closed. If not, the Backbone.View built-in method,
<code>remove</code>, will be called instead.</p>
<h3 id="marionette-todo-app">Marionette Todo app</h3>
<p>Having learned about Marionette’s high-level concepts, let’s explore
refactoring the Todo application we created in our first exercise to use
it. The complete code for this application can be found in Derick’s
TodoMVC <a
href="https://github.com/derickbailey/todomvc/tree/marionette/labs/architecture-examples/backbone_marionette/js">fork</a>.</p>
<p>Our final implementation will be visually and functionally equivalent
to the original app, as seen below.</p>
<p><img src="img/marionette_todo0.png" /></p>
<p>First, we define an application object representing our base TodoMVC
app. This will contain initialization code and define the default layout
regions for our app.</p>
<p><strong>TodoMVC.js:</strong></p>
<div class="sourceCode" id="cb178"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoMVC <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="at">Marionette</span><span class="op">.</span><span class="fu">Application</span>()<span class="op">;</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>TodoMVC<span class="op">.</span><span class="fu">addRegions</span>({</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">header</span><span class="op">:</span> <span class="st">&#39;#header&#39;</span><span class="op">,</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">main</span><span class="op">:</span> <span class="st">&#39;#main&#39;</span><span class="op">,</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">footer</span><span class="op">:</span> <span class="st">&#39;#footer&#39;</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>TodoMVC<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;start&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>  Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">start</span>()<span class="op">;</span></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Regions are used to manage the content that’s displayed within
specific elements, and the <code>addRegions</code> method on the
<code>TodoMVC</code> object is just a shortcut for creating
<code>Region</code> objects. We supply a jQuery selector for each region
to manage (e.g., <code>#header</code>, <code>#main</code>, and
<code>#footer</code>) and then tell the region to show various Backbone
views within that region.</p>
<p>Once the application object has been initialized, we call
<code>Backbone.history.start()</code> to route the initial URL.</p>
<p>Next, we define our Layouts. A layout is a specialized type of view
that directly extends <code>Marionette.ItemView</code>. This means it’s
intended to render a single template and may or may not have a model (or
<code>item</code>) associated with the template.</p>
<p>One of the main differences between a Layout and an
<code>ItemView</code> is that the layout contains regions. When defining
a Layout, we supply it with both a <code>template</code> and the regions
that the template contains. After rendering the layout, we can display
other views within the layout using the regions that were defined.</p>
<p>In our TodoMVC Layout module below, we define Layouts for:</p>
<ul>
<li>Header: where we can create new Todos</li>
<li>Footer: where we summarize how many Todos are remaining/have been
completed</li>
</ul>
<p>This captures some of the view logic that was previously in our
<code>AppView</code> and <code>TodoView</code>.</p>
<p>Note that Marionette modules (such as the below) offer a simple
module system which is used to create privacy and encapsulation in
Marionette apps. These certainly don’t have to be used however, and
later on in this section we’ll provide links to alternative
implementations using RequireJS + AMD instead.</p>
<p><strong>TodoMVC.Layout.js:</strong></p>
<div class="sourceCode" id="cb179"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>TodoMVC<span class="op">.</span><span class="fu">module</span>(<span class="st">&#39;Layout&#39;</span><span class="op">,</span> <span class="kw">function</span>(Layout<span class="op">,</span> App<span class="op">,</span> Backbone<span class="op">,</span> Marionette<span class="op">,</span> $<span class="op">,</span> _) {</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Layout Header View</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ------------------</span></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>  Layout<span class="op">.</span><span class="at">Header</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Marionette</span><span class="op">.</span><span class="at">ItemView</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> <span class="st">&#39;#template-header&#39;</span><span class="op">,</span></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// UI Bindings create cached attributes that</span></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// point to jQuery selected objects.</span></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ui</span><span class="op">:</span> {</span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">input</span><span class="op">:</span> <span class="st">&#39;#new-todo&#39;</span></span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;keypress #new-todo&#39;</span><span class="op">:</span> <span class="st">&#39;onInputKeypress&#39;</span><span class="op">,</span></span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;blur #new-todo&#39;</span><span class="op">:</span> <span class="st">&#39;onTodoBlur&#39;</span></span>
<span id="cb179-18"><a href="#cb179-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-19"><a href="#cb179-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-20"><a href="#cb179-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">onTodoBlur</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb179-21"><a href="#cb179-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> todoText <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">val</span>()<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb179-22"><a href="#cb179-22" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">createTodo</span>(todoText)<span class="op">;</span></span>
<span id="cb179-23"><a href="#cb179-23" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-24"><a href="#cb179-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-25"><a href="#cb179-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">onInputKeypress</span><span class="op">:</span> <span class="kw">function</span>(e) {</span>
<span id="cb179-26"><a href="#cb179-26" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> ENTER_KEY <span class="op">=</span> <span class="dv">13</span><span class="op">;</span></span>
<span id="cb179-27"><a href="#cb179-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> todoText <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">val</span>()<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb179-28"><a href="#cb179-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-29"><a href="#cb179-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ( e<span class="op">.</span><span class="at">which</span> <span class="op">===</span> ENTER_KEY <span class="op">&amp;&amp;</span> todoText ) {</span>
<span id="cb179-30"><a href="#cb179-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">createTodo</span>(todoText)<span class="op">;</span></span>
<span id="cb179-31"><a href="#cb179-31" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb179-32"><a href="#cb179-32" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb179-33"><a href="#cb179-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-34"><a href="#cb179-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completeAdd</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb179-35"><a href="#cb179-35" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">val</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb179-36"><a href="#cb179-36" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-37"><a href="#cb179-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-38"><a href="#cb179-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">createTodo</span><span class="op">:</span> <span class="kw">function</span>(todoText) {</span>
<span id="cb179-39"><a href="#cb179-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (todoText<span class="op">.</span><span class="fu">trim</span>() <span class="op">===</span> <span class="st">&quot;&quot;</span>){ <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb179-40"><a href="#cb179-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-41"><a href="#cb179-41" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb179-42"><a href="#cb179-42" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> todoText</span>
<span id="cb179-43"><a href="#cb179-43" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb179-44"><a href="#cb179-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-45"><a href="#cb179-45" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">completeAdd</span>()<span class="op">;</span></span>
<span id="cb179-46"><a href="#cb179-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb179-47"><a href="#cb179-47" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb179-48"><a href="#cb179-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-49"><a href="#cb179-49" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Layout Footer View</span></span>
<span id="cb179-50"><a href="#cb179-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ------------------</span></span>
<span id="cb179-51"><a href="#cb179-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-52"><a href="#cb179-52" aria-hidden="true" tabindex="-1"></a>  Layout<span class="op">.</span><span class="at">Footer</span> <span class="op">=</span> Marionette<span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb179-53"><a href="#cb179-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> <span class="st">&#39;#template-footer&#39;</span><span class="op">,</span></span>
<span id="cb179-54"><a href="#cb179-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-55"><a href="#cb179-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// UI Bindings create cached attributes that</span></span>
<span id="cb179-56"><a href="#cb179-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">// point to jQuery selected objects.</span></span>
<span id="cb179-57"><a href="#cb179-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ui</span><span class="op">:</span> {</span>
<span id="cb179-58"><a href="#cb179-58" aria-hidden="true" tabindex="-1"></a>      <span class="dt">todoCount</span><span class="op">:</span> <span class="st">&#39;#todo-count .count&#39;</span><span class="op">,</span></span>
<span id="cb179-59"><a href="#cb179-59" aria-hidden="true" tabindex="-1"></a>      <span class="dt">todoCountLabel</span><span class="op">:</span> <span class="st">&#39;#todo-count .label&#39;</span><span class="op">,</span></span>
<span id="cb179-60"><a href="#cb179-60" aria-hidden="true" tabindex="-1"></a>      <span class="dt">clearCount</span><span class="op">:</span> <span class="st">&#39;#clear-completed .count&#39;</span><span class="op">,</span></span>
<span id="cb179-61"><a href="#cb179-61" aria-hidden="true" tabindex="-1"></a>      <span class="dt">filters</span><span class="op">:</span> <span class="st">&quot;#filters a&quot;</span></span>
<span id="cb179-62"><a href="#cb179-62" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-63"><a href="#cb179-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-64"><a href="#cb179-64" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb179-65"><a href="#cb179-65" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;click #clear-completed&quot;</span><span class="op">:</span> <span class="st">&quot;onClearClick&quot;</span></span>
<span id="cb179-66"><a href="#cb179-66" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-67"><a href="#cb179-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-68"><a href="#cb179-68" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb179-69"><a href="#cb179-69" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">bindTo</span>( App<span class="op">.</span><span class="at">vent</span><span class="op">,</span> <span class="st">&quot;todoList: filter&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">updateFilterSelection</span><span class="op">,</span> <span class="kw">this</span> )<span class="op">;</span></span>
<span id="cb179-70"><a href="#cb179-70" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">bindTo</span>( <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">,</span> <span class="st">&#39;all&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">updateCount</span><span class="op">,</span> <span class="kw">this</span> )<span class="op">;</span></span>
<span id="cb179-71"><a href="#cb179-71" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-72"><a href="#cb179-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-73"><a href="#cb179-73" aria-hidden="true" tabindex="-1"></a>    <span class="dt">onRender</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb179-74"><a href="#cb179-74" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">updateCount</span>()<span class="op">;</span></span>
<span id="cb179-75"><a href="#cb179-75" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-76"><a href="#cb179-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-77"><a href="#cb179-77" aria-hidden="true" tabindex="-1"></a>    <span class="dt">updateCount</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb179-78"><a href="#cb179-78" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> activeCount <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">getActive</span>()<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb179-79"><a href="#cb179-79" aria-hidden="true" tabindex="-1"></a>      completedCount <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">getCompleted</span>()<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb179-80"><a href="#cb179-80" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">todoCount</span><span class="op">.</span><span class="fu">html</span>(activeCount)<span class="op">;</span></span>
<span id="cb179-81"><a href="#cb179-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-82"><a href="#cb179-82" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">todoCountLabel</span><span class="op">.</span><span class="fu">html</span>(activeCount <span class="op">===</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">&#39;item&#39;</span> <span class="op">:</span> <span class="st">&#39;items&#39;</span>)<span class="op">;</span></span>
<span id="cb179-83"><a href="#cb179-83" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">clearCount</span><span class="op">.</span><span class="fu">html</span>(completedCount <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">&#39;&#39;</span> <span class="op">:</span> <span class="st">&#39;(&#39;</span> <span class="op">+</span> completedCount <span class="op">+</span> <span class="st">&#39;)&#39;</span>)<span class="op">;</span></span>
<span id="cb179-84"><a href="#cb179-84" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-85"><a href="#cb179-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-86"><a href="#cb179-86" aria-hidden="true" tabindex="-1"></a>    <span class="dt">updateFilterSelection</span><span class="op">:</span> <span class="kw">function</span>( filter ) {</span>
<span id="cb179-87"><a href="#cb179-87" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">filters</span></span>
<span id="cb179-88"><a href="#cb179-88" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">removeClass</span>(<span class="st">&#39;selected&#39;</span>)</span>
<span id="cb179-89"><a href="#cb179-89" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">filter</span>( <span class="st">&#39;[href=&quot;#&#39;</span> <span class="op">+</span> filter <span class="op">+</span> <span class="st">&#39;&quot;]&#39;</span>)</span>
<span id="cb179-90"><a href="#cb179-90" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addClass</span>( <span class="st">&#39;selected&#39;</span> )<span class="op">;</span></span>
<span id="cb179-91"><a href="#cb179-91" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb179-92"><a href="#cb179-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-93"><a href="#cb179-93" aria-hidden="true" tabindex="-1"></a>    <span class="dt">onClearClick</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb179-94"><a href="#cb179-94" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> completed <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">getCompleted</span>()<span class="op">;</span></span>
<span id="cb179-95"><a href="#cb179-95" aria-hidden="true" tabindex="-1"></a>      completed<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span> <span class="fu">destroy</span>(todo) {</span>
<span id="cb179-96"><a href="#cb179-96" aria-hidden="true" tabindex="-1"></a>        todo<span class="op">.</span><span class="fu">destroy</span>()<span class="op">;</span></span>
<span id="cb179-97"><a href="#cb179-97" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb179-98"><a href="#cb179-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb179-99"><a href="#cb179-99" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb179-100"><a href="#cb179-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-101"><a href="#cb179-101" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Next, we tackle application routing and workflow, such as controlling
Layouts in the page which can be shown or hidden.</p>
<p>Recall how Backbone routes trigger methods within the Router as shown
below in our original Workspace router from our first exercise:</p>
<div class="sourceCode" id="cb180"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Workspace <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">routes</span><span class="op">:</span> {</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;*filter&#39;</span><span class="op">:</span> <span class="st">&#39;setFilter&#39;</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">setFilter</span><span class="op">:</span> <span class="kw">function</span>(param) {</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Set the current filter to be used</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>      <span class="bu">window</span><span class="op">.</span><span class="at">app</span><span class="op">.</span><span class="at">TodoFilter</span> <span class="op">=</span> param<span class="op">.</span><span class="fu">trim</span>() <span class="op">||</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Trigger a collection filter event, causing hiding/unhiding</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">// of Todo view items</span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>      <span class="bu">window</span><span class="op">.</span><span class="at">app</span><span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;filter&#39;</span>)<span class="op">;</span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<p>Marionette uses the concept of an AppRouter to simplify routing. This
reduces the boilerplate for handling route events and allows routers to
be configured to call methods on an object directly. We configure our
AppRouter using <code>appRoutes</code> which replaces the
<code>'*filter': 'setFilter'</code> route defined in our original router
and invokes a method on our Controller.</p>
<p>The TodoList Controller, also found in this next code block, handles
some of the remaining visibility logic originally found in
<code>AppView</code> and <code>TodoView</code>, albeit using very
readable Layouts.</p>
<p><strong>TodoMVC.TodoList.js:</strong></p>
<div class="sourceCode" id="cb181"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>TodoMVC<span class="op">.</span><span class="fu">module</span>(<span class="st">&#39;TodoList&#39;</span><span class="op">,</span> <span class="kw">function</span>(TodoList<span class="op">,</span> App<span class="op">,</span> Backbone<span class="op">,</span> Marionette<span class="op">,</span> $<span class="op">,</span> _) {</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// TodoList Router</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ---------------</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Handle routes to show the active vs complete todo items</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>  TodoList<span class="op">.</span><span class="at">Router</span> <span class="op">=</span> Marionette<span class="op">.</span><span class="at">AppRouter</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">appRoutes</span><span class="op">:</span> {</span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;*filter&#39;</span><span class="op">:</span> <span class="st">&#39;filterItems&#39;</span></span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// TodoList Controller (Mediator)</span></span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ------------------------------</span></span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Control the workflow and logic that exists at the application</span></span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// level, above the implementation detail of views and models</span></span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>  TodoList<span class="op">.</span><span class="at">Controller</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todoList</span> <span class="op">=</span> <span class="kw">new</span> App<span class="op">.</span><span class="at">Todos</span><span class="op">.</span><span class="fu">TodoList</span>()<span class="op">;</span></span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a>  _<span class="op">.</span><span class="fu">extend</span>(TodoList<span class="op">.</span><span class="at">Controller</span><span class="op">.</span><span class="at">prototype</span><span class="op">,</span> {</span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start the app by showing the appropriate views</span></span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and fetching the list of todo items, if there are any</span></span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">showHeader</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoList</span>)<span class="op">;</span></span>
<span id="cb181-30"><a href="#cb181-30" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">showFooter</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoList</span>)<span class="op">;</span></span>
<span id="cb181-31"><a href="#cb181-31" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">showTodoList</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoList</span>)<span class="op">;</span></span>
<span id="cb181-32"><a href="#cb181-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb181-33"><a href="#cb181-33" aria-hidden="true" tabindex="-1"></a>  App<span class="op">.</span><span class="fu">bindTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoList</span><span class="op">,</span> <span class="st">&#39;reset add remove&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">toggleFooter</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb181-34"><a href="#cb181-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">todoList</span><span class="op">.</span><span class="fu">fetch</span>()<span class="op">;</span></span>
<span id="cb181-35"><a href="#cb181-35" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb181-36"><a href="#cb181-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-37"><a href="#cb181-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">showHeader</span><span class="op">:</span> <span class="kw">function</span>(todoList) {</span>
<span id="cb181-38"><a href="#cb181-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> header <span class="op">=</span> <span class="kw">new</span> App<span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">Header</span>({</span>
<span id="cb181-39"><a href="#cb181-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">collection</span><span class="op">:</span> todoList</span>
<span id="cb181-40"><a href="#cb181-40" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb181-41"><a href="#cb181-41" aria-hidden="true" tabindex="-1"></a>      App<span class="op">.</span><span class="at">header</span><span class="op">.</span><span class="fu">show</span>(header)<span class="op">;</span></span>
<span id="cb181-42"><a href="#cb181-42" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb181-43"><a href="#cb181-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-44"><a href="#cb181-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">showFooter</span><span class="op">:</span> <span class="kw">function</span>(todoList) {</span>
<span id="cb181-45"><a href="#cb181-45" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> footer <span class="op">=</span> <span class="kw">new</span> App<span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">Footer</span>({</span>
<span id="cb181-46"><a href="#cb181-46" aria-hidden="true" tabindex="-1"></a>        <span class="dt">collection</span><span class="op">:</span> todoList</span>
<span id="cb181-47"><a href="#cb181-47" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb181-48"><a href="#cb181-48" aria-hidden="true" tabindex="-1"></a>      App<span class="op">.</span><span class="at">footer</span><span class="op">.</span><span class="fu">show</span>(footer)<span class="op">;</span></span>
<span id="cb181-49"><a href="#cb181-49" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb181-50"><a href="#cb181-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-51"><a href="#cb181-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">showTodoList</span><span class="op">:</span> <span class="kw">function</span>(todoList) {</span>
<span id="cb181-52"><a href="#cb181-52" aria-hidden="true" tabindex="-1"></a>      App<span class="op">.</span><span class="at">main</span><span class="op">.</span><span class="fu">show</span>(<span class="kw">new</span> TodoList<span class="op">.</span><span class="at">Views</span><span class="op">.</span><span class="fu">ListView</span>({</span>
<span id="cb181-53"><a href="#cb181-53" aria-hidden="true" tabindex="-1"></a>        <span class="dt">collection</span><span class="op">:</span> todoList</span>
<span id="cb181-54"><a href="#cb181-54" aria-hidden="true" tabindex="-1"></a>      }))<span class="op">;</span></span>
<span id="cb181-55"><a href="#cb181-55" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb181-56"><a href="#cb181-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb181-57"><a href="#cb181-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">toggleFooter</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb181-58"><a href="#cb181-58" aria-hidden="true" tabindex="-1"></a>      App<span class="op">.</span><span class="at">footer</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">toggle</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoList</span><span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb181-59"><a href="#cb181-59" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb181-60"><a href="#cb181-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-61"><a href="#cb181-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the filter to show complete or all items</span></span>
<span id="cb181-62"><a href="#cb181-62" aria-hidden="true" tabindex="-1"></a>    <span class="dt">filterItems</span><span class="op">:</span> <span class="kw">function</span>(filter) {</span>
<span id="cb181-63"><a href="#cb181-63" aria-hidden="true" tabindex="-1"></a>      App<span class="op">.</span><span class="at">vent</span><span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;todoList:filter&#39;</span><span class="op">,</span> filter<span class="op">.</span><span class="fu">trim</span>() <span class="op">||</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb181-64"><a href="#cb181-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb181-65"><a href="#cb181-65" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb181-66"><a href="#cb181-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-67"><a href="#cb181-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">// TodoList Initializer</span></span>
<span id="cb181-68"><a href="#cb181-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --------------------</span></span>
<span id="cb181-69"><a href="#cb181-69" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb181-70"><a href="#cb181-70" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get the TodoList up and running by initializing the mediator</span></span>
<span id="cb181-71"><a href="#cb181-71" aria-hidden="true" tabindex="-1"></a>  <span class="co">// when the the application is started, pulling in all of the</span></span>
<span id="cb181-72"><a href="#cb181-72" aria-hidden="true" tabindex="-1"></a>  <span class="co">// existing Todo items and displaying them.</span></span>
<span id="cb181-73"><a href="#cb181-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb181-74"><a href="#cb181-74" aria-hidden="true" tabindex="-1"></a>  TodoList<span class="op">.</span><span class="fu">addInitializer</span>(<span class="kw">function</span>() {</span>
<span id="cb181-75"><a href="#cb181-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-76"><a href="#cb181-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> TodoList<span class="op">.</span><span class="fu">Controller</span>()<span class="op">;</span></span>
<span id="cb181-77"><a href="#cb181-77" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> TodoList<span class="op">.</span><span class="fu">Router</span>({</span>
<span id="cb181-78"><a href="#cb181-78" aria-hidden="true" tabindex="-1"></a>      <span class="dt">controller</span><span class="op">:</span> controller</span>
<span id="cb181-79"><a href="#cb181-79" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb181-80"><a href="#cb181-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-81"><a href="#cb181-81" aria-hidden="true" tabindex="-1"></a>    controller<span class="op">.</span><span class="fu">start</span>()<span class="op">;</span></span>
<span id="cb181-82"><a href="#cb181-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-83"><a href="#cb181-83" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb181-84"><a href="#cb181-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-85"><a href="#cb181-85" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>####Controllers</p>
<p>In this particular app, note that Controllers don’t add a great deal
to the overall workflow. In general, Marionette’s philosophy on routers
is that they should be an afterthought in the implementation of
applications. Quite often, we’ve seen developers abuse Backbone’s
routing system by making it the sole controller of the entire
application workflow and logic.</p>
<p>This inevitably leads to mashing every possible combination of code
into the router methods - view creation, model loading, coordinating
different parts of the app, etc. Developers such as Derick view this as
a violation of the <a
href="http://en.wikipedia.org/wiki/Single_responsibility_principle">single-responsibility
principle</a> (SRP) and separation of concerns.</p>
<p>Backbone’s router and history exist to deal with a specific aspect of
browsers - managing the forward and back buttons. Marionette’s
philosophy is that it should be limited to that, with the code that gets
executed by the navigation being somewhere else. This allows the
application to be used with or without a router. We can call a
controller’s “show” method from a button click, from an application
event handler, or from a router, and we will end up with the same
application state no matter how we called that method.</p>
<p>Derick has written extensively about his thoughts on this topic,
which you can read more about on his blog:</p>
<ul>
<li><a
href="http://lostechies.com/derickbailey/2011/12/27/the-responsibilities-of-the-various-pieces-of-backbone-js/">http://lostechies.com/derickbailey/2011/12/27/the-responsibilities-of-the-various-pieces-of-backbone-js/</a></li>
<li><a
href="http://lostechies.com/derickbailey/2012/01/02/reducing-backbone-routers-to-nothing-more-than-configuration/">http://lostechies.com/derickbailey/2012/01/02/reducing-backbone-routers-to-nothing-more-than-configuration/</a></li>
<li><a
href="http://lostechies.com/derickbailey/2012/02/06/3-stages-of-a-backbone-applications-startup/">http://lostechies.com/derickbailey/2012/02/06/3-stages-of-a-backbone-applications-startup/</a></li>
</ul>
<h4 id="compositeview">CompositeView</h4>
<p>Our next task is defining the actual views for individual Todo items
and lists of items in our TodoMVC application. For this, we make use of
Marionette’s <code>CompositeView</code>s. The idea behind a
CompositeView is that it represents a visualization of a composite or
hierarchical structure of leaves (or nodes) and branches.</p>
<p>Think of these views as being a hierarchy of parent-child models, and
recursive by default. The same CompositeView type will be used to render
each item in a collection that is handled by the composite view. For
non-recursive hierarchies, we are able to override the item view by
defining an <code>itemView</code> attribute.</p>
<p>For our Todo List Item View, we define it as an ItemView, then our
Todo List View is a CompositeView where we override the
<code>itemView</code> setting and tell it to use the Todo List Item View
for each item in the collection.</p>
<p>TodoMVC.TodoList.Views.js</p>
<div class="sourceCode" id="cb182"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>TodoMVC<span class="op">.</span><span class="fu">module</span>(<span class="st">&#39;TodoList.Views&#39;</span><span class="op">,</span> <span class="kw">function</span>(Views<span class="op">,</span> App<span class="op">,</span> Backbone<span class="op">,</span> Marionette<span class="op">,</span> $<span class="op">,</span> _) {</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Todo List Item View</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// -------------------</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Display an individual todo item, and respond to changes</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// that are made to the item, including marking completed.</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>  Views<span class="op">.</span><span class="at">ItemView</span> <span class="op">=</span> Marionette<span class="op">.</span><span class="at">ItemView</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tagName</span><span class="op">:</span> <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="st">&#39;#template-todoItemView&#39;</span><span class="op">,</span></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ui</span><span class="op">:</span> {</span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">edit</span><span class="op">:</span> <span class="st">&#39;.edit&#39;</span></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;click .destroy&#39;</span><span class="op">:</span> <span class="st">&#39;destroy&#39;</span><span class="op">,</span></span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;dblclick label&#39;</span><span class="op">:</span> <span class="st">&#39;onEditClick&#39;</span><span class="op">,</span></span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;keypress .edit&#39;</span><span class="op">:</span> <span class="st">&#39;onEditKeypress&#39;</span><span class="op">,</span></span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;blur .edit&#39;</span>    <span class="op">:</span> <span class="st">&#39;onEditBlur&#39;</span><span class="op">,</span></span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;click .toggle&#39;</span> <span class="op">:</span> <span class="st">&#39;toggle&#39;</span></span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb182-26"><a href="#cb182-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">bindTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb182-27"><a href="#cb182-27" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-28"><a href="#cb182-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-29"><a href="#cb182-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onRender</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb182-30"><a href="#cb182-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">removeClass</span>( <span class="st">&#39;active completed&#39;</span> )<span class="op">;</span></span>
<span id="cb182-31"><a href="#cb182-31" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb182-32"><a href="#cb182-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ( <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>( <span class="st">&#39;completed&#39;</span> )) {</span>
<span id="cb182-33"><a href="#cb182-33" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">addClass</span>( <span class="st">&#39;completed&#39;</span> )<span class="op">;</span></span>
<span id="cb182-34"><a href="#cb182-34" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> { </span>
<span id="cb182-35"><a href="#cb182-35" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">addClass</span>( <span class="st">&#39;active&#39;</span> )<span class="op">;</span></span>
<span id="cb182-36"><a href="#cb182-36" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb182-37"><a href="#cb182-37" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-38"><a href="#cb182-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-39"><a href="#cb182-39" aria-hidden="true" tabindex="-1"></a>      <span class="dt">destroy</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb182-40"><a href="#cb182-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">destroy</span>()<span class="op">;</span></span>
<span id="cb182-41"><a href="#cb182-41" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-42"><a href="#cb182-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-43"><a href="#cb182-43" aria-hidden="true" tabindex="-1"></a>      <span class="dt">toggle</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb182-44"><a href="#cb182-44" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">toggle</span>()<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb182-45"><a href="#cb182-45" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-46"><a href="#cb182-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-47"><a href="#cb182-47" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onEditClick</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb182-48"><a href="#cb182-48" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">addClass</span>(<span class="st">&#39;editing&#39;</span>)<span class="op">;</span></span>
<span id="cb182-49"><a href="#cb182-49" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">edit</span><span class="op">.</span><span class="fu">focus</span>()<span class="op">;</span></span>
<span id="cb182-50"><a href="#cb182-50" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-51"><a href="#cb182-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb182-52"><a href="#cb182-52" aria-hidden="true" tabindex="-1"></a>      <span class="dt">updateTodo</span> <span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb182-53"><a href="#cb182-53" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> todoText <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">edit</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb182-54"><a href="#cb182-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (todoText <span class="op">===</span> <span class="st">&#39;&#39;</span>) {</span>
<span id="cb182-55"><a href="#cb182-55" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">destroy</span>()<span class="op">;</span></span>
<span id="cb182-56"><a href="#cb182-56" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb182-57"><a href="#cb182-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">setTodoText</span>(todoText)<span class="op">;</span></span>
<span id="cb182-58"><a href="#cb182-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">completeEdit</span>()<span class="op">;</span></span>
<span id="cb182-59"><a href="#cb182-59" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-60"><a href="#cb182-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-61"><a href="#cb182-61" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onEditBlur</span><span class="op">:</span> <span class="kw">function</span>(e){</span>
<span id="cb182-62"><a href="#cb182-62" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">updateTodo</span>()<span class="op">;</span></span>
<span id="cb182-63"><a href="#cb182-63" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-64"><a href="#cb182-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-65"><a href="#cb182-65" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onEditKeypress</span><span class="op">:</span> <span class="kw">function</span>(e) {</span>
<span id="cb182-66"><a href="#cb182-66" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> ENTER_KEY <span class="op">=</span> <span class="dv">13</span><span class="op">;</span></span>
<span id="cb182-67"><a href="#cb182-67" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> todoText <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">edit</span><span class="op">.</span><span class="fu">val</span>()<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb182-68"><a href="#cb182-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-69"><a href="#cb182-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ( e<span class="op">.</span><span class="at">which</span> <span class="op">===</span> ENTER_KEY <span class="op">&amp;&amp;</span> todoText ) {</span>
<span id="cb182-70"><a href="#cb182-70" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;title&#39;</span><span class="op">,</span> todoText)<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb182-71"><a href="#cb182-71" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">removeClass</span>(<span class="st">&#39;editing&#39;</span>)<span class="op">;</span></span>
<span id="cb182-72"><a href="#cb182-72" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb182-73"><a href="#cb182-73" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-74"><a href="#cb182-74" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb182-75"><a href="#cb182-75" aria-hidden="true" tabindex="-1"></a>      <span class="dt">setTodoText</span><span class="op">:</span> <span class="kw">function</span>(todoText){</span>
<span id="cb182-76"><a href="#cb182-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (todoText<span class="op">.</span><span class="fu">trim</span>() <span class="op">===</span> <span class="st">&quot;&quot;</span>){ <span class="cf">return</span><span class="op">;</span> }</span>
<span id="cb182-77"><a href="#cb182-77" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;title&#39;</span><span class="op">,</span> todoText)<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb182-78"><a href="#cb182-78" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-79"><a href="#cb182-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-80"><a href="#cb182-80" aria-hidden="true" tabindex="-1"></a>      <span class="dt">completeEdit</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb182-81"><a href="#cb182-81" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">removeClass</span>(<span class="st">&#39;editing&#39;</span>)<span class="op">;</span></span>
<span id="cb182-82"><a href="#cb182-82" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb182-83"><a href="#cb182-83" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb182-84"><a href="#cb182-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-85"><a href="#cb182-85" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Item List View</span></span>
<span id="cb182-86"><a href="#cb182-86" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --------------</span></span>
<span id="cb182-87"><a href="#cb182-87" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb182-88"><a href="#cb182-88" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Controls the rendering of the list of items, including the</span></span>
<span id="cb182-89"><a href="#cb182-89" aria-hidden="true" tabindex="-1"></a>  <span class="co">// filtering of active vs completed items for display.</span></span>
<span id="cb182-90"><a href="#cb182-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-91"><a href="#cb182-91" aria-hidden="true" tabindex="-1"></a>  Views<span class="op">.</span><span class="at">ListView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Marionette</span><span class="op">.</span><span class="at">CompositeView</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb182-92"><a href="#cb182-92" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="st">&#39;#template-todoListCompositeView&#39;</span><span class="op">,</span></span>
<span id="cb182-93"><a href="#cb182-93" aria-hidden="true" tabindex="-1"></a>      <span class="dt">childView</span><span class="op">:</span> Views<span class="op">.</span><span class="at">ItemView</span><span class="op">,</span></span>
<span id="cb182-94"><a href="#cb182-94" aria-hidden="true" tabindex="-1"></a>      <span class="dt">childViewContainer</span><span class="op">:</span> <span class="st">&#39;#todo-list&#39;</span><span class="op">,</span></span>
<span id="cb182-95"><a href="#cb182-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-96"><a href="#cb182-96" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ui</span><span class="op">:</span> {</span>
<span id="cb182-97"><a href="#cb182-97" aria-hidden="true" tabindex="-1"></a>        <span class="dt">toggle</span><span class="op">:</span> <span class="st">&#39;#toggle-all&#39;</span></span>
<span id="cb182-98"><a href="#cb182-98" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-99"><a href="#cb182-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-100"><a href="#cb182-100" aria-hidden="true" tabindex="-1"></a>      <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb182-101"><a href="#cb182-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;click #toggle-all&#39;</span><span class="op">:</span> <span class="st">&#39;onToggleAllClick&#39;</span></span>
<span id="cb182-102"><a href="#cb182-102" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-103"><a href="#cb182-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-104"><a href="#cb182-104" aria-hidden="true" tabindex="-1"></a>      <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb182-105"><a href="#cb182-105" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">bindTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">,</span> <span class="st">&#39;all&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">update</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb182-106"><a href="#cb182-106" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-107"><a href="#cb182-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-108"><a href="#cb182-108" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onRender</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb182-109"><a href="#cb182-109" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">update</span>()<span class="op">;</span></span>
<span id="cb182-110"><a href="#cb182-110" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-111"><a href="#cb182-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-112"><a href="#cb182-112" aria-hidden="true" tabindex="-1"></a>      <span class="dt">update</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb182-113"><a href="#cb182-113" aria-hidden="true" tabindex="-1"></a>        <span class="kw">function</span> <span class="fu">reduceCompleted</span>(left<span class="op">,</span> right) { </span>
<span id="cb182-114"><a href="#cb182-114" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> left <span class="op">&amp;&amp;</span> right<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>)<span class="op">;</span> </span>
<span id="cb182-115"><a href="#cb182-115" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb182-116"><a href="#cb182-116" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb182-117"><a href="#cb182-117" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> allCompleted <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">reduce</span>(reduceCompleted<span class="op">,</span><span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb182-118"><a href="#cb182-118" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">ui</span><span class="op">.</span><span class="at">toggle</span><span class="op">.</span><span class="fu">prop</span>(<span class="st">&#39;checked&#39;</span><span class="op">,</span> allCompleted)<span class="op">;</span></span>
<span id="cb182-119"><a href="#cb182-119" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">parent</span>()<span class="op">.</span><span class="fu">toggle</span>(<span class="op">!!</span><span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb182-120"><a href="#cb182-120" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb182-121"><a href="#cb182-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-122"><a href="#cb182-122" aria-hidden="true" tabindex="-1"></a>      <span class="dt">onToggleAllClick</span><span class="op">:</span> <span class="kw">function</span>(e) {</span>
<span id="cb182-123"><a href="#cb182-123" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> isChecked <span class="op">=</span> e<span class="op">.</span><span class="at">currentTarget</span><span class="op">.</span><span class="at">checked</span><span class="op">;</span></span>
<span id="cb182-124"><a href="#cb182-124" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>(todo) {</span>
<span id="cb182-125"><a href="#cb182-125" aria-hidden="true" tabindex="-1"></a>          todo<span class="op">.</span><span class="fu">save</span>({<span class="st">&#39;completed&#39;</span><span class="op">:</span> isChecked})<span class="op">;</span></span>
<span id="cb182-126"><a href="#cb182-126" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb182-127"><a href="#cb182-127" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb182-128"><a href="#cb182-128" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb182-129"><a href="#cb182-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-130"><a href="#cb182-130" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Application Event Handlers</span></span>
<span id="cb182-131"><a href="#cb182-131" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --------------------------</span></span>
<span id="cb182-132"><a href="#cb182-132" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb182-133"><a href="#cb182-133" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Handler for filtering the list of items by showing and</span></span>
<span id="cb182-134"><a href="#cb182-134" aria-hidden="true" tabindex="-1"></a>  <span class="co">// hiding through the use of various CSS classes</span></span>
<span id="cb182-135"><a href="#cb182-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-136"><a href="#cb182-136" aria-hidden="true" tabindex="-1"></a>  App<span class="op">.</span><span class="at">vent</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;todoList:filter&#39;</span><span class="op">,</span><span class="kw">function</span>(filter) {</span>
<span id="cb182-137"><a href="#cb182-137" aria-hidden="true" tabindex="-1"></a>    filter <span class="op">=</span> filter <span class="op">||</span> <span class="st">&#39;all&#39;</span><span class="op">;</span></span>
<span id="cb182-138"><a href="#cb182-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(<span class="st">&#39;#todoapp&#39;</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">&#39;class&#39;</span><span class="op">,</span> <span class="st">&#39;filter-&#39;</span> <span class="op">+</span> filter)<span class="op">;</span></span>
<span id="cb182-139"><a href="#cb182-139" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb182-140"><a href="#cb182-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-141"><a href="#cb182-141" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>At the end of the last code block, you will also notice an event
handler using <code>vent</code>. This is an event aggregator that allows
us to handle <code>filterItem</code> triggers from our TodoList
controller.</p>
<p>Finally, we define the model and collection for representing our Todo
items. These are semantically not very different from the original
versions we used in our first exercise and have been re-written to
better fit in with Derick’s preferred style of coding.</p>
<p><strong>TodoMVC.Todos.js:</strong></p>
<div class="sourceCode" id="cb183"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>TodoMVC<span class="op">.</span><span class="fu">module</span>(<span class="st">&#39;Todos&#39;</span><span class="op">,</span> <span class="kw">function</span>(Todos<span class="op">,</span> App<span class="op">,</span> Backbone<span class="op">,</span> Marionette<span class="op">,</span> $<span class="op">,</span> _) {</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Local Variables</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ---------------</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> localStorageKey <span class="op">=</span> <span class="st">&#39;todos-backbone-marionettejs&#39;</span><span class="op">;</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Todo Model</span></span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ----------</span></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>  Todos<span class="op">.</span><span class="at">Todo</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">localStorage</span><span class="op">:</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">LocalStorage</span>(localStorageKey)<span class="op">,</span></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">created</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="fu">isNew</span>()) {</span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;created&#39;</span><span class="op">,</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>())<span class="op">;</span></span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">toggle</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;completed&#39;</span><span class="op">,</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="fu">isCompleted</span>())<span class="op">;</span></span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-30"><a href="#cb183-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">isCompleted</span><span class="op">:</span> <span class="kw">function</span>() { </span>
<span id="cb183-31"><a href="#cb183-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>)<span class="op">;</span> </span>
<span id="cb183-32"><a href="#cb183-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb183-33"><a href="#cb183-33" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb183-34"><a href="#cb183-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-35"><a href="#cb183-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Todo Collection</span></span>
<span id="cb183-36"><a href="#cb183-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ---------------</span></span>
<span id="cb183-37"><a href="#cb183-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-38"><a href="#cb183-38" aria-hidden="true" tabindex="-1"></a>  Todos<span class="op">.</span><span class="at">TodoList</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb183-39"><a href="#cb183-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> Todos<span class="op">.</span><span class="at">Todo</span><span class="op">,</span></span>
<span id="cb183-40"><a href="#cb183-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-41"><a href="#cb183-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">localStorage</span><span class="op">:</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">LocalStorage</span>(localStorageKey)<span class="op">,</span></span>
<span id="cb183-42"><a href="#cb183-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-43"><a href="#cb183-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">getCompleted</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb183-44"><a href="#cb183-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">filter</span>(<span class="kw">this</span><span class="op">.</span><span class="at">_isCompleted</span>)<span class="op">;</span></span>
<span id="cb183-45"><a href="#cb183-45" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb183-46"><a href="#cb183-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-47"><a href="#cb183-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">getActive</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb183-48"><a href="#cb183-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">reject</span>(<span class="kw">this</span><span class="op">.</span><span class="at">_isCompleted</span>)<span class="op">;</span></span>
<span id="cb183-49"><a href="#cb183-49" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb183-50"><a href="#cb183-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-51"><a href="#cb183-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">comparator</span><span class="op">:</span> <span class="kw">function</span>(todo) {</span>
<span id="cb183-52"><a href="#cb183-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;created&#39;</span>)<span class="op">;</span></span>
<span id="cb183-53"><a href="#cb183-53" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb183-54"><a href="#cb183-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-55"><a href="#cb183-55" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_isCompleted</span><span class="op">:</span> <span class="kw">function</span>(todo) {</span>
<span id="cb183-56"><a href="#cb183-56" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> todo<span class="op">.</span><span class="fu">isCompleted</span>()<span class="op">;</span></span>
<span id="cb183-57"><a href="#cb183-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb183-58"><a href="#cb183-58" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb183-59"><a href="#cb183-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-60"><a href="#cb183-60" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>We finally kick-start everything off in our application index file,
by calling <code>start</code> on our main application object:</p>
<p>Initialization:</p>
<div class="sourceCode" id="cb184"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>      <span class="fu">$</span>(<span class="kw">function</span>() {</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Start the TodoMVC app (defined in js/TodoMVC.js)</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>        TodoMVC<span class="op">.</span><span class="fu">start</span>()<span class="op">;</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span></code></pre></div>
<p>And that’s it!</p>
<h3
id="is-the-marionette-implementation-of-the-todo-app-more-maintainable">Is
the Marionette implementation of the Todo app more maintainable?</h3>
<p>Derick feels that maintainability largely comes down to modularity,
separating responsibilities (Single Responsibility Principle and
Separation of Concerns) by using patterns to keep concerns from being
mixed together. It can, however, be difficult to simply extract things
into separate modules for the sake of extraction, abstraction, or
dividing the concept down into its simplest parts.</p>
<p>The Single Responsibility Principle (SRP) tells us quite the opposite
- that we need to understand the context in which things change. What
parts always change together, in <em>this</em> system? What parts can
change independently? Without knowing this, we won’t know what pieces
should be broken out into separate components and modules versus put
together into the same module or object.</p>
<p>The way Derick organizes his apps into modules is by creating a
breakdown of concepts at each level. A higher level module is a higher
level of concern - an aggregation of responsibilities. Each
responsibility is broken down into an expressive API set that is
implemented by lower level modules (Dependency Inversion Principle).
These are coordinated through a mediator - which he typically refers to
as the Controller in a module.</p>
<p>The way Derick organizes his files also plays directly into
maintainability and he has also written posts about the importance of
keeping a sane application folder structure that I recommend
reading:</p>
<ul>
<li><a
href="http://lostechies.com/derickbailey/2012/02/02/javascript-file-folder-structures-just-pick-one/">http://lostechies.com/derickbailey/2012/02/02/javascript-file-folder-structures-just-pick-one/</a></li>
<li><a
href="http://hilojs.codeplex.com/discussions/362875#post869640">http://hilojs.codeplex.com/discussions/362875#post869640</a></li>
</ul>
<h3 id="marionette-and-flexibility">Marionette And Flexibility</h3>
<p>Marionette is a flexible framework, much like Backbone itself. It
offers a wide variety of tools to help create and organize an
application architecture on top of Backbone, but like Backbone itself,
it doesn’t dictate that you have to use all of its pieces in order to
use any of them.</p>
<p>The flexibility and versatility in Marionette is easiest to
understand by examining three variations of TodoMVC implemented with it
that have been created for comparison purposes:</p>
<ul>
<li><a
href="https://github.com/jsoverson/todomvc/tree/master/labs/architecture-examples/backbone_marionette">Simple</a>
- by Jarrod Overson</li>
<li><a
href="https://github.com/jsoverson/todomvc/tree/master/labs/dependency-examples/backbone_marionette_require">RequireJS</a>
- also by Jarrod</li>
<li><a
href="https://github.com/derickbailey/todomvc/tree/marionette/labs/architecture-examples/backbone_marionette/js">Marionette
modules</a> - by Derick Bailey</li>
</ul>
<p><strong>The simple version</strong>: This version of TodoMVC shows
some raw use of Marionette’s various view types, an application object,
and the event aggregator. The objects that are created are added
directly to the global namespace and are fairly straightforward. This is
a great example of how Marionette can be used to augment existing code
without having to re-write everything around Marionette.</p>
<p><strong>The RequireJS version</strong>: Using Marionette with
RequireJS helps to create a modularized application architecture - a
tremendously important concept in scaling JavaScript applications.
RequireJS provides a powerful set of tools that can be leveraged to
great advantage, making Marionette even more flexible than it already
is.</p>
<p><strong>The Marionette module version</strong>: RequireJS isn’t the
only way to create a modularized application architecture, though. For
those that wish to build applications in modules and namespaces,
Marionette provides a built-in module and namespacing structure. This
example application takes the simple version of the application and
re-writes it into a namespaced application architecture, with an
application controller (mediator / workflow object) that brings all of
the pieces together.</p>
<p>Marionette certainly provides its share of opinions on how a Backbone
application should be architected. The combination of modules, view
types, event aggregator, application objects, and more, can be used to
create a very powerful and flexible architecture based on these
opinions.</p>
<p>But as you can see, Marionette isn’t a completely rigid, “my way or
the highway” framework. It provides many elements of an application
foundation that can be mixed and matched with other architectural
styles, such as AMD or namespacing, or provide simple augmentation to
existing projects by reducing boilerplate code for rendering views.</p>
<p>This flexibility creates a much greater opportunity for Marionette to
provide value to you and your projects, as it allows you to scale the
use of Marionette with your application’s needs.</p>
<h3 id="and-so-much-more">And So Much More</h3>
<p>This is just the tip of the proverbial iceberg for Marionette, even
for the <code>ItemView</code> and <code>Region</code> objects that we’ve
explored. There is far more functionality, more features, and more
flexibility and customizability that can be put to use in both of these
objects. Then we have the other dozen or so components that Marionette
provides, each with their own set of behaviors built in, customization
and extension points, and more.</p>
<p>To learn more about Marionette’s components, the features they
provide and how to use them, check out the Marionette documentation,
links to the wiki, to the source code, the project core contributors,
and much more at <a
href="http://marionettejs.com">http://marionettejs.com</a>.</p>
<p>
 
</p>
<p>
 
</p>
<h2 id="thorax">Thorax</h2>
<p><em>By Ryan Eastridge &amp; Addy Osmani</em></p>
<p>Part of Backbone’s appeal is that it provides structure but is
generally un-opinionated, in particular when it comes to views. Thorax
makes an opinionated decision to use Handlebars as its templating
solution. Some of the patterns found in Marionette are found in Thorax
as well. Marionette exposes most of these patterns as JavaScript APIs
while in Thorax they are often exposed as template helpers. This chapter
assumes the reader has knowledge of Handlebars.</p>
<p>Thorax was created by Ryan Eastridge and Kevin Decker to create
Walmart’s mobile web application. This chapter is limited to Thorax’s
templating features and patterns implemented in Thorax that you can
utilize in your application regardless of whether you choose to adopt
Thorax. To learn more about other features implemented in Thorax and to
download boilerplate projects visit the <a
href="http://thoraxjs.org">Thorax website</a>.</p>
<h3 id="hello-world">Hello World</h3>
<p>In Backbone, when creating a new view, options passed are merged into
any default options already present on a view and are exposed via
<code>this.options</code> for later reference.</p>
<p><code>Thorax.View</code> differs from <code>Backbone.View</code> in
that there is no <code>options</code> object. All arguments passed to
the constructor become properties of the view, which in turn become
available to the <code>template</code>:</p>
<div class="sourceCode" id="cb185"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> view <span class="op">=</span> <span class="kw">new</span> Thorax<span class="op">.</span><span class="fu">View</span>({</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">greeting</span><span class="op">:</span> <span class="st">&#39;Hello&#39;</span><span class="op">,</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">template</span><span class="op">:</span> Handlebars<span class="op">.</span><span class="fu">compile</span>(<span class="st">&#39;{{greeting}} World!&#39;</span>)</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>    view<span class="op">.</span><span class="fu">appendTo</span>(<span class="st">&#39;body&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>In most examples in this chapter a <code>template</code> property
will be specified. In larger projects including the boilerplate projects
provided on the Thorax website a <code>name</code> property would
instead be used and a <code>template</code> of the same file name in
your project would automatically be assigned to the view.</p>
<p>If a <code>model</code> is set on a view, its attributes also become
available to the template:</p>
<pre><code>var view = new Thorax.View({
    model: new Thorax.Model({key: &#39;value&#39;}),
    template: Handlebars.compile(&#39;{{key}}&#39;)
});</code></pre>
<h3 id="embedding-child-views">Embedding child views</h3>
<p>The view helper allows you to embed other views within a view. Child
views can be specified as properties of the view:</p>
<div class="sourceCode" id="cb187"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> parent <span class="op">=</span> <span class="kw">new</span> Thorax<span class="op">.</span><span class="fu">View</span>({</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">child</span><span class="op">:</span> <span class="kw">new</span> Thorax<span class="op">.</span><span class="fu">View</span>(<span class="op">...</span>)<span class="op">,</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">template</span><span class="op">:</span> Handlebars<span class="op">.</span><span class="fu">compile</span>(<span class="st">&#39;{{view child}}&#39;</span>)</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p>Or the name of a child view to initialize as well as any optional
properties you wish to pass. In this case the child view must have
previously been created with <code>extend</code> and given a
<code>name</code> property:</p>
<div class="sourceCode" id="cb188"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> ChildView <span class="op">=</span> Thorax<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;child&#39;</span><span class="op">,</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">template</span><span class="op">:</span> <span class="op">...</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> parent <span class="op">=</span> <span class="kw">new</span> Thorax<span class="op">.</span><span class="fu">View</span>({</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">template</span><span class="op">:</span> Handlebars<span class="op">.</span><span class="fu">compile</span>(<span class="st">&#39;{{view &quot;child&quot; key=&quot;value&quot;}}&#39;</span>)</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p>The view helper may also be used as a block helper, in which case the
block will be assigned as the <code>template</code> property of the
child view:</p>
<div class="sourceCode" id="cb189"><pre
class="sourceCode handlebars"><code class="sourceCode mustache"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{#view</span> child<span class="fu">}}</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>        child will have this block</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>        set as its template property</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{/view}}</span></span></code></pre></div>
<p>Handlebars is string based, while <code>Backbone.View</code>
instances have a DOM <code>el</code>. Since we are mixing metaphors, the
embedding of views works via a placeholder mechanism where the
<code>view</code> helper in this case adds the view passed to the helper
to a hash of <code>children</code>, then injects placeholder HTML into
the template such as:</p>
<div class="sourceCode" id="cb190"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-view-placeholder-cid</span><span class="op">=</span><span class="st">&quot;view2&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Then once the parent view is rendered, we walk the DOM in search of
all the placeholders we created, replacing them with the child views’
<code>el</code>s:</p>
<div class="sourceCode" id="cb191"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">find</span>(<span class="st">&#39;[data-view-placeholder-cid]&#39;</span>)<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(el) {</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> cid <span class="op">=</span> el<span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;data-view-placeholder-cid&#39;</span>)<span class="op">,</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>            view <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">children</span>[cid]<span class="op">;</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>        view<span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">replaceWith</span>(view<span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span></code></pre></div>
<h3 id="view-helpers">View helpers</h3>
<p>One of the most useful constructs in Thorax is
<code>Handlebars.registerViewHelper</code> (not to be confused with
<code>Handlebars.registerHelper</code>). This method will register a new
block helper that will create and embed a <code>HelperView</code>
instance with its <code>template</code> set to the captured block. A
<code>HelperView</code> instance is different from that of a regular
child view in that its context will be that of the parent’s in the
template. Like other child views it will have a <code>parent</code>
property set to that of the declaring view. Many of the built-in helpers
in Thorax including the <code>collection</code> helper are created in
this manner.</p>
<p>A simple example would be an <code>on</code> helper that re-rendered
the generated <code>HelperView</code> instance each time an event was
triggered on the declaring / parent view:</p>
<pre><code>Handlebars.registerViewHelper(&#39;on&#39;, function(eventName, helperView) {
    helperView.parent.on(eventName, function() {
        helperView.render();
    });
});</code></pre>
<p>An example use of this would be to have a counter that would
increment each time a button was clicked. This example makes use of the
<code>button</code> helper in Thorax which simply makes a button that
triggers a view event when clicked:</p>
<div class="sourceCode" id="cb193"><pre
class="sourceCode handlebars"><code class="sourceCode mustache"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{#on</span> <span class="st">&quot;incremented&quot;</span><span class="fu">}}</span><span class="va">{{</span>i<span class="va">}}</span><span class="fu">{{/on}}</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{#button</span><span class="ot"> trigger</span><span class="op">=</span><span class="st">&quot;incremented&quot;</span><span class="fu">}}</span>Add<span class="fu">{{/button}}</span></span></code></pre></div>
<p>And the corresponding view class:</p>
<div class="sourceCode" id="cb194"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Thorax<span class="op">.</span><span class="fu">View</span>({</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>            <span class="dt">incremented</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>                <span class="op">++</span><span class="kw">this</span><span class="op">.</span><span class="at">i</span><span class="op">;</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="at">i</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">template</span><span class="op">:</span> <span class="op">...</span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<h3 id="collection-helper">collection helper</h3>
<p>The <code>collection</code> helper creates and embeds a
<code>CollectionView</code> instance, creating a view for each item in a
collection, updating when items are added, removed, or changed in the
collection. The simplest usage of the helper would look like:</p>
<div class="sourceCode" id="cb195"><pre
class="sourceCode handlebars"><code class="sourceCode mustache"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{#collection</span> kittens<span class="fu">}}</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;li&gt;</span><span class="va">{{</span>name<span class="va">}}</span><span class="kw">&lt;/li&gt;</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{/collection}}</span></span></code></pre></div>
<p>And the corresponding view:</p>
<div class="sourceCode" id="cb196"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Thorax<span class="op">.</span><span class="fu">View</span>({</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">kittens</span><span class="op">:</span> <span class="kw">new</span> Thorax<span class="op">.</span><span class="fu">Collection</span>(<span class="op">...</span>)<span class="op">,</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="op">...</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p>The block in this case will be assigned as the <code>template</code>
for each item view created, and the context will be the
<code>attributes</code> of the given model. This helper accepts options
that can be arbitrary HTML attributes, a <code>tag</code> option to
specify the type of tag containing the collection, or any of the
following:</p>
<ul>
<li><code>item-template</code> - A template to display for each model.
If a block is specified it will become the item-template</li>
<li><code>item-view</code> - A view class to use when each item view is
created</li>
<li><code>empty-template</code> - A template to display when the
collection is empty. If an inverse / else block is specified it will
become the empty-template</li>
<li><code>empty-view</code> - A view to display when the collection is
empty</li>
</ul>
<p>Options and blocks can be used in combination, in this case creating
a <code>KittenView</code> class with a <code>template</code> set to the
captured block for each kitten in the collection:</p>
<div class="sourceCode" id="cb197"><pre
class="sourceCode handlebars"><code class="sourceCode mustache"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{#collection</span> kittens<span class="ot"> item-view</span><span class="op">=</span><span class="st">&quot;KittenView&quot;</span><span class="ot"> tag</span><span class="op">=</span><span class="st">&quot;ul&quot;</span><span class="fu">}}</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;li&gt;</span><span class="va">{{</span>name<span class="va">}}</span><span class="kw">&lt;/li&gt;</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{else}}</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;li&gt;</span>No kittens!<span class="kw">&lt;/li&gt;</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{/collection}}</span></span></code></pre></div>
<p>Note that multiple collections can be used per view, and collections
can be nested. This is useful when there are models that contain
collections that contain models that contain…</p>
<div class="sourceCode" id="cb198"><pre
class="sourceCode handlebars"><code class="sourceCode mustache"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{#collection</span> kittens<span class="fu">}}</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;h2&gt;</span><span class="va">{{</span>name<span class="va">}}</span><span class="kw">&lt;/h2&gt;</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;p&gt;</span>Kills:<span class="kw">&lt;/p&gt;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{{#collection</span> miceKilled<span class="ot"> tag</span><span class="op">=</span><span class="st">&quot;ul&quot;</span><span class="fu">}}</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;li&gt;</span><span class="va">{{</span>name<span class="va">}}</span><span class="kw">&lt;/li&gt;</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{{/collection}}</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{/collection}}</span></span></code></pre></div>
<h3 id="custom-html-data-attributes">Custom HTML data attributes</h3>
<p>Thorax makes heavy use of custom HTML data attributes to operate.
While some make sense only within the context of Thorax, several are
quite useful to have in any Backbone project for writing other functions
against, or for general debugging. In order to add some to your views in
non-Thorax projects, override the <code>setElement</code> method in your
base view class:</p>
<div class="sourceCode" id="cb199"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>  MyApplication<span class="op">.</span><span class="at">View</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">setElement</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> response <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">setElement</span><span class="op">.</span><span class="fu">apply</span>(<span class="kw">this</span><span class="op">,</span> <span class="kw">arguments</span>)<span class="op">;</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">name</span> <span class="op">&amp;&amp;</span> <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">&#39;data-view-name&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">&#39;data-view-cid&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">cid</span>)<span class="op">;</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">collection</span> <span class="op">&amp;&amp;</span> <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">&#39;data-collection-cid&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="at">cid</span>)<span class="op">;</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">model</span> <span class="op">&amp;&amp;</span> <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">&#39;data-model-cid&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">cid</span>)<span class="op">;</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response<span class="op">;</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<p>In addition to making your application more immediately
comprehensible in the inspector, it’s now possible to extend jQuery /
Zepto with functions to lookup the closest view, model or collection to
a given element. In order to make it work you have to save references to
each view created in your base view class by overriding the
<code>_configure</code> method:</p>
<div class="sourceCode" id="cb200"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>    MyApplication<span class="op">.</span><span class="at">View</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_configure</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>            Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">_configure</span><span class="op">.</span><span class="fu">apply</span>(<span class="kw">this</span><span class="op">,</span> <span class="kw">arguments</span>)<span class="op">;</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>            Thorax<span class="op">.</span><span class="at">_viewsIndexedByCid</span>[<span class="kw">this</span><span class="op">.</span><span class="at">cid</span>] <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dispose</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>            Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">dispose</span><span class="op">.</span><span class="fu">apply</span>(<span class="kw">this</span><span class="op">,</span> <span class="kw">arguments</span>)<span class="op">;</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">delete</span> Thorax<span class="op">.</span><span class="at">_viewsIndexedByCid</span>[<span class="kw">this</span><span class="op">.</span><span class="at">cid</span>]<span class="op">;</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p>Then we can extend jQuery / Zepto:</p>
<div class="sourceCode" id="cb201"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>    $<span class="op">.</span><span class="at">fn</span><span class="op">.</span><span class="at">view</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> el <span class="op">=</span> <span class="fu">$</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">closest</span>(<span class="st">&#39;[data-view-cid]&#39;</span>)<span class="op">;</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> el <span class="op">&amp;&amp;</span> Thorax<span class="op">.</span><span class="at">_viewsIndexedByCid</span>[el<span class="op">.</span><span class="fu">attr</span>(<span class="st">&#39;data-view-cid&#39;</span>)]<span class="op">;</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>    $<span class="op">.</span><span class="at">fn</span><span class="op">.</span><span class="at">model</span> <span class="op">=</span> <span class="kw">function</span>(view) {</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> $this <span class="op">=</span> <span class="fu">$</span>(<span class="kw">this</span>)<span class="op">,</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>            modelElement <span class="op">=</span> $this<span class="op">.</span><span class="fu">closest</span>(<span class="st">&#39;[data-model-cid]&#39;</span>)<span class="op">,</span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>            modelCid <span class="op">=</span> modelElement <span class="op">&amp;&amp;</span> modelElement<span class="op">.</span><span class="fu">attr</span>(<span class="st">&#39;[data-model-cid]&#39;</span>)<span class="op">;</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (modelCid) {</span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> view <span class="op">=</span> $this<span class="op">.</span><span class="fu">view</span>()<span class="op">;</span></span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> view <span class="op">&amp;&amp;</span> view<span class="op">.</span><span class="at">model</span><span class="op">;</span></span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span></code></pre></div>
<p>Now instead of storing references to models randomly throughout your
application to lookup when a given DOM event occurs you can use
<code>$(element).model()</code>. In Thorax, this can particularly useful
in conjunction with the <code>collection</code> helper which generates a
view class (with a <code>model</code> property) for each
<code>model</code> in the collection. An example template:</p>
<div class="sourceCode" id="cb202"><pre
class="sourceCode handlebars"><code class="sourceCode mustache"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{#collection</span> kittens<span class="ot"> tag</span><span class="op">=</span><span class="st">&quot;ul&quot;</span><span class="fu">}}</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;li&gt;</span><span class="va">{{</span>name<span class="va">}}</span><span class="kw">&lt;/li&gt;</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{{/collection}}</span></span></code></pre></div>
<p>And the corresponding view class:</p>
<div class="sourceCode" id="cb203"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>    Thorax<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;click li&#39;</span><span class="op">:</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>          <span class="kw">var</span> kitten <span class="op">=</span> <span class="fu">$</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">model</span>()<span class="op">;</span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Clicked on &#39;</span> <span class="op">+</span> kitten<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;name&#39;</span>))<span class="op">;</span></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">kittens</span><span class="op">:</span> <span class="kw">new</span> Thorax<span class="op">.</span><span class="fu">Collection</span>(<span class="op">...</span>)<span class="op">,</span></span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="op">...</span></span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span>  </span></code></pre></div>
<p>A common anti-pattern in Backbone applications is to assign a
<code>className</code> to a single view class. Consider using the
<code>data-view-name</code> attribute as a CSS selector instead, saving
CSS classes for things that will be used multiple times:</p>
<div class="sourceCode" id="cb204"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">[data-view-name</span><span class="op">=</span><span class="st">&quot;child&quot;</span><span class="ex">]</span> {</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<h3 id="thorax-resources">Thorax Resources</h3>
<p>No Backbone related tutorial would be complete without a todo
application. A <a href="http://todomvc.com/examples/thorax/">Thorax
implementation of TodoMVC</a> is available, in addition to this far
simpler example composed of this single Handlebars template:</p>
<div class="sourceCode" id="cb205"><pre
class="sourceCode handlebars"><code class="sourceCode mustache"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{{#collection</span> todos<span class="ot"> tag</span><span class="op">=</span><span class="st">&quot;ul&quot;</span><span class="fu">}}</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;li</span><span class="fu">{{#if</span> done<span class="fu">}}</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;done&quot;</span><span class="fu">{{/if}}</span><span class="kw">&gt;</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;checkbox&quot;</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;done&quot;</span><span class="fu">{{#if</span> done<span class="fu">}}</span><span class="ot"> checked</span><span class="op">=</span><span class="st">&quot;checked&quot;</span><span class="fu">{{/if}}</span><span class="kw">&gt;</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;span&gt;</span><span class="va">{{</span>item<span class="va">}}</span><span class="kw">&lt;/span&gt;</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/li&gt;</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{{/collection}}</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;form&gt;</span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="kw">&gt;</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;submit&quot;</span><span class="ot"> value</span><span class="op">=</span><span class="st">&quot;Add&quot;</span><span class="kw">&gt;</span></span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/form&gt;</span></span></code></pre></div>
<p>and the corresponding JavaScript:</p>
<div class="sourceCode" id="cb206"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> todosView <span class="op">=</span> Thorax<span class="op">.</span><span class="fu">View</span>({</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">todos</span><span class="op">:</span> <span class="kw">new</span> Thorax<span class="op">.</span><span class="fu">Collection</span>()<span class="op">,</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;change input[type=&quot;checkbox&quot;]&#39;</span><span class="op">:</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> target <span class="op">=</span> <span class="fu">$</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>              target<span class="op">.</span><span class="fu">model</span>()<span class="op">.</span><span class="fu">set</span>({<span class="dt">done</span><span class="op">:</span> <span class="op">!!</span>target<span class="op">.</span><span class="fu">attr</span>(<span class="st">&#39;checked&#39;</span>)})<span class="op">;</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;submit form&#39;</span><span class="op">:</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>              <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>              <span class="kw">var</span> input <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;input[type=&quot;text&quot;]&#39;</span>)<span class="op">;</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>              <span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">add</span>({<span class="dt">item</span><span class="op">:</span> input<span class="op">.</span><span class="fu">val</span>()})<span class="op">;</span></span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>              input<span class="op">.</span><span class="fu">val</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="st">&#39;...&#39;</span></span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a>  todosView<span class="op">.</span><span class="fu">appendTo</span>(<span class="st">&#39;body&#39;</span>)<span class="op">;</span></span></code></pre></div>
To see Thorax in action on a large scale website visit walmart.com on
any Android or iOS device. For a complete list of resources visit the <a
href="http://thoraxjs.org">Thorax website</a>.
<p>
 
</p>
<p>
 
</p>
<h1 id="common-problems-solutions">Common Problems &amp; Solutions</h1>
<p>In this section, we will review a number of common problems
developers often experience once they’ve started to work on relatively
non-trivial projects using Backbone.js, as well as present potential
solutions.</p>
<p>Perhaps the most frequent of these questions surround how to do more
with Views. If you are interested in discovering how to work with nested
Views, learn about view disposal and inheritance, this section will
hopefully have you covered.</p>
<h4 id="working-with-nested-views">Working With Nested Views</h4>
<p><strong>Problem</strong></p>
<p>What is the best approach for rendering and appending nested Views
(or Subviews) in Backbone.js?</p>
<p><strong>Solution 1</strong></p>
<p>Since pages are composed of nested elements and Backbone views
correspond to elements within the page, nesting views is an intuitive
approach to managing a hierarchy of elements.</p>
<p>The best way to combine views is simply using:</p>
<pre><code>this.$(&#39;.someContainer&#39;).append(innerView.el);</code></pre>
<p>which just relies on jQuery. We could use this in a real example as
follows:</p>
<div class="sourceCode" id="cb208"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>initialize <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//...</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>render <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">empty</span>()<span class="op">;</span></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerView1</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Subview</span>({options})<span class="op">;</span></span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerView2</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Subview</span>({options})<span class="op">;</span></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.inner-view-container&#39;</span>)</span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="kw">this</span><span class="op">.</span><span class="at">innerView1</span><span class="op">.</span><span class="at">el</span>)</span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="kw">this</span><span class="op">.</span><span class="at">innerView2</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Solution 2</strong></p>
<p>Beginners sometimes also try using <code>setElement</code> to solve
this problem, however keep in mind that using this method is an easy way
to shoot yourself in the foot. Avoid using this approach when the first
solution is a viable option:</p>
<div class="sourceCode" id="cb209"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Where we have previously defined a View, SubView</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="co">// in a parent View we could do:</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>initialize <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerView1</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Subview</span>({options})<span class="op">;</span></span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerView2</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Subview</span>({options})<span class="op">;</span></span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a>render <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">template</span>())<span class="op">;</span></span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-16"><a href="#cb209-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerView1</span><span class="op">.</span><span class="fu">setElement</span>(<span class="st">&#39;.some-element1&#39;</span>)<span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb209-17"><a href="#cb209-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerView2</span><span class="op">.</span><span class="fu">setElement</span>(<span class="st">&#39;.some-element2&#39;</span>)<span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb209-18"><a href="#cb209-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here we are creating subviews in the parent view’s
<code>initialize()</code> method and rendering the subviews in the
parent’s <code>render()</code> method. The elements managed by the
subviews exist in the parent’s template and the
<code>View.setElement()</code> method is used to re-assign the element
associated with each subview.</p>
<p><code>setElement()</code> changes a view’s element, including
re-delegating event handlers by removing them from the old element and
binding them to the new element. Note that <code>setElement()</code>
returns the view, allowing us to chain the call to
<code>render()</code>.</p>
<p>This works and has some positive qualities: you don’t need to worry
about maintaining the order of your DOM elements when appending, views
are initialized early, and the render() method doesn’t need to take on
too many responsibilities at once.</p>
<p>Unfortunately, downsides are that you can’t set the
<code>tagName</code> property of subviews and events need to be
re-delegated. The first solution doesn’t suffer from this problem.</p>
<p><strong>Solution 3</strong></p>
<p>One more possible solution to this problem could be written:</p>
<div class="sourceCode" id="cb210"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> OuterView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">inner</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">InnerView</span>()<span class="op">;</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Detach InnerView before reseting OuterView&#39;s $el</span></span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">inner</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">detach</span>()<span class="op">;</span> </span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// or this.$el.empty() if you have no template</span></span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// this.$el.html(template); </span></span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">append</span>(<span class="kw">this</span><span class="op">.</span><span class="at">inner</span><span class="op">.</span><span class="at">$el</span>)<span class="op">;</span></span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb210-17"><a href="#cb210-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-18"><a href="#cb210-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> InnerView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb210-19"><a href="#cb210-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb210-20"><a href="#cb210-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(template)<span class="op">;</span></span>
<span id="cb210-21"><a href="#cb210-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb210-22"><a href="#cb210-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This tackles a few specific design decisions:</p>
<ul>
<li>The order in which you append the sub-elements matters</li>
<li>The OuterView doesn’t contain the HTML elements to be set in the
InnerView(s), meaning that we can still specify tagName in the
InnerView</li>
<li>render() is called after the InnerView element has been placed into
the DOM. This is useful if your InnerView’s render() method is sizing
itself on the page based on the dimensions of another element. This is a
common use case.</li>
</ul>
<p>Note that InnerView needs to call <code>View.delegateEvents()</code>
to bind its event handlers to its new DOM since it is replacing the
content of its element.</p>
<p><strong>Solution 4</strong></p>
<p>A better solution, which is more clean but has the potential to
affect performance is:</p>
<div class="sourceCode" id="cb211"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> OuterView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(template)<span class="op">;</span> <span class="co">// or this.$el.empty() if you have no template</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">inner</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">InnerView</span>()<span class="op">;</span></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">append</span>(<span class="kw">this</span><span class="op">.</span><span class="at">inner</span><span class="op">.</span><span class="at">$el</span>)<span class="op">;</span></span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> InnerView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(template)<span class="op">;</span></span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Solution 5</strong></p>
<p>If multiple views need to be nested at particular locations in a
template, a hash of child views indexed by child view cids’ should be
created. In the template, use a custom HTML attribute named
<code>data-view-cid</code> to create placeholder elements for each view
to embed. Once the template has been rendered and its output appended to
the parent view’s <code>$el</code>, each placeholder can be queried for
and replaced with the child view’s <code>el</code>.</p>
<p>A sample implementation containing a single child view could be
written:</p>
<div class="sourceCode" id="cb212"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> OuterView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">children</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">child</span> <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">View</span>()<span class="op">;</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">children</span>[<span class="kw">this</span><span class="op">.</span><span class="at">child</span><span class="op">.</span><span class="at">cid</span>] <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">child</span><span class="op">;</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(<span class="st">&#39;&lt;div data-view-cid=&quot;&#39;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">child</span><span class="op">.</span><span class="at">cid</span> <span class="op">+</span> <span class="st">&#39;&quot;&gt;&lt;/div&gt;&#39;</span>)<span class="op">;</span></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>        _<span class="op">.</span><span class="fu">each</span>(<span class="kw">this</span><span class="op">.</span><span class="at">children</span><span class="op">,</span> <span class="kw">function</span>(view<span class="op">,</span> cid) {</span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;[data-view-cid=&quot;&#39;</span> <span class="op">+</span> cid <span class="op">+</span> <span class="st">&#39;&quot;]&#39;</span>)<span class="op">.</span><span class="fu">replaceWith</span>(view<span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>The use of <code>cid</code>s (client ids) here is useful because it
illustrates separating a model and its views by having views referenced
by their instances and not their attributes. It’s quite common to ask
for all views that satisfy an attribute on their models, but if you have
recursive subviews or repeated views (a common occurrence), you can’t
simply ask for views by attributes. That is, unless you specify
additional attributes that separate duplicates. Using <code>cid</code>s
solves this problem as it allows for direct references to views.</p>
<p>Generally speaking, more developers opt for Solution 1 or 5 as:</p>
<ul>
<li>The majority of their views may already rely on being in the DOM in
their render() method</li>
<li>When the OuterView is re-rendered, views don’t have to be
re-initialized where re-initialization has the potential to cause memory
leaks and issues with existing bindings</li>
</ul>
<p>The Backbone extensions <a
href="#marionettejs-backbone.marionette">Marionette</a> and <a
href="#thorax">Thorax</a> provide logic for nesting views, and rendering
collections where each item has an associated view. Marionette provides
APIs in JavaScript while Thorax provides APIs via Handlebars template
helpers. We will examine both of these in an upcoming chapter.</p>
<p>(Thanks to <a
href="http://stackoverflow.com/users/299189/lukas">Lukas</a> and <a
href="http://stackoverflow.com/users/154765/ian-storm-taylor">Ian
Taylor</a> for these tips).</p>
<h4 id="managing-models-in-nested-views">Managing Models In Nested
Views</h4>
<p><strong>Problem</strong></p>
<p>What is the best way to manage models in nested views?</p>
<p><strong>Solution</strong></p>
<p>In order to reach attributes on related models in a nested setup,
models require some prior knowledge of each other, something which
Backbone doesn’t implicitly handle out of the box.</p>
<p>One approach is to make sure each child model has a ‘parent’
attribute. This way you can traverse the nesting first up to the parent
and then down to any siblings that you know of. So, assuming we have
models modelA, modelB and modelC:</p>
<div class="sourceCode" id="cb213"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="co">// When initializing modelA, I would suggest setting a link to the parent</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="co">// model when doing this, like this:</span></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>ModelA <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">modelB</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">modelB</span>()<span class="op">;</span></span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">modelB</span><span class="op">.</span><span class="at">parent</span> <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">modelC</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">modelC</span>()<span class="op">;</span></span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">modelC</span><span class="op">.</span><span class="at">parent</span> <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This allows you to reach the parent model in any child model function
through <code>this.parent</code>.</p>
<p>Now, we have already discussed a few options for how to construct
nested Views using Backbone. For the sake of simplicity, let us imagine
that we are creating a new child view <code>ViewB</code> from within the
<code>initialize()</code> method of <code>ViewA</code> below.
<code>ViewB</code> can reach out over the <code>ViewA</code> model and
listen out for changes on any of its nested models.</p>
<p>See inline for comments on exactly what each step is enabling:</p>
<div class="sourceCode" id="cb214"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Define View A</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>ViewA <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>       <span class="co">// Create an instance of View B</span></span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>       <span class="kw">this</span><span class="op">.</span><span class="at">viewB</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">ViewB</span>()<span class="op">;</span></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>       <span class="co">// Create a reference back to this (parent) view</span></span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>       <span class="kw">this</span><span class="op">.</span><span class="at">viewB</span><span class="op">.</span><span class="at">parentView</span> <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a>       <span class="co">// Append ViewB to ViewA</span></span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">$</span>(<span class="kw">this</span><span class="op">.</span><span class="at">el</span>)<span class="op">.</span><span class="fu">append</span>(<span class="kw">this</span><span class="op">.</span><span class="at">viewB</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb214-15"><a href="#cb214-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb214-16"><a href="#cb214-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-17"><a href="#cb214-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Define View B</span></span>
<span id="cb214-18"><a href="#cb214-18" aria-hidden="true" tabindex="-1"></a>ViewB <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb214-19"><a href="#cb214-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-20"><a href="#cb214-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">//...,</span></span>
<span id="cb214-21"><a href="#cb214-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-22"><a href="#cb214-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb214-23"><a href="#cb214-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Listen for changes to the nested models in our parent ViewA</span></span>
<span id="cb214-24"><a href="#cb214-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">parent</span><span class="op">.</span><span class="at">modelB</span><span class="op">,</span> <span class="st">&quot;change&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb214-25"><a href="#cb214-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">parent</span><span class="op">.</span><span class="at">modelC</span><span class="op">,</span> <span class="st">&quot;change&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb214-26"><a href="#cb214-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-27"><a href="#cb214-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We can also call any method on our parent view if it is defined</span></span>
<span id="cb214-28"><a href="#cb214-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">// $(this.parentView.el).shake();</span></span>
<span id="cb214-29"><a href="#cb214-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb214-30"><a href="#cb214-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-31"><a href="#cb214-31" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb214-32"><a href="#cb214-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-33"><a href="#cb214-33" aria-hidden="true" tabindex="-1"></a><span class="co">// Create an instance of ViewA with ModelA</span></span>
<span id="cb214-34"><a href="#cb214-34" aria-hidden="true" tabindex="-1"></a><span class="co">// viewA will create its own instance of ViewB</span></span>
<span id="cb214-35"><a href="#cb214-35" aria-hidden="true" tabindex="-1"></a><span class="co">// from inside the initialize() method</span></span>
<span id="cb214-36"><a href="#cb214-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> viewA <span class="op">=</span> <span class="kw">new</span> <span class="fu">ViewA</span>({ <span class="dt">model</span><span class="op">:</span> ModelA })<span class="op">;</span></span></code></pre></div>
<h4 id="rendering-a-parent-view-from-a-child-view">Rendering A Parent
View From A Child View</h4>
<p><strong>Problem</strong></p>
<p>How would one render a Parent View from one of its Children?</p>
<p><strong>Solution</strong></p>
<p>In a scenario where you have a view containing another view, such as
a photo gallery containing a larger view modal, you may find that you
need to render or re-render the parent view from the child. The good
news is that solving this problem is quite straight-forward.</p>
<p>The simplest solution is to just use
<code>this.parentView.render();</code>.</p>
<p>If however inversion of control is desired, events may be used to
provide an equally valid solution.</p>
<p>Say we wish to begin rendering when a particular event has occurred.
For the sake of example, let us call this event ‘somethingHappened’. The
parent view can bind notifications on the child view to know when the
event has occurred. It can then render itself.</p>
<p>In the parent view:</p>
<div class="sourceCode" id="cb215"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Parent initialize</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">childView</span><span class="op">,</span> <span class="st">&#39;somethingHappened&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Parent removal</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="fu">stopListening</span>(<span class="kw">this</span><span class="op">.</span><span class="at">childView</span><span class="op">,</span> <span class="st">&#39;somethingHappened&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>In the child view:</p>
<div class="sourceCode" id="cb216"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="co">// After the event has occurred</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="fu">trigger</span>(<span class="st">&#39;somethingHappened&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>The child will trigger a “somethingHappened” event and the parent’s
render function will be called.</p>
<p>(Thanks to Tal <a
href="http://stackoverflow.com/users/269666/tal-bereznitskey">Bereznitskey</a>
for this tip)</p>
<h4 id="disposing-view-hierarchies">Disposing View Hierarchies</h4>
<p><strong>Problem</strong></p>
<p>Where your application is setup with multiple Parent and Child Views,
it is also common to desire removing any DOM elements associated with
such views as well as unbinding any event handlers tied to child
elements when you no longer require them.</p>
<p><strong>Solution</strong></p>
<p>The solution in the last question should be enough to handle this use
case, but if you require a more explicit example that handles children,
we can see one below:</p>
<div class="sourceCode" id="cb217"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">close</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">onClose</span>) {</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">onClose</span>()<span class="op">;</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>NewView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>       <span class="kw">this</span><span class="op">.</span><span class="at">childViews</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">renderChildren</span><span class="op">:</span> <span class="kw">function</span>(item) {</span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> itemView <span class="op">=</span> <span class="kw">new</span> <span class="fu">NewChildView</span>({ <span class="dt">model</span><span class="op">:</span> item })<span class="op">;</span></span>
<span id="cb217-14"><a href="#cb217-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">$</span>(<span class="kw">this</span><span class="op">.</span><span class="at">el</span>)<span class="op">.</span><span class="fu">prepend</span>(itemView<span class="op">.</span><span class="fu">render</span>())<span class="op">;</span></span>
<span id="cb217-15"><a href="#cb217-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">childViews</span><span class="op">.</span><span class="fu">push</span>(itemView)<span class="op">;</span></span>
<span id="cb217-16"><a href="#cb217-16" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb217-17"><a href="#cb217-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">onClose</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb217-18"><a href="#cb217-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">_</span>(<span class="kw">this</span><span class="op">.</span><span class="at">childViews</span>)<span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>(view) {</span>
<span id="cb217-19"><a href="#cb217-19" aria-hidden="true" tabindex="-1"></a>        view<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb217-20"><a href="#cb217-20" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb217-21"><a href="#cb217-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb217-22"><a href="#cb217-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb217-23"><a href="#cb217-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-24"><a href="#cb217-24" aria-hidden="true" tabindex="-1"></a>NewChildView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb217-25"><a href="#cb217-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tagName</span><span class="op">:</span> <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb217-26"><a href="#cb217-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb217-27"><a href="#cb217-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb217-28"><a href="#cb217-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Here, a close() method for views is implemented which disposes of a
view when it is no longer needed or needs to be reset.</p>
<p>In most cases, the view removal should not affect any associated
models. For example, if you are working on a blogging application and
you remove a view with comments, perhaps another view in your app shows
a selection of comments and resetting the collection would affect those
views as well.</p>
<p>(Thanks to <a
href="http://stackoverflow.com/users/906136/dira">dira</a> for this
tip)</p>
<p>Note: You may also be interested in reading about the Marionette
Composite Views in the Extensions part of the book.</p>
<h4 id="rendering-view-hierarchies">Rendering View Hierarchies</h4>
<p><strong>Problem</strong></p>
<p>Let us say you have a Collection, where each item in the Collection
could itself be a Collection. You can render each item in the
Collection, and indeed can render any items which themselves are
Collections. The problem you might have is how to render HTML that
reflects the hierarchical nature of the data structure.</p>
<p><strong>Solution</strong></p>
<p>The most straight-forward way to approach this problem is to use a
framework like Derick Bailey’s <a
href="https://github.com/marionettejs/backbone.marionette">Backbone.Marionette</a>.
In this framework is a type of view called a CompositeView.</p>
<p>The basic idea of a CompositeView is that it can render a model and a
collection within the same view.</p>
<p>It can render a single model with a template. It can also take a
collection from that model and for each model in that collection, render
a view. By default it uses the same composite view type that you’ve
defined to render each of the models in the collection. All you have to
do is tell the view instance where the collection is, via the initialize
method, and you’ll get a recursive hierarchy rendered.</p>
<p>There is a working demo of this in action available <a
href="http://jsfiddle.net/derickbailey/AdWjU/">online</a>.</p>
<p>And you can get the source code and documentation for <a
href="https://github.com/marionettejs/backbone.marionette">Marionette</a>
too.</p>
<h4 id="working-with-nested-models-or-collections">Working With Nested
Models Or Collections</h4>
<p><strong>Problem</strong></p>
<p>Backbone doesn’t include support for nested models or collections out
of the box, favoring the use of good patterns for modeling your
structured data on the client side. How do I work around this?</p>
<p><strong>Solution</strong></p>
<p>As we’ve seen, it’s common to create collections representing groups
of models using Backbone. It’s also however common to wish to nest
collections within models, depending on the type of application you are
working on.</p>
<p>Take for example a Building model that contains many Room models
which could sit in a Rooms collection.</p>
<p>You could expose a <code>this.rooms</code> collection for each
building, allowing you to lazy-load rooms once a building has been
opened.</p>
<div class="sourceCode" id="cb218"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Building <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">rooms</span> <span class="op">=</span> <span class="kw">new</span> Rooms<span class="op">;</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">rooms</span><span class="op">.</span><span class="at">url</span> <span class="op">=</span> <span class="st">&#39;/building/&#39;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;/rooms&#39;</span><span class="op">;</span></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">rooms</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;reset&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">updateCounts</span>)<span class="op">;</span></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a new building model</span></span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> townHall <span class="op">=</span> <span class="kw">new</span> Building<span class="op">;</span></span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a><span class="co">// once opened, lazy-load the rooms</span></span>
<span id="cb218-17"><a href="#cb218-17" aria-hidden="true" tabindex="-1"></a>townHall<span class="op">.</span><span class="at">rooms</span><span class="op">.</span><span class="fu">fetch</span>({<span class="dt">reset</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span></code></pre></div>
<p>There are also a number of Backbone plugins which can help with
nested data structures, such as <a
href="https://github.com/PaulUithol/Backbone-relational">Backbone
Relational</a>. This plugin handles one-to-one, one-to-many and
many-to-one relations between models for Backbone and has some excellent
<a href="http://backbonerelational.org/">documentation</a>.</p>
<h4 id="better-model-property-validation">Better Model Property
Validation</h4>
<p><strong>Problem</strong></p>
<p>As we learned earlier in the book, the <code>validate</code> method
on a Model is called by <code>set</code> (when the validate option is
set) and <code>save</code>. It is passed the model attributes updated
with the values passed to these methods.</p>
<p>By default, when we define a custom <code>validate</code> method,
Backbone passes all of a model’s attributes through this validation each
time, regardless of which model attributes are being set.</p>
<p>This means that it can be a challenge to determine which specific
fields are being set or validated without being concerned about the
others that aren’t being set at the same time.</p>
<p><strong>Solution</strong></p>
<p>To illustrate this problem better, let us look at a typical
registration form use case that:</p>
<ul>
<li>Validates form fields using the blur event</li>
<li>Validates each field regardless of whether other model attributes
(i.e., other form data) are valid or not.</li>
</ul>
<p>Here is one example of a desired use case:</p>
<p>We have a form where a user focuses and blurs first name, last name,
and email HTML input boxes without entering any data. A “this field is
required” message should be presented next to each form field.</p>
<p>HTML:</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=utf-8&gt;
  &lt;title&gt;Form Validation - Model#validate&lt;/title&gt;
  &lt;script src=&#39;http://code.jquery.com/jquery.js&#39;&gt;&lt;/script&gt;
  &lt;script src=&#39;http://underscorejs.org/underscore.js&#39;&gt;&lt;/script&gt;
  &lt;script src=&#39;http://backbonejs.org/backbone.js&#39;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;form&gt;
    &lt;label&gt;First Name&lt;/label&gt;
    &lt;input name=&#39;firstname&#39;&gt;
    &lt;span data-msg=&#39;firstname&#39;&gt;&lt;/span&gt;
    &lt;br&gt;
    &lt;label&gt;Last Name&lt;/label&gt;
    &lt;input name=&#39;lastname&#39;&gt;
    &lt;span data-msg=&#39;lastname&#39;&gt;&lt;/span&gt;
    &lt;br&gt;
    &lt;label&gt;Email&lt;/label&gt;
    &lt;input name=&#39;email&#39;&gt;
    &lt;span data-msg=&#39;email&#39;&gt;&lt;/span&gt;
  &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Basic validation that could be written using the current Backbone
<code>validate</code> method to work with this form could be implemented
using something like:</p>
<div class="sourceCode" id="cb220"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>validate<span class="op">:</span> <span class="kw">function</span>(attrs) {</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="op">!</span>attrs<span class="op">.</span><span class="at">firstname</span>) <span class="cf">return</span> <span class="st">&#39;first name is empty&#39;</span><span class="op">;</span></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="op">!</span>attrs<span class="op">.</span><span class="at">lastname</span>) <span class="cf">return</span> <span class="st">&#39;last name is empty&#39;</span><span class="op">;</span></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="op">!</span>attrs<span class="op">.</span><span class="at">email</span>) <span class="cf">return</span> <span class="st">&#39;email is empty&#39;</span><span class="op">;</span></span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Unfortunately, this method would trigger a <code>firstname</code>
error each time any of the fields were blurred and only an error message
next to the first name field would be presented.</p>
<p>One potential solution to the problem is to validate all fields and
return all of the errors:</p>
<div class="sourceCode" id="cb221"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>validate<span class="op">:</span> <span class="kw">function</span>(attrs) {</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> errors <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">firstname</span>) errors<span class="op">.</span><span class="at">firstname</span> <span class="op">=</span> <span class="st">&#39;first name is empty&#39;</span><span class="op">;</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">lastname</span>) errors<span class="op">.</span><span class="at">lastname</span> <span class="op">=</span> <span class="st">&#39;last name is empty&#39;</span><span class="op">;</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">email</span>) errors<span class="op">.</span><span class="at">email</span> <span class="op">=</span> <span class="st">&#39;email is empty&#39;</span><span class="op">;</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>_<span class="op">.</span><span class="fu">isEmpty</span>(errors)) <span class="cf">return</span> errors<span class="op">;</span></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This can be adapted into a solution that defines a Field model for
each input in our form and works within the parameters of our use case
as follows:</p>
<div class="sourceCode" id="cb222"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="kw">function</span>($) {</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> User <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">validate</span><span class="op">:</span> <span class="kw">function</span>(attrs) {</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> errors <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">errors</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">firstname</span>) errors<span class="op">.</span><span class="at">firstname</span> <span class="op">=</span> <span class="st">&#39;firstname is required&#39;</span><span class="op">;</span></span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">lastname</span>) errors<span class="op">.</span><span class="at">lastname</span> <span class="op">=</span> <span class="st">&#39;lastname is required&#39;</span><span class="op">;</span></span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">email</span>) errors<span class="op">.</span><span class="at">email</span> <span class="op">=</span> <span class="st">&#39;email is required&#39;</span><span class="op">;</span></span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>_<span class="op">.</span><span class="fu">isEmpty</span>(errors)) <span class="cf">return</span> errors<span class="op">;</span></span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb222-14"><a href="#cb222-14" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb222-15"><a href="#cb222-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-16"><a href="#cb222-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Field <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb222-17"><a href="#cb222-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {<span class="dt">blur</span><span class="op">:</span> <span class="st">&#39;validate&#39;</span>}<span class="op">,</span></span>
<span id="cb222-18"><a href="#cb222-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb222-19"><a href="#cb222-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">name</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">&#39;name&#39;</span>)<span class="op">;</span></span>
<span id="cb222-20"><a href="#cb222-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$msg</span> <span class="op">=</span> <span class="fu">$</span>(<span class="st">&#39;[data-msg=&#39;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">name</span> <span class="op">+</span> <span class="st">&#39;]&#39;</span>)<span class="op">;</span></span>
<span id="cb222-21"><a href="#cb222-21" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb222-22"><a href="#cb222-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">validate</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb222-23"><a href="#cb222-23" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">set</span>(<span class="kw">this</span><span class="op">.</span><span class="at">name</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">val</span>()<span class="op">,</span> {<span class="dt">validate</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb222-24"><a href="#cb222-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$msg</span><span class="op">.</span><span class="fu">text</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">errors</span>[<span class="kw">this</span><span class="op">.</span><span class="at">name</span>] <span class="op">||</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb222-25"><a href="#cb222-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb222-26"><a href="#cb222-26" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb222-27"><a href="#cb222-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-28"><a href="#cb222-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> user <span class="op">=</span> <span class="kw">new</span> User<span class="op">;</span></span>
<span id="cb222-29"><a href="#cb222-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-30"><a href="#cb222-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="st">&#39;input&#39;</span>)<span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>() {</span>
<span id="cb222-31"><a href="#cb222-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">Field</span>({<span class="dt">el</span><span class="op">:</span> <span class="kw">this</span><span class="op">,</span> <span class="dt">model</span><span class="op">:</span> user})<span class="op">;</span></span>
<span id="cb222-32"><a href="#cb222-32" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb222-33"><a href="#cb222-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-34"><a href="#cb222-34" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This works fine as the solution checks the validation for each
attribute individually and sets the message for the correct blurred
field. A <a href="http://jsbin.com/afetez/2/edit">demo</a> of the above
by <a href="http://github.com/braddunbar"><span class="citation"
data-cites="braddunbar">@braddunbar</span></a> is also available.</p>
<p>Unfortunately, this solution does perform validation on all fields
every time, even though we are only displaying errors for the field that
has changed. If we have multiple client-side validation methods, we may
not want to have to call each validation method on every attribute every
time, so this solution might not be ideal for everyone.</p>
<h5 id="backbone.validateall">Backbone.validateAll</h5>
<p>A potentially better alternative to the above is to use <a
href="http://github.com/@franko"><span class="citation"
data-cites="gfranko">@gfranko</span></a>’s <a
href="https://github.com/gfranko/Backbone.validateAll">Backbone.validateAll</a>
plugin, specifically created to validate specific Model properties (or
form fields) without worrying about the validation of any other Model
properties (or form fields).</p>
<p>Here is how we would setup a partial User Model and validate method
using this plugin for our use case:</p>
<div class="sourceCode" id="cb223"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a new User Model</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> User <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// RegEx Patterns</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">patterns</span><span class="op">:</span> {</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">specialCharacters</span><span class="op">:</span> <span class="st">&#39;[^a-zA-Z 0-9]+&#39;</span><span class="op">,</span></span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>          <span class="dt">digits</span><span class="op">:</span> <span class="st">&#39;[0-9]&#39;</span><span class="op">,</span></span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a>          <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;^[a-zA-Z0-9._-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[.]{1}[a-zA-Z]{2,6}$&#39;</span></span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-15"><a href="#cb223-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validators</span></span>
<span id="cb223-16"><a href="#cb223-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">validators</span><span class="op">:</span> {</span>
<span id="cb223-17"><a href="#cb223-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-18"><a href="#cb223-18" aria-hidden="true" tabindex="-1"></a>          <span class="dt">minLength</span><span class="op">:</span> <span class="kw">function</span>(value<span class="op">,</span> minLength) {</span>
<span id="cb223-19"><a href="#cb223-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> value<span class="op">.</span><span class="at">length</span> <span class="op">&gt;=</span> minLength<span class="op">;</span></span>
<span id="cb223-20"><a href="#cb223-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-21"><a href="#cb223-21" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb223-22"><a href="#cb223-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-23"><a href="#cb223-23" aria-hidden="true" tabindex="-1"></a>          <span class="dt">maxLength</span><span class="op">:</span> <span class="kw">function</span>(value<span class="op">,</span> maxLength) {</span>
<span id="cb223-24"><a href="#cb223-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> value<span class="op">.</span><span class="at">length</span> <span class="op">&lt;=</span> maxLength<span class="op">;</span></span>
<span id="cb223-25"><a href="#cb223-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-26"><a href="#cb223-26" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb223-27"><a href="#cb223-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-28"><a href="#cb223-28" aria-hidden="true" tabindex="-1"></a>          <span class="dt">isEmail</span><span class="op">:</span> <span class="kw">function</span>(value) {</span>
<span id="cb223-29"><a href="#cb223-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> User<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">validators</span><span class="op">.</span><span class="fu">pattern</span>(value<span class="op">,</span> User<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">patterns</span><span class="op">.</span><span class="at">email</span>)<span class="op">;</span></span>
<span id="cb223-30"><a href="#cb223-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-31"><a href="#cb223-31" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb223-32"><a href="#cb223-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-33"><a href="#cb223-33" aria-hidden="true" tabindex="-1"></a>          <span class="dt">hasSpecialCharacter</span><span class="op">:</span> <span class="kw">function</span>(value) {</span>
<span id="cb223-34"><a href="#cb223-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> User<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">validators</span><span class="op">.</span><span class="fu">pattern</span>(value<span class="op">,</span> User<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">patterns</span><span class="op">.</span><span class="at">specialCharacters</span>)<span class="op">;</span></span>
<span id="cb223-35"><a href="#cb223-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-36"><a href="#cb223-36" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb223-37"><a href="#cb223-37" aria-hidden="true" tabindex="-1"></a>         <span class="op">...</span></span>
<span id="cb223-38"><a href="#cb223-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-39"><a href="#cb223-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We can determine which properties are getting validated by</span></span>
<span id="cb223-40"><a href="#cb223-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// checking to see if properties are equal to null</span></span>
<span id="cb223-41"><a href="#cb223-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-42"><a href="#cb223-42" aria-hidden="true" tabindex="-1"></a>        <span class="dt">validate</span><span class="op">:</span> <span class="kw">function</span>(attrs) {</span>
<span id="cb223-43"><a href="#cb223-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-44"><a href="#cb223-44" aria-hidden="true" tabindex="-1"></a>          <span class="kw">var</span> errors <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">errors</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb223-45"><a href="#cb223-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-46"><a href="#cb223-46" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(attrs<span class="op">.</span><span class="at">firstname</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb223-47"><a href="#cb223-47" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">firstname</span>) {</span>
<span id="cb223-48"><a href="#cb223-48" aria-hidden="true" tabindex="-1"></a>                  errors<span class="op">.</span><span class="at">firstname</span> <span class="op">=</span> <span class="st">&#39;firstname is required&#39;</span><span class="op">;</span></span>
<span id="cb223-49"><a href="#cb223-49" aria-hidden="true" tabindex="-1"></a>                  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;first name isEmpty validation called&#39;</span>)<span class="op">;</span></span>
<span id="cb223-50"><a href="#cb223-50" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb223-51"><a href="#cb223-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-52"><a href="#cb223-52" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> <span class="cf">if</span>(<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">validators</span><span class="op">.</span><span class="fu">minLength</span>(attrs<span class="op">.</span><span class="at">firstname</span><span class="op">,</span> <span class="dv">2</span>))</span>
<span id="cb223-53"><a href="#cb223-53" aria-hidden="true" tabindex="-1"></a>                errors<span class="op">.</span><span class="at">firstname</span> <span class="op">=</span> <span class="st">&#39;firstname is too short&#39;</span><span class="op">;</span></span>
<span id="cb223-54"><a href="#cb223-54" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> <span class="cf">if</span>(<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">validators</span><span class="op">.</span><span class="fu">maxLength</span>(attrs<span class="op">.</span><span class="at">firstname</span><span class="op">,</span> <span class="dv">15</span>))</span>
<span id="cb223-55"><a href="#cb223-55" aria-hidden="true" tabindex="-1"></a>                errors<span class="op">.</span><span class="at">firstname</span> <span class="op">=</span> <span class="st">&#39;firstname is too large&#39;</span><span class="op">;</span></span>
<span id="cb223-56"><a href="#cb223-56" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> <span class="cf">if</span>(<span class="kw">this</span><span class="op">.</span><span class="at">validators</span><span class="op">.</span><span class="fu">hasSpecialCharacter</span>(attrs<span class="op">.</span><span class="at">firstname</span>)) errors<span class="op">.</span><span class="at">firstname</span> <span class="op">=</span> <span class="st">&#39;firstname cannot contain special characters&#39;</span><span class="op">;</span></span>
<span id="cb223-57"><a href="#cb223-57" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb223-58"><a href="#cb223-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-59"><a href="#cb223-59" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(attrs<span class="op">.</span><span class="at">lastname</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb223-60"><a href="#cb223-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-61"><a href="#cb223-61" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (<span class="op">!</span>attrs<span class="op">.</span><span class="at">lastname</span>) {</span>
<span id="cb223-62"><a href="#cb223-62" aria-hidden="true" tabindex="-1"></a>                  errors<span class="op">.</span><span class="at">lastname</span> <span class="op">=</span> <span class="st">&#39;lastname is required&#39;</span><span class="op">;</span></span>
<span id="cb223-63"><a href="#cb223-63" aria-hidden="true" tabindex="-1"></a>                  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;last name isEmpty validation called&#39;</span>)<span class="op">;</span></span>
<span id="cb223-64"><a href="#cb223-64" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb223-65"><a href="#cb223-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-66"><a href="#cb223-66" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> <span class="cf">if</span>(<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">validators</span><span class="op">.</span><span class="fu">minLength</span>(attrs<span class="op">.</span><span class="at">lastname</span><span class="op">,</span> <span class="dv">2</span>))</span>
<span id="cb223-67"><a href="#cb223-67" aria-hidden="true" tabindex="-1"></a>                errors<span class="op">.</span><span class="at">lastname</span> <span class="op">=</span> <span class="st">&#39;lastname is too short&#39;</span><span class="op">;</span></span>
<span id="cb223-68"><a href="#cb223-68" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> <span class="cf">if</span>(<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">validators</span><span class="op">.</span><span class="fu">maxLength</span>(attrs<span class="op">.</span><span class="at">lastname</span><span class="op">,</span> <span class="dv">15</span>))</span>
<span id="cb223-69"><a href="#cb223-69" aria-hidden="true" tabindex="-1"></a>                errors<span class="op">.</span><span class="at">lastname</span> <span class="op">=</span> <span class="st">&#39;lastname is too large&#39;</span><span class="op">;</span></span>
<span id="cb223-70"><a href="#cb223-70" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> <span class="cf">if</span>(<span class="kw">this</span><span class="op">.</span><span class="at">validators</span><span class="op">.</span><span class="fu">hasSpecialCharacter</span>(attrs<span class="op">.</span><span class="at">lastname</span>)) errors<span class="op">.</span><span class="at">lastname</span> <span class="op">=</span> <span class="st">&#39;lastname cannot contain special characters&#39;</span><span class="op">;</span></span>
<span id="cb223-71"><a href="#cb223-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-72"><a href="#cb223-72" aria-hidden="true" tabindex="-1"></a>          }</span></code></pre></div>
<p>This allows the logic inside of our validate methods to determine
which form fields are currently being set/validated, and ignore the
model properties that are not being set.</p>
<p>It’s fairly straight-forward to use as well. We can simply define a
new Model instance and then set the data on our model using the
<code>validateAll</code> option to use the behavior defined by the
plugin:</p>
<div class="sourceCode" id="cb224"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> user <span class="op">=</span> <span class="kw">new</span> <span class="fu">User</span>()<span class="op">;</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>user<span class="op">.</span><span class="fu">set</span>({ <span class="st">&#39;firstname&#39;</span><span class="op">:</span> <span class="st">&#39;Greg&#39;</span> }<span class="op">,</span> {<span class="dt">validate</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">validateAll</span><span class="op">:</span> <span class="kw">false</span>})<span class="op">;</span></span></code></pre></div>
<p>That’s it. The Backbone.validateAll logic doesn’t override the
default Backbone logic by default and so it’s perfectly capable of being
used for scenarios where you might care more about field-validation <a
href="http://jsperf.com/backbone-validateall">performance</a> as well as
those where you don’t. Both solutions presented in this section should
work fine however.</p>
<h5 id="backbone.validation">Backbone.Validation</h5>
<p>As we’ve seen, the <code>validate</code> method Backbone offers is
<code>undefined</code> by default and you need to override it with your
own custom validation logic to get model validation in place. Often
developers run into the issue of implementing this validation as nested
ifs and elses, which can become unmaintainable when things get
complicated.</p>
<p>Another helpful plugin for Backbone called <a
href="https://github.com/thedersen/backbone.validation">Backbone.Validation</a>
attempts to solve this problem by offering an extensible way to declare
validation rules on the model and overrides the <code>validate</code>
method behind the scenes.</p>
<p>One of the useful methods this plugin includes is (pseudo) live
validation via a <code>preValidate</code> method. This can be used to
check on key-press if the input for a model is valid without changing
the model itself. You can run any validators for a model attribute by
calling the <code>preValidate</code> method, passing it the name of the
attribute along with the value you would like validated.</p>
<div class="sourceCode" id="cb225"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co">// If the value of the attribute is invalid, a truthy error message is returned</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="co">// if not, it returns a falsy value</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> errorMsg <span class="op">=</span> user<span class="op">.</span><span class="fu">preValidate</span>(<span class="st">&#39;firstname&#39;</span><span class="op">,</span> <span class="st">&#39;Greg&#39;</span>)<span class="op">;</span></span></code></pre></div>
<h5 id="form-specific-validation-classes">Form-specific validation
classes</h5>
<p>That said, the most optimal solution to this problem may not be to
stick validation in your model attributes. Instead, you could have a
function specifically designed for validating a specific form and there
are many good JavaScript form validation libraries out there that can
help with this.</p>
<p>If you want to stick it on your model, you can also make it a class
function:</p>
<div class="sourceCode" id="cb226"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>User<span class="op">.</span><span class="at">validate</span> <span class="op">=</span> <span class="kw">function</span>(formElement) {</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">//...</span></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>For more information on validation plugins available for Backbone,
see the <a
href="https://github.com/documentcloud/backbone/wiki/Extensions%2C-Plugins%2C-Resources#model">Backbone
wiki</a>.</p>
<h4 id="avoiding-conflicts-with-multiple-backbone-versions">Avoiding
Conflicts With Multiple Backbone Versions</h4>
<p><strong>Problem</strong></p>
<p>In instances out of your control, you may have to work around having
more than one version of Backbone in the same page. How do you work
around this without causing conflicts?</p>
<p><strong>Solution</strong></p>
<p>Like most client-side projects, Backbone’s code is wrapped in an
immediately-invoked function expression:</p>
<div class="sourceCode" id="cb227"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">function</span>(){</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Backbone.js</span></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">call</span>(<span class="kw">this</span>)<span class="op">;</span></span></code></pre></div>
<p>Several things happen during this configuration stage. A Backbone
<code>namespace</code> is created, and multiple versions of Backbone on
the same page are supported through the noConflict mode:</p>
<div class="sourceCode" id="cb228"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> <span class="bu">root</span> <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> previousBackbone <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="at">Backbone</span><span class="op">;</span></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>Backbone<span class="op">.</span><span class="at">noConflict</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span><span class="op">.</span><span class="at">Backbone</span> <span class="op">=</span> previousBackbone<span class="op">;</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Multiple versions of Backbone can be used on the same page by calling
<code>noConflict</code> like this:</p>
<div class="sourceCode" id="cb229"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Backbone19 <span class="op">=</span> Backbone<span class="op">.</span><span class="fu">noConflict</span>()<span class="op">;</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Backbone19 refers to the most recently loaded version,</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="co">// and `window.Backbone` will be restored to the previously</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="co">// loaded version</span></span></code></pre></div>
<h4 id="building-model-and-view-hierarchies">Building Model And View
Hierarchies</h4>
<p><strong>Problem</strong></p>
<p>How does inheritance work with Backbone? How can I share code between
similar models and views? How can I call methods that have been
overridden?</p>
<p><strong>Solution</strong></p>
<p>For its inheritance, Backbone internally uses an
<code>inherits</code> function inspired by <code>goog.inherits</code>,
Google’s implementation from the Closure Library. It’s basically a
function to correctly setup the prototype chain.</p>
<div class="sourceCode" id="cb230"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">var</span> inherits <span class="op">=</span> <span class="kw">function</span>(parent<span class="op">,</span> protoProps<span class="op">,</span> staticProps) {</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span></code></pre></div>
<p>The only major difference here is that Backbone’s API accepts two
objects containing <code>instance</code> and <code>static</code>
methods.</p>
<p>Following on from this, for inheritance purposes all of Backbone’s
objects contain an <code>extend</code> method as follows:</p>
<div class="sourceCode" id="cb231"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>Model<span class="op">.</span><span class="at">extend</span> <span class="op">=</span> Collection<span class="op">.</span><span class="at">extend</span> <span class="op">=</span> Router<span class="op">.</span><span class="at">extend</span> <span class="op">=</span> View<span class="op">.</span><span class="at">extend</span> <span class="op">=</span> extend<span class="op">;</span></span></code></pre></div>
<p>Most development with Backbone is based around inheriting from these
objects, and they’re designed to mimic a classical object-oriented
implementation.</p>
<p>The above isn’t quite the same as ECMAScript 5’s
<code>Object.create</code>, as it’s actually copying properties (methods
and values) from one object to another. As this isn’t enough to support
Backbone’s inheritance and class model, the following steps are
performed:</p>
<ul>
<li>The instance methods are checked to see if there’s a constructor
property. If so, the class’s constructor is used, otherwise the parent’s
constructor is used (i.e., Backbone.Model)</li>
<li>Underscore’s extend method is called to add the parent class’s
methods to the new child class</li>
<li>The <code>prototype</code> property of a blank constructor function
is assigned with the parent’s prototype, and a new instance of this is
set to the child’s <code>prototype</code> property</li>
<li>Underscore’s extend method is called twice to add the static and
instance methods to the child class</li>
<li>The child’s prototype’s constructor and a <code>__super__</code>
property are assigned</li>
<li>This pattern is also used for classes in CoffeeScript, so Backbone
classes are compatible with CoffeeScript classes.</li>
</ul>
<p><code>extend</code> can be used for a great deal more and developers
who are fans of mixins will like that it can be used for this too. You
can define functionality on any custom object, and then quite literally
copy &amp; paste all of the methods and attributes from that object to a
Backbone one:</p>
<p>For example:</p>
<div class="sourceCode" id="cb232"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyMixin <span class="op">=</span> {</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">foo</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span><span class="op">,</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sayFoo</span><span class="op">:</span> <span class="kw">function</span>(){<span class="fu">alert</span>(<span class="kw">this</span><span class="op">.</span><span class="at">foo</span>)<span class="op">;</span>}</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a> <span class="co">// ...</span></span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(MyView<span class="op">.</span><span class="at">prototype</span><span class="op">,</span> MyMixin)<span class="op">;</span></span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myView <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyView</span>()<span class="op">;</span></span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a>myView<span class="op">.</span><span class="fu">sayFoo</span>()<span class="op">;</span> <span class="co">//=&gt; &#39;bar&#39;</span></span></code></pre></div>
<p>We can take this further and also apply it to View inheritance. The
following is an example of how to extend one View using another:</p>
<div class="sourceCode" id="cb233"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Panel <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> PanelAdvanced <span class="op">=</span> Panel<span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Calling Overridden Methods</strong></p>
<p>However, if you have an <code>initialize()</code> method in Panel,
then it won’t be called if you also have an <code>initialize()</code>
method in PanelAdvanced, so you would have to call Panel’s initialize
method explicitly:</p>
<div class="sourceCode" id="cb234"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Panel <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(options){</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Panel initialized&#39;</span>)<span class="op">;</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">foo</span> <span class="op">=</span> <span class="st">&#39;bar&#39;</span><span class="op">;</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> PanelAdvanced <span class="op">=</span> Panel<span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(options){</span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a>    Panel<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">initialize</span><span class="op">.</span><span class="fu">call</span>(<span class="kw">this</span><span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;PanelAdvanced initialized&#39;</span>)<span class="op">;</span></span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">this</span><span class="op">.</span><span class="at">foo</span>)<span class="op">;</span> <span class="co">// Log: bar</span></span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a><span class="co">// We can also inherit PanelAdvanced if needed</span></span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> PanelAdvancedExtra <span class="op">=</span> PanelAdvanced<span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(options){</span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a>    PanelAdvanced<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">initialize</span><span class="op">.</span><span class="fu">call</span>(<span class="kw">this</span><span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;PanelAdvancedExtra initialized&#39;</span>)<span class="op">;</span></span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-22"><a href="#cb234-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb234-23"><a href="#cb234-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-24"><a href="#cb234-24" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">Panel</span>()<span class="op">;</span></span>
<span id="cb234-25"><a href="#cb234-25" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">PanelAdvanced</span>()<span class="op">;</span></span>
<span id="cb234-26"><a href="#cb234-26" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">PanelAdvancedExtra</span>()<span class="op">;</span></span></code></pre></div>
<p>This isn’t the most elegant of solutions because if you have a lot of
Views that inherit from Panel, then you’ll have to remember to call
Panel’s initialize from all of them.</p>
<p>It’s worth noting that if Panel doesn’t have an initialize method now
but you choose to add it in the future, then you’ll need to go to all of
the inherited classes in the future and make sure they call Panel’s
initialize.</p>
<p>So here’s an alternative way to define Panel so that your inherited
views don’t need to call Panel’s initialize method:</p>
<div class="sourceCode" id="cb235"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Panel <span class="op">=</span> <span class="kw">function</span> (options) {</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// put all of Panel&#39;s initialization code here</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Panel initialized&#39;</span>)<span class="op">;</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">foo</span> <span class="op">=</span> <span class="st">&#39;bar&#39;</span><span class="op">;</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>  Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">apply</span>(<span class="kw">this</span><span class="op">,</span> [options])<span class="op">;</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(Panel<span class="op">.</span><span class="at">prototype</span><span class="op">,</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="at">prototype</span><span class="op">,</span> {</span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// put all of Panel&#39;s methods here. For example:</span></span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sayHi</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;hello from Panel&#39;</span>)<span class="op">;</span></span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>Panel<span class="op">.</span><span class="at">extend</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="at">extend</span><span class="op">;</span></span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a><span class="co">// other classes then inherit from Panel like this:</span></span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> PanelAdvanced <span class="op">=</span> Panel<span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span> (options) {</span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;PanelAdvanced initialized&#39;</span>)<span class="op">;</span></span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">this</span><span class="op">.</span><span class="at">foo</span>)<span class="op">;</span></span>
<span id="cb235-23"><a href="#cb235-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb235-24"><a href="#cb235-24" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb235-25"><a href="#cb235-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-26"><a href="#cb235-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> panelAdvanced <span class="op">=</span> <span class="kw">new</span> <span class="fu">PanelAdvanced</span>()<span class="op">;</span> <span class="co">//Logs: Panel initialized, PanelAdvanced initialized, bar</span></span>
<span id="cb235-27"><a href="#cb235-27" aria-hidden="true" tabindex="-1"></a>panelAdvanced<span class="op">.</span><span class="fu">sayHi</span>()<span class="op">;</span> <span class="co">// Logs: hello from Panel</span></span></code></pre></div>
<p>When used appropriately, Underscore’s <code>extend</code> method can
save a great deal of time and effort writing redundant code.</p>
<p>(Thanks to <a href="http://dailyjs.com">Alex Young</a>, <a
href="http://stackoverflow.com/users/93448/derick-bailey">Derick
Bailey</a> and <a
href="http://stackoverflow.com/users/188740/johnnyo">JohnnyO</a> for the
heads up about these tips).</p>
<p><strong>Backbone-Super</strong></p>
<p><a
href="https://github.com/lukasolson/Backbone-Super">Backbone-Super</a>
by Lukas Olson adds a *_super* method to <em>Backbone.Model</em> using
<a href="http://ejohn.org/blog/simple-javascript-inheritance/">John
Resig’s Inheritance script</a>. Rather than using
Backbone.Model.prototype.set.call as per the Backbone.js documentation,
_super can be called instead:</p>
<div class="sourceCode" id="cb236"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co">// This is how we normally do it</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> OldFashionedNote <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span><span class="op">:</span> <span class="kw">function</span>(attributes<span class="op">,</span> options) {</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Call parent&#39;s method</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>    Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">set</span><span class="op">.</span><span class="fu">call</span>(<span class="kw">this</span><span class="op">,</span> attributes<span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// some custom code here</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>After including this plugin, you can do the same thing with the
following syntax:</p>
<div class="sourceCode" id="cb237"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co">// This is how we can do it after using the Backbone-super plugin</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Note <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span><span class="op">:</span> <span class="kw">function</span>(attributes<span class="op">,</span> options) {</span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Call parent&#39;s method</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">_super</span>(attributes<span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// some custom code here</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h4 id="event-aggregators-and-mediators">Event Aggregators And
Mediators</h4>
<p><strong>Problem</strong></p>
<p>How do I channel multiple event sources through a single object?</p>
<p><strong>Solution</strong></p>
<p>Using an Event Aggregator. It’s common for developers to think of
Mediators when faced with this problem, so let’s explore what an Event
Aggregator is, what the Mediator pattern is and how they differ.</p>
<p>Design patterns often differ only in semantics and intent. That is,
the language used to describe the pattern is what sets it apart, more
than an implementation of that specific pattern. It often comes down to
squares vs rectangles vs polygons. You can create the same end result
with all three, given the constraints of a square are still met – or you
can use polygons to create an infinitely larger and more complex set of
things.</p>
<p>When it comes to the Mediator and Event Aggregator patterns, there
are some times where it may look like the patterns are interchangeable
due to implementation similarities. However, the semantics and intent of
these patterns are very different. And even if the implementations both
use some of the same core constructs, I believe there is a distinct
difference between them. I also believe they should not be interchanged
or confused in communication because of the differences.</p>
<p>#####Event Aggregator</p>
<p>The core idea of the Event Aggregator, according to Martin Fowler, is
to channel multiple event sources through a single object so that other
objects needing to subscribe to the events don’t need to know about
every event source.</p>
<p>######Backbone’s Event Aggregator</p>
<p>The easiest event aggregator to show is that of Backbone.js – it’s
built into the Backbone object directly.</p>
<div class="sourceCode" id="cb238"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> View1 <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;click .foo&quot;</span><span class="op">:</span> <span class="st">&quot;doIt&quot;</span></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">doIt</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// trigger an event through the event aggregator</span></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a>    Backbone<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;some:event&quot;</span>)<span class="op">;</span></span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> View2 <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// subscribe to the event aggregator&#39;s event</span></span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a>    Backbone<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;some:event&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">doStuff</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb238-21"><a href="#cb238-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-22"><a href="#cb238-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">doStuff</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb238-23"><a href="#cb238-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb238-24"><a href="#cb238-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb238-25"><a href="#cb238-25" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>In this example, the first view is triggering an event when a DOM
element is clicked. The event is triggered through Backbone’s built-in
event aggregator – the Backbone object. Of course, it’s trivial to
create your own event aggregator in Backbone, and there are some key
things that we need to keep in mind when using an event aggregator, to
keep our code simple.</p>
<p>#######jQuery’s Event Aggregator</p>
<p>Did you know that jQuery has a built-in event aggregator? They don’t
call it this, but it’s in there and it’s scoped to DOM events. It also
happens to look like Backbone’s event aggregator:</p>
<pre><code>$(&quot;#mainArticle&quot;).on(&quot;click&quot;, function(e){

  // handle click event on any element underneath our #mainArticle element

});</code></pre>
<p>This code sets up an event handler function that waits for an unknown
number of event sources to trigger a “click” event, and it allows any
number of listeners to attach to the events of those event publishers.
jQuery just happens to scope this event aggregator to the DOM.</p>
<p>#####Mediator</p>
<p>A Mediator is an object that coordinates interactions (logic and
behavior) between multiple objects. It makes decisions on when to call
which objects, based on the actions (or inaction) of other objects and
input.</p>
<p><strong>A Mediator For Backbone</strong></p>
<p>Backbone doesn’t have the idea of a mediator built into it like a lot
of MV* frameworks do. But that doesn’t mean you can’t write one using a
single line of code:</p>
<div class="sourceCode" id="cb240"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mediator <span class="op">=</span> {}<span class="op">;</span></span></code></pre></div>
<p>Yes, of course this is just an object literal in JavaScript. Once
again, we’re talking about semantics here. The purpose of the mediator
is to control the workflow between objects and we really don’t need
anything more than an object literal to do this.</p>
<div class="sourceCode" id="cb241"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> orgChart <span class="op">=</span> {</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">addNewEmployee</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// getEmployeeDetail provides a view that users interact with</span></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> employeeDetail <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getEmployeeDetail</span>()<span class="op">;</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// when the employee detail is complete, the mediator (the &#39;orgchart&#39; object)</span></span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// decides what should happen next</span></span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a>    employeeDetail<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;complete&quot;</span><span class="op">,</span> <span class="kw">function</span>(employee){</span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// set up additional objects that have additional events, which are used</span></span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// by the mediator to do additional things</span></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> managerSelector <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">selectManager</span>(employee)<span class="op">;</span></span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a>      managerSelector<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;save&quot;</span><span class="op">,</span> <span class="kw">function</span>(employee){</span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a>        employee<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb241-20"><a href="#cb241-20" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb241-21"><a href="#cb241-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-22"><a href="#cb241-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb241-23"><a href="#cb241-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This example shows a very basic implementation of a mediator object
with Backbone-based objects that can trigger and subscribe to events.
I’ve often referred to this type of object as a “workflow” object in the
past, but the truth is that it is a mediator. It is an object that
handles the workflow between many other objects, aggregating the
responsibility of that workflow knowledge into a single object. The
result is workflow that is easier to understand and maintain.</p>
<p>#####Similarities And Differences</p>
<p>There are, without a doubt, similarities between the event aggregator
and mediator examples that I’ve shown here. The similarities boil down
to two primary items: events and third-party objects. These differences
are superficial at best, though. When we dig into the intent of the
pattern and see that the implementations can be dramatically different,
the nature of the patterns become more apparent.</p>
<p>######Events</p>
<p>Both the event aggregator and mediator use events, in the above
examples. An event aggregator obviously deals with events – it’s in the
name after all. The mediator only uses events because it makes life easy
when dealing with Backbone, though. There is nothing that says a
mediator must be built with events. You can build a mediator with
callback methods, by handing the mediator reference to the child object,
or by any of a number of other means.</p>
<p>The difference, then, is why these two patterns are both using
events. The event aggregator, as a pattern, is designed to deal with
events. The mediator, though, only uses them because it’s
convenient.</p>
<p>######Third-Party Objects</p>
<p>Both the event aggregator and mediator, by design, use a third-party
object to facilitate things. The event aggregator itself is a
third-party to the event publisher and the event subscriber. It acts as
a central hub for events to pass through. The mediator is also a third
party to other objects, though. So where is the difference? Why don’t we
call an event aggregator a mediator? The answer largely comes down to
where the application logic and workflow is coded.</p>
<p>In the case of an event aggregator, the third party object is there
only to facilitate the pass-through of events from an unknown number of
sources to an unknown number of handlers. All workflow and business
logic that needs to be kicked off is put directly into the object that
triggers the events and the objects that handle the events.</p>
<p>In the case of the mediator, though, the business logic and workflow
is aggregated into the mediator itself. The mediator decides when an
object should have its methods called and attributes updated based on
factors that the mediator knows about. It encapsulates the workflow and
process, coordinating multiple objects to produce the desired system
behaviour. The individual objects involved in this workflow each know
how to perform their own task. But it’s the mediator that tells the
objects when to perform the tasks by making decisions at a higher level
than the individual objects.</p>
<p>An event aggregator facilitates a “fire and forget” model of
communication. The object triggering the event doesn’t care if there are
any subscribers. It just fires the event and moves on. A mediator,
though, might use events to make decisions, but it is definitely not
“fire and forget”. A mediator pays attention to a known set of input or
activities so that it can facilitate and coordinate additional behavior
with a known set of actors (objects).</p>
<p>#####Relationships: When To Use Which</p>
<p>Understanding the similarities and differences between an event
aggregator and mediator is important for semantic reasons. It’s equally
as important to understand when to use which pattern, though. The basic
semantics and intent of the patterns does inform the question of when,
but actual experience in using the patterns will help you understand the
more subtle points and nuanced decisions that have to be made.</p>
<p>######Event Aggregator Use</p>
<p>In general, an event aggregator is used when you either have too many
objects to listen to directly, or you have objects that are entirely
unrelated.</p>
<p>When two objects have a direct relationship already – say, a parent
view and child view – then there might be little benefit in using an
event aggregator. Have the child view trigger an event and the parent
view can handle the event. This is most commonly seen in Backbone’s
Collection and Model, where all Model events are bubbled up to and
through its parent Collection. A Collection often uses model events to
modify the state of itself or other models. Handling “selected” items in
a collection is a good example of this.</p>
<p>jQuery’s on method as an event aggregator is a great example of too
many objects to listen to. If you have 10, 20 or 200 DOM elements that
can trigger a “click” event, it might be a bad idea to set up a listener
on all of them individually. This could quickly deteriorate performance
of the application and user experience. Instead, using jQuery’s on
method allows us to aggregate all of the events and reduce the overhead
of 10, 20, or 200 event handlers down to 1.</p>
<p>Indirect relationships are also a great time to use event
aggregators. In Backbone applications, it is very common to have
multiple view objects that need to communicate, but have no direct
relationship. For example, a menu system might have a view that handles
the menu item clicks. But we don’t want the menu to be directly tied to
the content views that show all of the details and information when a
menu item is clicked. Having the content and menu coupled together would
make the code very difficult to maintain, in the long run. Instead, we
can use an event aggregator to trigger “menu:click:foo” events, and have
a “foo” object handle the click event to show its content on the
screen.</p>
<p>######Mediator Use</p>
<p>A mediator is best applied when two or more objects have an indirect
working relationship, and business logic or workflow needs to dictate
the interactions and coordination of these objects.</p>
<p>A wizard interface is a good example of this, as shown with the
“orgChart” example, above. There are multiple views that facilitate the
entire workflow of the wizard. Rather than tightly coupling the view
together by having them reference each other directly, we can decouple
them and more explicitly model the workflow between them by introducing
a mediator.</p>
<p>The mediator extracts the workflow from the implementation details
and creates a more natural abstraction at a higher level, showing us at
a much faster glance what that workflow is. We no longer have to dig
into the details of each view in the workflow, to see what the workflow
actually is.</p>
<p>#####Event Aggregator And Mediator Together</p>
<p>The crux of the difference between an event aggregator and a
mediator, and why these pattern names should not be interchanged with
each other, is illustrated best by showing how they can be used
together. The menu example for an event aggregator is the perfect place
to introduce a mediator as well.</p>
<p>Clicking a menu item may trigger a series of changes throughout an
application. Some of these changes will be independent of others, and
using an event aggregator for this makes sense. Some of these changes
may be internally related to each other, though, and may use a mediator
to enact those changes. A mediator, then, could be set up to listen to
the event aggregator. It could run its logic and process to facilitate
and coordinate many objects that are related to each other, but
unrelated to the original event source.</p>
<div class="sourceCode" id="cb242"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MenuItem <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;click .thatThing&quot;</span><span class="op">:</span> <span class="st">&quot;clickedIt&quot;</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clickedIt</span><span class="op">:</span> <span class="kw">function</span>(e){</span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// assume this triggers &quot;menu:click:foo&quot;</span></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>    Backbone<span class="op">.</span><span class="fu">trigger</span>(<span class="st">&quot;menu:click:&quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;name&quot;</span>))<span class="op">;</span></span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a><span class="co">// ... somewhere else in the app</span></span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyWorkflow <span class="op">=</span> <span class="kw">function</span>(){</span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>  Backbone<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;menu:click:foo&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">doStuff</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a>MyWorkflow<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">doStuff</span> <span class="op">=</span> <span class="kw">function</span>(){</span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// instantiate multiple objects here.</span></span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// set up event handlers for those objects.</span></span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// coordinate all of the objects into a meaningful workflow.</span></span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>In this example, when the MenuItem with the right model is clicked,
the <code>“menu:click:foo”</code> event will be triggered. An instance
of the “MyWorkflow” object, assuming one is already instantiated, will
handle this specific event and will coordinate all of the objects that
it knows about, to create the desired user experience and workflow.</p>
<p>An event aggregator and a mediator have been combined to create a
much more meaningful experience in both the code and the application
itself. We now have a clean separation between the menu and the workflow
through an event aggregator and we are still keeping the workflow itself
clean and maintainable through the use of a mediator.</p>
<p>#####Pattern Language: Semantics</p>
<p>There is one overriding point to make in all of this discussion:
semantics. Communicating intent and semantics through the use of named
patterns is only viable and only valid when all parties in a
communication medium understand the language in the same way.</p>
<p>If I say “apple”, what am I talking about? Am I talking about a
fruit? Or am I talking about a technology and consumer products company?
As Sharon Cichelli says: “semantics will continue to be important, until
we learn how to communicate in something other than language”.</p>
<h1 id="modular-development">Modular Development</h1>
<h2 id="introduction-1">Introduction</h2>
<p>When we say an application is modular, we generally mean it’s
composed of a set of highly decoupled, distinct pieces of functionality
stored in modules. As you probably know, loose coupling facilitates
easier maintainability of apps by removing dependencies where possible.
When this is implemented efficiently, it’s quite easy to see how changes
to one part of a system may affect another.</p>
<p>Unlike some more traditional programming languages, the current
iteration of JavaScript (ECMA-262) doesn’t provide developers with the
means to import such modules of code in a clean, organized manner.</p>
<p>Instead, developers are left to fall back on variations of the module
or object literal patterns combined with script tags or a script loader.
With many of these, module scripts are strung together in the DOM with
namespaces being described by a single global object where it’s still
possible to have name collisions. There’s also no clean way to handle
dependency management without some manual effort or third party
tools.</p>
<p>Whilst native solutions to these problems may be arriving via <a
href="http://wiki.ecmascript.org/doku.php?id=harmony:specification_drafts">ES6</a>
(the next version of the official JavaScript specification) <a
href="http://wiki.ecmascript.org/doku.php?id=harmony:modules">modules
proposal</a>, the good news is that writing modular JavaScript has never
been easier and you can start doing it today.</p>
<p>In this next part of the book, we’re going to look at how to use AMD
modules and RequireJS to cleanly wrap units of code in your application
into manageable modules. We’ll also cover an alternate approach called
Lumbar which uses routes to determine when modules are loaded.</p>
<h2 id="organizing-modules-with-requirejs-and-amd">Organizing modules
with RequireJS and AMD</h2>
<p><em>Partly Contributed by <a
href="https://github.com/jackfranklin">Jack Franklin</a></em></p>
<p><a href="http://requirejs.org">RequireJS</a> is a popular script
loader written by James Burke - a developer who has been quite
instrumental in helping shape the AMD module format, which we’ll discuss
shortly. Amongst other things RequireJS helps you to load multiple
script files, define modules with or without dependencies, and load in
non-script dependencies such as text files.</p>
<h3
id="maintainability-problems-with-multiple-script-files">Maintainability
problems with multiple script files</h3>
<p>You might be thinking that there is little benefit to RequireJS.
After all, you can simply load in your JavaScript files through multiple
<code>&lt;script&gt;</code> tags, which is very straightforward.
However, doing it that way has a lot of drawbacks, including increasing
the HTTP overhead.</p>
<p>Every time the browser loads in a file you’ve referenced in a
<code>&lt;script&gt;</code> tag, it makes an HTTP request to load the
file’s contents. It has to make a new HTTP request for each file you
want to load, which causes problems.</p>
<ul>
<li>Browsers are limited in how many parallel requests they can make, so
often it’s slow to load multiple files, as it can only do a certain
number at a time. This number depends on the user’s settings and
browser, but is usually around 4-8. When working on Backbone
applications it’s good to split your app into multiple JS files, so it’s
easy to hit that limit quickly. This can be negated by minifying your
code into one file as part of a build process, but does not help with
the next point.</li>
<li>Scripts are loaded synchronously. This means that the browser cannot
continue page rendering while the script is loading.</li>
</ul>
<p>What tools like RequireJS do is load scripts asynchronously. This
means we have to adjust our code slightly, you can’t just swap out
<code>&lt;script&gt;</code> elements for a small piece of RequireJS
code, but the benefits are very worthwhile:</p>
<ul>
<li>Loading the scripts asynchronously means the load process is
non-blocking. The browser can continue to render the rest of the page as
the scripts are being loaded, speeding up the initial load time.</li>
<li>We can load modules in more intelligently, having more control over
when they are loaded and ensuring that modules which have dependencies
are loaded in the right order.</li>
</ul>
<h3 id="need-for-better-dependency-management">Need for better
dependency management</h3>
<p>Dependency management is a challenging subject, in particular when
writing JavaScript in the browser. The closest thing we have to
dependency management by default is simply making sure we order our
<code>&lt;script&gt;</code> tags such that code that depends on code in
another file is loaded after the file it depends on. This is not a good
approach. As I’ve already discussed, loading multiple files in that way
is bad for performance; needing them to be loaded in a certain order is
very brittle.</p>
<p>Being able to load code on an as-needed basis is something RequireJS
is very good at. Rather than load all our JavaScript code in during
initial page load, a better approach is to dynamically load modules when
that code is required. This avoids loading all the code when the user
first hits your application, consequently speeding up initial load
times.</p>
<p>Think about the GMail web client for a moment. When a user initially
loads the page on their first visit, Google can simply hide widgets such
as the chat module until the user has indicated (by clicking ‘expand’)
that they wish to use it. Through dynamic dependency loading, Google
could load up the chat module at that time, rather than forcing all
users to load it when the page first initializes. This can improve
performance and load times and can definitely prove useful when building
larger applications. As the codebase for an application grows this
becomes even more important.</p>
<p>The important thing to note here is that while it’s absolutely fine
to develop applications without a script loader, there are significant
benefits to utilizing tools like RequireJS in your application.</p>
<h3 id="asynchronous-module-definition-amd">Asynchronous Module
Definition (AMD)</h3>
<p>RequireJS implements the <a
href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD Specification</a>
which defines a method for writing modular code and managing
dependencies. The RequireJS website also has a section <a
href="http://requirejs.org/docs/whyamd.html">documenting the reasons
behind implementing AMD</a>:</p>
<blockquote>
<p>The AMD format comes from wanting a module format that was better
than today’s “write a bunch of script tags with implicit dependencies
that you have to manually order” and something that was easy to use
directly in the browser. Something with good debugging characteristics
that did not require server-specific tooling to get started.</p>
</blockquote>
<h3 id="writing-amd-modules-with-requirejs">Writing AMD modules with
RequireJS</h3>
<p>As discussed above, the overall goal for the AMD format is to provide
a solution for modular JavaScript that developers can use today. The two
key concepts you need to be aware of when using it with a script-loader
are the <code>define()</code> method for defining modules and the
<code>require()</code> method for loading dependencies.
<code>define()</code> is used to define named or unnamed modules using
the following signature:</p>
<div class="sourceCode" id="cb243"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>(</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>    module_id <span class="co">/*optional*/</span><span class="op">,</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>    [dependencies] <span class="co">/*optional*/</span><span class="op">,</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>    definition <span class="kw">function</span> <span class="co">/*function for instantiating the module or object*/</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p>As you can tell by the inline comments, the <code>module_id</code> is
an optional argument which is typically only required when non-AMD
concatenation tools are being used (there may be some other edge cases
where it’s useful too). When this argument is left out, we call the
module ‘anonymous’. When working with anonymous modules, RequireJS will
use a module’s file path as its module id, so the adage Don’t Repeat
Yourself (DRY) should be applied by omitting the module id in the
<code>define()</code> invocation.</p>
<p>The dependencies argument is an array representing all of the other
modules that this module depends on and the third argument is a factory
that can either be a function that should be executed to instantiate the
module or an object.</p>
<p>A barebones module (compatible with RequireJS) could be defined using
<code>define()</code> as follows:</p>
<div class="sourceCode" id="cb244"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co">// A module ID has been omitted here to make the module anonymous</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([<span class="st">&#39;foo&#39;</span><span class="op">,</span> <span class="st">&#39;bar&#39;</span>]<span class="op">,</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// module definition function</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// dependencies (foo and bar) are mapped to function parameters</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> ( foo<span class="op">,</span> bar ) {</span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// return a value that defines the module export</span></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// (i.e. the functionality we want to expose for consumption)</span></span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// create your module here</span></span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> myModule <span class="op">=</span> {</span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">doStuff</span><span class="op">:</span><span class="kw">function</span>(){</span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true" tabindex="-1"></a>                <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Yay! Stuff&#39;</span>)<span class="op">;</span></span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-17"><a href="#cb244-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> myModule<span class="op">;</span></span>
<span id="cb244-18"><a href="#cb244-18" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><em>Note: RequireJS is intelligent enough to automatically infer the
‘.js’ extension to your script file names. As such, this extension is
generally omitted when specifying dependencies.</em></p>
<h4 id="alternate-syntax">Alternate syntax</h4>
<p>There is also a <a
href="http://requirejs.org/docs/whyamd.html#sugar">sugared version</a>
of <code>define()</code> available that allows you to declare your
dependencies as local variables using <code>require()</code>. This will
feel familiar to anyone who’s used node, and can be easier to add or
remove dependencies. Here is the previous snippet using the alternate
syntax:</p>
<div class="sourceCode" id="cb245"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co">// A module ID has been omitted here to make the module anonymous</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>(<span class="kw">function</span>(require){</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// module definition function</span></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// dependencies (foo and bar) are defined as local vars</span></span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> foo <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;foo&#39;</span>)<span class="op">,</span></span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>        bar <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;bar&#39;</span>)<span class="op">;</span></span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// return a value that defines the module export</span></span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// (i.e. the functionality we want to expose for consumption)</span></span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create your module here</span></span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> myModule <span class="op">=</span> {</span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">doStuff</span><span class="op">:</span><span class="kw">function</span>(){</span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Yay! Stuff&#39;</span>)<span class="op">;</span></span>
<span id="cb245-16"><a href="#cb245-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb245-17"><a href="#cb245-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb245-18"><a href="#cb245-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-19"><a href="#cb245-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> myModule<span class="op">;</span></span>
<span id="cb245-20"><a href="#cb245-20" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The <code>require()</code> method is typically used to load code in a
top-level JavaScript file or within a module should you wish to
dynamically fetch dependencies. An example of its usage is:</p>
<div class="sourceCode" id="cb246"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Consider &#39;foo&#39; and &#39;bar&#39; are two external modules</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="co">// In this example, the &#39;exports&#39; from the two modules loaded are passed as</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="co">// function arguments to the callback (foo and bar)</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a><span class="co">// so that they can similarly be accessed</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>( [<span class="st">&#39;foo&#39;</span><span class="op">,</span> <span class="st">&#39;bar&#39;</span>]<span class="op">,</span> <span class="kw">function</span> ( foo<span class="op">,</span> bar ) {</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// rest of your code here</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>    foo<span class="op">.</span><span class="fu">doSomething</span>()<span class="op">;</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Addy’s post on <a
href="http://addyosmani.com/writing-modular-js/">Writing Modular JS</a>
covers the AMD specification in much more detail. Defining and using
modules will be covered in this book shortly when we look at more
structured examples of using RequireJS.</p>
<h3 id="getting-started-with-requirejs">Getting Started with
RequireJS</h3>
<p>Before using RequireJS and Backbone we will first set up a very basic
RequireJS project to demonstrate how it works. The first thing to do is
to <a href="http://requirejs.org/docs/download.html#requirejs">Download
RequireJS</a>. When you load in the RequireJS script in your HTML file,
you need to also tell it where your main JavaScript file is located.
Typically this will be called something like “app.js”, and is the main
entry point for your application. You do this by adding in a
<code>data-main</code> attribute to the <code>script</code> tag:</p>
<div class="sourceCode" id="cb247"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> data-main</span><span class="op">=</span><span class="st">&quot;app&quot;</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;lib/require.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Now, RequireJS will automatically load <code>app.js</code> for
you.</p>
<h4 id="requirejs-configuration">RequireJS Configuration</h4>
<p>In the main JavaScript file that you load with the
<code>data-main</code> attribute you can configure how RequireJS loads
the rest of your application. This is done by calling
<code>require.config</code>, and passing in an object:</p>
<div class="sourceCode" id="cb248"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span><span class="fu">config</span>({</span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// your configuration key/values here</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">baseUrl</span><span class="op">:</span> <span class="st">&quot;app&quot;</span><span class="op">,</span> <span class="co">// generally the same directory as the script used in a data-main attribute for the top level script</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">paths</span><span class="op">:</span> {}<span class="op">,</span> <span class="co">// set up custom paths to libraries, or paths to RequireJS plugins</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">shim</span><span class="op">:</span> {}<span class="op">,</span> <span class="co">// used for setting up all Shims (see below for more detail)</span></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The main reason you’d want to configure RequireJS is to add shims,
which we’ll cover next. To see other configuration options available to
you, I recommend checking out the <a
href="http://requirejs.org/docs/api.html#config">RequireJS
documentation</a>.</p>
<h5 id="requirejs-shims">RequireJS Shims</h5>
<p>Ideally, each library that we use with RequireJS will come with AMD
support. That is, it uses the <code>define</code> method to define the
library as a module. While Backbone and Underscore have added AMD
support in recent years, we’re going to show an example of how to shim a
library that does not using RequireJS.</p>
<p>To demonstrate this, first let’s shim Underscore, and then we’ll shim
Backbone too. Shims are very simple to implement:</p>
<div class="sourceCode" id="cb249"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span><span class="fu">config</span>({</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">shim</span><span class="op">:</span> {</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;lib/underscore&#39;</span><span class="op">:</span> {</span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">exports</span><span class="op">:</span> <span class="st">&#39;_&#39;</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Note that when specifying paths for RequireJS you should omit the
<code>.js</code> from the end of script names.</p>
<p>The important line here is <code>exports: '_'</code>. This line tells
RequireJS that the script in <code>'lib/underscore.js'</code> creates a
global variable called <code>_</code> instead of defining a module. Now
when we list Underscore as a dependency RequireJS will know to give us
the <code>_</code> global variable as though it was the module defined
by that script. We can set up a shim for Backbone too:</p>
<div class="sourceCode" id="cb250"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span><span class="fu">config</span>({</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">shim</span><span class="op">:</span> {</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;lib/underscore&#39;</span><span class="op">:</span> {</span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>          <span class="dt">exports</span><span class="op">:</span> <span class="st">&#39;_&#39;</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;lib/backbone&#39;</span><span class="op">:</span> {</span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">deps</span><span class="op">:</span> [<span class="st">&#39;lib/underscore&#39;</span><span class="op">,</span> <span class="st">&#39;jquery&#39;</span>]<span class="op">,</span></span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">exports</span><span class="op">:</span> <span class="st">&#39;Backbone&#39;</span></span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Again, that configuration tells RequireJS to return the global
<code>Backbone</code> variable that Backbone exports, but this time
you’ll notice that Backbone’s dependencies are defined. This means
whenever this:</p>
<div class="sourceCode" id="cb251"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>( <span class="st">&#39;lib/backbone&#39;</span><span class="op">,</span> <span class="kw">function</span>( Backbone ) {<span class="op">...</span>} )<span class="op">;</span></span></code></pre></div>
<p>Is run, it will first make sure the dependencies are met, and then
pass the global <code>Backbone</code> object into the callback function.
You don’t need to do this with every library, only the ones that don’t
support AMD. For example, jQuery does support it, as of jQuery 1.7.</p>
<p>If you’d like to read more about general RequireJS usage, the <a
href="http://requirejs.org/docs/api.html">RequireJS API docs</a> are
incredibly thorough and easy to read.</p>
<h4 id="custom-paths">Custom Paths</h4>
<p>Typing long paths to file names like <code>lib/backbone</code> can
get tedious. RequireJS lets us set up custom paths in our configuration
object. Here, whenever I refer to “underscore”, RequireJS will look for
the file <code>lib/underscore.js</code>:</p>
<div class="sourceCode" id="cb252"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span><span class="fu">config</span>({</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">paths</span><span class="op">:</span> {</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;underscore&#39;</span><span class="op">:</span> <span class="st">&#39;lib/underscore&#39;</span></span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Of course, this can be combined with a shim:</p>
<div class="sourceCode" id="cb253"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span><span class="fu">config</span>({</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">paths</span><span class="op">:</span> {</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;underscore&#39;</span><span class="op">:</span> <span class="st">&#39;lib/underscore&#39;</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">shim</span><span class="op">:</span> {</span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;underscore&#39;</span><span class="op">:</span> {</span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>          <span class="dt">exports</span><span class="op">:</span> <span class="st">&#39;_&#39;</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Just make sure that you refer to the custom path in your shim
settings, too. Now you can do</p>
<div class="sourceCode" id="cb254"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>( [<span class="st">&#39;underscore&#39;</span>]<span class="op">,</span> <span class="kw">function</span>(_) {</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="co">// code here</span></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>to shim Underscore but still use a custom path.</p>
<h3 id="require.js-and-backbone-examples">Require.js and Backbone
Examples</h3>
<p>Now that we’ve taken a look at how to define AMD modules, let’s
review how to go about wrapping components like views and collections so
that they can also be easily loaded as dependencies for any parts of
your application that require them. At its simplest, a Backbone model
may just require Backbone and Underscore.js. These are dependencies, so
we can define those when defining the new modules. Note that the
following examples presume you have configured RequireJS to shim
Backbone and Underscore, as discussed previously.</p>
<h4 id="wrapping-models-views-and-other-components-with-amd">Wrapping
models, views, and other components with AMD</h4>
<p>For example, here is how a model is defined.</p>
<div class="sourceCode" id="cb255"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([<span class="st">&#39;underscore&#39;</span><span class="op">,</span> <span class="st">&#39;backbone&#39;</span>]<span class="op">,</span> <span class="kw">function</span>(_<span class="op">,</span> Backbone) {</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> myModel <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Default attributes</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">content</span><span class="op">:</span> <span class="st">&#39;hello world&#39;</span><span class="op">,</span></span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// A dummy initialization method</span></span>
<span id="cb255-10"><a href="#cb255-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb255-11"><a href="#cb255-11" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb255-12"><a href="#cb255-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-13"><a href="#cb255-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clear</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb255-14"><a href="#cb255-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">destroy</span>()<span class="op">;</span></span>
<span id="cb255-15"><a href="#cb255-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb255-16"><a href="#cb255-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb255-17"><a href="#cb255-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-18"><a href="#cb255-18" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb255-19"><a href="#cb255-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> myModel<span class="op">;</span></span>
<span id="cb255-20"><a href="#cb255-20" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Note how we alias Underscore.js’s instance to <code>_</code> and
Backbone to just <code>Backbone</code>, making it very trivial to
convert non-AMD code over to using this module format. For a view which
might require other dependencies such as jQuery, this can similarly be
done as follows:</p>
<div class="sourceCode" id="cb256"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;jquery&#39;</span><span class="op">,</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;underscore&#39;</span><span class="op">,</span></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;backbone&#39;</span><span class="op">,</span></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;collections/mycollection&#39;</span><span class="op">,</span></span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;views/myview&#39;</span></span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span> <span class="kw">function</span>($<span class="op">,</span> _<span class="op">,</span> Backbone<span class="op">,</span> myCollection<span class="op">,</span> myView){</span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> AppView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
<p>Aliasing to the dollar-sign (<code>$</code>) once again makes it very
easy to encapsulate any part of an application you wish using AMD.</p>
<p>Doing it this way makes it easy to organize your Backbone application
as you like. It’s recommended to separate modules into folders. For
example, individual folders for models, collections, views and so on.
RequireJS doesn’t care about what folder structure you use; as long as
you use the correct path when using <code>require</code>, it will
happily pull in the file.</p>
<p>As part of this chapter I’ve made a very simple <a
href="https://github.com/javascript-playground/backbone-require-example">Backbone
application with RequireJS that you can find on Github</a>. It is a
stock application for a manager of a shop. They can add new items and
filter down the items based on price, but nothing more. Because it’s so
simple it’s easier to focus purely on the RequireJS part of the
implementation, rather than deal with complex JavaScript and Backbone
logic too.</p>
<p>At the base of this application is the <code>Item</code> model, which
describes a single item in the stock. Its implementation is very
straight forward:</p>
<div class="sourceCode" id="cb257"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>( [<span class="st">&quot;lib/backbone&quot;</span>]<span class="op">,</span> <span class="kw">function</span> ( Backbone ) {</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Item <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">price</span><span class="op">:</span> <span class="dv">35</span><span class="op">,</span></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">photo</span><span class="op">:</span> <span class="st">&quot;http://www.placedog.com/100/100&quot;</span></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Item<span class="op">;</span></span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Converting an individual model, collection, view or similar into an
AMD, RequireJS compliant one is typically very straight forward. Usually
all that’s needed is the first line, calling <code>define</code>, and to
make sure that once you’ve defined your object - in this case, the
<code>Item</code> model, to return it.</p>
<p>Let’s now set up a view for that individual item:</p>
<div class="sourceCode" id="cb258"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>( [<span class="st">&quot;lib/backbone&quot;</span>]<span class="op">,</span> <span class="kw">function</span> ( Backbone ) {</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ItemView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tagName</span><span class="op">:</span> <span class="st">&quot;div&quot;</span><span class="op">,</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">className</span><span class="op">:</span> <span class="st">&quot;item-wrap&quot;</span><span class="op">,</span></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>(<span class="fu">$</span>(<span class="st">&quot;#itemTemplate&quot;</span>)<span class="op">.</span><span class="fu">html</span>())<span class="op">,</span></span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">template</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span>))<span class="op">;</span></span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ItemView<span class="op">;</span></span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This view doesn’t actually depend on the model it will be used with,
so again the only dependency is Backbone. Other than that it’s just a
regular Backbone view. There’s nothing special going on here, other than
returning the object and using <code>define</code> so RequireJS can pick
it up. Now let’s make a collection to view a list of items. This time we
will need to reference the <code>Item</code> model, so we add it as a
dependency:</p>
<div class="sourceCode" id="cb259"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([<span class="st">&quot;lib/backbone&quot;</span><span class="op">,</span> <span class="st">&quot;models/item&quot;</span>]<span class="op">,</span> <span class="kw">function</span>(Backbone<span class="op">,</span> Item) {</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Cart <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> Item<span class="op">,</span></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;add&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">updateSet</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">updateSet</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>      items <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">models</span><span class="op">;</span></span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Cart<span class="op">;</span></span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>I’ve called this collection <code>Cart</code>, as it’s a group of
items. As the <code>Item</code> model is the second dependency, I can
bind the variable <code>Item</code> to it by declaring it as the second
argument to the callback function. I can then refer to this within my
collection implementation.</p>
<p>Finally, let’s have a look at the view for this collection. (This
file is much bigger in the application, but I’ve taken some bits out so
it’s easier to examine).</p>
<div class="sourceCode" id="cb260"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([<span class="st">&quot;lib/backbone&quot;</span><span class="op">,</span> <span class="st">&quot;views/itemview&quot;</span>]<span class="op">,</span> <span class="kw">function</span>(Backbone<span class="op">,</span> ItemView) {</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ItemCollectionView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">el</span><span class="op">:</span> <span class="st">&#39;#yourcart&#39;</span><span class="op">,</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(collection) {</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">collection</span> <span class="op">=</span> collection<span class="op">;</span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;reset&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(<span class="st">&quot;&quot;</span>)<span class="op">;</span></span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>(item) {</span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">renderItem</span>(item)<span class="op">;</span></span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">renderItem</span><span class="op">:</span> <span class="kw">function</span>(item) {</span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> itemView <span class="op">=</span> <span class="kw">new</span> <span class="fu">ItemView</span>({<span class="dt">model</span><span class="op">:</span> item})<span class="op">;</span></span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">append</span>(itemView<span class="op">.</span><span class="fu">render</span>()<span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb260-18"><a href="#cb260-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb260-19"><a href="#cb260-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// more methods here removed</span></span>
<span id="cb260-20"><a href="#cb260-20" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb260-21"><a href="#cb260-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ItemCollectionView<span class="op">;</span></span>
<span id="cb260-22"><a href="#cb260-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>There really is nothing to it once you’ve got the general pattern.
Define each “object” (a model, view, collection, router or otherwise)
through RequireJS, and then specify them as dependencies to other
objects that need them. Again, you can find this entire application <a
href="https://github.com/javascript-playground/backbone-require-example">on
Github</a>.</p>
<p>If you’d like to take a look at how others do it, <a
href="https://github.com/phawk/Backbone-Stack">Pete Hawkins’ Backbone
Stack repository</a> is a good example of structuring a Backbone
application using RequireJS. Greg Franko has also written <a
href="http://gregfranko.com/blog/using-backbone-dot-js-with-require-dot-js/">an
overview of how he uses Backbone and Require</a>, and <a
href="http://jeremyckahn.github.com/blog/2012/08/18/keeping-it-sane-backbone-views-and-require-dot-js/">Jeremy
Kahn’s post</a> neatly describes his approach. For a look at a full
sample application, the <a
href="https://github.com/addyosmani/todomvc/tree/gh-pages/dependency-examples/backbone_require">Backbone
and Require version</a> of the TodoMVC application is a good starting
point.</p>
<h3
id="keeping-your-templates-external-using-requirejs-and-the-text-plugin">Keeping
Your Templates External Using RequireJS And The Text Plugin</h3>
<p>Moving your templates to external files is actually quite
straight-forward, whether they are Underscore, Mustache, Handlebars or
any other text-based template format. Let’s look at how we do that with
RequireJS.</p>
<p>RequireJS has a special plugin called text.js which is used to load
in text file dependencies. To use the text plugin, follow these
steps:</p>
<ol type="1">
<li><p>Download the plugin from
http://requirejs.org/docs/download.html#text and place it in either the
same directory as your application’s main JS file or a suitable
sub-directory.</p></li>
<li><p>Next, include the text.js plugin in your initial RequireJS
configuration options. In the code snippet below, we assume that
RequireJS is being included in our page prior to this code snippet being
executed.</p></li>
</ol>
<div class="sourceCode" id="cb261"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span><span class="fu">config</span>( {</span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">paths</span><span class="op">:</span> {</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;text&#39;</span><span class="op">:</span> <span class="st">&#39;libs/require/text&#39;</span><span class="op">,</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">baseUrl</span><span class="op">:</span> <span class="st">&#39;app&#39;</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>} )<span class="op">;</span></span></code></pre></div>
<ol start="3" type="1">
<li>When the <code>text!</code> prefix is used for a dependency,
RequireJS will automatically load the text plugin and treat the
dependency as a text resource. A typical example of this in action may
look like:</li>
</ol>
<div class="sourceCode" id="cb262"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>([<span class="st">&#39;js/app&#39;</span><span class="op">,</span> <span class="st">&#39;text!templates/mainView.html&#39;</span>]<span class="op">,</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span>( app<span class="op">,</span> mainView ) {</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// the contents of the mainView file will be</span></span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// loaded into mainView for usage.</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<ol start="4" type="1">
<li>Finally we can use the text resource that’s been loaded for
templating purposes. You’re probably used to storing your HTML templates
inline using a script with a specific identifier.</li>
</ol>
<p>With Underscore.js’s micro-templating (and jQuery) this would
typically be:</p>
<p>HTML:</p>
<div class="sourceCode" id="cb263"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;mainViewTemplate&quot;</span><span class="dt">&gt;</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;%</span> _<span class="op">.</span><span class="fu">each</span>( person<span class="op">,</span> <span class="kw">function</span>( person_item ){ <span class="op">%&gt;</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>li<span class="op">&gt;&lt;%=</span> person_item<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;name&#39;</span>) <span class="op">%&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;%</span> })<span class="op">;</span> <span class="op">%&gt;</span></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>JS:</p>
<div class="sourceCode" id="cb264"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> compiled_template <span class="op">=</span> _<span class="op">.</span><span class="fu">template</span>( <span class="fu">$</span>(<span class="st">&#39;#mainViewTemplate&#39;</span>)<span class="op">.</span><span class="fu">html</span>() )<span class="op">;</span></span></code></pre></div>
<p>With RequireJS and the text plugin however, it’s as simple as saving
the same template into an external text file (say,
<code>mainView.html</code>) and doing the following:</p>
<div class="sourceCode" id="cb265"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>([<span class="st">&#39;js/app&#39;</span><span class="op">,</span> <span class="st">&#39;text!templates/mainView.html&#39;</span>]<span class="op">,</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span>(app<span class="op">,</span> mainView){</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> compiled_template <span class="op">=</span> _<span class="op">.</span><span class="fu">template</span>( mainView )<span class="op">;</span></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p>That’s it! Now you can apply your template to a view in Backbone with
something like:</p>
<div class="sourceCode" id="cb266"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>collection<span class="op">.</span><span class="at">someview</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>( <span class="fu">compiled_template</span>( { <span class="dt">results</span><span class="op">:</span> collection<span class="op">.</span><span class="at">models</span> } ) )<span class="op">;</span></span></code></pre></div>
<p>All templating solutions will have their own custom methods for
handling template compilation, but if you understand the above,
substituting Underscore’s micro-templating for any other solution should
be fairly trivial.</p>
<h3
id="optimizing-backbone-apps-for-production-with-the-requirejs-optimizer">Optimizing
Backbone apps for production with the RequireJS Optimizer</h3>
<p>Once you’re written your application, the next important step is to
prepare it for deployment to production. The majority of non-trivial
apps are likely to consist of several scripts and so optimizing,
minimizing, and concatenating your scripts prior to pushing can reduce
the number of scripts your users need to download.</p>
<p>A command-line optimization tool for RequireJS projects called r.js
is available to help with this workflow. It offers a number of
capabilities, including:</p>
<ul>
<li>Concatenating specific scripts and minifying them using external
tools such as UglifyJS (which is used by default) or Google’s Closure
Compiler for optimal browser delivery, whilst preserving the ability to
dynamically load modules</li>
<li>Optimizing CSS and stylesheets by inlining CSS files imported using
<span class="citation" data-cites="import">@import</span>, stripping out
comments, etc.</li>
<li>The ability to run AMD projects in both Node and Rhino (more on this
later)</li>
</ul>
<p>If you find yourself wanting to ship a single file with all
dependencies included, r.js can help with this too. Whilst RequireJS
does support lazy-loading, your application may be small enough that
reducing HTTP requests to a single script file is feasible.</p>
<p>You’ll notice that I mentioned the word ‘specific’ in the first
bullet point. The RequireJS optimizer only concatenates module scripts
that have been specified as string literals in <code>require</code> and
<code>define</code> calls (which you’ve probably used). As clarified by
the <a href="http://requirejs.org/docs/optimization.html">optimizer
docs</a> this means that Backbone modules defined like this:</p>
<div class="sourceCode" id="cb267"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([<span class="st">&#39;jquery&#39;</span><span class="op">,</span> <span class="st">&#39;backbone&#39;</span><span class="op">,</span> <span class="st">&#39;underscore&#39;</span><span class="op">,</span> <span class="st">&#39;collections/sample&#39;</span><span class="op">,</span> <span class="st">&#39;views/test&#39;</span>]<span class="op">,</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span>($<span class="op">,</span> Backbone<span class="op">,</span> _<span class="op">,</span> Sample<span class="op">,</span> Test){</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">//...</span></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p>will combine fine, however dynamic dependencies such as:</p>
<div class="sourceCode" id="cb268"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> models <span class="op">=</span> someCondition <span class="op">?</span> [<span class="st">&#39;models/ab&#39;</span><span class="op">,</span> <span class="st">&#39;models/ac&#39;</span>] <span class="op">:</span> [<span class="st">&#39;models/ba&#39;</span><span class="op">,</span> <span class="st">&#39;models/bc&#39;</span>]<span class="op">;</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([<span class="st">&#39;jquery&#39;</span><span class="op">,</span> <span class="st">&#39;backbone&#39;</span><span class="op">,</span> <span class="st">&#39;underscore&#39;</span>]<span class="op">.</span><span class="fu">concat</span>(models)<span class="op">,</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span>($<span class="op">,</span> Backbone<span class="op">,</span> _<span class="op">,</span> firstModel<span class="op">,</span> secondModel){</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">//...</span></span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p>will be ignored. This is by design as it ensures that dynamic
dependency/module loading can still take place even after
optimization.</p>
<p>Although the RequireJS optimizer works fine in both Node and Java
environments, it’s strongly recommended to run it under Node as it
executes significantly faster there.</p>
<p>To get started with r.js, grab it from the <a
href="http://requirejs.org/docs/download.html#rjs">RequireJS download
page</a> or <a
href="http://requirejs.org/docs/optimization.html#download">through
NPM</a>. To begin getting our project to build with r.js, we will need
to create a new build profile.</p>
<p>Assuming the code for our application and external dependencies are
in <code>app/libs</code>, our build.js build profile could simply
be:</p>
<pre><code>({
  baseUrl: &#39;app&#39;,
  out: &#39;dist/main.js&#39;,</code></pre>
<p>The paths above are relative to the <code>baseUrl</code> for our
project and in our case it would make sense to make this the
<code>app</code> folder. The <code>out</code> parameter informs r.js
that we want to concatenate everything into a single file called
<code>main.js</code> under the <code>dist/</code> directory. Note that
here we do need to add the <code>.js</code> extension to the filename.
Earlier, we saw that when referencing modules by filenames, you don’t
need to use the <code>.js</code> extension, however this is one case in
which you do.</p>
<p>Alternatively, we can specify <code>dir</code>, which will ensure the
contents of our <code>app</code> directory are copied into this
directory. e.g.:</p>
<pre><code>({
  baseUrl: &#39;app&#39;,
  dir: &#39;release&#39;,
  out: &#39;dist/main.js&#39;</code></pre>
<p>Additional options that can be specified such as <code>modules</code>
and <code>appDir</code> are not compatible with <code>out</code>,
however let’s briefly discuss them in case you do wish to use them.</p>
<p><code>modules</code> is an array where we can explicitly specify the
module names we would like to have optimized.</p>
<pre><code>    modules: [
        {
            name: &#39;app&#39;,
            exclude: [
                // If you prefer not to include certain 
                // libs exclude them here
            ]
        }</code></pre>
<p><code>appDir</code> - when specified, our<code>baseUrl</code> is
relative to this parameter. If <code>appDir</code> is not defined,
<code>baseUrl</code> is simply relative to the <code>build.js</code>
file.</p>
<pre><code>    appDir: &#39;./&#39;,</code></pre>
<p>Back to our build profile, the <code>main</code> parameter is used to
specify our main module - we are making use of <code>include</code> here
as we’re going to take advantage of <a
href="https://github.com/jrburke/almond">Almond</a> - a stripped down
loader for RequireJS modules which is useful should you not need to load
modules in dynamically.</p>
<pre><code>  include: [&#39;libs/almond&#39;, &#39;main&#39;],
  wrap: true,</code></pre>
<p><code>include</code> is another array which specifies the modules we
want to include in the build. By specifying “main”, r.js will trace over
all modules main depends on and will include them. <code>wrap</code>
wraps modules which RequireJS needs into a closure so that only what we
export is included in the global environment.</p>
<pre><code>  paths: {
    backbone: &#39;libs/backbone&#39;,
    underscore: &#39;libs/underscore&#39;,
    jquery: &#39;libs/jquery&#39;,
    text: &#39;libs/text&#39;
  }
})</code></pre>
<p>The remainder of the build.js file would be a regular paths
configuration object. We can compile our project into a target file by
running:</p>
<pre><code>node r.js -o build.js</code></pre>
<p>which should place our compiled project into dist/main.js.</p>
<p>The build profile is usually placed inside the ‘scripts’ or ‘js’
directory of your project. As per the docs, this file can however exist
anywhere you wish, but you’ll need to edit the contents of your build
profile accordingly.</p>
<p>That’s it. As long as you have UglifyJS/Closure tools setup
correctly, r.js should be able to easily optimize your entire Backbone
project in just a few key-strokes.</p>
<p>If you would like to learn more about build profiles, James Burke has
a <a
href="https://github.com/jrburke/r.js/blob/master/build/example.build.js">heavily
commented sample file</a> with all the possible options available.</p>
<h1 id="exercise-3-your-first-modular-backbone-requirejs-app">Exercise
3: Your First Modular Backbone + RequireJS App</h1>
<p>In this chapter, we’ll look at our first practical Backbone &amp;
RequireJS project - how to build a modular Todo application. Similar to
exercise 1, the application will allow us to add new todos, edit new
todos and clear todo items that have been marked as completed. For a
more advanced practical, see the section on mobile Backbone
development.</p>
<p>The complete code for the application can can be found in the
<code>practicals/modular-todo-app</code> folder of this repo (thanks to
Thomas Davis and Jérôme Gravel-Niquet). Alternatively grab a copy of my
side-project <a href="https://github.com/addyosmani/todomvc">TodoMVC</a>
which contains the sources to both AMD and non-AMD versions.</p>
<h3 id="overview">Overview</h3>
<p>Writing a modular Backbone application can be a straight-forward
process. There are however, some key conceptual differences to be aware
of if opting to use AMD as your module format of choice:</p>
<ul>
<li>As AMD isn’t a standard native to JavaScript or the browser, it’s
necessary to use a script loader (such as RequireJS or curl.js) in order
to support defining components and modules using this module format. As
we’ve already reviewed, there are a number of advantages to using the
AMD as well as RequireJS to assist here.</li>
<li>Models, views, controllers and routers need to be encapsulated
<em>using</em> the AMD-format. This allows each component of our
Backbone application to cleanly manage dependencies (e.g. collections
required by a view) in the same way that AMD allows non-Backbone modules
to.</li>
<li>Non-Backbone components/modules (such as utilities or application
helpers) can also be encapsulated using AMD. I encourage you to try
developing these modules in such a way that they can both be used and
tested independent of your Backbone code as this will increase their
ability to be re-used elsewhere.</li>
</ul>
<p>Now that we’ve reviewed the basics, let’s take a look at developing
our application. For reference, the structure of our app is as
follows:</p>
<pre><code>index.html
...js/
    main.js
    .../models
            todo.js
    .../views
            app.js
            todos.js
    .../collections
            todos.js
    .../templates
            stats.html
            todos.html
    ../libs
        .../backbone
        .../jquery
        .../underscore
        .../require
                require.js
                text.js
...css/</code></pre>
<h3 id="markup">Markup</h3>
<p>The markup for the application is relatively simple and consists of
three primary parts: an input section for entering new todo items
(<code>create-todo</code>), a list section to display existing items
(which can also be edited in-place) (<code>todo-list</code>) and finally
a section summarizing how many items are left to be completed
(<code>todo-stats</code>).</p>
<pre><code>&lt;div id=&quot;todoapp&quot;&gt;

      &lt;div class=&quot;content&quot;&gt;

        &lt;div id=&quot;create-todo&quot;&gt;
          &lt;input id=&quot;new-todo&quot; placeholder=&quot;What needs to be done?&quot; type=&quot;text&quot; /&gt;
          &lt;span class=&quot;ui-tooltip-top&quot;&gt;Press Enter to save this task&lt;/span&gt;
        &lt;/div&gt;

        &lt;div id=&quot;todos&quot;&gt;
          &lt;ul id=&quot;todo-list&quot;&gt;&lt;/ul&gt;
        &lt;/div&gt;

        &lt;div id=&quot;todo-stats&quot;&gt;&lt;/div&gt;

      &lt;/div&gt;

&lt;/div&gt;</code></pre>
<p>The rest of the tutorial will now focus on the JavaScript side of the
practical.</p>
<h3 id="configuration-options">Configuration options</h3>
<p>If you’ve read the earlier chapter on AMD, you may have noticed that
explicitly needing to define each dependency a Backbone module (view,
collection or other module) may require with it can get a little
tedious. This can however be improved.</p>
<p>In order to simplify referencing common paths the modules in our
application may use, we use a RequireJS <a
href="http://requirejs.org/docs/api.html#config">configuration
object</a>, which is typically defined as a top-level script file.
Configuration objects have a number of useful capabilities, the most
useful being mode name-mapping. Name-maps are basically a key:value
pair, where the key defines the alias you wish to use for a path and the
value represents the true location of the path.</p>
<p>In the code-sample below, you can see some typical examples of common
name-maps which include: <code>backbone</code>, <code>underscore</code>,
<code>jquery</code> and depending on your choice, the RequireJS
<code>text</code> plugin, which assists with loading text assets like
templates.</p>
<p><strong>main.js</strong></p>
<div class="sourceCode" id="cb278"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span><span class="fu">config</span>({</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">baseUrl</span><span class="op">:</span><span class="st">&#39;../&#39;</span><span class="op">,</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">paths</span><span class="op">:</span> {</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">jquery</span><span class="op">:</span> <span class="st">&#39;libs/jquery/jquery-min&#39;</span><span class="op">,</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">underscore</span><span class="op">:</span> <span class="st">&#39;libs/underscore/underscore-min&#39;</span><span class="op">,</span></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">backbone</span><span class="op">:</span> <span class="st">&#39;libs/backbone/backbone-optamd3-min&#39;</span><span class="op">,</span></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;libs/require/text&#39;</span></span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>([<span class="st">&#39;views/app&#39;</span>]<span class="op">,</span> <span class="kw">function</span>(AppView){</span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app_view <span class="op">=</span> <span class="kw">new</span> AppView<span class="op">;</span></span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The <code>require()</code> at the end of our main.js file is simply
there so we can load and instantiate the primary view for our
application (<code>views/app.js</code>). You’ll commonly see both this
and the configuration object included in most top-level script files for
a project.</p>
<p>In addition to offering name-mapping, the configuration object can be
used to define additional properties such as <code>waitSeconds</code> -
the number of seconds to wait before script loading times out and
<code>locale</code>, should you wish to load up i18n bundles for custom
languages. The <code>baseUrl</code> is simply the path to use for module
lookups.</p>
<p>For more information on configuration objects, please feel free to
check out the excellent guide to them in the <a
href="http://requirejs.org/docs/api.html#config">RequireJS docs</a>.</p>
<h3 id="modularizing-our-models-views-and-collections">Modularizing our
models, views and collections</h3>
<p>Before we dive into AMD-wrapped versions of our Backbone components,
let’s review a sample of a non-AMD view. The following view listens for
changes to its model (a Todo item) and re-renders if a user edits the
value of the item.</p>
<div class="sourceCode" id="cb279"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//... is a list tag.</span></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tagName</span><span class="op">:</span>  <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cache the template function for a single item.</span></span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>(<span class="fu">$</span>(<span class="st">&#39;#item-template&#39;</span>)<span class="op">.</span><span class="fu">html</span>())<span class="op">,</span></span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The DOM events specific to an item.</span></span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;click .check&#39;</span>              <span class="op">:</span> <span class="st">&#39;toggleDone&#39;</span><span class="op">,</span></span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;dblclick div.todo-content&#39;</span> <span class="op">:</span> <span class="st">&#39;edit&#39;</span><span class="op">,</span></span>
<span id="cb279-13"><a href="#cb279-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;click span.todo-destroy&#39;</span>   <span class="op">:</span> <span class="st">&#39;clear&#39;</span><span class="op">,</span></span>
<span id="cb279-14"><a href="#cb279-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;keypress .todo-input&#39;</span>      <span class="op">:</span> <span class="st">&#39;updateOnEnter&#39;</span></span>
<span id="cb279-15"><a href="#cb279-15" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb279-16"><a href="#cb279-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-17"><a href="#cb279-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The TodoView listens for changes to its model, re-rendering. Since there&#39;s</span></span>
<span id="cb279-18"><a href="#cb279-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a one-to-one correspondence between a **Todo** and a **TodoView** in this</span></span>
<span id="cb279-19"><a href="#cb279-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// app, we set a direct reference on the model for convenience.</span></span>
<span id="cb279-20"><a href="#cb279-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb279-21"><a href="#cb279-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb279-22"><a href="#cb279-22" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">view</span> <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb279-23"><a href="#cb279-23" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb279-24"><a href="#cb279-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>Note how for templating the common practice of referencing a script
by an ID (or other selector) and obtaining its value is used. This of
course requires that the template being accessed is implicitly defined
in our markup. The following is the ‘embedded’ version of our template
being referenced above:</p>
<pre><code>&lt;script type=&quot;text/template&quot; id=&quot;item-template&quot;&gt;
      &lt;div class=&quot;todo &lt;%= done ? &#39;done&#39; : &#39;&#39; %&gt;&quot;&gt;
        &lt;div class=&quot;display&quot;&gt;
          &lt;input class=&quot;check&quot; type=&quot;checkbox&quot; &lt;%= done ? &#39;checked=&quot;checked&quot;&#39; : &#39;&#39; %&gt; /&gt;
          &lt;div class=&quot;todo-content&quot;&gt;&lt;/div&gt;
          &lt;span class=&quot;todo-destroy&quot;&gt;&lt;/span&gt;
        &lt;/div&gt;
        &lt;div class=&quot;edit&quot;&gt;
          &lt;input class=&quot;todo-input&quot; type=&quot;text&quot; value=&quot;&quot; /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
&lt;/script&gt;</code></pre>
<p>Whilst there is nothing wrong with the template itself, once we begin
to develop larger applications requiring multiple templates, including
them all in our markup on page-load can quickly become both unmanageable
and come with performance costs. We’ll look at solving this problem in a
minute.</p>
<p>Let’s now take a look at the AMD-version of our view. As discussed
earlier, the ‘module’ is wrapped using AMD’s <code>define()</code> which
allows us to specify the dependencies our view requires. Using the
mapped paths to ‘jquery’ etc. simplifies referencing common dependencies
and instances of dependencies are themselves mapped to local variables
that we can access (e.g. ‘jquery’ is mapped to <code>$</code>).</p>
<p><strong>views/todo.js</strong></p>
<div class="sourceCode" id="cb281"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;jquery&#39;</span><span class="op">,</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;underscore&#39;</span><span class="op">,</span></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;backbone&#39;</span><span class="op">,</span></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;text!templates/todos.html&#39;</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span> <span class="kw">function</span>($<span class="op">,</span> _<span class="op">,</span> Backbone<span class="op">,</span> todosTemplate){</span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> TodoView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb281-8"><a href="#cb281-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-9"><a href="#cb281-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//... is a list tag.</span></span>
<span id="cb281-10"><a href="#cb281-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tagName</span><span class="op">:</span>  <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb281-11"><a href="#cb281-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-12"><a href="#cb281-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cache the template function for a single item.</span></span>
<span id="cb281-13"><a href="#cb281-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>(todosTemplate)<span class="op">,</span></span>
<span id="cb281-14"><a href="#cb281-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-15"><a href="#cb281-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The DOM events specific to an item.</span></span>
<span id="cb281-16"><a href="#cb281-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb281-17"><a href="#cb281-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;click .check&#39;</span>              <span class="op">:</span> <span class="st">&#39;toggleDone&#39;</span><span class="op">,</span></span>
<span id="cb281-18"><a href="#cb281-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;dblclick div.todo-content&#39;</span> <span class="op">:</span> <span class="st">&#39;edit&#39;</span><span class="op">,</span></span>
<span id="cb281-19"><a href="#cb281-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;click span.todo-destroy&#39;</span>   <span class="op">:</span> <span class="st">&#39;clear&#39;</span><span class="op">,</span></span>
<span id="cb281-20"><a href="#cb281-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;keypress .todo-input&#39;</span>      <span class="op">:</span> <span class="st">&#39;updateOnEnter&#39;</span></span>
<span id="cb281-21"><a href="#cb281-21" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb281-22"><a href="#cb281-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-23"><a href="#cb281-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The TodoView listens for changes to its model, re-rendering. Since there&#39;s</span></span>
<span id="cb281-24"><a href="#cb281-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a one-to-one correspondence between a **Todo** and a **TodoView** in this</span></span>
<span id="cb281-25"><a href="#cb281-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// app, we set a direct reference on the model for convenience.</span></span>
<span id="cb281-26"><a href="#cb281-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb281-27"><a href="#cb281-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span>)<span class="op">;</span></span>
<span id="cb281-28"><a href="#cb281-28" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">view</span> <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb281-29"><a href="#cb281-29" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb281-30"><a href="#cb281-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-31"><a href="#cb281-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Re-render the contents of the todo item.</span></span>
<span id="cb281-32"><a href="#cb281-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb281-33"><a href="#cb281-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">template</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span>))<span class="op">;</span></span>
<span id="cb281-34"><a href="#cb281-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">setContent</span>()<span class="op">;</span></span>
<span id="cb281-35"><a href="#cb281-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb281-36"><a href="#cb281-36" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb281-37"><a href="#cb281-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-38"><a href="#cb281-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use `jQuery.text` to set the contents of the todo item.</span></span>
<span id="cb281-39"><a href="#cb281-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">setContent</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb281-40"><a href="#cb281-40" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> content <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;content&#39;</span>)<span class="op">;</span></span>
<span id="cb281-41"><a href="#cb281-41" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.todo-content&#39;</span>)<span class="op">.</span><span class="fu">text</span>(content)<span class="op">;</span></span>
<span id="cb281-42"><a href="#cb281-42" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">input</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.todo-input&#39;</span>)<span class="op">;</span></span>
<span id="cb281-43"><a href="#cb281-43" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;blur&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">close</span>)<span class="op">;</span></span>
<span id="cb281-44"><a href="#cb281-44" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">val</span>(content)<span class="op">;</span></span>
<span id="cb281-45"><a href="#cb281-45" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb281-46"><a href="#cb281-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>From a maintenance perspective, there’s nothing logically different
in this version of our view, except for how we approach templating.</p>
<p>Using the RequireJS text plugin (the dependency marked
<code>text</code>), we can actually store all of the contents for the
template we looked at earlier in an external file (todos.html).</p>
<p><strong>templates/todos.html</strong></p>
<div class="sourceCode" id="cb282"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;todo </span><span class="er">&lt;</span><span class="st">%= done ? &#39;done&#39; : &#39;&#39; %&gt;&quot;</span><span class="dt">&gt;</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;display&quot;</span><span class="dt">&gt;</span></span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;check&quot;</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;checkbox&quot;</span><span class="ot"> </span><span class="er">&lt;%</span><span class="op">=</span> <span class="st">done</span><span class="ot"> </span><span class="er">?</span><span class="ot"> </span><span class="er">&#39;</span><span class="ot">checked</span><span class="op">=</span><span class="st">&quot;checked&quot;</span><span class="er">&#39;</span><span class="ot"> : </span><span class="er">&#39;&#39;</span><span class="ot"> </span><span class="er">%</span><span class="dt">&gt;</span> /&gt;</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;todo-content&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;todo-destroy&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;edit&quot;</span><span class="dt">&gt;</span></span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;todo-input&quot;</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> value</span><span class="op">=</span><span class="st">&quot;&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb282-10"><a href="#cb282-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>There’s no longer a need to be concerned with IDs for the template as
we can map its contents to a local variable (in this case
<code>todosTemplate</code>). We then simply pass this to the
Underscore.js templating function <code>_.template()</code> the same way
we normally would have the value of our template script.</p>
<p>Next, let’s look at how to define models as dependencies which can be
pulled into collections. Here’s an AMD-compatible model module, which
has two default values: a <code>content</code> attribute for the content
of a Todo item and a boolean <code>done</code> state, allowing us to
trigger whether the item has been completed or not.</p>
<p><strong>models/todo.js</strong></p>
<div class="sourceCode" id="cb283"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([<span class="st">&#39;underscore&#39;</span><span class="op">,</span> <span class="st">&#39;backbone&#39;</span>]<span class="op">,</span> <span class="kw">function</span>(_<span class="op">,</span> Backbone) {</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> TodoModel <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Default attributes for the todo.</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Ensure that each todo created has `content`.</span></span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">content</span><span class="op">:</span> <span class="st">&#39;empty todo...&#39;</span><span class="op">,</span></span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">done</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb283-9"><a href="#cb283-9" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb283-10"><a href="#cb283-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-11"><a href="#cb283-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb283-12"><a href="#cb283-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb283-13"><a href="#cb283-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-14"><a href="#cb283-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Toggle the `done` state of this todo item.</span></span>
<span id="cb283-15"><a href="#cb283-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">toggle</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb283-16"><a href="#cb283-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">save</span>({<span class="dt">done</span><span class="op">:</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;done&#39;</span>)})<span class="op">;</span></span>
<span id="cb283-17"><a href="#cb283-17" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb283-18"><a href="#cb283-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-19"><a href="#cb283-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove this Todo from *localStorage* and delete its view.</span></span>
<span id="cb283-20"><a href="#cb283-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clear</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb283-21"><a href="#cb283-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">destroy</span>()<span class="op">;</span></span>
<span id="cb283-22"><a href="#cb283-22" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb283-23"><a href="#cb283-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb283-24"><a href="#cb283-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-25"><a href="#cb283-25" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb283-26"><a href="#cb283-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> TodoModel<span class="op">;</span></span>
<span id="cb283-27"><a href="#cb283-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>As per other types of dependencies, we can easily map our model
module to a local variable (in this case <code>Todo</code>) so it can be
referenced as the model to use for our <code>TodosCollection</code>.
This collection also supports a simple <code>done()</code> filter for
narrowing down Todo items that have been completed and a
<code>remaining()</code> filter for those that are still
outstanding.</p>
<p><strong>collections/todos.js</strong></p>
<div class="sourceCode" id="cb284"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;underscore&#39;</span><span class="op">,</span></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;backbone&#39;</span><span class="op">,</span></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;libs/backbone/localstorage&#39;</span><span class="op">,</span></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;models/todo&#39;</span></span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span> <span class="kw">function</span>(_<span class="op">,</span> Backbone<span class="op">,</span> Store<span class="op">,</span> Todo){</span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> TodosCollection <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reference to this collection&#39;s model.</span></span>
<span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> Todo<span class="op">,</span></span>
<span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Save all of the todo items under the `todos` namespace.</span></span>
<span id="cb284-14"><a href="#cb284-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">localStorage</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Store</span>(<span class="st">&#39;todos&#39;</span>)<span class="op">,</span></span>
<span id="cb284-15"><a href="#cb284-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-16"><a href="#cb284-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Filter down the list of all todo items that are finished.</span></span>
<span id="cb284-17"><a href="#cb284-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">done</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb284-18"><a href="#cb284-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span>(todo){ <span class="cf">return</span> todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;done&#39;</span>)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb284-19"><a href="#cb284-19" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb284-20"><a href="#cb284-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-21"><a href="#cb284-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Filter down the list to only todo items that are still not finished.</span></span>
<span id="cb284-22"><a href="#cb284-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">remaining</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb284-23"><a href="#cb284-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">without</span><span class="op">.</span><span class="fu">apply</span>(<span class="kw">this</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">done</span>())<span class="op">;</span></span>
<span id="cb284-24"><a href="#cb284-24" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb284-25"><a href="#cb284-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>In addition to allowing users to add new Todo items from views (which
we then insert as models in a collection), we ideally also want to be
able to display how many items have been completed and how many are
remaining. We’ve already defined filters that can provide us this
information in the above collection, so let’s use them in our main
application view.</p>
<p><strong>views/app.js</strong></p>
<div class="sourceCode" id="cb285"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;jquery&#39;</span><span class="op">,</span></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;underscore&#39;</span><span class="op">,</span></span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;backbone&#39;</span><span class="op">,</span></span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;collections/todos&#39;</span><span class="op">,</span></span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;views/todo&#39;</span><span class="op">,</span></span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;text!templates/stats.html&#39;</span></span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span> <span class="kw">function</span>($<span class="op">,</span> _<span class="op">,</span> Backbone<span class="op">,</span> Todos<span class="op">,</span> TodoView<span class="op">,</span> statsTemplate){</span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> AppView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-12"><a href="#cb285-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Instead of generating a new element, bind to the existing skeleton of</span></span>
<span id="cb285-13"><a href="#cb285-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// the App already present in the HTML.</span></span>
<span id="cb285-14"><a href="#cb285-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">el</span><span class="op">:</span> <span class="fu">$</span>(<span class="st">&#39;#todoapp&#39;</span>)<span class="op">,</span></span>
<span id="cb285-15"><a href="#cb285-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-16"><a href="#cb285-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our template for the line of statistics at the bottom of the app.</span></span>
<span id="cb285-17"><a href="#cb285-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">statsTemplate</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>(statsTemplate)<span class="op">,</span></span>
<span id="cb285-18"><a href="#cb285-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-19"><a href="#cb285-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...events, initialize() etc. can be seen in the complete file</span></span>
<span id="cb285-20"><a href="#cb285-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-21"><a href="#cb285-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Re-rendering the App just means refreshing the statistics -- the rest</span></span>
<span id="cb285-22"><a href="#cb285-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// of the app doesn&#39;t change.</span></span>
<span id="cb285-23"><a href="#cb285-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb285-24"><a href="#cb285-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> done <span class="op">=</span> Todos<span class="op">.</span><span class="fu">done</span>()<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb285-25"><a href="#cb285-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;#todo-stats&#39;</span>)<span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">statsTemplate</span>({</span>
<span id="cb285-26"><a href="#cb285-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">total</span><span class="op">:</span>      Todos<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb285-27"><a href="#cb285-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">done</span><span class="op">:</span>       Todos<span class="op">.</span><span class="fu">done</span>()<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb285-28"><a href="#cb285-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">remaining</span><span class="op">:</span>  Todos<span class="op">.</span><span class="fu">remaining</span>()<span class="op">.</span><span class="at">length</span></span>
<span id="cb285-29"><a href="#cb285-29" aria-hidden="true" tabindex="-1"></a>      }))<span class="op">;</span></span>
<span id="cb285-30"><a href="#cb285-30" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb285-31"><a href="#cb285-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>Above, we map the second template for this project,
<code>templates/stats.html</code> to <code>statsTemplate</code> which is
used for rendering the overall <code>done</code> and
<code>remaining</code> states. This works by simply passing our template
the length of our overall Todos collection (<code>Todos.length</code> -
the number of Todo items created so far) and similarly the length
(counts) for items that have been completed
(<code>Todos.done().length</code>) or are remaining
(<code>Todos.remaining().length</code>).</p>
<p>The contents of our <code>statsTemplate</code> can be seen below.
It’s nothing too complicated, but does use ternary conditions to
evaluate whether we should state there’s “1 item” or “2 item<i>s</i>” in
a particular state.</p>
<pre><code>&lt;% if (total) { %&gt;
        &lt;span class=&quot;todo-count&quot;&gt;
          &lt;span class=&quot;number&quot;&gt;&lt;%= remaining %&gt;&lt;/span&gt;
          &lt;span class=&quot;word&quot;&gt;&lt;%= remaining == 1 ? &#39;item&#39; : &#39;items&#39; %&gt;&lt;/span&gt; left.
        &lt;/span&gt;
      &lt;% } %&gt;
      &lt;% if (done) { %&gt;
        &lt;span class=&quot;todo-clear&quot;&gt;
          &lt;a href=&quot;#&quot;&gt;
            Clear &lt;span class=&quot;number-done&quot;&gt;&lt;%= done %&gt;&lt;/span&gt;
            completed &lt;span class=&quot;word-done&quot;&gt;&lt;%= done == 1 ? &#39;item&#39; : &#39;items&#39; %&gt;&lt;/span&gt;
          &lt;/a&gt;
        &lt;/span&gt;
      &lt;% } %&gt;</code></pre>
<p>The rest of the source for the Todo app mainly consists of code for
handling user and application events, but that rounds up most of the
core concepts for this practical.</p>
<p>To see how everything ties together, feel free to grab the source by
cloning this repo or browse it <a
href="https://github.com/addyosmani/backbone-fundamentals/tree/master/practicals/modular-todo-app">online</a>
to learn more. I hope you find it helpful!</p>
<p><strong>Note:</strong> While this first practical doesn’t use a build
profile as outlined in the chapter on using the RequireJS optimizer, we
will be using one in the section on building mobile Backbone
applications.</p>
<h2 id="route-based-module-loading">Route-based module loading</h2>
<p>This section will discuss a route based approach to module loading as
implemented in <a href="http://walmartlabs.github.com/lumbar">Lumbar</a>
by Kevin Decker. Like RequireJS, Lumbar is also a modular build system,
but the pattern it implements for loading routes may be used with any
build system.</p>
<p>The specifics of the Lumbar build tool are not discussed in this
book. To see a complete Lumbar based project with the loader and build
system see <a href="http://thoraxjs.org">Thorax</a> which provides
boilerplate projects for various environments including Lumbar.</p>
<h3 id="json-based-module-configuration">JSON-based module
configuration</h3>
<p>RequireJS defines dependencies per file, while Lumbar defines a list
of files for each module in a central JSON configuration file,
outputting a single JavaScript file for each defined module. Lumbar
requires that each module (except the base module) define a single
router and a list of routes. An example file might look like:</p>
<pre><code> {
    &quot;modules&quot;: {
        &quot;base&quot;: {
            &quot;scripts&quot;: [
                &quot;js/lib/underscore.js&quot;,
                &quot;js/lib/backbone.js&quot;,
                &quot;etc&quot;
            ]
        },
        &quot;pages&quot;: {
            &quot;scripts&quot;: [
                &quot;js/routers/pages.js&quot;,
                &quot;js/views/pages/index.js&quot;,
                &quot;etc&quot;
            ],
            &quot;routes&quot;: {
                &quot;&quot;: &quot;index&quot;,
                &quot;contact&quot;: &quot;contact&quot;
            }
        }
    }
}</code></pre>
<p>Every JavaScript file defined in a module will have a
<code>module</code> object in scope which contains the <code>name</code>
and <code>routes</code> for the module. In
<code>js/routers/pages.js</code> we could define a Backbone router for
our <code>pages</code> module like so:</p>
<pre><code>new (Backbone.Router.extend({
    routes: module.routes,
    index: function() {},
    contact: function() {}
}));</code></pre>
<h3 id="module-loader-router">Module loader Router</h3>
<p>A little used feature of <code>Backbone.Router</code> is its ability
to create multiple routers that listen to the same set of routes. Lumbar
uses this feature to create a router that listens to all routes in the
application. When a route is matched, this master router checks to see
if the needed module is loaded. If the module is already loaded, then
the master router takes no action and the router defined by the module
will handle the route. If the needed module has not yet been loaded, it
will be loaded, then <code>Backbone.history.loadUrl</code> will be
called. This reloads the route, causes the master router to take no
further action and the router defined in the freshly loaded module to
respond.</p>
<p>A sample implementation is provided below. The <code>config</code>
object would need to contain the data from our sample configuration JSON
file above, and the <code>loader</code> object would need to implement
<code>isLoaded</code> and <code>loadModule</code> methods. Note that
Lumbar provides all of these implementations, the examples are provided
to create your own implementation.</p>
<pre><code>// Create an object that will be used as the prototype
// for our master router
var handlers = {
    routes: {}
};

_.each(config.modules, function(module, moduleName) {
    if (module.routes) {
        // Generate a loading callback for the module
        var callbackName = &quot;loader_&quot; moduleName;
        handlers[callbackName] = function() {
            if (loader.isLoaded(moduleName)) {
                // Do nothing if the module is loaded
                return;
            } else {
                //the module needs to be loaded
                loader.loadModule(moduleName, function() {
                    // Module is loaded, reloading the route
                    // will trigger callback in the module&#39;s
                    // router
                    Backbone.history.loadUrl();
                });
            }
        };
        // Each route in the module should trigger the
        // loading callback
        _.each(module.routes, function(methodName, route) {
            handlers.routes[route] = callbackName;
        });
    }
});

// Create the master router
new (Backbone.Router.extend(handlers));</code></pre>
<h3 id="using-nodejs-to-handle-pushstate">Using NodeJS to handle
pushState</h3>
<p><code>window.history.pushState</code> support (serving Backbone
routes without a hash mark) requires that the server be aware of what
URLs your Backbone application will handle, since the user should be
able to enter the app at any of those routes (or hit reload after
navigating to a pushState URL).</p>
<p>Another advantage to defining all routes in a single location is that
the same JSON configuration file provided above could be loaded by the
server, listening to each route. A sample implementation in NodeJS and
Express:</p>
<pre><code>var fs = require(&#39;fs&#39;),
    _ = require(&#39;underscore&#39;),
    express = require(&#39;express&#39;),
    server = express(),
    config = JSON.parse(fs.readFileSync(&#39;path/to/config.json&#39;));

_.each(config.modules, function(module, moduleName) {
    if (module.routes) {
        _.each(module.routes, function(methodName, route) {
            server.get(route, function(req, res) {
                  res.sendFile(&#39;public/index.html&#39;);
            });
        });
    }
});</code></pre>
<p>This assumes that index.html will be serving out your Backbone
application. The <code>Backbone.History</code> object can handle the
rest of the routing logic as long as a <code>root</code> option is
specified. A sample configuration for a simple application that lives at
the root might look like:</p>
<pre><code>Backbone.history || (Backbone.history = new Backbone.History());
Backbone.history.start({
  pushState: true,
  root: &#39;/&#39;
});</code></pre>
<h2 id="an-asset-package-alternative-for-dependency-management">An asset
package alternative for dependency management</h2>
<p>For more than trivial views, DocumentCloud have a home-built asset
packager called <a
href="https://github.com/documentcloud/jammit">Jammit</a>, which has
easy integration with Underscore.js templates and can also be used for
dependency management.</p>
<p>Jammit expects your JavaScript templates (JST) to live alongside any
ERB templates you’re using in the form of .jst files. It packages the
templates into a global JST object which can be used to render templates
into strings. Making Jammit aware of your templates is straight-forward
- just add an entry for something like <code>views/**/*.jst</code> to
your app package in assets.yml.</p>
<p>To provide Jammit dependencies you simply write out an assets.yml
file that either listed the dependencies in order or used a combination
of free capture directories (for example: <code>/**/*.js</code>,
<code>templates/*.js</code>, and specific files).</p>
<p>A template using Jammit can derive it’s data from the collection
object that is passed to it:</p>
<pre><code>this.$el.html(JST.myTemplate({ collection: this.collection }));</code></pre>
<h1 id="paginating-backbone.js-requests-collections">Paginating
Backbone.js Requests &amp; Collections</h1>
<h2 id="introduction-2">Introduction</h2>
<p>Pagination is a ubiquitous problem we often find ourselves needing to
solve on the web - perhaps most predominantly when working with service
APIs and JavaScript-heavy clients which consume them. It’s also a
problem that is often under-refined as most of us consider pagination
relatively easy to get right. This isn’t however always the case as
pagination tends to get more tricky than it initially seems.</p>
<p>Before we dive into solutions for paginating data for your Backbone
applications, let’s define exactly what we consider pagination to
be:</p>
<p>Pagination is a control system allowing users to browse through pages
of search results (or any type of content) which is continued. Search
results are the canonical example, but pagination today is found on news
sites, blogs, and discussion boards, often in the form of Previous and
Next links. More complete pagination systems offer granular control of
the specific pages you can navigate to, giving the user more power to
find what they are looking for.</p>
<p>It isn’t a problem limited to pages requiring some visual controls
for pagination either - sites like Facebook, Pinterest, and Twitter have
demonstrated that there are many contexts where infinite paging is also
useful. Infinite paging is, of course, when we pre-fetch (or appear to
pre-fetch) content from a subsequent page and add it directly to the
user’s current page, making the experience feel “infinite”.</p>
<p>Pagination is very context-specific and depends on the content being
displayed. In the Google search results, pagination is important as they
want to offer you the most relevant set of results in the first 1-2
pages. After that, you might be a little more selective (or random) with
the page you choose to navigate to. This differs from cases where you’ll
want to cycle through consecutive pages for (e.g., for a news article or
blog post).</p>
<p>Pagination is almost certainly content and context-specific, but as
Faruk Ates has <a
href="https://gist.github.com/mislav/622561">previously</a> pointed out
the principles of good pagination apply no matter what the content or
context is. As with everything extensible when it comes to Backbone, you
can write your own pagination to address many of these content-specific
types of pagination problems. That said, you’ll probably spend quite a
bit of time on this and sometimes you just want to use a tried and
tested solution that just works.</p>
<p>On this topic, we’re going to go through a set of pagination
components I (and a group of <a
href="https://github.com/addyosmani/backbone.paginator/contributors">contributors</a>)
wrote for Backbone.js, which should hopefully come in useful if you’re
working on applications which need to page Backbone Collections. They’re
part of an extension called <a
href="http://github.com/addyosmani/backbone.paginator">Backbone.Paginator</a>.</p>
<h3 id="backbone.paginator">Backbone.Paginator</h3>
<p><strong>Note:</strong> As of Backbone.Paginator <a
href="https://github.com/backbone-paginator/backbone.paginator/releases">2.0</a>,
the API to the project has changed and includes updates which break
backwards compatibility. The below section refers to Backbone.Paginator
1.0 which can still be downloaded <a
href="https://github.com/backbone-paginator/backbone.paginator/releases/tag/v1.0.0">here</a>.</p>
<p>When working with data on the client-side, the three types of
pagination we are most likely to run into are:</p>
<p><strong>Requests to a service layer (API)</strong> - For example,
query for results containing the term ‘Paul’ - if 5,000 results are
available only display 20 results per page (leaving us with 250 possible
result pages that can be navigated to).</p>
<p>This problem actually has quite a great deal more to it, such as
maintaining persistence of other URL parameters (e.g. sort, query,
order) which can change based on a user’s search configuration in a UI.
One also has to think of a clean way of hooking views up to this
pagination so you can easily navigate between pages (e.g., First, Last,
Next, Previous, 1,2,3), manage the number of results displayed per page
and so on.</p>
<p><strong>Further client-side pagination of data returned -</strong>
e.g. we’ve been returned a JSON response containing 100 results. Rather
than displaying all 100 to the user, we only display 20 of these results
within a navigable UI in the browser.</p>
<p>Similar to the request problem, client-pagination has its own
challenges like navigation once again (Next, Previous, 1,2,3), sorting,
order, switching the number of results to display per page and so
on.</p>
<p><strong>Infinite results</strong> - with services such as Facebook,
the concept of numeric pagination is instead replaced with a ‘Load More’
or ‘View More’ button. Triggering this normally fetches the next ‘page’
of N results but rather than replacing the previous set of results
loaded entirely, we simply append to them instead.</p>
<p>A request pager which simply appends results in a view rather than
replacing on each new fetch is effectively an ‘infinite’ pager.</p>
<p><strong>Let’s now take a look at exactly what we’re getting out of
the box:</strong></p>
<p>Backbone.Paginator is a set of opinionated components for paginating
collections of data using Backbone.js. It aims to provide both solutions
for assisting with pagination of requests to a server (e.g. an API) as
well as pagination of single-loads of data, where we may wish to further
paginate a collection of N results into M pages within a view.</p>
<p><img src="img/paginator-ui.png" /></p>
<p>Backbone.Paginator supports two main pagination components:</p>
<ul>
<li><strong>Backbone.Paginator.requestPager</strong>: For pagination of
requests between a client and a server-side API</li>
<li><strong>Backbone.Paginator.clientPager</strong>: For pagination of
data returned from a server which you would like to further paginate
within the UI (e.g. 60 results are returned, paginate into 3 pages of
20)</li>
</ul>
<h3 id="live-examples">Live Examples</h3>
<p>If you would like to look at examples built using the components
included in the project, links to official demos are included below and
use the Netflix API so that you can see them working with an actual data
source.</p>
<ul>
<li><a
href="http://addyosmani.github.com/backbone.paginator/examples/netflix-request-paging/index.html">Backbone.Paginator.requestPager()</a></li>
<li><a
href="http://addyosmani.github.com/backbone.paginator/examples/netflix-client-paging/index.html">Backbone.Paginator.clientPager()</a></li>
<li><a
href="http://addyosmani.github.com/backbone.paginator/examples/netflix-infinite-paging/index.html">Infinite
Pagination (Backbone.Paginator.requestPager())</a></li>
<li><a
href="http://addyosmani.github.com/backbone.paginator/examples/google-diacritic/index.html">Diacritic
Plugin</a></li>
</ul>
<p>##Paginator.requestPager</p>
<p>In this section we’re going to walk through using the requestPager.
You would use this component when working with a service API which
itself supports pagination. This component allows users to control the
pagination settings for requests to this API (i.e. navigate to the next,
previous, N pages) via the client-side.</p>
<p>The idea is that pagination, searching, and filtering of data can all
be done from your Backbone application without the need for a page
reload.</p>
<p><img src="img/paginator-request.png" /></p>
<p>####1. Create a new Paginated collection</p>
<p>First, we define a new Paginated collection using
<code>Backbone.Paginator.requestPager()</code> as follows:</p>
<div class="sourceCode" id="cb293"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> PaginatedCollection <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Paginator</span><span class="op">.</span><span class="at">requestPager</span><span class="op">.</span><span class="fu">extend</span>({</span></code></pre></div>
<p>####2. Set the model for the collection as normal</p>
<p>Within our collection, we then (as normal) specify the model to be
used with this collection followed by the URL (or base URL) for the
service providing our data (e.g. the Netflix API).</p>
<div class="sourceCode" id="cb294"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>        model<span class="op">:</span> model<span class="op">,</span></span></code></pre></div>
<p>####3. Configure the base URL and the type of the request</p>
<p>We need to set a base URL. The <code>type</code> of the request is
<code>GET</code> by default, and the <code>dataType</code> is
<code>jsonp</code> in order to enable cross-domain requests.</p>
<div class="sourceCode" id="cb295"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>    paginator_core<span class="op">:</span> {</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the type of the request (GET by default)</span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;GET&#39;</span><span class="op">,</span></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the type of reply (jsonp by default)</span></span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataType</span><span class="op">:</span> <span class="st">&#39;jsonp&#39;</span><span class="op">,</span></span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-8"><a href="#cb295-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the URL (or base URL) for the service</span></span>
<span id="cb295-9"><a href="#cb295-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// if you want to have a more dynamic URL, you can make this a function</span></span>
<span id="cb295-10"><a href="#cb295-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// that returns a string</span></span>
<span id="cb295-11"><a href="#cb295-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;http://odata.netflix.com/Catalog/People(49446)/TitlesActedIn?&#39;</span></span>
<span id="cb295-12"><a href="#cb295-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span></code></pre></div>
<h2 id="gotchas">Gotchas!</h2>
<p>If you use <code>dataType</code> <strong>NOT</strong> jsonp, please
remove the callback custom parameter inside the <code>server_api</code>
configuration.</p>
<p>####4. Configure how the library will show the results</p>
<p>We need to tell the library how many items per page we would like to
see, etc…</p>
<div class="sourceCode" id="cb296"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>    paginator_ui<span class="op">:</span> {</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the lowest page index your API allows to be accessed</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">firstPage</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// which page should the paginator start from</span></span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">// (also, the actual page the paginator is on)</span></span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">currentPage</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-9"><a href="#cb296-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// how many items per page should be shown</span></span>
<span id="cb296-10"><a href="#cb296-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">perPage</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb296-11"><a href="#cb296-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-12"><a href="#cb296-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// a default number of total pages to query in case the API or</span></span>
<span id="cb296-13"><a href="#cb296-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// service you are using does not support providing the total</span></span>
<span id="cb296-14"><a href="#cb296-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// number of pages for us.</span></span>
<span id="cb296-15"><a href="#cb296-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 10 as a default in case your service doesn&#39;t return the total</span></span>
<span id="cb296-16"><a href="#cb296-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalPages</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb296-17"><a href="#cb296-17" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span></code></pre></div>
<p>####5. Configure the parameters we want to send to the server</p>
<p>Only the base URL won’t be enough for most cases, so you can pass
more parameters to the server. Note how you can use functions instead of
hardcoded values, and you can also refer to the values you specified in
<code>paginator_ui</code>.</p>
<div class="sourceCode" id="cb297"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>    server_api<span class="op">:</span> {</span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the query field in the request</span></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$filter&#39;</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// number of items to return per request/page</span></span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$top&#39;</span><span class="op">:</span> <span class="kw">function</span>() { <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">perPage</span> }<span class="op">,</span></span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-8"><a href="#cb297-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// how many results the request should skip ahead to</span></span>
<span id="cb297-9"><a href="#cb297-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// customize as needed. For the Netflix API, skipping ahead based on</span></span>
<span id="cb297-10"><a href="#cb297-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// page * number of results per page was necessary.</span></span>
<span id="cb297-11"><a href="#cb297-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$skip&#39;</span><span class="op">:</span> <span class="kw">function</span>() { <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">currentPage</span> <span class="op">*</span> <span class="kw">this</span><span class="op">.</span><span class="at">perPage</span> }<span class="op">,</span></span>
<span id="cb297-12"><a href="#cb297-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-13"><a href="#cb297-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// field to sort by</span></span>
<span id="cb297-14"><a href="#cb297-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$orderby&#39;</span><span class="op">:</span> <span class="st">&#39;ReleaseYear&#39;</span><span class="op">,</span></span>
<span id="cb297-15"><a href="#cb297-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-16"><a href="#cb297-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">// what format would you like to request results in?</span></span>
<span id="cb297-17"><a href="#cb297-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$format&#39;</span><span class="op">:</span> <span class="st">&#39;json&#39;</span><span class="op">,</span></span>
<span id="cb297-18"><a href="#cb297-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-19"><a href="#cb297-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">// custom parameters</span></span>
<span id="cb297-20"><a href="#cb297-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$inlinecount&#39;</span><span class="op">:</span> <span class="st">&#39;allpages&#39;</span><span class="op">,</span></span>
<span id="cb297-21"><a href="#cb297-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$callback&#39;</span><span class="op">:</span> <span class="st">&#39;callback&#39;</span></span>
<span id="cb297-22"><a href="#cb297-22" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span></code></pre></div>
<h2 id="gotchas-1">Gotchas!</h2>
<p>If you use <code>$callback</code>, please ensure that you did use the
jsonp as a <code>dataType</code> inside your <code>paginator_core</code>
configuration.</p>
<p>####6. Finally, configure Collection.parse() and we’re done</p>
<p>The last thing we need to do is configure our collection’s
<code>parse()</code> method. We want to ensure we’re returning the
correct part of our JSON response containing the data our collection
will be populated with, which below is <code>response.d.results</code>
(for the Netflix API).</p>
<p>You might also notice that we’re setting <code>this.totalPages</code>
to the total page count returned by the API. This allows us to define
the maximum number of (result) pages available for the current/last
request so that we can clearly display this in the UI. It also allows us
to influence whether clicking say, a ‘next’ button should proceed with a
request or not.</p>
<div class="sourceCode" id="cb298"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>        parse<span class="op">:</span> <span class="kw">function</span> (response) {</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Be sure to change this based on how your results</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>            <span class="co">// are structured (e.g. d.results is Netflix specific)</span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> tags <span class="op">=</span> response<span class="op">.</span><span class="at">d</span><span class="op">.</span><span class="at">results</span><span class="op">;</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>            <span class="co">//Normally this.totalPages would equal response.d.__count</span></span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a>            <span class="co">//but as this particular NetFlix request only returns a</span></span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">//total count of items for the search, we divide.</span></span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="at">totalPages</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(response<span class="op">.</span><span class="at">d</span><span class="op">.</span><span class="at">__count</span> <span class="op">/</span> <span class="kw">this</span><span class="op">.</span><span class="at">perPage</span>)<span class="op">;</span></span>
<span id="cb298-9"><a href="#cb298-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> tags<span class="op">;</span></span>
<span id="cb298-10"><a href="#cb298-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb298-11"><a href="#cb298-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb298-12"><a href="#cb298-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-13"><a href="#cb298-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>####Convenience methods:</p>
<p>For your convenience, the following methods are made available for
use in your views to interact with the <code>requestPager</code>:</p>
<ul>
<li><strong>Collection.goTo( n, options )</strong> - go to a specific
page</li>
<li><strong>Collection.nextPage( options )</strong> - go to the next
page</li>
<li><strong>Collection.prevPage( options )</strong> - go to the previous
page</li>
<li><strong>Collection.howManyPer( n )</strong> - set the number of
items to display per page</li>
</ul>
<p><strong>requestPager</strong> collection’s methods
<code>.goTo()</code>, <code>.nextPage()</code> and
<code>.prevPage()</code> are all extensions of the original <a
href="http://backbonejs.org/#Collection-fetch">Backbone
Collection.fetch() methods</a>. As so, they all can take the same option
object as a parameter.</p>
<p>This option object can use <code>success</code> and
<code>error</code> parameters to pass a function to be executed after
server answer.</p>
<div class="sourceCode" id="cb299"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>Collection<span class="op">.</span><span class="fu">goTo</span>(n<span class="op">,</span> {</span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">success</span><span class="op">:</span> <span class="kw">function</span>( collection<span class="op">,</span> response ) {</span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// called is server request success</span></span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">error</span><span class="op">:</span> <span class="kw">function</span>( collection<span class="op">,</span> response ) {</span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// called if server request fail</span></span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb299-8"><a href="#cb299-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>To manage callback, you could also use the <a
href="http://api.jquery.com/jQuery.ajax/#jqXHR">jqXHR</a> returned by
these methods to manage callback.</p>
<div class="sourceCode" id="cb300"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>Collection</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">requestNextPage</span>()</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">done</span>(<span class="kw">function</span>( data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR ) {</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// called is server request success</span></span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">fail</span>(<span class="kw">function</span>( data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR ) {</span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// called if server request fail</span></span>
<span id="cb300-8"><a href="#cb300-8" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb300-9"><a href="#cb300-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">always</span>(<span class="kw">function</span>( data<span class="op">,</span> textStatus<span class="op">,</span> jqXHR ) {</span>
<span id="cb300-10"><a href="#cb300-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do something after server request is complete</span></span>
<span id="cb300-11"><a href="#cb300-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb300-12"><a href="#cb300-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>If you’d like to add the incoming models to the current collection,
instead of replacing the collection’s contents, pass
<code>{update: true, remove: false}</code> as options to these
methods.</p>
<div class="sourceCode" id="cb301"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>Collection<span class="op">.</span><span class="fu">prevPage</span>({ <span class="dt">update</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">remove</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span></code></pre></div>
<p>##Paginator.clientPager</p>
<p>The clientPager is used to further paginate data that has already
been returned by the service API. Say you’ve requested 100 results from
the service and wish to split this into 5 pages of paginated results,
each containing 20 results at a client level - the clientPager makes it
trivial to do this.</p>
<p><img src="img/paginator-client.png" /></p>
<p>Use the clientPager when you prefer to get results in a single “load”
and thus avoid making additional network requests each time your users
want to fetch the next “page” of items. As the results have all already
been requested, it’s just a case of switching between the ranges of data
actually presented to the user.</p>
<p>####1. Create a new paginated collection with a model and URL</p>
<p>As with <code>requestPager</code>, let’s first create a new Paginated
<code>Backbone.Paginator.clientPager</code> collection, with a
model:</p>
<div class="sourceCode" id="cb302"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> PaginatedCollection <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Paginator</span><span class="op">.</span><span class="at">clientPager</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">model</span><span class="op">:</span> model<span class="op">,</span></span></code></pre></div>
<p>####2. Configure the base URL and the type of the request</p>
<p>We need to set a base URL. The <code>type</code> of the request is
<code>GET</code> by default, and the <code>dataType</code> is
<code>jsonp</code> in order to enable cross-domain requests.</p>
<div class="sourceCode" id="cb303"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>    paginator_core<span class="op">:</span> {</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the type of the request (GET by default)</span></span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;GET&#39;</span><span class="op">,</span></span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the type of reply (jsonp by default)</span></span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataType</span><span class="op">:</span> <span class="st">&#39;jsonp&#39;</span><span class="op">,</span></span>
<span id="cb303-7"><a href="#cb303-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-8"><a href="#cb303-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the URL (or base URL) for the service</span></span>
<span id="cb303-9"><a href="#cb303-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;http://odata.netflix.com/v2/Catalog/Titles?&amp;&#39;</span></span>
<span id="cb303-10"><a href="#cb303-10" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span></code></pre></div>
<p>####3. Configure how the library will show the results</p>
<p>We need to tell the library how many items per page we would like to
see, etc…</p>
<div class="sourceCode" id="cb304"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>    paginator_ui<span class="op">:</span> {</span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the lowest page index your API allows to be accessed</span></span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">firstPage</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// which page should the paginator start from</span></span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">// (also, the actual page the paginator is on)</span></span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">currentPage</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb304-8"><a href="#cb304-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-9"><a href="#cb304-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// how many items per page should be shown</span></span>
<span id="cb304-10"><a href="#cb304-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">perPage</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb304-11"><a href="#cb304-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-12"><a href="#cb304-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// a default number of total pages to query in case the API or</span></span>
<span id="cb304-13"><a href="#cb304-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// service you are using does not support providing the total</span></span>
<span id="cb304-14"><a href="#cb304-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// number of pages for us.</span></span>
<span id="cb304-15"><a href="#cb304-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 10 as a default in case your service doesn&#39;t return the total</span></span>
<span id="cb304-16"><a href="#cb304-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalPages</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb304-17"><a href="#cb304-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-18"><a href="#cb304-18" aria-hidden="true" tabindex="-1"></a>      <span class="co">// The total number of pages to be shown as a pagination</span></span>
<span id="cb304-19"><a href="#cb304-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">// list is calculated by (pagesInRange * 2) + 1.</span></span>
<span id="cb304-20"><a href="#cb304-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">pagesInRange</span><span class="op">:</span> <span class="dv">4</span></span>
<span id="cb304-21"><a href="#cb304-21" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span></code></pre></div>
<p>####4. Configure the parameters we want to send to the server</p>
<p>Only the base URL won’t be enough for most cases, so you can pass
more parameters to the server. Note how you can use functions instead of
hardcoded values, and you can also refer to the values you specified in
<code>paginator_ui</code>.</p>
<div class="sourceCode" id="cb305"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>    server_api<span class="op">:</span> {</span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the query field in the request</span></span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$filter&#39;</span><span class="op">:</span> <span class="st">&#39;substringof(</span><span class="sc">\&#39;</span><span class="st">america</span><span class="sc">\&#39;</span><span class="st">,Name)&#39;</span><span class="op">,</span></span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// number of items to return per request/page</span></span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$top&#39;</span><span class="op">:</span> <span class="kw">function</span>() { <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">perPage</span> }<span class="op">,</span></span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// how many results the request should skip ahead to</span></span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// customize as needed. For the Netflix API, skipping ahead based on</span></span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// page * number of results per page was necessary.</span></span>
<span id="cb305-11"><a href="#cb305-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$skip&#39;</span><span class="op">:</span> <span class="kw">function</span>() { <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">currentPage</span> <span class="op">*</span> <span class="kw">this</span><span class="op">.</span><span class="at">perPage</span> }<span class="op">,</span></span>
<span id="cb305-12"><a href="#cb305-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-13"><a href="#cb305-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// field to sort by</span></span>
<span id="cb305-14"><a href="#cb305-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$orderby&#39;</span><span class="op">:</span> <span class="st">&#39;ReleaseYear&#39;</span><span class="op">,</span></span>
<span id="cb305-15"><a href="#cb305-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-16"><a href="#cb305-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">// what format would you like to request results in?</span></span>
<span id="cb305-17"><a href="#cb305-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$format&#39;</span><span class="op">:</span> <span class="st">&#39;json&#39;</span><span class="op">,</span></span>
<span id="cb305-18"><a href="#cb305-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-19"><a href="#cb305-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">// custom parameters</span></span>
<span id="cb305-20"><a href="#cb305-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$inlinecount&#39;</span><span class="op">:</span> <span class="st">&#39;allpages&#39;</span><span class="op">,</span></span>
<span id="cb305-21"><a href="#cb305-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;$callback&#39;</span><span class="op">:</span> <span class="st">&#39;callback&#39;</span></span>
<span id="cb305-22"><a href="#cb305-22" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span></code></pre></div>
<p>####5. Finally, configure Collection.parse() and we’re done</p>
<p>And finally we have our <code>parse()</code> method, which in this
case isn’t concerned with the total number of result pages available on
the server as we have our own total count of pages for the paginated
data in the UI.</p>
<div class="sourceCode" id="cb306"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>    parse<span class="op">:</span> <span class="kw">function</span> (response) {</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> tags <span class="op">=</span> response<span class="op">.</span><span class="at">d</span><span class="op">.</span><span class="at">results</span><span class="op">;</span></span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> tags<span class="op">;</span></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p>####Convenience methods:</p>
<p>As mentioned, your views can hook into a number of convenience
methods to navigate around UI-paginated data. For
<code>clientPager</code> these include:</p>
<ul>
<li><strong>Collection.goTo(n, options)</strong> - go to a specific
page</li>
<li><strong>Collection.prevPage(options)</strong> - go to the previous
page</li>
<li><strong>Collection.nextPage(options)</strong> - go to the next
page</li>
<li><strong>Collection.howManyPer(n)</strong> - set how many items to
display per page</li>
<li><strong>Collection.setSort(sortBy, sortDirection)</strong> - update
sort on the current view. Sorting will automatically detect if you’re
trying to sort numbers (even if they’re strored as strings) and will do
the right thing.</li>
<li><strong>Collection.setFilter(filterFields, filterWords)</strong> -
filter the current view. Filtering supports multiple words without any
specific order, so you’ll basically get a full-text search ability.
Also, you can pass it only one field from the model, or you can pass an
array with fields and all of them will get filtered. Last option is to
pass it an object containing a comparison method and rules. Currently,
only <code>levenshtein</code> method is available.</li>
</ul>
<p>The <code>goTo()</code>, <code>prevPage()</code>, and
<code>nextPage()</code> functions do not require the
<code>options</code> param since they will be executed synchronously.
However, when specified, the success callback will be invoked before the
function returns. For example:</p>
<div class="sourceCode" id="cb307"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nextPage</span>()<span class="op">;</span> <span class="co">// this works just fine!</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nextPage</span>({<span class="dt">success</span><span class="op">:</span> <span class="kw">function</span>() { }})<span class="op">;</span> <span class="co">// this will call the success function</span></span></code></pre></div>
<p>The options param exists to preserve (some) interface unification
between the requestPaginator and clientPaginator so that they may be
used interchangeably in your Backbone.Views.</p>
<div class="sourceCode" id="cb308"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">collection</span><span class="op">.</span><span class="fu">setFilter</span>(</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">&#39;Name&#39;</span><span class="op">:</span> {<span class="dt">cmp_method</span><span class="op">:</span> <span class="st">&#39;levenshtein&#39;</span><span class="op">,</span> <span class="dt">max_distance</span><span class="op">:</span> <span class="dv">7</span>}}</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="st">&quot;Amreican P&quot;</span> <span class="co">// Note the switched &#39;r&#39; and &#39;e&#39;, and the &#39;P&#39; from &#39;Pie&#39;</span></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span></code></pre></div>
<p>Also note that the Levenshtein plugin should be loaded and enabled
using the <code>useLevenshteinPlugin</code> variable. Last but not less
important: performing Levenshtein comparison returns the
<code>distance</code> between two strings. It won’t let you
<em>search</em> lengthy text. The distance between two strings means the
number of characters that should be added, removed or moved to the left
or to the right so the strings get equal. That means that comparing
“Something” in “This is a test that could show something” will return
32, which is bigger than comparing “Something” and “ABCDEFG” (9). Use
Levenshtein only for short texts (titles, names, etc).</p>
<ul>
<li><p><strong>Collection.doFakeFilter(filterFields,
filterWords)</strong> - returns the models count after fake-applying a
call to <code>Collection.setFilter</code>.</p></li>
<li><p><strong>Collection.setFieldFilter(rules)</strong> - filter each
value of each model according to <code>rules</code> that you pass as
argument. Example: You have a collection of books with ‘release year’
and ‘author’. You can filter only the books that were released between
1999 and 2003. And then you can add another <code>rule</code> that will
filter those books only to authors who’s name start with ‘A’. Possible
rules: function, required, min, max, range, minLength, maxLength,
rangeLength, oneOf, equalTo, containsAllOf, pattern. Passing this an
empty rules set will remove any FieldFilter rules applied.</p></li>
</ul>
<div class="sourceCode" id="cb309"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>  my_collection<span class="op">.</span><span class="fu">setFieldFilter</span>([</span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">field</span><span class="op">:</span> <span class="st">&#39;release_year&#39;</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;range&#39;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> {<span class="dt">min</span><span class="op">:</span> <span class="st">&#39;1999&#39;</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="st">&#39;2003&#39;</span>}}<span class="op">,</span></span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">field</span><span class="op">:</span> <span class="st">&#39;author&#39;</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;pattern&#39;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">RegExp</span>(<span class="st">&#39;A*&#39;</span><span class="op">,</span> <span class="st">&#39;igm&#39;</span>)}</span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a>  ])<span class="op">;</span></span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">//Rules:</span></span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">//var my_var = &#39;green&#39;;</span></span>
<span id="cb309-10"><a href="#cb309-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb309-11"><a href="#cb309-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;color&#39;, type: &#39;equalTo&#39;, value: my_var}</span></span>
<span id="cb309-12"><a href="#cb309-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;color&#39;, type: &#39;function&#39;, value: function(field_value){ return field_value == my_var; } }</span></span>
<span id="cb309-13"><a href="#cb309-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;color&#39;, type: &#39;required&#39;}</span></span>
<span id="cb309-14"><a href="#cb309-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;number_of_colors&#39;, type: &#39;min&#39;, value: &#39;2&#39;}</span></span>
<span id="cb309-15"><a href="#cb309-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;number_of_colors&#39;, type: &#39;max&#39;, value: &#39;4&#39;}</span></span>
<span id="cb309-16"><a href="#cb309-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;number_of_colors&#39;, type: &#39;range&#39;, value: {min: &#39;2&#39;, max: &#39;4&#39;} }</span></span>
<span id="cb309-17"><a href="#cb309-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;color_name&#39;, type: &#39;minLength&#39;, value: &#39;4&#39;}</span></span>
<span id="cb309-18"><a href="#cb309-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;color_name&#39;, type: &#39;maxLength&#39;, value: &#39;6&#39;}</span></span>
<span id="cb309-19"><a href="#cb309-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;color_name&#39;, type: &#39;rangeLength&#39;, value: {min: &#39;4&#39;, max: &#39;6&#39;}}</span></span>
<span id="cb309-20"><a href="#cb309-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;color_name&#39;, type: &#39;oneOf&#39;, value: [&#39;green&#39;, &#39;yellow&#39;]}</span></span>
<span id="cb309-21"><a href="#cb309-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;color_name&#39;, type: &#39;pattern&#39;, value: new RegExp(&#39;gre*&#39;, &#39;ig&#39;)}</span></span>
<span id="cb309-22"><a href="#cb309-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">//{field: &#39;color_name&#39;, type: &#39;containsAllOf&#39;, value: [&#39;green&#39;, &#39;yellow&#39;, &#39;blue&#39;]}</span></span></code></pre></div>
<ul>
<li><strong>Collection.doFakeFieldFilter(rules)</strong> - returns the
models count after fake-applying a call to
<code>Collection.setFieldFilter</code>.</li>
</ul>
<p>####Implementation notes:</p>
<p>You can use some variables in your <code>View</code> to represent the
actual state of the paginator.</p>
<ul>
<li><code>totalUnfilteredRecords</code> - Contains the number of
records, including all records filtered in any way. (Only available in
<code>clientPager</code>)</li>
<li><code>totalRecords</code> - Contains the number of records</li>
<li><code>currentPage</code> - The actual page were the paginator is
at.</li>
<li><code>perPage</code> - The number of records the paginator will show
per page.</li>
<li><code>totalPages</code> - The number of total pages.</li>
<li><code>startRecord</code> - The position of the first record shown in
the current page (eg 41 to 50 from 2000 records) (Only available in
<code>clientPager</code>)</li>
<li><code>endRecord</code> - The position of the last record shown in
the current page (eg 41 to 50 from 2000 records) (Only available in
<code>clientPager</code>)</li>
<li><code>pagesInRange</code> - The number of pages to be drawn on each
side of the current page. So if <code>pagesInRange</code> is 3 and
<code>currentPage</code> is 13 you will get the numbers 10, 11, 12,
13(selected), 14, 15, 16.</li>
</ul>
<div class="sourceCode" id="cb310"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- sample template for pagination UI --&gt;</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;text/html&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;tmpServerPagination&quot;</span><span class="dt">&gt;</span></span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;row-fluid&quot;</span><span class="dt">&gt;</span></span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-6"><a href="#cb310-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;pagination span8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb310-7"><a href="#cb310-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb310-8"><a href="#cb310-8" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% _.each (pageSet, function (p) { %&gt;</span>
<span id="cb310-9"><a href="#cb310-9" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% if (currentPage == p) { %&gt;</span>
<span id="cb310-10"><a href="#cb310-10" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;active&quot;</span><span class="dt">&gt;&lt;</span><span class="kw">span</span><span class="dt">&gt;</span><span class="er">&lt;</span>%= p %&gt;<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-11"><a href="#cb310-11" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% } else { %&gt;</span>
<span id="cb310-12"><a href="#cb310-12" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;page&quot;</span><span class="dt">&gt;</span><span class="er">&lt;</span>%= p %&gt;<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-13"><a href="#cb310-13" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% } %&gt;</span>
<span id="cb310-14"><a href="#cb310-14" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% }); %&gt;</span>
<span id="cb310-15"><a href="#cb310-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb310-16"><a href="#cb310-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb310-17"><a href="#cb310-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-18"><a href="#cb310-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;pagination span4&quot;</span><span class="dt">&gt;</span></span>
<span id="cb310-19"><a href="#cb310-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb310-20"><a href="#cb310-20" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% if (currentPage &gt; firstPage) { %&gt;</span>
<span id="cb310-21"><a href="#cb310-21" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;serverprevious&quot;</span><span class="dt">&gt;</span>Previous<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-22"><a href="#cb310-22" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% }else{ %&gt;</span>
<span id="cb310-23"><a href="#cb310-23" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">span</span><span class="dt">&gt;</span>Previous<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-24"><a href="#cb310-24" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% }%&gt;</span>
<span id="cb310-25"><a href="#cb310-25" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% if (currentPage <span class="er">&lt;</span> totalPages) { %&gt;</span>
<span id="cb310-26"><a href="#cb310-26" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;servernext&quot;</span><span class="dt">&gt;</span>Next<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-27"><a href="#cb310-27" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% } else { %&gt;</span>
<span id="cb310-28"><a href="#cb310-28" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">span</span><span class="dt">&gt;</span>Next<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-29"><a href="#cb310-29" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% } %&gt;</span>
<span id="cb310-30"><a href="#cb310-30" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% if (firstPage != currentPage) { %&gt;</span>
<span id="cb310-31"><a href="#cb310-31" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;serverfirst&quot;</span><span class="dt">&gt;</span>First<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-32"><a href="#cb310-32" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% } else { %&gt;</span>
<span id="cb310-33"><a href="#cb310-33" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">span</span><span class="dt">&gt;</span>First<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-34"><a href="#cb310-34" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% } %&gt;</span>
<span id="cb310-35"><a href="#cb310-35" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% if (totalPages != currentPage) { %&gt;</span>
<span id="cb310-36"><a href="#cb310-36" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;serverlast&quot;</span><span class="dt">&gt;</span>Last<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-37"><a href="#cb310-37" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% } else { %&gt;</span>
<span id="cb310-38"><a href="#cb310-38" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">span</span><span class="dt">&gt;</span>Last<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb310-39"><a href="#cb310-39" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>% } %&gt;</span>
<span id="cb310-40"><a href="#cb310-40" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb310-41"><a href="#cb310-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb310-42"><a href="#cb310-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-43"><a href="#cb310-43" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb310-44"><a href="#cb310-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-45"><a href="#cb310-45" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;cell serverhowmany&quot;</span><span class="dt">&gt;</span> Show <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span></span>
<span id="cb310-46"><a href="#cb310-46" aria-hidden="true" tabindex="-1"></a><span class="ot">    class</span><span class="op">=</span><span class="st">&quot;selected&quot;</span><span class="dt">&gt;</span>18<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span> | <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;&quot;</span><span class="dt">&gt;</span>9<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span> | <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;&quot;</span><span class="dt">&gt;</span>12<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span> per page</span>
<span id="cb310-47"><a href="#cb310-47" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb310-48"><a href="#cb310-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-49"><a href="#cb310-49" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;divider&quot;</span><span class="dt">&gt;</span>/<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb310-50"><a href="#cb310-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-51"><a href="#cb310-51" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;cell first records&quot;</span><span class="dt">&gt;</span></span>
<span id="cb310-52"><a href="#cb310-52" aria-hidden="true" tabindex="-1"></a>    Page: <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;label&quot;</span><span class="dt">&gt;</span><span class="er">&lt;</span>%= currentPage %&gt;<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span> of <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;label&quot;</span><span class="dt">&gt;</span><span class="er">&lt;</span>%= totalPages %&gt;<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span> shown</span>
<span id="cb310-53"><a href="#cb310-53" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb310-54"><a href="#cb310-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-55"><a href="#cb310-55" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="plugins">Plugins</h3>
<p><strong>Diacritic.js</strong></p>
<p>A plugin for Backbone.Paginator that replaces diacritic characters
(<code>´</code>, <code>˝</code>, <code>̏</code>,
<code>˚</code>,<code>~</code> etc.) with characters that match them most
closely. This is particularly useful for filtering.</p>
<p><img src="img/paginator-dia.png" /></p>
<p>To enable the plugin, set <code>this.useDiacriticsPlugin</code> to
true, as can be seen in the example below:</p>
<div class="sourceCode" id="cb311"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>Paginator<span class="op">.</span><span class="at">clientPager</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Default values used when sorting and/or filtering.</span></span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">useDiacriticsPlugin</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> <span class="co">// use diacritics plugin if available</span></span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<h3 id="bootstrapping">Bootstrapping</h3>
<p>By default, both the clientPager and requestPager will make an
initial request to the server in order to populate their internal paging
data. In order to avoid this additional request, it may be beneficial to
bootstrap your Backbone.Paginator instance from data that already exists
in the dom.</p>
<p><strong>Backbone.Paginator.clientPager:</strong></p>
<div class="sourceCode" id="cb312"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Extend the Backbone.Paginator.clientPager with your own configuration options</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyClientPager <span class="op">=</span>  Backbone<span class="op">.</span><span class="at">Paginator</span><span class="op">.</span><span class="at">clientPager</span><span class="op">.</span><span class="fu">extend</span>({<span class="dt">paginator_ui</span><span class="op">:</span> {}})<span class="op">;</span></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Create an instance of your class and populate with the models of your entire collection</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> aClientPager <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyClientPager</span>([{<span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;foo&#39;</span>}<span class="op">,</span> {<span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span>}])<span class="op">;</span></span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Invoke the bootstrap function</span></span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>aClientPager<span class="op">.</span><span class="fu">bootstrap</span>()<span class="op">;</span></span></code></pre></div>
<p>Note: If you intend to bootstrap a clientPager, there is no need to
specify a ‘paginator_core’ object in your configuration (since you
should have already populated the clientPager with the entirety of its
necessary data)</p>
<p><strong>Backbone.Paginator.requestPager:</strong></p>
<div class="sourceCode" id="cb313"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Extend the Backbone.Paginator.requestPager with your own configuration options</span></span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyRequestPager <span class="op">=</span>  Backbone<span class="op">.</span><span class="at">Paginator</span><span class="op">.</span><span class="at">requestPager</span><span class="op">.</span><span class="fu">extend</span>({<span class="dt">paginator_ui</span><span class="op">:</span> {}})<span class="op">;</span></span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Create an instance of your class with the first page of data</span></span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> aRequestPager <span class="op">=</span> <span class="kw">new</span> <span class="fu">MyRequestPager</span>([{<span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;foo&#39;</span>}<span class="op">,</span> {<span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span>}])<span class="op">;</span></span>
<span id="cb313-6"><a href="#cb313-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Invoke the bootstrap function and configure requestPager with &#39;totalRecords&#39;</span></span>
<span id="cb313-7"><a href="#cb313-7" aria-hidden="true" tabindex="-1"></a>aRequestPager<span class="op">.</span><span class="fu">bootstrap</span>({<span class="dt">totalRecords</span><span class="op">:</span> <span class="dv">50</span>})<span class="op">;</span></span></code></pre></div>
<p>Note: Both the clientPager and requestPager <code>bootstrap</code>
function will accept an options param that will be extended by your
Backbone.Paginator instance. However the ‘totalRecords’ property will be
set implicitly by the clientPager.</p>
<p><a
href="http://ricostacruz.com/backbone-patterns/#bootstrapping_data">More
on Backbone bootstrapping</a></p>
<h3 id="styling">Styling</h3>
<p>You’re of course free to customize the overall look and feel of the
paginators as much as you wish. By default, all sample applications make
use of <a href="http://twitter.github.com/bootstrap">Twitter
Bootstrap</a> for styling links, buttons and drop-downs.</p>
<p>CSS classes are available to style record counts, filters, sorting
and more:</p>
<p><img src="img/paginator-styling2.png" /></p>
<p>Classes are also available for styling more granular elements like
page counts within <code>breadcrumb &gt; pages</code>
e.g. <code>.page</code>, <code>.page selected</code>:</p>
<p><img src="img/paginator-classes.png" /></p>
<p>There’s a tremendous amount of flexibility available for styling and
as you’re in control of templating too, your paginators can be made to
look as visually simple or complex as needed.</p>
<h3 id="conclusions">Conclusions</h3>
<p>Although it’s certainly possible to write your own custom pagination
classes to work with Backbone Collections, Backbone.Paginator tries to
take care of much of this for you.</p>
<p>It’s highly configurable, avoiding the need to write your own paging
when working with Collections of data sourced from your database or API.
Use the plugin to help tame large lists of data into more manageable,
easily navigatable, paginated lists.</p>
<p>Additionally, if you have any questions about Backbone.Paginator (or
would like to help improve it), feel free to post to the project <a
href="https://github.com/addyosmani/backbone.paginator">issues</a>
list.</p>
<h1 id="backbone-boilerplate-and-grunt-bbb">Backbone Boilerplate And
Grunt-BBB</h1>
<p>Boilerplates provide us a starting point for working on projects.
They’re a base for building upon using the minimum required code to get
something functional put together. When you’re working on a new Backbone
application, a new Model typically only takes a few lines of code to get
working.</p>
<p>That alone probably isn’t enough however, as you’ll need a Collection
to group those models, a View to render them and perhaps a router if
you’re looking to making specific views of your Collection data
bookmarkable. If you’re starting on a completely fresh project, you may
also need a build process in place to produce an optimized version of
your app that can be pushed to production.</p>
<p>This is where boilerplate solutions are useful. Rather than having to
manually write out the initial code for each piece of your Backbone app,
a boilerplate could do this for you, also ideally taking care of the
build process.</p>
<p><a href="https://github.com/tbranyen/backbone-boilerplate/">Backbone
Boilerplate</a> (or just BB) provides just this. It is an excellent set
of best practices and utilities for building Backbone.js applications,
created by Backbone contributor <a
href="https://github.com/tbranyen">Tim Branyen</a>. He took the the
gotchas, pitfalls and common tasks he ran into while heavily using
Backbone to build apps and crafted BB as a result of this
experience.</p>
<p><a href="https://github.com/backbone-boilerplate/grunt-bbb">Grunt-BBB
or Boilerplate Build Buddy</a> is the companion tool to BB, which offers
scaffolding, file watcher and build capabilities. Used together with BB
it provides an excellent base for quickly starting new Backbone
applications.</p>
<p><img src="img/bbb.png" /></p>
<p>Out of the box, BB and Grunt-BBB provide us with:</p>
<ul>
<li>Backbone, <a href="https://github.com/bestiejs/lodash">Lodash</a>
(an <a href="http://underscorejs.org/">Underscore.js</a> alternative)
and <a href="http://jquery.com">jQuery</a> with an <a
href="http://html5boilerplate.com">HTML5 Boilerplate</a> foundation</li>
<li>Boilerplate and scaffolding support, allowing us to spend minimal
time writing boilerplate for modules, collections and so on.</li>
<li>A build tool for template pre-compilation and, concatenation &amp;
minification of all our libraries, application code and stylesheets</li>
<li>A Lightweight node.js webserver</li>
</ul>
<p>Notes on build tool steps:</p>
<ul>
<li>Template pre-compilation: using a template library such as
Underscore micro-templating or Handlebars.js generally involves three
steps: (1) reading a raw template, (2) compiling it into a JavaScript
function and (3) running the compiled template with your desired data.
Precompiling eliminates the second step from runtime, by moving this
process into a build step.</li>
<li>Concatenation is the process of combining a number of assets (in our
case, script files) into a single (or fewer number) of files to reduce
the number of HTTP requests required to obtain them.</li>
<li>Minification is the process of removing unnecessary characters
(e.g. white space, new lines, comments) from code and compressing it to
reduce the overall size of the scripts being served.</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<h3 id="backbone-boilerplate-and-grunt-bbb-1">Backbone Boilerplate and
Grunt-BBB</h3>
<p>To get started we’re going to install Grunt-BBB, which will include
Backbone Boilerplate and any third-party dependencies it might need such
as the Grunt build tool.</p>
<p>We can install Grunt-BBB via NPM by running:</p>
<pre class="shell"><code>npm install -g bbb</code></pre>
<p>That’s it. We should now be good to go.</p>
<p>A typical workflow for using grunt-bbb, which we will use later on
is:</p>
<ul>
<li>Initialize a new project (<code>bbb init</code>)</li>
<li>Add new modules and templates (<code>bbb init:module</code>)</li>
<li>Preview changes using the built in server
(<code>bbb server</code>)</li>
<li>Run the build tool (<code>bbb build</code>)</li>
<li>Lint JavaScript, compile templates, build your application using
r.js, minify CSS and JavaScript (using <code>bbb release</code>)</li>
</ul>
<h2 id="creating-a-new-project">Creating a new project</h2>
<p>Let’s create a new directory for our project and run
<code>bbb init</code> to kick things off. A number of project
sub-directories and files will be stubbed out for us, as shown
below:</p>
<pre class="shell"><code>$ bbb init
Running &quot;init&quot; task
This task will create one or more files in the current directory, based on the
environment and the answers to a few questions. Note that answering &quot;?&quot; to any
question will show question-specific help and answering &quot;none&quot; to most questions
will leave its value blank.

&quot;bbb&quot; template notes:
This tool will help you install, configure, build, and maintain your Backbone
Boilerplate project.
Writing app/app.js...OK
Writing app/config.js...OK
Writing app/main.js...OK
Writing app/router.js...OK
Writing app/styles/index.css...OK
Writing favicon.ico...OK
Writing grunt.js...OK
Writing index.html...OK
Writing package.json...OK
Writing readme.md...OK
Writing test/jasmine/index.html...OK
Writing test/jasmine/spec/example.js...OK
Writing test/jasmine/vendor/jasmine-html.js...OK
Writing test/jasmine/vendor/jasmine.css...OK
Writing test/jasmine/vendor/jasmine.js...OK
Writing test/jasmine/vendor/jasmine_favicon.png...OK
Writing test/jasmine/vendor/MIT.LICENSE...OK
Writing test/qunit/index.html...OK
Writing test/qunit/tests/example.js...OK
Writing test/qunit/vendor/qunit.css...OK
Writing test/qunit/vendor/qunit.js...OK
Writing vendor/h5bp/css/main.css...OK
Writing vendor/h5bp/css/normalize.css...OK
Writing vendor/jam/backbone/backbone.js...OK
Writing vendor/jam/backbone/package.json...OK
Writing vendor/jam/backbone.layoutmanager/backbone.layoutmanager.js...OK
Writing vendor/jam/backbone.layoutmanager/package.json...OK
Writing vendor/jam/jquery/jquery.js...OK
Writing vendor/jam/jquery/package.json...OK
Writing vendor/jam/lodash/lodash.js...OK
Writing vendor/jam/lodash/lodash.min.js...OK
Writing vendor/jam/lodash/lodash.underscore.min.js...OK
Writing vendor/jam/lodash/package.json...OK
Writing vendor/jam/require.config.js...OK
Writing vendor/jam/require.js...OK
Writing vendor/js/libs/almond.js...OK
Writing vendor/js/libs/require.js...OK

Initialized from template &quot;bbb&quot;.

Done, without errors.</code></pre>
<p>Let’s review what has been generated.</p>
<h3 id="index.html">index.html</h3>
<p>This is a fairly standard stripped-down HTML5 Boilerplate foundation
with the notable exception of including <a
href="http://requirejs.org">RequireJS</a> at the bottom of the page.</p>
<div class="sourceCode" id="cb316"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">&quot;en&quot;</span><span class="dt">&gt;</span></span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;utf-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> http-equiv</span><span class="op">=</span><span class="st">&quot;X-UA-Compatible&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;IE=edge,chrome=1&quot;</span><span class="dt">&gt;</span></span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;width=device-width,initial-scale=1&quot;</span><span class="dt">&gt;</span></span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-8"><a href="#cb316-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Backbone Boilerplate<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb316-9"><a href="#cb316-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-10"><a href="#cb316-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- Application styles. --&gt;</span></span>
<span id="cb316-11"><a href="#cb316-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!--(if target dummy)&gt;&lt;!--&gt;</span></span>
<span id="cb316-12"><a href="#cb316-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/app/styles/index.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb316-13"><a href="#cb316-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!--&lt;!(endif)--&gt;</span></span>
<span id="cb316-14"><a href="#cb316-14" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb316-15"><a href="#cb316-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb316-16"><a href="#cb316-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- Application container. --&gt;</span></span>
<span id="cb316-17"><a href="#cb316-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">main</span><span class="ot"> role</span><span class="op">=</span><span class="st">&quot;main&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;main&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">main</span><span class="dt">&gt;</span></span>
<span id="cb316-18"><a href="#cb316-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-19"><a href="#cb316-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- Application source. --&gt;</span></span>
<span id="cb316-20"><a href="#cb316-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!--(if target dummy)&gt;&lt;!--&gt;</span></span>
<span id="cb316-21"><a href="#cb316-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> data-main</span><span class="op">=</span><span class="st">&quot;/app/config&quot;</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;/vendor/js/libs/require.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb316-22"><a href="#cb316-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!--&lt;!(endif)--&gt;</span></span>
<span id="cb316-23"><a href="#cb316-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-24"><a href="#cb316-24" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb316-25"><a href="#cb316-25" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>RequireJS - the <a
href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD</a> (Asynchronous
Module Definition) module and script loader - will assist us with
managing the modules in our application. We’ve already covered it in the
last chapter, but let’s recap what this particular block does in terms
of the Boilerplate:</p>
<pre><code>&lt;script data-main=&quot;/app/config&quot; src=&quot;/vendor/js/libs/require.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>The <code>data-main</code> attribute is used to inform RequireJS to
load <code>app/config.js</code> (a configuration object) after it has
finished loading itself. You’ll notice that we’ve omitted the
<code>.js</code> extension here as RequireJS can automatically add this
for us, however it will respect your paths if we do choose to include it
regardless. Let’s now look at the config file being referenced.</p>
<h3 id="config.js">config.js</h3>
<p>A RequireJS configuration object allows us to specify aliases and
paths for dependencies we’re likely to reference often (e.g., jQuery),
bootstrap properties like our base application URL, and
<code>shim</code> libraries that don’t support AMD natively.</p>
<p>This is what the config file in Backbone Boilerplate looks like:</p>
<div class="sourceCode" id="cb318"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Set the require.js configuration for your application.</span></span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>require<span class="op">.</span><span class="fu">config</span>({</span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Initialize the application with the main application file and the JamJS</span></span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// generated configuration file.</span></span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">deps</span><span class="op">:</span> [<span class="st">&quot;../vendor/jam/require.config&quot;</span><span class="op">,</span> <span class="st">&quot;main&quot;</span>]<span class="op">,</span></span>
<span id="cb318-7"><a href="#cb318-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-8"><a href="#cb318-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">paths</span><span class="op">:</span> {</span>
<span id="cb318-9"><a href="#cb318-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Put paths here.</span></span>
<span id="cb318-10"><a href="#cb318-10" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb318-11"><a href="#cb318-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-12"><a href="#cb318-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">shim</span><span class="op">:</span> {</span>
<span id="cb318-13"><a href="#cb318-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Put shims here.</span></span>
<span id="cb318-14"><a href="#cb318-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb318-15"><a href="#cb318-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-16"><a href="#cb318-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The first option defined in the above config is
<code>deps: ["../vendor/jam/require.config", "main"]</code>. This
informs RequireJS to load up additional RequireJS configuration as well
a a main.js file, which is considered the entry point for our
application.</p>
<p>You may notice that we haven’t specified any other path information
for <code>main</code>. Require will infer the default
<code>baseUrl</code> using the path from our <code>data-main</code>
attribute in index.html. In other words, our <code>baseUrl</code> is
<code>app/</code> and any scripts we require will be loaded relative to
this location. We could use the <code>baseUrl</code> option to override
this default if we wanted to use a different location.</p>
<p>The next block is <code>paths</code>, which we can use to specify
paths relative to the <code>baseUrl</code> as well as the paths/aliases
to dependencies we’re likely to regularly reference.</p>
<p>After this comes <code>shim</code>, an important part of our
RequireJS configuration which allows us to load libraries which are not
AMD compliant. The basic idea here is that rather than requiring all
libraries to implement support for AMD, the <code>shim</code> takes care
of the hard work for us.</p>
<p>Going back to <code>deps</code>, the contents of our
<code>require.config</code> file can be seen below.</p>
<div class="sourceCode" id="cb319"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> jam <span class="op">=</span> {</span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;packages&quot;</span><span class="op">:</span> [</span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;backbone&quot;</span><span class="op">,</span></span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;location&quot;</span><span class="op">:</span> <span class="st">&quot;../vendor/jam/backbone&quot;</span><span class="op">,</span></span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;main&quot;</span><span class="op">:</span> <span class="st">&quot;backbone.js&quot;</span></span>
<span id="cb319-7"><a href="#cb319-7" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb319-8"><a href="#cb319-8" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb319-9"><a href="#cb319-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;backbone.layoutmanager&quot;</span><span class="op">,</span></span>
<span id="cb319-10"><a href="#cb319-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;location&quot;</span><span class="op">:</span> <span class="st">&quot;../vendor/jam/backbone.layoutmanager&quot;</span><span class="op">,</span></span>
<span id="cb319-11"><a href="#cb319-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;main&quot;</span><span class="op">:</span> <span class="st">&quot;backbone.layoutmanager.js&quot;</span></span>
<span id="cb319-12"><a href="#cb319-12" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb319-13"><a href="#cb319-13" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb319-14"><a href="#cb319-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;jquery&quot;</span><span class="op">,</span></span>
<span id="cb319-15"><a href="#cb319-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;location&quot;</span><span class="op">:</span> <span class="st">&quot;../vendor/jam/jquery&quot;</span><span class="op">,</span></span>
<span id="cb319-16"><a href="#cb319-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;main&quot;</span><span class="op">:</span> <span class="st">&quot;jquery.js&quot;</span></span>
<span id="cb319-17"><a href="#cb319-17" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb319-18"><a href="#cb319-18" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb319-19"><a href="#cb319-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;lodash&quot;</span><span class="op">,</span></span>
<span id="cb319-20"><a href="#cb319-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;location&quot;</span><span class="op">:</span> <span class="st">&quot;../vendor/jam/lodash&quot;</span><span class="op">,</span></span>
<span id="cb319-21"><a href="#cb319-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;main&quot;</span><span class="op">:</span> <span class="st">&quot;./lodash.js&quot;</span></span>
<span id="cb319-22"><a href="#cb319-22" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb319-23"><a href="#cb319-23" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb319-24"><a href="#cb319-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;version&quot;</span><span class="op">:</span> <span class="st">&quot;0.2.11&quot;</span><span class="op">,</span></span>
<span id="cb319-25"><a href="#cb319-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;shim&quot;</span><span class="op">:</span> {</span>
<span id="cb319-26"><a href="#cb319-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;backbone&quot;</span><span class="op">:</span> {</span>
<span id="cb319-27"><a href="#cb319-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;deps&quot;</span><span class="op">:</span> [</span>
<span id="cb319-28"><a href="#cb319-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;jquery&quot;</span><span class="op">,</span></span>
<span id="cb319-29"><a href="#cb319-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;lodash&quot;</span></span>
<span id="cb319-30"><a href="#cb319-30" aria-hidden="true" tabindex="-1"></a>            ]<span class="op">,</span></span>
<span id="cb319-31"><a href="#cb319-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;exports&quot;</span><span class="op">:</span> <span class="st">&quot;Backbone&quot;</span></span>
<span id="cb319-32"><a href="#cb319-32" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb319-33"><a href="#cb319-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;backbone.layoutmanager&quot;</span><span class="op">:</span> {</span>
<span id="cb319-34"><a href="#cb319-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;deps&quot;</span><span class="op">:</span> [</span>
<span id="cb319-35"><a href="#cb319-35" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;jquery&quot;</span><span class="op">,</span></span>
<span id="cb319-36"><a href="#cb319-36" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;backbone&quot;</span><span class="op">,</span></span>
<span id="cb319-37"><a href="#cb319-37" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;lodash&quot;</span></span>
<span id="cb319-38"><a href="#cb319-38" aria-hidden="true" tabindex="-1"></a>            ]<span class="op">,</span></span>
<span id="cb319-39"><a href="#cb319-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;exports&quot;</span><span class="op">:</span> <span class="st">&quot;Backbone.LayoutManager&quot;</span></span>
<span id="cb319-40"><a href="#cb319-40" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb319-41"><a href="#cb319-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb319-42"><a href="#cb319-42" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>The <code>jam</code> object is to support configuration of <a
href="http://jamjs.org/">Jam</a> - a package manager for the front-end
which helps install, upgrade and configure the dependencies used by your
project. It is currently the package manager of choice for Backbone
Boilerplate.</p>
<p>Under the <code>packages</code> array, a number of dependencies are
specified for inclusion, such as Backbone, the Backbone.LayoutManager
plugin, jQuery and Lo-dash.</p>
<p>For those curious about <a
href="https://github.com/tbranyen/backbone.layoutmanager">Backbone.LayoutManager</a>,
it’s a Backbone plugin that provides a foundation for assembling layouts
and views within Backbone.</p>
<p>Additional packages you install using Jam will have a corresponding
entry added to <code>packages</code>.</p>
<h3 id="main.js">main.js</h3>
<p>Next, we have <code>main.js</code>, which defines the entry point for
our application. We use a global <code>require()</code> method to load
an array containing any other scripts needed, such as our application
<code>app.js</code> and our main router <code>router.js</code>. Note
that most of the time, we will only use <code>require()</code> for
bootstrapping an application and a similar method called
<code>define()</code> for all other purposes.</p>
<p>The function defined after our array of dependencies is a callback
which doesn’t fire until these scripts have loaded. Notice how we’re
able to locally alias references to “app” and “router” as
<code>app</code> and <code>Router</code> for convenience.</p>
<div class="sourceCode" id="cb320"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>([</span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Application.</span></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;app&quot;</span><span class="op">,</span></span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Main Router.</span></span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;router&quot;</span></span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span></span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-9"><a href="#cb320-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span>(app<span class="op">,</span> Router) {</span>
<span id="cb320-10"><a href="#cb320-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-11"><a href="#cb320-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Define your master router on the application namespace and trigger all</span></span>
<span id="cb320-12"><a href="#cb320-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// navigation from this instance.</span></span>
<span id="cb320-13"><a href="#cb320-13" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="at">router</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Router</span>()<span class="op">;</span></span>
<span id="cb320-14"><a href="#cb320-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-15"><a href="#cb320-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Trigger the initial route and enable HTML5 History API support, set the</span></span>
<span id="cb320-16"><a href="#cb320-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// root folder to &#39;/&#39; by default.  Change in app.js.</span></span>
<span id="cb320-17"><a href="#cb320-17" aria-hidden="true" tabindex="-1"></a>  Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">start</span>({ <span class="dt">pushState</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">root</span><span class="op">:</span> app<span class="op">.</span><span class="at">root</span> })<span class="op">;</span></span>
<span id="cb320-18"><a href="#cb320-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-19"><a href="#cb320-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// All navigation that is relative should be passed through the navigate</span></span>
<span id="cb320-20"><a href="#cb320-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// method, to be processed by the router. If the link has a `data-bypass`</span></span>
<span id="cb320-21"><a href="#cb320-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// attribute, bypass the delegation completely.</span></span>
<span id="cb320-22"><a href="#cb320-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="bu">document</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> <span class="st">&quot;a[href]:not([data-bypass])&quot;</span><span class="op">,</span> <span class="kw">function</span>(evt) {</span>
<span id="cb320-23"><a href="#cb320-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the absolute anchor href.</span></span>
<span id="cb320-24"><a href="#cb320-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> href <span class="op">=</span> { <span class="dt">prop</span><span class="op">:</span> <span class="fu">$</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">prop</span>(<span class="st">&quot;href&quot;</span>)<span class="op">,</span> <span class="dt">attr</span><span class="op">:</span> <span class="fu">$</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">&quot;href&quot;</span>) }<span class="op">;</span></span>
<span id="cb320-25"><a href="#cb320-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the absolute root.</span></span>
<span id="cb320-26"><a href="#cb320-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> <span class="bu">root</span> <span class="op">=</span> location<span class="op">.</span><span class="at">protocol</span> <span class="op">+</span> <span class="st">&quot;//&quot;</span> <span class="op">+</span> location<span class="op">.</span><span class="at">host</span> <span class="op">+</span> app<span class="op">.</span><span class="at">root</span><span class="op">;</span></span>
<span id="cb320-27"><a href="#cb320-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-28"><a href="#cb320-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Ensure the root is part of the anchor href, meaning it&#39;s relative.</span></span>
<span id="cb320-29"><a href="#cb320-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (href<span class="op">.</span><span class="at">prop</span><span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="bu">root</span><span class="op">.</span><span class="at">length</span>) <span class="op">===</span> <span class="bu">root</span>) {</span>
<span id="cb320-30"><a href="#cb320-30" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Stop the default event to ensure the link will not cause a page</span></span>
<span id="cb320-31"><a href="#cb320-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">// refresh.</span></span>
<span id="cb320-32"><a href="#cb320-32" aria-hidden="true" tabindex="-1"></a>      evt<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb320-33"><a href="#cb320-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-34"><a href="#cb320-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">// `Backbone.history.navigate` is sufficient for all Routers and will</span></span>
<span id="cb320-35"><a href="#cb320-35" aria-hidden="true" tabindex="-1"></a>      <span class="co">// trigger the correct events. The Router&#39;s internal `navigate` method</span></span>
<span id="cb320-36"><a href="#cb320-36" aria-hidden="true" tabindex="-1"></a>      <span class="co">// calls this anyways.  The fragment is sliced from the root.</span></span>
<span id="cb320-37"><a href="#cb320-37" aria-hidden="true" tabindex="-1"></a>      Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">navigate</span>(href<span class="op">.</span><span class="at">attr</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb320-38"><a href="#cb320-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb320-39"><a href="#cb320-39" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb320-40"><a href="#cb320-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-41"><a href="#cb320-41" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Inline, Backbone Boilerplate includes boilerplate code for
initializing our router with HTML5 History API support and handling
other navigation scenarios, so we don’t have to.</p>
<h3 id="app.js">app.js</h3>
<p>Let us now look at our <code>app.js</code> module. Typically, in
non-Backbone Boilerplate applications, an <code>app.js</code> file may
contain the core logic or module references needed to kick start an
app.</p>
<p>In this case however, this file is used to define templating and
layout configuration options as well as utilities for consuming layouts.
To a beginner, this might look like a lot of code to comprehend, but the
good news is that for basic apps, you’re unlikely to need to heavily
modify this. Instead, you’ll be more concerned with modules for your
app, which we’ll look at next.</p>
<div class="sourceCode" id="cb321"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;backbone.layoutmanager&quot;</span></span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Provide a global location to place configuration settings and module</span></span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// creation.</span></span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> app <span class="op">=</span> {</span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The root path to run the application.</span></span>
<span id="cb321-9"><a href="#cb321-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">root</span><span class="op">:</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb321-10"><a href="#cb321-10" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb321-11"><a href="#cb321-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-12"><a href="#cb321-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Localize or create a new JavaScript Template object.</span></span>
<span id="cb321-13"><a href="#cb321-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> JST <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">JST</span> <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">JST</span> <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb321-14"><a href="#cb321-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-15"><a href="#cb321-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Configure LayoutManager with Backbone Boilerplate defaults.</span></span>
<span id="cb321-16"><a href="#cb321-16" aria-hidden="true" tabindex="-1"></a>  Backbone<span class="op">.</span><span class="at">LayoutManager</span><span class="op">.</span><span class="fu">configure</span>({</span>
<span id="cb321-17"><a href="#cb321-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Allow LayoutManager to augment Backbone.View.prototype.</span></span>
<span id="cb321-18"><a href="#cb321-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">manage</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb321-19"><a href="#cb321-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-20"><a href="#cb321-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">prefix</span><span class="op">:</span> <span class="st">&quot;app/templates/&quot;</span><span class="op">,</span></span>
<span id="cb321-21"><a href="#cb321-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-22"><a href="#cb321-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fetch</span><span class="op">:</span> <span class="kw">function</span>(path) {</span>
<span id="cb321-23"><a href="#cb321-23" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Concatenate the file extension.</span></span>
<span id="cb321-24"><a href="#cb321-24" aria-hidden="true" tabindex="-1"></a>      path <span class="op">=</span> path <span class="op">+</span> <span class="st">&quot;.html&quot;</span><span class="op">;</span></span>
<span id="cb321-25"><a href="#cb321-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-26"><a href="#cb321-26" aria-hidden="true" tabindex="-1"></a>      <span class="co">// If cached, use the compiled template.</span></span>
<span id="cb321-27"><a href="#cb321-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (JST[path]) {</span>
<span id="cb321-28"><a href="#cb321-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> JST[path]<span class="op">;</span></span>
<span id="cb321-29"><a href="#cb321-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb321-30"><a href="#cb321-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-31"><a href="#cb321-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Put fetch into `async-mode`.</span></span>
<span id="cb321-32"><a href="#cb321-32" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> done <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">async</span>()<span class="op">;</span></span>
<span id="cb321-33"><a href="#cb321-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-34"><a href="#cb321-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Seek out the template asynchronously.</span></span>
<span id="cb321-35"><a href="#cb321-35" aria-hidden="true" tabindex="-1"></a>      $<span class="op">.</span><span class="fu">get</span>(app<span class="op">.</span><span class="at">root</span> <span class="op">+</span> path<span class="op">,</span> <span class="kw">function</span>(contents) {</span>
<span id="cb321-36"><a href="#cb321-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">done</span>(JST[path] <span class="op">=</span> _<span class="op">.</span><span class="fu">template</span>(contents))<span class="op">;</span></span>
<span id="cb321-37"><a href="#cb321-37" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb321-38"><a href="#cb321-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb321-39"><a href="#cb321-39" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb321-40"><a href="#cb321-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-41"><a href="#cb321-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mix Backbone.Events, modules, and layout management into the app object.</span></span>
<span id="cb321-42"><a href="#cb321-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> _<span class="op">.</span><span class="fu">extend</span>(app<span class="op">,</span> {</span>
<span id="cb321-43"><a href="#cb321-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a custom object with a nested Views object.</span></span>
<span id="cb321-44"><a href="#cb321-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">module</span><span class="op">:</span> <span class="kw">function</span>(additionalProps) {</span>
<span id="cb321-45"><a href="#cb321-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> _<span class="op">.</span><span class="fu">extend</span>({ <span class="dt">Views</span><span class="op">:</span> {} }<span class="op">,</span> additionalProps)<span class="op">;</span></span>
<span id="cb321-46"><a href="#cb321-46" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb321-47"><a href="#cb321-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-48"><a href="#cb321-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Helper for using layouts.</span></span>
<span id="cb321-49"><a href="#cb321-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">useLayout</span><span class="op">:</span> <span class="kw">function</span>(name<span class="op">,</span> options) {</span>
<span id="cb321-50"><a href="#cb321-50" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Enable variable arity by allowing the first argument to be the options</span></span>
<span id="cb321-51"><a href="#cb321-51" aria-hidden="true" tabindex="-1"></a>      <span class="co">// object and omitting the name argument.</span></span>
<span id="cb321-52"><a href="#cb321-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (_<span class="op">.</span><span class="fu">isObject</span>(name)) {</span>
<span id="cb321-53"><a href="#cb321-53" aria-hidden="true" tabindex="-1"></a>        options <span class="op">=</span> name<span class="op">;</span></span>
<span id="cb321-54"><a href="#cb321-54" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb321-55"><a href="#cb321-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-56"><a href="#cb321-56" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Ensure options is an object.</span></span>
<span id="cb321-57"><a href="#cb321-57" aria-hidden="true" tabindex="-1"></a>      options <span class="op">=</span> options <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb321-58"><a href="#cb321-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-59"><a href="#cb321-59" aria-hidden="true" tabindex="-1"></a>      <span class="co">// If a name property was specified use that as the template.</span></span>
<span id="cb321-60"><a href="#cb321-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (_<span class="op">.</span><span class="fu">isString</span>(name)) {</span>
<span id="cb321-61"><a href="#cb321-61" aria-hidden="true" tabindex="-1"></a>        options<span class="op">.</span><span class="at">template</span> <span class="op">=</span> name<span class="op">;</span></span>
<span id="cb321-62"><a href="#cb321-62" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb321-63"><a href="#cb321-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-64"><a href="#cb321-64" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Create a new Layout with options.</span></span>
<span id="cb321-65"><a href="#cb321-65" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> layout <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Layout</span>(_<span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb321-66"><a href="#cb321-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">el</span><span class="op">:</span> <span class="st">&quot;#main&quot;</span></span>
<span id="cb321-67"><a href="#cb321-67" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> options))<span class="op">;</span></span>
<span id="cb321-68"><a href="#cb321-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-69"><a href="#cb321-69" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Cache the reference.</span></span>
<span id="cb321-70"><a href="#cb321-70" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">layout</span> <span class="op">=</span> layout<span class="op">;</span></span>
<span id="cb321-71"><a href="#cb321-71" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb321-72"><a href="#cb321-72" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> Backbone<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span>
<span id="cb321-73"><a href="#cb321-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-74"><a href="#cb321-74" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Note: JST stands for JavaScript templates and generally refers to
templates which have been (or will be) precompiled as part of a build
step. When running <code>bbb release</code> or <code>bbb debug</code>,
Underscore/Lo-dash templates will be precompiled to avoid the need to
compile them at runtime within the browser.</p>
<h3 id="creating-backbone-boilerplate-modules">Creating Backbone
Boilerplate Modules</h3>
<p>Not to be confused with simply being just an AMD module, a Backbone
Boilerplate <code>module</code> is a script composed of a:</p>
<ul>
<li>Model</li>
<li>Collection</li>
<li>Views (optional)</li>
</ul>
<p>We can easily create a new Boilerplate module using
<code>grunt-bbb</code> once again using <code>init</code>:</p>
<pre class="shell"><code># Create a new module
$ bbb init:module

# Grunt prompt
Please answer the following:
[?] Module Name foo
[?] Do you need to make any changes to the above before continuing? (y/N)

Writing app/modules/foo.js...OK
Writing app/styles/foo.styl...OK
Writing app/templates/foo.html...OK

Initialized from template &quot;module&quot;.

Done, without errors.</code></pre>
<p>This will generate a module <code>foo.js</code> as follows:</p>
<div class="sourceCode" id="cb323"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Foo module</span></span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Application.</span></span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;app&quot;</span></span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span></span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-7"><a href="#cb323-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Map dependencies from above array.</span></span>
<span id="cb323-8"><a href="#cb323-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span>(app) {</span>
<span id="cb323-9"><a href="#cb323-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-10"><a href="#cb323-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create a new module.</span></span>
<span id="cb323-11"><a href="#cb323-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Foo <span class="op">=</span> app<span class="op">.</span><span class="fu">module</span>()<span class="op">;</span></span>
<span id="cb323-12"><a href="#cb323-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-13"><a href="#cb323-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default Model.</span></span>
<span id="cb323-14"><a href="#cb323-14" aria-hidden="true" tabindex="-1"></a>  Foo<span class="op">.</span><span class="at">Model</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb323-15"><a href="#cb323-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-16"><a href="#cb323-16" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb323-17"><a href="#cb323-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-18"><a href="#cb323-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default Collection.</span></span>
<span id="cb323-19"><a href="#cb323-19" aria-hidden="true" tabindex="-1"></a>  Foo<span class="op">.</span><span class="at">Collection</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb323-20"><a href="#cb323-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> Foo<span class="op">.</span><span class="at">Model</span></span>
<span id="cb323-21"><a href="#cb323-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb323-22"><a href="#cb323-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-23"><a href="#cb323-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default View.</span></span>
<span id="cb323-24"><a href="#cb323-24" aria-hidden="true" tabindex="-1"></a>  Foo<span class="op">.</span><span class="at">Views</span><span class="op">.</span><span class="at">Layout</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb323-25"><a href="#cb323-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> <span class="st">&quot;foo&quot;</span></span>
<span id="cb323-26"><a href="#cb323-26" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb323-27"><a href="#cb323-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-28"><a href="#cb323-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the module for AMD compliance.</span></span>
<span id="cb323-29"><a href="#cb323-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Foo<span class="op">;</span></span>
<span id="cb323-30"><a href="#cb323-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-31"><a href="#cb323-31" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Notice how boilerplate code for a model, collection and view have
been scaffolded out for us.</p>
<p>Optionally, we may also wish to include references to plugins such as
the Backbone LocalStorage or Offline adapters. One clean way of
including a plugin in the above boilerplate could be:</p>
<div class="sourceCode" id="cb324"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Foo module</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Application.</span></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;app&quot;</span><span class="op">,</span></span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Plugins</span></span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;plugins/backbone-localstorage&#39;</span></span>
<span id="cb324-7"><a href="#cb324-7" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span></span>
<span id="cb324-8"><a href="#cb324-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-9"><a href="#cb324-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Map dependencies from above array.</span></span>
<span id="cb324-10"><a href="#cb324-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span>(app<span class="op">,</span> Store) {</span>
<span id="cb324-11"><a href="#cb324-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-12"><a href="#cb324-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create a new module.</span></span>
<span id="cb324-13"><a href="#cb324-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Foo <span class="op">=</span> app<span class="op">.</span><span class="fu">module</span>()<span class="op">;</span></span>
<span id="cb324-14"><a href="#cb324-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-15"><a href="#cb324-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default Model.</span></span>
<span id="cb324-16"><a href="#cb324-16" aria-hidden="true" tabindex="-1"></a>  Foo<span class="op">.</span><span class="at">Model</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb324-17"><a href="#cb324-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Save all of the items under the `&quot;foo&quot;` namespace.</span></span>
<span id="cb324-18"><a href="#cb324-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">localStorage</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Store</span>(<span class="st">&#39;foo-backbone&#39;</span>)<span class="op">,</span></span>
<span id="cb324-19"><a href="#cb324-19" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb324-20"><a href="#cb324-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-21"><a href="#cb324-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default Collection.</span></span>
<span id="cb324-22"><a href="#cb324-22" aria-hidden="true" tabindex="-1"></a>  Foo<span class="op">.</span><span class="at">Collection</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb324-23"><a href="#cb324-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> Foo<span class="op">.</span><span class="at">Model</span></span>
<span id="cb324-24"><a href="#cb324-24" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb324-25"><a href="#cb324-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-26"><a href="#cb324-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Default View.</span></span>
<span id="cb324-27"><a href="#cb324-27" aria-hidden="true" tabindex="-1"></a>  Foo<span class="op">.</span><span class="at">Views</span><span class="op">.</span><span class="at">Layout</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb324-28"><a href="#cb324-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> <span class="st">&quot;foo&quot;</span></span>
<span id="cb324-29"><a href="#cb324-29" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb324-30"><a href="#cb324-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-31"><a href="#cb324-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the module for AMD compliance.</span></span>
<span id="cb324-32"><a href="#cb324-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Foo<span class="op">;</span></span>
<span id="cb324-33"><a href="#cb324-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-34"><a href="#cb324-34" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="router.js">router.js</h3>
<p>Finally, let’s look at our application router which is used for
handling navigation. The default router Backbone Boilerplate generates
for us includes sane defaults out of the box and can be easily
extended.</p>
<div class="sourceCode" id="cb325"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Application.</span></span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;app&quot;</span></span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span></span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-6"><a href="#cb325-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span>(app) {</span>
<span id="cb325-7"><a href="#cb325-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-8"><a href="#cb325-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Defining the application router, you can attach sub routers here.</span></span>
<span id="cb325-9"><a href="#cb325-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Router <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb325-10"><a href="#cb325-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">routes</span><span class="op">:</span> {</span>
<span id="cb325-11"><a href="#cb325-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;&quot;</span><span class="op">:</span> <span class="st">&quot;index&quot;</span></span>
<span id="cb325-12"><a href="#cb325-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb325-13"><a href="#cb325-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-14"><a href="#cb325-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">index</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb325-15"><a href="#cb325-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-16"><a href="#cb325-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb325-17"><a href="#cb325-17" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb325-18"><a href="#cb325-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-19"><a href="#cb325-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Router<span class="op">;</span></span>
<span id="cb325-20"><a href="#cb325-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-21"><a href="#cb325-21" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>If however we would like to execute some module-specific logic, when
the page loads (i.e. when a user hits the default route), we can pull in
a module as a dependency and optionally use the Backbone LayoutManager
to attach Views to our layout as follows:</p>
<div class="sourceCode" id="cb326"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Application.</span></span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;app&#39;</span><span class="op">,</span></span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Modules</span></span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;modules/foo&#39;</span></span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span></span>
<span id="cb326-8"><a href="#cb326-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-9"><a href="#cb326-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span>(app<span class="op">,</span> Foo) {</span>
<span id="cb326-10"><a href="#cb326-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-11"><a href="#cb326-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Defining the application router, you can attach sub routers here.</span></span>
<span id="cb326-12"><a href="#cb326-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> Router <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb326-13"><a href="#cb326-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">routes</span><span class="op">:</span> {</span>
<span id="cb326-14"><a href="#cb326-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;&#39;</span><span class="op">:</span> <span class="st">&#39;index&#39;</span></span>
<span id="cb326-15"><a href="#cb326-15" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb326-16"><a href="#cb326-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-17"><a href="#cb326-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">index</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb326-18"><a href="#cb326-18" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Create a new Collection</span></span>
<span id="cb326-19"><a href="#cb326-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> collection <span class="op">=</span> <span class="kw">new</span> Foo<span class="op">.</span><span class="fu">Collection</span>()<span class="op">;</span></span>
<span id="cb326-20"><a href="#cb326-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-21"><a href="#cb326-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Use and configure a &#39;main&#39; layout</span></span>
<span id="cb326-22"><a href="#cb326-22" aria-hidden="true" tabindex="-1"></a>            app<span class="op">.</span><span class="fu">useLayout</span>(<span class="st">&#39;main&#39;</span>)<span class="op">.</span><span class="fu">setViews</span>({</span>
<span id="cb326-23"><a href="#cb326-23" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// Attach the bar View into the content View</span></span>
<span id="cb326-24"><a href="#cb326-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;.bar&#39;</span><span class="op">:</span> <span class="kw">new</span> Foo<span class="op">.</span><span class="at">Views</span><span class="op">.</span><span class="fu">Bar</span>({</span>
<span id="cb326-25"><a href="#cb326-25" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">collection</span><span class="op">:</span> collection</span>
<span id="cb326-26"><a href="#cb326-26" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb326-27"><a href="#cb326-27" aria-hidden="true" tabindex="-1"></a>             })<span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb326-28"><a href="#cb326-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb326-29"><a href="#cb326-29" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb326-30"><a href="#cb326-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-31"><a href="#cb326-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Fetch data (e.g., from localStorage)</span></span>
<span id="cb326-32"><a href="#cb326-32" aria-hidden="true" tabindex="-1"></a>  collection<span class="op">.</span><span class="fu">fetch</span>()<span class="op">;</span></span>
<span id="cb326-33"><a href="#cb326-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-34"><a href="#cb326-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Router<span class="op">;</span></span>
<span id="cb326-35"><a href="#cb326-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-36"><a href="#cb326-36" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="other-useful-tools-projects">Other Useful Tools &amp;
Projects</h2>
<p>When working with Backbone, you usually need to write a number of
different classes and files for your application. Scaffolding tools such
as Grunt-BBB can help automate this process by generating basic
boilerplates for the files you need for you.</p>
<h3 id="yeoman">Yeoman</h3>
<p>If you appreciated Grunt-BBB but would like to explore a tool for
assisting with your broader development workflow, I’m happy to recommend
a tool I’ve been helping with called <a
href="http://yeoman.io">Yeoman</a>.</p>
<p><img src="img/yeoman.png" /></p>
<p>Yeoman is a workflow comprised of a collection of tools and best
practices for helping you develop more efficiently. It’s comprised of yo
(a scaffolding tool), <a href="http://gruntjs.com">Grunt</a>(a build
tool) and <a href="http://bower.io">Bower</a> (a client-side package
manager).</p>
<p>Where Grunt-BBB focuses on offering an opionated start for Backbone
projects, Yeoman allows you to scaffold apps using Backbone (or other
libraries and frameworks), get Backbone plugins directly from the
command-line and compile your CoffeeScript, Sass or other abstractions
without additional effort.</p>
<p><img src="img/bower.png" /></p>
<p>You may also be interested in <a href="http://brunch.io/">Brunch</a>,
a similar project which uses skeleton boilerplates to generate new
applications.</p>
<h3 id="backbone-devtools">Backbone DevTools</h3>
<p>When building an application with Backbone, there’s some additional
tooling available for your day-to-day debugging workflow.</p>
<p>Backbone DevTools was created to help with this and is a Chrome
DevTools extension allowing you to inspect events, syncs, View-DOM
bindings and what objects have been instantiated.</p>
<p>A useful View hierarchy is displayed in the Elements panel. Also,
when you inspect a DOM element the closest View will be exposed via
$view in the console.</p>
<p><img src="img/bbdevtools.jpg" /></p>
<p>At the time of writing, the project is currently available on <a
href="https://github.com/spect88/backbone-devtools">GitHub</a>.</p>
<h2 id="conclusions-1">Conclusions</h2>
<p>In this section we reviewed Backbone Boilerplate and learned how to
use the <code>bbb</code> tool to help us scaffold out our
application.</p>
<p>If you would like to learn more about how this project helps
structure your app, BBB includes some built-in boilerplate sample apps
that can be easily generated for review.</p>
<p>These include a boilerplate tutorial project
(<code>bbb init:tutorial</code>) and an implementation of my <a
href="http://todomvc">TodoMVC</a> project
(<code>bbb init:todomvc</code>). I recommend checking these out as
they’ll provide you with a more complete picture of how Backbone
Boilerplate, its templates, and so on fit into the overall setup for a
web app.</p>
<p>For more about Grunt-BBB, remember to take a look at the official
project <a
href="https://github.com/backbone-boilerplate/grunt-bbb">repository</a>.
There is also a related <a
href="https://dl.dropbox.com/u/79007/talks/Modern_Web_Applications/slides/index.html">slide-deck</a>
available for those interested in reading more.</p>
<h1 id="backbone-jquery-mobile">Backbone &amp; jQuery Mobile</h1>
<h3 id="mobile-app-development-with-jquery-mobile">Mobile app
development with jQuery Mobile</h3>
<p>The mobile web is huge and it is continuing to grow at an impressive
rate. Along with the massive growth of the mobile internet comes a
striking diversity of devices and browsers. As a result, making your
applications cross-platform and mobile-ready is both important and
challenging. Creating native apps is expensive. It is very costly in
terms of time and it usually requires varied experiences in programming
languages like Objective C , C#, Java and JavaScript to support multiple
runtime environments.</p>
<p>HTML, CSS, and JavaScript enable you to build a single application
targeting a common runtime environment: the browser. This approach
supports a broad range of mobile devices such as tablets, smartphones,
and notebooks along with traditional PCs.</p>
<p>The challenging task is not only to adapt contents like text and
pictures properly to various screen resolutions but also to have same
user experience across native apps under different operating systems.
Like jQueryUI, jQuery Mobile is a user interface framework based on
jQuery that works across all popular phone, tablet, e-Reader, and
desktop platforms. It is built with accessibility and universal access
in mind.</p>
<p>The main idea of the framework is to enable anyone to create a mobile
app using only HTML. Knowledge of a programming language is not required
and there is no need to write complex, device specific CSS. For this
reason jQMobile follows two main principles we first need to understand
in order to integrate the framework to Backbone: <em>progressive
enhancement</em> and <em>responsive web design</em>.</p>
<h4 id="the-principle-of-progressive-widget-enhancement-by-jqmobile">The
Principle of progressive widget enhancement by jQMobile</h4>
<p>JQuery Mobile follows progressive enhancement and responsive web
design principles using HTML-5 markup-driven definitions and
configurations.</p>
<p>A page in jQuery Mobile consists of an element with a
<code>data-role="page"</code> attribute. Within the <code>page</code>
container, any valid HTML markup can be used, but for typical pages in
jQM, the immediate children are divs with
<code>data-role="header"</code>, <code>data-role="content"</code>, and
<code>data-role="footer"</code>. The baseline requirement for a page is
only a page wrapper to support the navigation system, the rest is
optional.</p>
<p>An initial HTML page looks like this:</p>
<div class="sourceCode" id="cb327"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Page Title<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb327-5"><a href="#cb327-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-6"><a href="#cb327-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;width=device-width, initial-scale=1&quot;</span><span class="dt">&gt;</span></span>
<span id="cb327-7"><a href="#cb327-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-8"><a href="#cb327-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.css&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb327-9"><a href="#cb327-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;http://code.jquery.com/jquery-1.9.1.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb327-10"><a href="#cb327-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb327-11"><a href="#cb327-11" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb327-12"><a href="#cb327-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb327-13"><a href="#cb327-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-14"><a href="#cb327-14" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;page&quot;</span><span class="dt">&gt;</span></span>
<span id="cb327-15"><a href="#cb327-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;header&quot;</span><span class="dt">&gt;</span></span>
<span id="cb327-16"><a href="#cb327-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>Page Title<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb327-17"><a href="#cb327-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb327-18"><a href="#cb327-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;content&quot;</span><span class="dt">&gt;</span></span>
<span id="cb327-19"><a href="#cb327-19" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Page content goes here.<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb327-20"><a href="#cb327-20" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;</span><span class="kw">form</span><span class="dt">&gt;</span></span>
<span id="cb327-21"><a href="#cb327-21" aria-hidden="true" tabindex="-1"></a>       <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;slider-1&quot;</span><span class="dt">&gt;</span>Slider with tooltip:<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb327-22"><a href="#cb327-22" aria-hidden="true" tabindex="-1"></a>       <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;range&quot;</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;slider-1&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;slider-1&quot;</span><span class="ot"> min</span><span class="op">=</span><span class="st">&quot;0&quot;</span><span class="ot"> max</span><span class="op">=</span><span class="st">&quot;100&quot;</span><span class="ot"> value</span><span class="op">=</span><span class="st">&quot;50&quot;</span><span class="ot"> </span></span>
<span id="cb327-23"><a href="#cb327-23" aria-hidden="true" tabindex="-1"></a><span class="ot">        data-popup-enabled</span><span class="op">=</span><span class="st">&quot;true&quot;</span><span class="dt">&gt;</span></span>
<span id="cb327-24"><a href="#cb327-24" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;/</span><span class="kw">form</span><span class="dt">&gt;</span></span>
<span id="cb327-25"><a href="#cb327-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb327-26"><a href="#cb327-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;footer&quot;</span><span class="dt">&gt;</span></span>
<span id="cb327-27"><a href="#cb327-27" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;</span><span class="kw">h4</span><span class="dt">&gt;</span>Page Footer<span class="dt">&lt;/</span><span class="kw">h4</span><span class="dt">&gt;</span></span>
<span id="cb327-28"><a href="#cb327-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb327-29"><a href="#cb327-29" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb327-30"><a href="#cb327-30" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb327-31"><a href="#cb327-31" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p><em>Example HTML setup of a basic jQuery Mobile page</em></p>
<p>JQuery Mobile will transform the written HTML definition to the
rendered HTML and CSS using its Progressive Widget Enhancement API. It
also executes JavaScript which is conditioned by configurations,
attribute properties, and runtime specific settings.</p>
<p>This implies: Whenever HTML content is added or changed, it needs to
be handled by the progressive widget enhancement of jQuery Mobile.</p>
<p><img src="img/chapter10-1-1-1.png" /></p>
<p><em>Comparison of the user interface of the default HTML to the
jQuery Mobile enhanced version</em></p>
<h4 id="understanding-jquery-mobile-navigation">Understanding jQuery
Mobile Navigation</h4>
<p>The jQuery Mobile navigation system controls its application’s
lifecycle by automatically “hijacking” standard links and form
submissions and turning them into AJAX requests. Whenever a link is
clicked or a form is submitted, that event is automatically intercepted
and used to issue an AJAX request based on the href or form action
instead of reloading the page.</p>
<p>When the page document is requested, jQuery Mobile searches the
document for all elements with the <code>data-role="page"</code>
attribute, parses its contents, and inserts that code into the DOM of
the original page. Once the new page is prepared, jQuery Mobile’s
JavaScript triggers a transition that shows the new page and hides the
HTML of the previous page in the DOM.</p>
<p>Next, any widgets in the incoming page are enhanced to apply all the
styles and behavior. The rest of the incoming page is discarded so any
scripts, stylesheets, or other information will not be included.</p>
<p>Via the <em>multi-page templating feature</em>, you can add as many
pages as you want to the same HTML file within the body tag by defining
divs with <code>data-role="page"</code> or
<code>data-role="dialog"</code> attributes along with an <code>id</code>
which can be used in links (preceded by a hashbang):</p>
<div class="sourceCode" id="cb328"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span>...<span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;page&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;firstpage&quot;</span><span class="dt">&gt;</span></span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb328-7"><a href="#cb328-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;content&quot;</span><span class="dt">&gt;</span> </span>
<span id="cb328-8"><a href="#cb328-8" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#secondpage&quot;</span><span class="dt">&gt;</span>go to secondpage<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb328-9"><a href="#cb328-9" aria-hidden="true" tabindex="-1"></a>   <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb328-10"><a href="#cb328-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb328-11"><a href="#cb328-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;page&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;secondpage&quot;</span><span class="dt">&gt;</span></span>
<span id="cb328-12"><a href="#cb328-12" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb328-13"><a href="#cb328-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;content&quot;</span><span class="ot"> </span><span class="dt">&gt;</span></span>
<span id="cb328-14"><a href="#cb328-14" aria-hidden="true" tabindex="-1"></a>       <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#firstdialog&quot;</span><span class="ot"> data-rel</span><span class="op">=</span><span class="st">&quot;dialog&quot;</span><span class="ot"> </span><span class="dt">&gt;</span>open a page as a dialog<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb328-15"><a href="#cb328-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb328-16"><a href="#cb328-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb328-17"><a href="#cb328-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;dialog&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;firstdialog&quot;</span><span class="dt">&gt;</span></span>
<span id="cb328-18"><a href="#cb328-18" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb328-19"><a href="#cb328-19" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;content&quot;</span><span class="dt">&gt;</span></span>
<span id="cb328-20"><a href="#cb328-20" aria-hidden="true" tabindex="-1"></a>       <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#firstpage&quot;</span><span class="dt">&gt;</span>leave dialog and go to first page<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb328-21"><a href="#cb328-21" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb328-22"><a href="#cb328-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb328-23"><a href="#cb328-23" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb328-24"><a href="#cb328-24" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p><em>jQuery Mobile multi-page templating example</em></p>
<p>To, for example, navigate to <em>secondpage</em> and have it appear
in a modal dialog using a fade-transition, you would just add the
<code>data-rel="dialog"</code>, <code>data-transition="fade"</code>, and
<code>href="index.html#secondpage"</code> attributes to an anchor
tag.</p>
<p>Roughly speaking, having its own event cycle, jQuery Mobile is a tiny
MVC framework which includes features like progressive widget
enhancement, pre-fetching, caching, and multi-page templating by HTML
configurations innately. In general, a Backbone.js developer does not
need to know about its internal event workflow, but will need to know
how to apply HTML-based configurations which will take action within the
event phase. The <em>Intercepting jQuery Mobile Events</em> section goes
into detail regarding how to handle special scenarios when fine-grained
JavaScript adaptions need to be applied.</p>
<p>For further introduction and explanations about jQuery Mobile
visit:</p>
<ul>
<li><a
href="http://view.jquerymobile.com/1.3.0/docs/intro/">http://view.jquerymobile.com/1.3.0/docs/intro/</a></li>
<li><a
href="http://view.jquerymobile.com/1.3.0/docs/widgets/pages/">http://view.jquerymobile.com/1.3.0/docs/widgets/pages/</a></li>
<li><a
href="http://view.jquerymobile.com/1.3.0/docs/intro/rwd.php">http://view.jquerymobile.com/1.3.0/docs/intro/rwd.php</a></li>
</ul>
<h3 id="basic-backbone-app-setup-for-jquery-mobile">Basic Backbone app
setup for jQuery Mobile</h3>
<p>The first major hurdle developers typically run into when building
applications with jQuery Mobile and an MV* framework is that both
frameworks want to handle application navigation.</p>
<p>To combine Backbone and jQuery Mobile, we first need to disable
jQuery Mobile’s navigation system and progressive enhancement. The
second step will then be to make use of jQM’s custom API to apply
configurations and enhance components during Backbone’s application
lifecycle instead.</p>
<p>The mobile app example presented here is based on the existing
codebase of the TodoMVC Backbone-Require.js example, which was discussed
in an earlier chapter, and is enhanced to support jQuery Mobile.</p>
<p><img src="img/chapter10-1-1.png" /></p>
<p><em>Screenshot of the TodoMVC app with jQuery Mobile</em></p>
<p>This implementation makes use of Grunt-BBB as well as Handlebars.js.
Additional utilities useful for mobile applications will be provided,
which can be easily combined and extended. (see the <em>Backbone
Boilerplate &amp; Grunt-BBB</em> and <em>Backbone Extensions</em>
chapters)</p>
<p><img src="img/chapter10-1-2.png" /></p>
<p><em>Workspace of the TodoMVC app with jQueryMobile and
Backbone</em></p>
<p>The order of the files loaded by Require.js is as follows:</p>
<ol type="1">
<li>jQuery</li>
<li>Underscore/Lodash</li>
<li>handlebars.compiled</li>
<li>TodoRouter (instantiates specific views)</li>
<li>jQueryMobile</li>
<li>JqueryMobileCustomInitConfig</li>
<li>Instantiation of the Backbone Router</li>
</ol>
<p>By opening the console in the project directory and then running the
Grunt-Backbone command <code>grunt handlebars</code> or
<code>grunt watch</code> in the console, it will combine and compile all
template files to <code>dist/debug/handlebars_packaged</code>. To start
the application, run <code>grunt server</code>.</p>
<p>Files instantiated, when redirected from the Backbone-Router are:</p>
<ol type="a">
<li><p><em>BasicView.js</em> and <em>basic_page_simple.template</em></p>
<p>The BasicView is responsible for the Handlebars multipage-template
processing. Its implementation of <code>render</code> calls the jQuery
Mobile API <code>$.mobile.changePage</code> to handle page navigation
and progressive widget enhancement.</p></li>
<li><p>Concrete view with its template partial</p>
<p>E.g., <code>EditTodoPage.js</code> and
<code>editTodoView.template_partial</code></p></li>
</ol>
<p>The head section of <code>index.html</code> needs to load the
<code>jquerymobile.css</code> as well as the <code>base.css</code>,
which is used by all Todo-MVC apps, and the <code>index.css</code> for
some project-specific custom CSS.</p>
<div class="sourceCode" id="cb329"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;utf-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> http-equiv</span><span class="op">=</span><span class="st">&quot;X-UA-Compatible&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;IE=edge,chrome=1&quot;</span><span class="dt">&gt;</span></span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;width=device-width,initial-scale=1&quot;</span><span class="dt">&gt;</span></span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>TodoMVC Jquery Mobile<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-9"><a href="#cb329-9" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- widget and responsive design styles --&gt;</span></span>
<span id="cb329-10"><a href="#cb329-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/assets/css/jquerymobile.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb329-11"><a href="#cb329-11" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- used by all TodoMVC apps --&gt;</span></span>
<span id="cb329-12"><a href="#cb329-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/assets/css/base.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb329-13"><a href="#cb329-13" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- custom css --&gt;</span></span>
<span id="cb329-14"><a href="#cb329-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/assets/css/index.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb329-15"><a href="#cb329-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb329-16"><a href="#cb329-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-17"><a href="#cb329-17" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb329-18"><a href="#cb329-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> data-main</span><span class="op">=</span><span class="st">&quot;/app/config&quot;</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;/assets/js/libs/require.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb329-19"><a href="#cb329-19" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb329-20"><a href="#cb329-20" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p><em>index.html</em></p>
<h3 id="workflow-with-backbone-and-jquerymobile">Workflow with Backbone
and jQueryMobile</h3>
<p>By delegating the routing and navigation functions of the jQuery
Mobile Framework to Backbone, we can profit from its clear separation of
application structure to later on easily share application logic between
a desktop webpage, tablets, and mobile apps.</p>
<p>We now need to contend with the different ways in which Backbone and
jQuery Mobile handle requests. <code>Backbone.Router</code> offers an
explicit way to define custom navigation routes, while jQuery Mobile
uses URL hash fragments to reference separate pages or views in the same
document.</p>
<p>Some of the ideas that have been previously proposed to work-around
this problem included manually patching Backbone and jQuery Mobile. The
solution demonstrated below will not only simplify the handling of the
jQuery Mobile component initialization event-cycle, but also enables use
of existing Backbone Router handlers.</p>
<p>To adapt the navigation control from jQuery Mobile to Backbone, we
first need to apply some specific settings to the
<code>mobileinit</code> event which occurs after the framework has
loaded in order to let the Backbone Router decide which page to
load.</p>
<p>A configuration which will get jQM to delegate navigation to Backbone
and which will also enable manual widget creation triggering is given
below:</p>
<div class="sourceCode" id="cb330"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="bu">document</span>)<span class="op">.</span><span class="fu">bind</span>(<span class="st">&quot;mobileinit&quot;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Disable jQM routing and component creation events   </span></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>   <span class="co">// disable hash-routing</span></span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a>   $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">hashListeningEnabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a>   <span class="co">// disable anchor-control</span></span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a>   $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">linkBindingEnabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb330-8"><a href="#cb330-8" aria-hidden="true" tabindex="-1"></a>   <span class="co">// can cause calling object creation twice and back button issues are solved</span></span>
<span id="cb330-9"><a href="#cb330-9" aria-hidden="true" tabindex="-1"></a>   $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">ajaxEnabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb330-10"><a href="#cb330-10" aria-hidden="true" tabindex="-1"></a>   <span class="co">// Otherwise after mobileinit, it tries to load a landing page</span></span>
<span id="cb330-11"><a href="#cb330-11" aria-hidden="true" tabindex="-1"></a>   $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">autoInitializePage</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb330-12"><a href="#cb330-12" aria-hidden="true" tabindex="-1"></a>   <span class="co">// we want to handle caching and cleaning the DOM ourselves</span></span>
<span id="cb330-13"><a href="#cb330-13" aria-hidden="true" tabindex="-1"></a>   $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">page</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">domCache</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb330-14"><a href="#cb330-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-15"><a href="#cb330-15" aria-hidden="true" tabindex="-1"></a><span class="co">// consider due to compatibility issues</span></span>
<span id="cb330-16"><a href="#cb330-16" aria-hidden="true" tabindex="-1"></a>   <span class="co">// not supported by all browsers</span></span>
<span id="cb330-17"><a href="#cb330-17" aria-hidden="true" tabindex="-1"></a>   $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">pushStateEnabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb330-18"><a href="#cb330-18" aria-hidden="true" tabindex="-1"></a>   <span class="co">// Solves phonegap issues with the back-button</span></span>
<span id="cb330-19"><a href="#cb330-19" aria-hidden="true" tabindex="-1"></a>   $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">phonegapNavigationEnabled</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb330-20"><a href="#cb330-20" aria-hidden="true" tabindex="-1"></a>   <span class="co">//no native datepicker will conflict with the jQM component</span></span>
<span id="cb330-21"><a href="#cb330-21" aria-hidden="true" tabindex="-1"></a>   $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">page</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">degradeInputs</span><span class="op">.</span><span class="at">date</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb330-22"><a href="#cb330-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><em>jquerymobile.config.js</em></p>
<p>The behaviour and usage of the new workflow will be explained below,
grouped by its functionalities:</p>
<ol type="a">
<li><p>Routing to a concrete View-page</p></li>
<li><p>Management of mobile page templates</p></li>
<li><p>DOM management</p></li>
<li><p>$.mobile.changePage</p></li>
</ol>
<p>In the following discussion, the steps 1-11 in the text refer to the
new workflow diagram of the mobile application below.</p>
<p><img src="img/chapter10-2-1.png" /></p>
<p><em>Workflow of TodoMVC, with Backbone and jQueryMobile</em></p>
<p>####Routing to a concrete View page, Inheriting from BasicView</p>
<p>When the hash URL changes, e.g., a link is clicked, the configuration
above prevents jQM from triggering its events. Instead, the Backbone
Router listens to the hash changes and decides which view to
request.</p>
<p>Experience has shown that, for mobile pages, it is a good practice to
create basic prototypes for jQM components such as basic pages, popups,
and dialogs, as well as for using the jQuery Validation Plugin. This
makes it much easier to exchange device-specific view logic at runtime
and adopt general strategies. This will also help to add syntax and to
support multi-chaining of prototype inheritance with JavaScript and
Backbone.</p>
<p>By creating a <code>BasicView</code> superclass, we enable all
inheriting view-pages to share a common way of handling jQM along with
common usage of a template engine and specific view handling.</p>
<p>When building with Grunt/Yeoman, the semantic templates are compiled
by Handlebar.js and the AMDs template files are combined into a single
file. By merging all page definitions into a single-file-app, it becomes
offline capable, which is important for mobile app.</p>
<h4 id="management-of-mobile-page-templates">Management of Mobile Page
Templates</h4>
<p>Within a concrete View page, you can override properties for static
values and functions to return dynamic values of the super class
<code>BasicView</code>. These values will be processed later by the
BasicView to construct the HTML of a jQuery Mobile page with the help of
Handlebars.</p>
<p>Additional dynamic template parameters, e.g., Backbone model
information, will be taken from the specific View and merged with the
ones from the BasicView.</p>
<p>A concrete View might look like:</p>
<div class="sourceCode" id="cb331"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">define</span>([</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;backbone&quot;</span><span class="op">,</span> <span class="st">&quot;modules/view/abstract/BasicView&quot;</span>]<span class="op">,</span></span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> (Backbone<span class="op">,</span> BasicView) {</span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> BasicView<span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">id</span> <span class="op">:</span> <span class="st">&quot;editTodoView&quot;</span><span class="op">,</span> </span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">getHeaderTitle</span> <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="st">&quot;Edit Todo&quot;</span><span class="op">;</span></span>
<span id="cb331-8"><a href="#cb331-8" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb331-9"><a href="#cb331-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">getSpecificTemplateValues</span> <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb331-10"><a href="#cb331-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> _<span class="op">.</span><span class="fu">clone</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span>)<span class="op">;</span></span>
<span id="cb331-11"><a href="#cb331-11" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb331-12"><a href="#cb331-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">events</span> <span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb331-13"><a href="#cb331-13" aria-hidden="true" tabindex="-1"></a>                <span class="co">// merged events of BasicView, to add an older fix for back button functionality</span></span>
<span id="cb331-14"><a href="#cb331-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> _<span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb331-15"><a href="#cb331-15" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;click #saveDescription&#39;</span> <span class="op">:</span> <span class="st">&#39;saveDescription&#39;</span></span>
<span id="cb331-16"><a href="#cb331-16" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">constructor</span><span class="op">.</span><span class="at">__super__</span><span class="op">.</span><span class="at">events</span>)<span class="op">;</span></span>
<span id="cb331-17"><a href="#cb331-17" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb331-18"><a href="#cb331-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">saveDescription</span> <span class="op">:</span> <span class="kw">function</span> (clickEvent) {</span>
<span id="cb331-19"><a href="#cb331-19" aria-hidden="true" tabindex="-1"></a>                <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">save</span>({</span>
<span id="cb331-20"><a href="#cb331-20" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">title</span> <span class="op">:</span> <span class="fu">$</span>(<span class="st">&quot;#todoDescription&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">el</span>)<span class="op">.</span><span class="fu">val</span>()</span>
<span id="cb331-21"><a href="#cb331-21" aria-hidden="true" tabindex="-1"></a>                })<span class="op">;</span></span>
<span id="cb331-22"><a href="#cb331-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb331-23"><a href="#cb331-23" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb331-24"><a href="#cb331-24" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb331-25"><a href="#cb331-25" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p><em>A concrete View (EditTodoPage.js)</em></p>
<p>By default, the BasicView uses
<code>basic_page_simple.template</code> as the Handlebars template. If
you need to use a custom template or want to introduce a new Super
abstract View with an alternate template, override the
<code>getTemplateID</code> function:</p>
<div class="sourceCode" id="cb332"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>getTemplateID <span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">&quot;custom_page_template&quot;</span><span class="op">;</span></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>By convention, the <code>id</code> attribute will be taken as the id
of the jQM page as well as the filename of the corresponding template
file to be inserted as a partial in the <code>basic_page_simple</code>
template. In the case of the <code>EditTodoPage</code> view, the name of
the file will be <code>editTodoPage.template_partial</code>.</p>
<p>Every concrete page is meant to be a partial, which will be inserted
in the <code>data-role="content"</code> element, where the parameter
<code>templatePartialPageID</code> is located.</p>
<p>Later on, the result of the <code>getHeaderTitle</code> function from
<code>EditTodoPage</code> will replace the <em>headerTitle</em> in the
abstract template.</p>
<div class="sourceCode" id="cb333"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>div data<span class="op">-</span>role<span class="op">=</span><span class="st">&quot;header&quot;</span><span class="op">&gt;</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a>        {{whatis <span class="st">&quot;Specific loaded Handlebars parameters:&quot;</span>}}</span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>        {{whatis <span class="kw">this</span>}}</span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>h2<span class="op">&gt;</span>{{headerTitle}}<span class="op">&lt;/</span>h2<span class="op">&gt;</span></span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>a id<span class="op">=</span><span class="st">&quot;backButton&quot;</span> href<span class="op">=</span><span class="st">&quot;href=&quot;</span>javascript<span class="op">:</span>history<span class="op">.</span><span class="fu">go</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span><span class="st">&quot; data-icon=&quot;</span>star<span class="st">&quot; data-rel=&quot;</span>back<span class="st">&quot; &gt;back&lt;/a&gt;</span></span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div data<span class="op">-</span>role<span class="op">=</span><span class="st">&quot;content&quot;</span><span class="op">&gt;</span></span>
<span id="cb333-8"><a href="#cb333-8" aria-hidden="true" tabindex="-1"></a>        {{whatis <span class="st">&quot;Template page trying to load:&quot;</span>}}</span>
<span id="cb333-9"><a href="#cb333-9" aria-hidden="true" tabindex="-1"></a>        {{whatis templatePartialPageID}}</span>
<span id="cb333-10"><a href="#cb333-10" aria-hidden="true" tabindex="-1"></a>        {{<span class="op">&gt;</span> templatePartialPageID}}</span>
<span id="cb333-11"><a href="#cb333-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb333-12"><a href="#cb333-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div data<span class="op">-</span>role<span class="op">=</span><span class="st">&quot;footer&quot;</span><span class="op">&gt;</span></span>
<span id="cb333-13"><a href="#cb333-13" aria-hidden="true" tabindex="-1"></a>        {{footerContent}}</span>
<span id="cb333-14"><a href="#cb333-14" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>div<span class="op">&gt;</span></span></code></pre></div>
<p><em>basic_page_simple.template</em></p>
<p><em>Note: The <code>whatis</code> Handlebars View helper does simple
logging of parameters.</em></p>
<p>All the additional parameters being returned by
<code>getSpecificTemplateValues</code> will be inserted into the
concrete template <code>editTodoPage.template_partial</code>.</p>
<p>Because <code>footerContent</code> is expected to be used rarely, its
content is returned by <code>getSpecificTemplateValues</code>.</p>
<p>In the case of the EditTodoPage view, all the model information is
being returned and <code>title</code> is used in the concrete partial
page:</p>
<div class="sourceCode" id="cb334"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;fieldcontain&quot;</span><span class="dt">&gt;</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;todoDescription&quot;</span><span class="dt">&gt;</span>Todo Description<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;todoDescription&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;todoDescription&quot;</span><span class="ot"> value</span><span class="op">=</span><span class="st">&quot;{{title}}&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;saveDescription&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;button&quot;</span><span class="ot"> data-mini</span><span class="op">=</span><span class="st">&quot;true&quot;</span><span class="dt">&gt;</span>Save<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span></code></pre></div>
<p><em>editTodoView.template_partial</em></p>
<p>When <code>render</code> is triggered, the
<code>basic_page_simple.template</code> and
<code>editTodoView.template_partial</code> templates will be loaded and
the parameters from <code>EditTodoPage</code> and <code>BasicView</code>
will be combined and generated by Handlebars to generate:</p>
<div class="sourceCode" id="cb335"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;header&quot;</span><span class="dt">&gt;</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">h2</span><span class="dt">&gt;</span>Edit Todo<span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;backButton&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;href=&quot;</span><span class="ot">javascript:history.go(-1)</span><span class="er">;&quot;</span><span class="ot"> data-icon</span><span class="op">=</span><span class="st">&quot;star&quot;</span><span class="ot"> data-rel</span><span class="op">=</span><span class="st">&quot;back&quot;</span><span class="ot"> </span><span class="dt">&gt;</span>back<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;content&quot;</span><span class="dt">&gt;</span></span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;fieldcontain&quot;</span><span class="dt">&gt;</span></span>
<span id="cb335-7"><a href="#cb335-7" aria-hidden="true" tabindex="-1"></a>       <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;todoDescription&quot;</span><span class="dt">&gt;</span>Todo Description<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb335-8"><a href="#cb335-8" aria-hidden="true" tabindex="-1"></a>       <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;todoDescription&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;todoDescription&quot;</span><span class="ot"> value</span><span class="op">=</span><span class="st">&quot;Cooking&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb335-9"><a href="#cb335-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb335-10"><a href="#cb335-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;saveDescription&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#&quot;</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;button&quot;</span><span class="ot"> data-mini</span><span class="op">=</span><span class="st">&quot;true&quot;</span><span class="dt">&gt;</span>Save<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb335-11"><a href="#cb335-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb335-12"><a href="#cb335-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-role</span><span class="op">=</span><span class="st">&quot;footer&quot;</span><span class="dt">&gt;</span></span>
<span id="cb335-13"><a href="#cb335-13" aria-hidden="true" tabindex="-1"></a>        Footer</span>
<span id="cb335-14"><a href="#cb335-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p><em>Final HTML definition resulting from basic_page_simple_template
and editTodoView.template_partial</em></p>
<p>The next section explains how the template parameters are collected
by the <code>BasicView</code> and the HTML definition is loaded.</p>
<h4 id="dom-management-and-.mobile.changepage">DOM management and
$.mobile.changePage</h4>
<p>When <code>render</code> is executed (line 29 is the source code
listing below), <code>BasicView</code> first cleans up the DOM by
removing the previous page (line 70). To delete the elements from the
DOM, <code>$.remove</code> cannot be used, but
<code>$previousEl.detach()</code> can be since <code>detach</code> does
not remove the element’s attached events and data.</p>
<p>This is important, because jQuery Mobile still needs information
(e.g., to trigger transition effects when switching to another page).
Keep in mind that the DOM data and events should be cleared later on as
well to avoid possible performance issues.</p>
<p>Other strategies than the one used in the function
<code>cleanupPossiblePageDuplicationInDOM</code> to cleanup the DOM are
viable. To only remove the old page having the same id as the current
from the DOM, when it was already requested before, would also be a
working strategy of preventing DOM duplication. Depending on what fits
best to your application needs, it is also possibly a one-banana problem
to exchange it using a caching mechanism.</p>
<p>Next, <code>BasicView</code> collects all template parameters from
the concrete View implementation and inserts the HTML of the requested
page into the body. This is done in steps 4, 5, 6, and 7 in the diagram
above (between lines 23 and 51 in the source listing).</p>
<p>Additionally, the <code>data-role</code> will be set on the jQuery
Mobile page. Commonly used attribute values are page, dialog, or
popup.</p>
<p>As you can see, (starting at line 74), the
<code>goBackInHistory</code> function contains a manual implementation
to handle the back button’s action. In certain scenarios, the back
button navigation functionality of jQuery Mobile was not working with
older versions and disabled jQMobile’s navigation system.</p>
<div class="sourceCode" id="cb336"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> <span class="fu">define</span>([</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>     <span class="st">&quot;lodash&quot;</span><span class="op">,</span></span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>     <span class="st">&quot;backbone&quot;</span><span class="op">,</span></span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span>     <span class="st">&quot;handlebars&quot;</span><span class="op">,</span></span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span>     <span class="st">&quot;handlebars_helpers&quot;</span></span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> ]<span class="op">,</span></span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> </span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> <span class="kw">function</span> (_<span class="op">,</span> Backbone<span class="op">,</span> Handlebars) {</span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span>     <span class="kw">var</span> BasicView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb336-10"><a href="#cb336-10" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>         <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-11"><a href="#cb336-11" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>             _<span class="op">.</span><span class="fu">bindAll</span>()<span class="op">;</span></span>
<span id="cb336-12"><a href="#cb336-12" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>             <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb336-13"><a href="#cb336-13" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span>         }<span class="op">,</span></span>
<span id="cb336-14"><a href="#cb336-14" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span>         <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb336-15"><a href="#cb336-15" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span>             <span class="st">&quot;click #backButton&quot;</span><span class="op">:</span> <span class="st">&quot;goBackInHistory&quot;</span></span>
<span id="cb336-16"><a href="#cb336-16" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span>         }<span class="op">,</span></span>
<span id="cb336-17"><a href="#cb336-17" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span>         <span class="dt">role</span><span class="op">:</span> <span class="st">&quot;page&quot;</span><span class="op">,</span></span>
<span id="cb336-18"><a href="#cb336-18" aria-hidden="true" tabindex="-1"></a><span class="dv">18</span>         <span class="dt">attributes</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-19"><a href="#cb336-19" aria-hidden="true" tabindex="-1"></a><span class="dv">19</span>             <span class="cf">return</span> {</span>
<span id="cb336-20"><a href="#cb336-20" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span>                 <span class="st">&quot;data-role&quot;</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">role</span></span>
<span id="cb336-21"><a href="#cb336-21" aria-hidden="true" tabindex="-1"></a><span class="dv">21</span>             }<span class="op">;</span></span>
<span id="cb336-22"><a href="#cb336-22" aria-hidden="true" tabindex="-1"></a><span class="dv">22</span>         }<span class="op">,</span></span>
<span id="cb336-23"><a href="#cb336-23" aria-hidden="true" tabindex="-1"></a><span class="dv">23</span>         <span class="dt">getHeaderTitle</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-24"><a href="#cb336-24" aria-hidden="true" tabindex="-1"></a><span class="dv">24</span>             <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getSpecificTemplateValues</span>()<span class="op">.</span><span class="at">headerTitle</span><span class="op">;</span></span>
<span id="cb336-25"><a href="#cb336-25" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span>         }<span class="op">,</span></span>
<span id="cb336-26"><a href="#cb336-26" aria-hidden="true" tabindex="-1"></a><span class="dv">26</span>         <span class="dt">getTemplateID</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-27"><a href="#cb336-27" aria-hidden="true" tabindex="-1"></a><span class="dv">27</span>             <span class="cf">return</span> <span class="st">&quot;basic_page_simple&quot;</span><span class="op">;</span></span>
<span id="cb336-28"><a href="#cb336-28" aria-hidden="true" tabindex="-1"></a><span class="dv">28</span>         }<span class="op">,</span></span>
<span id="cb336-29"><a href="#cb336-29" aria-hidden="true" tabindex="-1"></a><span class="dv">29</span>         <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-30"><a href="#cb336-30" aria-hidden="true" tabindex="-1"></a><span class="dv">30</span>             <span class="kw">this</span><span class="op">.</span><span class="fu">cleanupPossiblePageDuplicationInDOM</span>()<span class="op">;</span></span>
<span id="cb336-31"><a href="#cb336-31" aria-hidden="true" tabindex="-1"></a><span class="dv">31</span>             <span class="fu">$</span>(<span class="kw">this</span><span class="op">.</span><span class="at">el</span>)<span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">getBasicPageTemplateResult</span>())<span class="op">;</span></span>
<span id="cb336-32"><a href="#cb336-32" aria-hidden="true" tabindex="-1"></a><span class="dv">32</span>             <span class="kw">this</span><span class="op">.</span><span class="fu">addPageToDOMAndRenderJQM</span>()<span class="op">;</span></span>
<span id="cb336-33"><a href="#cb336-33" aria-hidden="true" tabindex="-1"></a><span class="dv">33</span>             <span class="kw">this</span><span class="op">.</span><span class="fu">enhanceJQMComponentsAPI</span>()<span class="op">;</span></span>
<span id="cb336-34"><a href="#cb336-34" aria-hidden="true" tabindex="-1"></a><span class="dv">34</span>         }<span class="op">,</span></span>
<span id="cb336-35"><a href="#cb336-35" aria-hidden="true" tabindex="-1"></a><span class="dv">35</span> <span class="co">// Generate HTML using the Handlebars templates</span></span>
<span id="cb336-36"><a href="#cb336-36" aria-hidden="true" tabindex="-1"></a><span class="dv">36</span>         <span class="dt">getTemplateResult</span><span class="op">:</span> <span class="kw">function</span> (templateDefinitionID<span class="op">,</span> templateValues) {</span>
<span id="cb336-37"><a href="#cb336-37" aria-hidden="true" tabindex="-1"></a><span class="dv">37</span>             <span class="cf">return</span> <span class="bu">window</span><span class="op">.</span><span class="at">JST</span>[templateDefinitionID](templateValues)<span class="op">;</span></span>
<span id="cb336-38"><a href="#cb336-38" aria-hidden="true" tabindex="-1"></a><span class="dv">38</span>         }<span class="op">,</span></span>
<span id="cb336-39"><a href="#cb336-39" aria-hidden="true" tabindex="-1"></a><span class="dv">39</span> <span class="co">// Collect all template paramters and merge them</span></span>
<span id="cb336-40"><a href="#cb336-40" aria-hidden="true" tabindex="-1"></a><span class="dv">40</span>         <span class="dt">getBasicPageTemplateResult</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-41"><a href="#cb336-41" aria-hidden="true" tabindex="-1"></a><span class="dv">41</span>             <span class="kw">var</span> templateValues <span class="op">=</span> {</span>
<span id="cb336-42"><a href="#cb336-42" aria-hidden="true" tabindex="-1"></a><span class="dv">42</span>                 <span class="dt">templatePartialPageID</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb336-43"><a href="#cb336-43" aria-hidden="true" tabindex="-1"></a><span class="dv">43</span>                 <span class="dt">headerTitle</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getHeaderTitle</span>()</span>
<span id="cb336-44"><a href="#cb336-44" aria-hidden="true" tabindex="-1"></a><span class="dv">44</span>             }<span class="op">;</span></span>
<span id="cb336-45"><a href="#cb336-45" aria-hidden="true" tabindex="-1"></a><span class="dv">45</span>             <span class="kw">var</span> specific <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getSpecificTemplateValues</span>()<span class="op">;</span></span>
<span id="cb336-46"><a href="#cb336-46" aria-hidden="true" tabindex="-1"></a><span class="dv">46</span>             $<span class="op">.</span><span class="fu">extend</span>(templateValues<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getSpecificTemplateValues</span>())<span class="op">;</span></span>
<span id="cb336-47"><a href="#cb336-47" aria-hidden="true" tabindex="-1"></a><span class="dv">47</span>             <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getTemplateResult</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">getTemplateID</span>()<span class="op">,</span> templateValues)<span class="op">;</span></span>
<span id="cb336-48"><a href="#cb336-48" aria-hidden="true" tabindex="-1"></a><span class="dv">48</span>         }<span class="op">,</span></span>
<span id="cb336-49"><a href="#cb336-49" aria-hidden="true" tabindex="-1"></a><span class="dv">49</span>         <span class="dt">getRequestedPageTemplateResult</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-50"><a href="#cb336-50" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span>             <span class="kw">this</span><span class="op">.</span><span class="fu">getBasicPageTemplateResult</span>()<span class="op">;</span></span>
<span id="cb336-51"><a href="#cb336-51" aria-hidden="true" tabindex="-1"></a><span class="dv">51</span>         }<span class="op">,</span></span>
<span id="cb336-52"><a href="#cb336-52" aria-hidden="true" tabindex="-1"></a><span class="dv">52</span>         <span class="dt">enhanceJQMComponentsAPI</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-53"><a href="#cb336-53" aria-hidden="true" tabindex="-1"></a><span class="dv">53</span> <span class="co">// changePage</span></span>
<span id="cb336-54"><a href="#cb336-54" aria-hidden="true" tabindex="-1"></a><span class="dv">54</span>             $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="fu">changePage</span>(<span class="st">&quot;#&quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> {</span>
<span id="cb336-55"><a href="#cb336-55" aria-hidden="true" tabindex="-1"></a><span class="dv">55</span>                 <span class="dt">changeHash</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb336-56"><a href="#cb336-56" aria-hidden="true" tabindex="-1"></a><span class="dv">56</span>                 <span class="dt">role</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">role</span></span>
<span id="cb336-57"><a href="#cb336-57" aria-hidden="true" tabindex="-1"></a><span class="dv">57</span>             })<span class="op">;</span></span>
<span id="cb336-58"><a href="#cb336-58" aria-hidden="true" tabindex="-1"></a><span class="dv">58</span>         }<span class="op">,</span></span>
<span id="cb336-59"><a href="#cb336-59" aria-hidden="true" tabindex="-1"></a><span class="dv">59</span> <span class="co">// Add page to DOM</span></span>
<span id="cb336-60"><a href="#cb336-60" aria-hidden="true" tabindex="-1"></a><span class="dv">60</span>         <span class="dt">addPageToDOMAndRenderJQM</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-61"><a href="#cb336-61" aria-hidden="true" tabindex="-1"></a><span class="dv">61</span>             <span class="fu">$</span>(<span class="st">&quot;body&quot;</span>)<span class="op">.</span><span class="fu">append</span>(<span class="fu">$</span>(<span class="kw">this</span><span class="op">.</span><span class="at">el</span>))<span class="op">;</span></span>
<span id="cb336-62"><a href="#cb336-62" aria-hidden="true" tabindex="-1"></a><span class="dv">62</span>             <span class="fu">$</span>(<span class="st">&quot;#&quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">id</span>)<span class="op">.</span><span class="fu">page</span>()<span class="op">;</span></span>
<span id="cb336-63"><a href="#cb336-63" aria-hidden="true" tabindex="-1"></a><span class="dv">63</span>         }<span class="op">,</span></span>
<span id="cb336-64"><a href="#cb336-64" aria-hidden="true" tabindex="-1"></a><span class="dv">64</span> <span class="co">// Cleanup DOM strategy</span></span>
<span id="cb336-65"><a href="#cb336-65" aria-hidden="true" tabindex="-1"></a><span class="dv">65</span>         <span class="dt">cleanupPossiblePageDuplicationInDOM</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb336-66"><a href="#cb336-66" aria-hidden="true" tabindex="-1"></a><span class="dv">66</span>         <span class="co">// Can also be moved to the event &quot;pagehide&quot;: or &quot;onPageHide&quot;</span></span>
<span id="cb336-67"><a href="#cb336-67" aria-hidden="true" tabindex="-1"></a><span class="dv">67</span>             <span class="kw">var</span> $previousEl <span class="op">=</span> <span class="fu">$</span>(<span class="st">&quot;#&quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb336-68"><a href="#cb336-68" aria-hidden="true" tabindex="-1"></a><span class="dv">68</span>             <span class="kw">var</span> alreadyInDom <span class="op">=</span> $previousEl<span class="op">.</span><span class="at">length</span> <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb336-69"><a href="#cb336-69" aria-hidden="true" tabindex="-1"></a><span class="dv">69</span>             <span class="cf">if</span> (alreadyInDom) {</span>
<span id="cb336-70"><a href="#cb336-70" aria-hidden="true" tabindex="-1"></a><span class="dv">70</span>                 $previousEl<span class="op">.</span><span class="fu">detach</span>()<span class="op">;</span></span>
<span id="cb336-71"><a href="#cb336-71" aria-hidden="true" tabindex="-1"></a><span class="dv">71</span>             }</span>
<span id="cb336-72"><a href="#cb336-72" aria-hidden="true" tabindex="-1"></a><span class="dv">72</span>         }<span class="op">,</span></span>
<span id="cb336-73"><a href="#cb336-73" aria-hidden="true" tabindex="-1"></a><span class="dv">73</span> <span class="co">// Strategy to always support back button with disabled navigation</span></span>
<span id="cb336-74"><a href="#cb336-74" aria-hidden="true" tabindex="-1"></a><span class="dv">74</span>         <span class="dt">goBackInHistory</span><span class="op">:</span> <span class="kw">function</span> (clickEvent) {</span>
<span id="cb336-75"><a href="#cb336-75" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span>             history<span class="op">.</span><span class="fu">go</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb336-76"><a href="#cb336-76" aria-hidden="true" tabindex="-1"></a><span class="dv">76</span>             <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb336-77"><a href="#cb336-77" aria-hidden="true" tabindex="-1"></a><span class="dv">77</span>         }</span>
<span id="cb336-78"><a href="#cb336-78" aria-hidden="true" tabindex="-1"></a><span class="dv">78</span>     })<span class="op">;</span></span>
<span id="cb336-79"><a href="#cb336-79" aria-hidden="true" tabindex="-1"></a><span class="dv">79</span> </span>
<span id="cb336-80"><a href="#cb336-80" aria-hidden="true" tabindex="-1"></a><span class="dv">80</span>     <span class="cf">return</span> BasicView<span class="op">;</span></span>
<span id="cb336-81"><a href="#cb336-81" aria-hidden="true" tabindex="-1"></a><span class="dv">81</span> })<span class="op">;</span></span></code></pre></div>
<p><em>BasicView.js</em></p>
<p>After the dynamic HTML is added to the DOM,
<code>$.mobile.changePage</code> has to be applied at step 8 (code line
54).</p>
<p>This is the most important API call, because it triggers the jQuery
Mobile component creation for the current page.</p>
<p>Next, the page will be displayed to the user at step 9.</p>
<div class="sourceCode" id="cb337"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>a data<span class="op">-</span>mini<span class="op">=</span><span class="st">&quot;true&quot;</span> data<span class="op">-</span>role<span class="op">=</span><span class="st">&quot;button&quot;</span> href<span class="op">=</span><span class="st">&quot;#&quot;</span> id<span class="op">=</span><span class="st">&quot;saveDescription&quot;</span> data<span class="op">-</span>corners<span class="op">=</span><span class="st">&quot;true&quot;</span> </span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a>data<span class="op">-</span>shadow<span class="op">=</span><span class="st">&quot;true&quot;</span> data<span class="op">-</span>iconshadow<span class="op">=</span><span class="st">&quot;true&quot;</span> data<span class="op">-</span>wrapperels<span class="op">=</span><span class="st">&quot;span&quot;</span> data<span class="op">-</span>theme<span class="op">=</span><span class="st">&quot;c&quot;</span> </span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span><span class="op">=</span><span class="st">&quot;ui-btn ui-shadow ui-btn-corner-all ui-mini ui-btn-up-c&quot;</span><span class="op">&gt;</span></span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>span <span class="kw">class</span><span class="op">=</span><span class="st">&quot;ui-btn-inner&quot;</span><span class="op">&gt;</span></span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a>         <span class="op">&lt;</span>span <span class="kw">class</span><span class="op">=</span><span class="st">&quot;ui-btn-text&quot;</span><span class="op">&gt;</span>Save<span class="op">&lt;/</span>span<span class="op">&gt;</span></span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a>     <span class="op">&lt;/</span>span<span class="op">&gt;</span></span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>a<span class="op">&gt;</span></span></code></pre></div>
<p><img src="img/chapter10-2-2.png" /></p>
<p><em>Look and feel of the written HTML code and the jQuery Mobile
enhanced Todo description page</em></p>
<p>UI enhancement is done in the <code>enhanceJQMComponentsAPI</code>
function in line 52:</p>
<div class="sourceCode" id="cb338"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>$<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="fu">changePage</span>(<span class="st">&quot;#&quot;</span> <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> {</span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>                      <span class="dt">changeHash</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>                      <span class="dt">role</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">role</span></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>                    })<span class="op">;</span></span></code></pre></div>
<p>To retain control of hash routing, <code>changeHash</code> has to be
set to false and the proper <code>role</code> parameter provided to
guarantee proper page appearance. Finally, <code>changePage</code> will
show the new page with its defined transition to the user.</p>
<p>For the basic use cases, it is advised to have one View per page, and
always render the complete page again by calling
<code>$.mobile.changePage</code> when widget enhancement needs to be
done.</p>
<p>To progress component enrichment of a newly added HTML-fragment into
the DOM, advanced techniques need to be applied to guarantee correct
appearance of the mobile components. You need to be very careful when
creating partial HTML code and updating values on UI elements. The next
section will explain how to handle these situations.</p>
<h3 id="applying-advanced-jqm-techniques-to-backbone">Applying advanced
jQM techniques to Backbone</h3>
<h4 id="dynamic-dom-scripting">Dynamic DOM Scripting</h4>
<p>The solution described above solves the issues of handling routing
with Backbone by calling <code>$.mobile.changePage('pageID')</code>.
Additionally, it guarantees that the HTML page will be completely
enhanced by the markup for jQuery Mobile.</p>
<p>The second tricky part with jQuery Mobile is to dynamically
manipulate specific DOM contents (e.g. after loading in content with
Ajax). We suggest you use this technique only if there is evidence for
an appreciable performance gain.</p>
<p>With the current version (1.3), jQM provides three ways, documented
and explained below in the official API, on forums, and blogs.</p>
<ul>
<li><p><strong>$(“pageId”).trigger(“pagecreate”)</strong></p>
<p><em>Creates markup of header, content as well as footer</em></p></li>
<li><p><strong>$(“anyElement”).trigger(“create”)</strong></p>
<p><em>Creates markup of the element as well as all
children</em></p></li>
<li><p><strong>$(“myListElement”).listview(“refresh”)</strong></p></li>
<li><p><strong>$(‘[type=“radio”]’).checkboxradio()</strong></p></li>
<li><p><strong>$(‘[type=“text”]’).textinput()</strong></p></li>
<li><p><strong>$(‘[type=“button”]’).button()</strong></p></li>
<li><p><strong>$(‘[data-role=“navbar”]’).navbar()</strong></p></li>
<li><p><strong>$(‘[type=“range”]’).slider()</strong></p></li>
<li><p><strong>$(‘select’).selectmenu()</strong></p>
<p><em>Every component of jQM offers plugins methods they can invoke to
update the state of specific UI elements.</em></p></li>
</ul>
<p>Sometimes, when creating a component from scratch, the following
error can occur: ‘cannot call methods on listview prior to
initialization’. This can be avoided, with component initialization
prior to markup enhancement, by calling it in the following way:</p>
<div class="sourceCode" id="cb339"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">$</span>(<span class="st">&#39;#mylist&#39;</span>)<span class="op">.</span><span class="fu">listview</span>()<span class="op">.</span><span class="fu">listview</span>(<span class="st">&#39;refresh&#39;</span>)</span></code></pre></div>
<p>To see more details and enhancements for further scripting pages of
JQM read their API and follow the release notes frequently.</p>
<ul>
<li><a
href="http://jquerymobile.com/test/docs/pages/page-scripting.html">jQuery
Mobile: Page Scripting</a></li>
<li><a
href="http://stackoverflow.com/questions/14468659/jquery-mobile-document-ready-vs-page-events/">jQuery
Mobile: Document Ready vs. Page Events</a></li>
<li><a
href="http://stackoverflow.com/questions/14550396/jquery-mobile-markup-enhancement-of-dynamically-added-content">StackOverflow:
Markup Enhancement of Dynamically Added Content</a></li>
</ul>
<p>If you consider using a <code>Model-Binding Plugin</code>, you will
need to come up with an automated mechanism to enrich single
components.</p>
<p>After having a look at the previous section about Dynamic DOM
Scripting, it might not be acceptable to completely re-create a
component (e.g. a Listview) which takes a longer time to load and to
reduce the complexity of event-delegation. Instead, the
component-specific plugins, which will only update the needed parts of
the HTML and CSS, should be used.</p>
<p>In the case of a Listview, you would need to call the following
function to update the list of added, edited, or removed entries:</p>
<div class="sourceCode" id="cb340"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="st">&#39;#mylist&#39;</span>)<span class="op">.</span><span class="fu">listview</span>()</span></code></pre></div>
<p>You need to come up with a means of detecting the component type to
in order to decide which plugin method needs to be called. The jQuery
Mobile Angular.js Adapter provides such a strategy and solution as
well.</p>
<p><a
href="https://github.com/tigbro/jquery-mobile-angular-adapter/blob/master/src/main/webapp/integration/jqmWidgetPatches.js">Example
of Model Binding with jQuery Mobile</a></p>
<h4 id="intercepting-jquery-mobile-events">Intercepting jQuery Mobile
Events</h4>
<p>In special situations you will need to take action on a triggered
jQuery Mobile event, which can be done as follows:</p>
<div class="sourceCode" id="cb341"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="st">&#39;#myPage&#39;</span>)<span class="op">.</span><span class="fu">live</span>(<span class="st">&#39;pagebeforecreate&#39;</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>){</span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>         <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;page was inserted into the DOM&#39;</span>)<span class="op">;</span></span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//run your own enhancement scripting here...</span></span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>          <span class="co">// prevent the page plugin from making its manipulations</span></span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb341-6"><a href="#cb341-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb341-7"><a href="#cb341-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-8"><a href="#cb341-8" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="st">&#39;#myPage&#39;</span>)<span class="op">.</span><span class="fu">live</span>(<span class="st">&#39;pagecreate&#39;</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>){</span>
<span id="cb341-9"><a href="#cb341-9" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(‘page was enhanced by jQM<span class="st">&#39;);</span></span>
<span id="cb341-10"><a href="#cb341-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>In such scenarios, it is important to know when the jQuery Mobile
events occur. The following diagram depicts the event cycle (page A is
the outgoing page and page B is the incoming page).</p>
<p><img src="img/chapter10-3-1.png" /></p>
<p><em>jQuery Mobile Event Cycle</em></p>
<p>An alternative is the jQuery Mobile Router project, which you might
use to replace the Backbone Router. With the help of the jQM Router
project, you could achieve a powerful way to intercept and route one of
the various jQM events. It is an extension to jQuery Mobile, which can
be used independently.</p>
<p>Be aware that jQM-Router misses some features of Backbone.Router and
is tightly coupled with the jQuery Mobile framework. For these reasons,
we did not use it for the TodoMVC app. If you intend to use it, consider
using a Backbone.js custom build to exclude the router code. This might
save around 25% relative to the max compressed size of 17,1 KB.</p>
<p><a href="http://gregfranko.com/backbone/customBuild/">Backbone’s
Custom Builder</a></p>
<h4 id="performance">Performance</h4>
<p>Performance is an important topic on mobile devices. jQuery Mobile
provides various tools that create performance logs which can give you a
good overview of the actual time spent in routing logic, component
enhancement, and visual effects.</p>
<p>Depending on the device, the time spent on transitions can take up to
90% of the load time. To disable all transitions, you can either pass
the transition <code>none</code> to <code>$.mobile.changePage()</code>,
in the configuration code block:</p>
<div class="sourceCode" id="cb342"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="bu">document</span>)<span class="op">.</span><span class="fu">bind</span>(<span class="st">&quot;mobileinit&quot;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>…</span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Otherwise, depending on takes up to 90% of loadtime</span></span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>  $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">defaultPageTransition</span> <span class="op">=</span> <span class="st">&quot;none&quot;</span><span class="op">;</span></span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>  $<span class="op">.</span><span class="at">mobile</span><span class="op">.</span><span class="at">defaultDialogTransition</span> <span class="op">=</span> <span class="st">&quot;none&quot;</span><span class="op">;</span></span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
<p>or consider adding device-specific settings, for example:</p>
<div class="sourceCode" id="cb343"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="bu">document</span>)<span class="op">.</span><span class="fu">bind</span>(<span class="st">&quot;mobileinit&quot;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> iosDevice <span class="op">=</span>((<span class="bu">navigator</span><span class="op">.</span><span class="at">userAgent</span><span class="op">.</span><span class="fu">match</span>(<span class="ss">/iPhone/i</span>))</span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">||</span> (<span class="bu">navigator</span><span class="op">.</span><span class="at">userAgent</span><span class="op">.</span><span class="fu">match</span>(<span class="ss">/iPod/i</span>))) <span class="op">?</span> <span class="kw">true</span> <span class="op">:</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a>  $<span class="op">.</span><span class="fu">extend</span>(  $<span class="op">.</span><span class="at">mobile</span> <span class="op">,</span> {</span>
<span id="cb343-7"><a href="#cb343-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">slideText</span> <span class="op">:</span>  (iosDevice) <span class="op">?</span> <span class="st">&quot;slide&quot;</span> <span class="op">:</span> <span class="st">&quot;none&quot;</span><span class="op">,</span></span>
<span id="cb343-8"><a href="#cb343-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">slideUpText</span> <span class="op">:</span>  (iosDevice) <span class="op">?</span> <span class="st">&quot;slideup&quot;</span> <span class="op">:</span> <span class="st">&quot;none&quot;</span><span class="op">,</span></span>
<span id="cb343-9"><a href="#cb343-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaultPageTransition</span><span class="op">:</span>(iosDevice) <span class="op">?</span> <span class="st">&quot;slide&quot;</span> <span class="op">:</span> <span class="st">&quot;none&quot;</span><span class="op">,</span></span>
<span id="cb343-10"><a href="#cb343-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaultDialogTransition</span><span class="op">:</span>(iosDevice) <span class="op">?</span> <span class="st">&quot;slide&quot;</span> <span class="op">:</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb343-11"><a href="#cb343-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<p>Also, consider doing your own pre-caching of enhanced jQuery Mobile
pages.</p>
<p>The jQuery Mobile API is frequently enhanced with regards to this
topic in each new release. We suggest you take a look at the latest
updated API to determine an optimal caching strategy with dynamic
scripting that best fits your needs.</p>
<p>For further information on performance, see the following:</p>
<ul>
<li><a
href="https://github.com/jquery/jquery-mobile/tree/master/tools">jQuery
Mobile Profiling Tools</a></li>
<li><a
href="http://backbonefu.com/2012/01/jquery-mobile-and-backbone-js-the-ugly/">Device
specific jQuery Mobile configuations</a></li>
<li><a
href="http://www.objectpartners.com/2012/11/02/use-jquery-mobile%E2%80%99s-tools-suite-to-help-you-debug-and-improve-your-jquery-mobile-application/">jQuery
Mobile Debugging tools</a></li>
<li><a
href="http://jquerymobile.com/demos/1.2.0/docs/pages/page-cache.html">jQuery
Mobile precaching functionalities</a></li>
</ul>
<h4 id="clever-multi-platform-support-management">Clever Multi-Platform
Support Management</h4>
<p>Nowadays, a company typically has an existing webpage and management
decides to provide an additional mobile app to customers. The code of
the web page and the mobile app become independent of each other and the
time required for content or feature changes becomes much higher than
for the webpage alone.</p>
<p>As the trend is towards an increasing number of mobile platforms and
dimensions, the effort required to support them is only increasing as
well. Ultimately, creating per-device experiences is not always viable.
However, it is essential that content is available to all users,
regardless of their browser and platform. This principle must be kept in
mind during the design phase.</p>
<p><em><a href="http://www.lukew.com/ff/entry.asp?933">Responsive
Design</a></em> and <em><a
href="http://www.abookapart.com/products/mobile-first">Mobile
First</a></em> approaches address these challenges.</p>
<p>The mobile app architecture presented in this chapter takes care of a
lot of the actual heavy lifting required, as it supports responsive
layouts out of the box and even supports browsers which cannot handle
media queries. It might not be obvious that jQM is a UI framework not
dissimilar to jQuery UI. jQuery Mobile is using the widget factory and
is capable of being used for more than just mobile environments.</p>
<p>To support multi-platform browsers using jQuery Mobile and Backbone,
you can, in order of increasing time and effort:</p>
<ol type="1">
<li>Ideally, have one code project, where only CSS differs for different
devices.</li>
<li>Same code project, and at runtime different HTML templates and
super-classes are exchanged per device type.</li>
<li>Same code project, and the Responsive Design API and most widgets of
jQuery Mobile will be reused. For the desktop browser, some components
will be added by another widget framework (e.g. <em>jQueryUI</em> or
<em>Twitter Boostrap</em>), e.g. controlled by the HTML templating.</li>
<li>Same code project, and at runtime, jQuery Mobile will be completely
replaced by another widget framework (e.g. <em>jQueryUI</em> or
<em>Twitter Boostrap</em>). Super-classes and configurations, as well as
concrete Backbone.View code snippets need to be replaced.</li>
<li>Different code projects, but common modules are reused.</li>
<li>For the desktop app, there is a completely separate code project.
Reasons might be the usage of complete different programming languagages
and/or frameworks, lack of Responsive Design knowledge or legacy of
pollution.</li>
</ol>
<p>The ideal solution, to build a nice-looking desktop application with
only one mobile framework, sounds crazy, but is feasible.</p>
<p>If you have a look at the jQuery Mobile API page in a desktop
browser, it does not look anything like a mobile application.</p>
<p><img src="img/chapter10-3-3.png" /></p>
<p><em>Desktop view of the jQuery Mobile API and Docs application
(http://view.jquerymobile.com/1.3.0/)</em></p>
<p>The same goes for the jQuery Mobile design examples, where jQuery
Mobile intends to add further user interface experiences.</p>
<p><img src="img/chapter10-3-4.png" /></p>
<p><em>Design examples of jQuery Mobile for desktop environments,
http://jquerymobile.com/designs/#desktop</em></p>
<p>The accordions, date-pickers, sliders - everything in the desktop UI
is re-using what jQM would be providing users on mobile devices. By way
of example, adding the attribute <code>data-mini="true"</code> on
components will lose the clumsiness of the mobile widgets on a desktop
browser.</p>
<p>See
http://jquerymobile.com/demos/1.2.0/docs/forms/forms-all-mini.html,
Mini-widgets for desktop applications by jQuery Mobile.</p>
<p>Thanks to some media queries, the desktop UI can make optimal use of
whitespace, expanding component blocks out and providing alternative
layouts while still making use of jQM as the component framework.</p>
<p>The benefit of this is that you don’t need to pull in another widget
framework (e.g., jQuery UI) separately to be able to take advantage of
these features. Thanks to the ThemeRoller, the components can look
pretty much exactly how you would like them to and users of the app can
get a jQM UI for lower-resolutions and a jQM-ish UI for everything
else.</p>
<p>The take away here is just to remember that if you are not already
going through the hassle of conditional script/style loading based on
screen-resolution (using matchMedia.js, etc.), there are simpler
approaches that can be taken to cross-device component theming. At least
the Responsive Design API of jQuery Mobile, which was added since
version 1.3.0, is always reasonable because it will work for mobile as
well as for desktop. In summary, you can manage jQuery Mobile components
to give users a typical desktop appearance and they will not realize a
difference.</p>
<p><a
href="http://view.jquerymobile.com/1.3.0/docs/intro/rwd.php">Responsive
Design with jQuery Mobile</a></p>
<p>Also, if you hit your limits of CSS-styling and configurations of
your jQuery Mobile application for desktop browsers, the additional
effort to use jQuery Mobile and Twitter Bootstrap together can be quite
simple. In the case that a desktop browser requests the page and Twitter
Bootstrap has been loaded, the mobile TodoMVC app would need conditional
code to not trigger the jQM Widget processive enhancement plugins API
(demonstrated in the <em>Dynamic DOM Scripting</em> section) in the
Backbone.View implementation. Therefore, as explained in the previous
sections, we recommend triggering widget enhancements by
<code>$.mobile.changePage</code> only once to load the complete
page.</p>
<p>An example of such a widget hybrid usage can be seen here:</p>
<p><img src="img/chapter10-3-2.png" /></p>
<p><em><a href="http://appengine.beecoss.com">Appengine boilerplate,
desktop and mobile appearance</a></em></p>
<p>Although it is using server-side technologies for templating using
the programming language Python, the principle of triggering progressive
enhancement at page load is the same as
<code>$mobile.changePage</code>.</p>
<p>As you can see, the JavaScript and even the CSS stays the same. The
only device-specific conditions and differences in implementations are
for selecting the appropriate framework imports, which are located in
the HTML template:</p>
<div class="sourceCode" id="cb344"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a> {% if is_mobile %}</span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/mobile/jquery.mobile-1.1.0.min.css&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>    {% else %}</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;apple-touch-icon&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/apple-touch-icon.png&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/css/style.css&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/css/bootstrap.min.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/css/bootstrap-responsive.min.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb344-9"><a href="#cb344-9" aria-hidden="true" tabindex="-1"></a>    {% endif %}</span>
<span id="cb344-10"><a href="#cb344-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;/css/main.css&quot;</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb344-11"><a href="#cb344-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-12"><a href="#cb344-12" aria-hidden="true" tabindex="-1"></a>    {% block mediaCSS %}{% endblock %}</span>
<span id="cb344-13"><a href="#cb344-13" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb344-14"><a href="#cb344-14" aria-hidden="true" tabindex="-1"></a> {% if is_mobile %}</span>
<span id="cb344-15"><a href="#cb344-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;/mobile/jquery.mobile-1.1.0.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb344-16"><a href="#cb344-16" aria-hidden="true" tabindex="-1"></a>    {% else %}</span>
<span id="cb344-17"><a href="#cb344-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;/js/libs/bootstrap.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb344-18"><a href="#cb344-18" aria-hidden="true" tabindex="-1"></a>    {% endif %}</span>
<span id="cb344-19"><a href="#cb344-19" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
<h1 id="unit-testing">Unit Testing</h1>
<p>One definition of unit testing is the process of taking the smallest
piece of testable code in an application, isolating it from the
remainder of your codebase, and determining if it behaves exactly as
expected.</p>
<p>For an application to be considered ‘well-tested’, each function
should ideally have its own separate unit tests where it’s tested
against the different conditions you expect it to handle. All tests must
pass before functionality is considered ‘complete’. This allows
developers to both modify a unit of code and its dependencies with a
level of confidence about whether these changes have caused any
breakage.</p>
<p>A basic example of unit testing is where a developer asserts that
passing specific values to a sum function results in the correct value
being returned. For an example more relevant to this book, we may wish
to assert that adding a new Todo item to a list correctly adds a Model
of a specific type to a Todos Collection.</p>
<p>When building modern web-applications, it’s typically considered
best-practice to include automated unit testing as a part of your
development process. In the following chapters we are going to look at
three different solutions for unit testing your Backbone.js apps -
Jasmine, QUnit and SinonJS.</p>
<h1 id="jasmine">Jasmine</h1>
<h2 id="behavior-driven-development">Behavior-Driven Development</h2>
<p>In this section, we’ll be taking a look at how to unit test Backbone
applications using a popular JavaScript testing framework called <a
href="http://pivotal.github.com/jasmine/">Jasmine</a> from Pivotal
Labs.</p>
<p>Jasmine describes itself as a behavior-driven development (BDD)
framework for testing JavaScript code. Before we jump into how the
framework works, it’s useful to understand exactly what <a
href="http://en.wikipedia.org/wiki/Behavior_Driven_Development">BDD</a>
is.</p>
<p>BDD is a second-generation testing approach first described by <a
href="http://dannorth.net/introducing-bdd/">Dan North</a> (the authority
on BDD) which attempts to test the behavior of software. It’s considered
second-generation as it came out of merging ideas from Domain driven
design (DDD) and lean software development. BDD helps teams deliver
high-quality software by answering many of the more confusing questions
early on in the agile process. Such questions commonly include those
concerning documentation and testing.</p>
<p>If you were to read a book on BDD, it’s likely that it would be
described as being ‘outside-in and pull-based’. The reason for this is
that it borrows the idea of ‘pulling features’ from Lean manufacturing
which effectively ensures that the right software solutions are being
written by a) focusing on the expected outputs of the system and b)
ensuring these outputs are achieved.</p>
<p>BDD recognizes that there are usually multiple stakeholders in a
project and not a single amorphous user of the system. These different
groups will be affected by the software being written in differing ways
and will have varying opinions of what quality in the system means to
them. It’s for this reason that it’s important to understand who the
software will be bringing value to and exactly what in it will be
valuable to them.</p>
<p>Finally, BDD relies on automation. Once you’ve defined the quality
expected, your team will want to check on the functionality of the
solution being built regularly and compare it to the results they
expect. In order to facilitate this efficiently, the process has to be
automated. BDD relies heavily on the automation of specification-testing
and Jasmine is a tool which can assist with this.</p>
<p>BDD helps both developers and non-technical stakeholders:</p>
<ul>
<li>Better understand and represent the models of the problems being
solved</li>
<li>Explain supported test cases in a language that non-developers can
read</li>
<li>Focus on minimizing translation of the technical code being written
and the domain language spoken by the business</li>
</ul>
<p>What this means is that developers should be able to show Jasmine
unit tests to a project stakeholder and (at a high level, thanks to a
common vocabulary being used) they’ll ideally be able to understand what
the code supports.</p>
<p>Developers often implement BDD in unison with another testing
paradigm known as <a
href="http://en.wikipedia.org/wiki/Test-driven_development">TDD</a>
(test-driven development). The main idea behind TDD is using the
following development process:</p>
<ol type="1">
<li>Write unit tests which describe the functionality you would like
your code to support</li>
<li>Watch these tests fail (as the code to support them hasn’t yet been
written)</li>
<li>Write code to make the tests pass</li>
<li>Rinse, repeat, and refactor</li>
</ol>
<p>In this chapter we’re going to use BDD (with TDD) to write unit tests
for a Backbone application.</p>
<p><strong><em>Note:</em></strong> I’ve seen a lot of developers also
opt for writing tests to validate behavior of their code after having
written it. While this is fine, note that it can come with pitfalls such
as only testing for behavior your code currently supports, rather than
the behavior needed to fully solve the problem.</p>
<h2 id="suites-specs-spies">Suites, Specs, &amp; Spies</h2>
<p>When using Jasmine, you’ll be writing suites and specifications
(specs). Suites basically describe scenarios while specs describe what
can be done in these scenarios.</p>
<p>Each spec is a JavaScript function, described with a call to
<code>it()</code> using a description string and a function. The
description should describe the behaviour the particular unit of code
should exhibit and, keeping in mind BDD, it should ideally be
meaningful. Here’s an example of a basic spec:</p>
<div class="sourceCode" id="cb345"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;should be incrementing in value&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a>    counter<span class="op">++;</span></span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>On its own, a spec isn’t particularly useful until expectations are
set about the behavior of the code. Expectations in specs are defined
using the <code>expect()</code> function and an <a
href="https://github.com/pivotal/jasmine/wiki/Matchers">expectation
matcher</a> (e.g., <code>toEqual()</code>, <code>toBeTruthy()</code>,
<code>toContain()</code>). A revised example using an expectation
matcher would look like:</p>
<div class="sourceCode" id="cb346"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;should be incrementing in value&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>    counter<span class="op">++;</span></span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(counter)<span class="op">.</span><span class="fu">toEqual</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The above code passes our behavioral expectation as
<code>counter</code> equals 1. Notice how easy it was to read the
expectation on the last line (you probably grokked it without any
explanation).</p>
<p>Specs are grouped into suites which we describe using Jasmine’s
<code>describe()</code> function, again passing a string as a
description and a function as we did for <code>it()</code>. The
name/description for your suite is typically that of the component or
module you’re testing.</p>
<p>Jasmine will use the description as the group name when it reports
the results of the specs you’ve asked it to run. A simple suite
containing our sample spec could look like:</p>
<div class="sourceCode" id="cb347"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Stats&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&#39;can increment a number&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-6"><a href="#cb347-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&#39;can subtract a number&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb347-7"><a href="#cb347-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb347-8"><a href="#cb347-8" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb347-9"><a href="#cb347-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Suites also share a functional scope, so it’s possible to declare
variables and functions inside a describe block which are accessible
within specs:</p>
<div class="sourceCode" id="cb348"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Stats&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> counter <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&#39;can increment a number&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// the counter was = 1</span></span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a>        counter <span class="op">=</span> counter <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb348-7"><a href="#cb348-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(counter)<span class="op">.</span><span class="fu">toEqual</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb348-8"><a href="#cb348-8" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb348-9"><a href="#cb348-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-10"><a href="#cb348-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&#39;can subtract a number&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb348-11"><a href="#cb348-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// the counter was = 2</span></span>
<span id="cb348-12"><a href="#cb348-12" aria-hidden="true" tabindex="-1"></a>        counter <span class="op">=</span> counter <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb348-13"><a href="#cb348-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(counter)<span class="op">.</span><span class="fu">toEqual</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb348-14"><a href="#cb348-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb348-15"><a href="#cb348-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong><em>Note:</em></strong> Suites are executed in the order in
which they are described, which can be useful to know if you would
prefer to see test results for specific parts of your application
reported first.</p>
<p>Jasmine also supports <strong>spies</strong> - a way to mock, spy,
and fake behavior in our unit tests. Spies replace the function they’re
spying on, allowing us to simulate behavior we would like to mock (i.e.,
test without using the actual implementation).</p>
<p>In the example below, we’re spying on the <code>setComplete</code>
method of a dummy Todo function to test that arguments can be passed to
it as expected.</p>
<div class="sourceCode" id="cb349"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Todo <span class="op">=</span> <span class="kw">function</span>(){</span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-4"><a href="#cb349-4" aria-hidden="true" tabindex="-1"></a>Todo<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">setComplete</span> <span class="op">=</span> <span class="kw">function</span> (arg){</span>
<span id="cb349-5"><a href="#cb349-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> arg<span class="op">;</span></span>
<span id="cb349-6"><a href="#cb349-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb349-7"><a href="#cb349-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-8"><a href="#cb349-8" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;a simple spy&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb349-9"><a href="#cb349-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&#39;should spy on an instance method of a Todo&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb349-10"><a href="#cb349-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> myTodo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb349-11"><a href="#cb349-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">spyOn</span>(myTodo<span class="op">,</span> <span class="st">&#39;setComplete&#39;</span>)<span class="op">;</span></span>
<span id="cb349-12"><a href="#cb349-12" aria-hidden="true" tabindex="-1"></a>        myTodo<span class="op">.</span><span class="fu">setComplete</span>(<span class="st">&#39;foo bar&#39;</span>)<span class="op">;</span></span>
<span id="cb349-13"><a href="#cb349-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-14"><a href="#cb349-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(myTodo<span class="op">.</span><span class="at">setComplete</span>)<span class="op">.</span><span class="fu">toHaveBeenCalledWith</span>(<span class="st">&#39;foo bar&#39;</span>)<span class="op">;</span></span>
<span id="cb349-15"><a href="#cb349-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-16"><a href="#cb349-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> myTodo2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb349-17"><a href="#cb349-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">spyOn</span>(myTodo2<span class="op">,</span> <span class="st">&#39;setComplete&#39;</span>)<span class="op">;</span></span>
<span id="cb349-18"><a href="#cb349-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-19"><a href="#cb349-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(myTodo2<span class="op">.</span><span class="at">setComplete</span>)<span class="op">.</span><span class="at">not</span><span class="op">.</span><span class="fu">toHaveBeenCalled</span>()<span class="op">;</span></span>
<span id="cb349-20"><a href="#cb349-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-21"><a href="#cb349-21" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb349-22"><a href="#cb349-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>You are more likely to use spies for testing <a
href="http://en.wikipedia.org/wiki/Asynchronous_communication">asynchronous</a>
behavior in your application such as AJAX requests. Jasmine
supports:</p>
<ul>
<li>Writing tests which can mock AJAX requests using spies. This allows
us to test both the code that initiates the AJAX request and the code
executed upon its completion. It’s also possible to mock/fake the server
responses. The benefit of this type of testing is that it’s faster as no
real calls are being made to a server. The ability to simulate any
response from the server is also of great benefit.</li>
<li>Asynchronous tests which don’t rely on spies</li>
</ul>
<p>This example of the first kind of test shows how to fake an AJAX
request and verify that the request was both calling the correct URL and
executed a callback where one was provided.</p>
<div class="sourceCode" id="cb350"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;the callback should be executed on success&#39;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// `.and.callFake()` calls a passed function when a spy</span></span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// has been called</span></span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">spyOn</span>($<span class="op">,</span> <span class="st">&#39;ajax&#39;</span>)<span class="op">.</span><span class="at">and</span><span class="op">.</span><span class="fu">callFake</span>(<span class="kw">function</span>(options) {</span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a>        options<span class="op">.</span><span class="fu">success</span>()<span class="op">;</span></span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb350-8"><a href="#cb350-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-9"><a href="#cb350-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a new spy</span></span>
<span id="cb350-10"><a href="#cb350-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> callback <span class="op">=</span> jasmine<span class="op">.</span><span class="fu">createSpy</span>()<span class="op">;</span></span>
<span id="cb350-11"><a href="#cb350-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-12"><a href="#cb350-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Exexute the spy callback if the</span></span>
<span id="cb350-13"><a href="#cb350-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// request for Todo 15 is successful</span></span>
<span id="cb350-14"><a href="#cb350-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">getTodo</span>(<span class="dv">15</span><span class="op">,</span> callback)<span class="op">;</span></span>
<span id="cb350-15"><a href="#cb350-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-16"><a href="#cb350-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Verify that the URL of the most recent call</span></span>
<span id="cb350-17"><a href="#cb350-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// matches our expected Todo item.</span></span>
<span id="cb350-18"><a href="#cb350-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>($<span class="op">.</span><span class="at">ajax</span><span class="op">.</span><span class="at">calls</span><span class="op">.</span><span class="fu">mostRecent</span>()<span class="op">.</span><span class="at">args</span>[<span class="dv">0</span>][<span class="st">&#39;url&#39;</span>])<span class="op">.</span><span class="fu">toEqual</span>(<span class="st">&#39;/todos/15&#39;</span>)<span class="op">;</span></span>
<span id="cb350-19"><a href="#cb350-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-20"><a href="#cb350-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// `expect(x).toHaveBeenCalled()` will pass if `x` is a</span></span>
<span id="cb350-21"><a href="#cb350-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// spy and was called.</span></span>
<span id="cb350-22"><a href="#cb350-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(callback)<span class="op">.</span><span class="fu">toHaveBeenCalled</span>()<span class="op">;</span></span>
<span id="cb350-23"><a href="#cb350-23" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb350-24"><a href="#cb350-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-25"><a href="#cb350-25" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getTodo</span>(id<span class="op">,</span> callback) {</span>
<span id="cb350-26"><a href="#cb350-26" aria-hidden="true" tabindex="-1"></a>    $<span class="op">.</span><span class="fu">ajax</span>({</span>
<span id="cb350-27"><a href="#cb350-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;GET&#39;</span><span class="op">,</span></span>
<span id="cb350-28"><a href="#cb350-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/todos/&#39;</span> <span class="op">+</span> id<span class="op">,</span></span>
<span id="cb350-29"><a href="#cb350-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dataType</span><span class="op">:</span> <span class="st">&#39;json&#39;</span><span class="op">,</span></span>
<span id="cb350-30"><a href="#cb350-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">success</span><span class="op">:</span> callback</span>
<span id="cb350-31"><a href="#cb350-31" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb350-32"><a href="#cb350-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>All of these are Spy-specific matchers and are documented on the
Jasmine <a
href="https://github.com/pivotal/jasmine/wiki/Spies">wiki</a>.</p>
<p>For the second type of test (asynchronous tests), we can take the
above further by taking advantage of three other methods Jasmine
supports:</p>
<ul>
<li><a
href="https://github.com/pivotal/jasmine/wiki/Asynchronous-specs">waits(timeout)</a>
- a native timeout before the next block is run</li>
<li><a
href="https://github.com/pivotal/jasmine/wiki/Asynchronous-specs">waitsFor(function,
optional message, optional timeout)</a> - a way to pause specs until
some other work has completed. Jasmine waits until the supplied function
returns true here before it moves on to the next block.</li>
<li><a
href="https://github.com/pivotal/jasmine/wiki/Asynchronous-specs">runs(function)</a>
- a block which runs as if it was directly called. They exist so that we
can test asynchronous processes.</li>
</ul>
<div class="sourceCode" id="cb351"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;should make an actual AJAX request to a server&#39;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a new spy</span></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> callback <span class="op">=</span> jasmine<span class="op">.</span><span class="fu">createSpy</span>()<span class="op">;</span></span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Exexute the spy callback if the</span></span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// request for Todo 16 is successful</span></span>
<span id="cb351-8"><a href="#cb351-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">getTodo</span>(<span class="dv">16</span><span class="op">,</span> callback)<span class="op">;</span></span>
<span id="cb351-9"><a href="#cb351-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-10"><a href="#cb351-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pause the spec until the callback count is</span></span>
<span id="cb351-11"><a href="#cb351-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// greater than 0</span></span>
<span id="cb351-12"><a href="#cb351-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">waitsFor</span>(<span class="kw">function</span>() {</span>
<span id="cb351-13"><a href="#cb351-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> callback<span class="op">.</span><span class="at">callCount</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb351-14"><a href="#cb351-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb351-15"><a href="#cb351-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-16"><a href="#cb351-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Once the wait is complete, our runs() block</span></span>
<span id="cb351-17"><a href="#cb351-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// will check to ensure our spy callback has been</span></span>
<span id="cb351-18"><a href="#cb351-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// called</span></span>
<span id="cb351-19"><a href="#cb351-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">runs</span>(<span class="kw">function</span>() {</span>
<span id="cb351-20"><a href="#cb351-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(callback)<span class="op">.</span><span class="fu">toHaveBeenCalled</span>()<span class="op">;</span></span>
<span id="cb351-21"><a href="#cb351-21" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb351-22"><a href="#cb351-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb351-23"><a href="#cb351-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-24"><a href="#cb351-24" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getTodo</span>(id<span class="op">,</span> callback) {</span>
<span id="cb351-25"><a href="#cb351-25" aria-hidden="true" tabindex="-1"></a>    $<span class="op">.</span><span class="fu">ajax</span>({</span>
<span id="cb351-26"><a href="#cb351-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;GET&#39;</span><span class="op">,</span></span>
<span id="cb351-27"><a href="#cb351-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;todos.json&#39;</span><span class="op">,</span></span>
<span id="cb351-28"><a href="#cb351-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dataType</span><span class="op">:</span> <span class="st">&#39;json&#39;</span><span class="op">,</span></span>
<span id="cb351-29"><a href="#cb351-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">success</span><span class="op">:</span> callback</span>
<span id="cb351-30"><a href="#cb351-30" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb351-31"><a href="#cb351-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong><em>Note:</em></strong> It’s useful to remember that when
making real requests to a web server in your unit tests, this has the
potential to massively slow down the speed at which tests run (due to
many factors including server latency). As this also introduces an
external dependency that can (and should) be minimized in your unit
testing, it is strongly recommended that you opt for spies to remove the
dependency on a web server.</p>
<h2 id="beforeeach-and-aftereach">beforeEach() and afterEach()</h2>
<p>Jasmine also supports specifying code that can be run before each
(<code>beforeEach()</code>) and after each (<code>afterEach()</code>)
test. This is useful for enforcing consistent conditions (such as
resetting variables that may be required by specs). In the following
example, <code>beforeEach()</code> is used to create a new sample Todo
model which specs can use for testing attributes.</p>
<div class="sourceCode" id="cb352"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">beforeEach</span>(<span class="kw">function</span>(){</span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">this</span><span class="op">.</span><span class="at">todo</span> <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>({</span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;Buy some more groceries&#39;</span><span class="op">,</span></span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">done</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb352-6"><a href="#cb352-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb352-7"><a href="#cb352-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-8"><a href="#cb352-8" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;should contain a text value if not the default value&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb352-9"><a href="#cb352-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">expect</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todo</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;text&#39;</span>))<span class="op">.</span><span class="fu">toEqual</span>(<span class="st">&#39;Buy some more groceries&#39;</span>)<span class="op">;</span></span>
<span id="cb352-10"><a href="#cb352-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Each nested <code>describe()</code> in your tests can have their own
<code>beforeEach()</code> and <code>afterEach()</code> methods which
support including setup and teardown methods relevant to a particular
suite.</p>
<p><code>beforeEach()</code> and <code>afterEach()</code> can be used
together to write tests verifying that our Backbone routes are being
correctly triggered when we navigate to the URL. We can start with the
<code>index</code> action:</p>
<div class="sourceCode" id="cb353"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Todo routes&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">beforeEach</span>(<span class="kw">function</span>(){</span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Create a new router</span></span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span> <span class="op">=</span> <span class="kw">new</span> App<span class="op">.</span><span class="fu">TodoRouter</span>()<span class="op">;</span></span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-8"><a href="#cb353-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Create a new spy</span></span>
<span id="cb353-9"><a href="#cb353-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">routerSpy</span> <span class="op">=</span> jasmine<span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb353-10"><a href="#cb353-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-11"><a href="#cb353-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Begin monitoring hashchange events</span></span>
<span id="cb353-12"><a href="#cb353-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>{</span>
<span id="cb353-13"><a href="#cb353-13" aria-hidden="true" tabindex="-1"></a>            Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">start</span>({</span>
<span id="cb353-14"><a href="#cb353-14" aria-hidden="true" tabindex="-1"></a>                <span class="dt">silent</span><span class="op">:</span><span class="kw">true</span><span class="op">,</span></span>
<span id="cb353-15"><a href="#cb353-15" aria-hidden="true" tabindex="-1"></a>                <span class="dt">pushState</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb353-16"><a href="#cb353-16" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb353-17"><a href="#cb353-17" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">catch</span>(e){</span>
<span id="cb353-18"><a href="#cb353-18" aria-hidden="true" tabindex="-1"></a>           <span class="co">// ...</span></span>
<span id="cb353-19"><a href="#cb353-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb353-20"><a href="#cb353-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-21"><a href="#cb353-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Navigate to a URL</span></span>
<span id="cb353-22"><a href="#cb353-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="fu">navigate</span>(<span class="st">&#39;/js/spec/SpecRunner.html&#39;</span>)<span class="op">;</span></span>
<span id="cb353-23"><a href="#cb353-23" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span> </span>
<span id="cb353-24"><a href="#cb353-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-25"><a href="#cb353-25" aria-hidden="true" tabindex="-1"></a>   <span class="fu">afterEach</span>(<span class="kw">function</span>(){</span>
<span id="cb353-26"><a href="#cb353-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-27"><a href="#cb353-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Navigate back to the URL</span></span>
<span id="cb353-28"><a href="#cb353-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="fu">navigate</span>(<span class="st">&#39;/js/spec/SpecRunner.html&#39;</span>)<span class="op">;</span></span>
<span id="cb353-29"><a href="#cb353-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-30"><a href="#cb353-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Disable Backbone.history temporarily.</span></span>
<span id="cb353-31"><a href="#cb353-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Note that this is not really useful in real apps but is</span></span>
<span id="cb353-32"><a href="#cb353-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// good for testing routers</span></span>
<span id="cb353-33"><a href="#cb353-33" aria-hidden="true" tabindex="-1"></a>        Backbone<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">stop</span>()<span class="op">;</span></span>
<span id="cb353-34"><a href="#cb353-34" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb353-35"><a href="#cb353-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-36"><a href="#cb353-36" aria-hidden="true" tabindex="-1"></a>   <span class="fu">it</span>(<span class="st">&#39;should call the index route correctly&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb353-37"><a href="#cb353-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="fu">bind</span>(<span class="st">&#39;route:index&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">routerSpy</span><span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb353-38"><a href="#cb353-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="fu">navigate</span>(<span class="st">&#39;&#39;</span><span class="op">,</span> {<span class="dt">trigger</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb353-39"><a href="#cb353-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-40"><a href="#cb353-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">// If everything in our beforeEach() and afterEach()</span></span>
<span id="cb353-41"><a href="#cb353-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// calls have been correctly executed, the following</span></span>
<span id="cb353-42"><a href="#cb353-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// should now pass.</span></span>
<span id="cb353-43"><a href="#cb353-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(<span class="kw">this</span><span class="op">.</span><span class="at">routerSpy</span>)<span class="op">.</span><span class="fu">toHaveBeenCalledOnce</span>()<span class="op">;</span></span>
<span id="cb353-44"><a href="#cb353-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(<span class="kw">this</span><span class="op">.</span><span class="at">routerSpy</span>)<span class="op">.</span><span class="fu">toHaveBeenCalledWith</span>()<span class="op">;</span></span>
<span id="cb353-45"><a href="#cb353-45" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb353-46"><a href="#cb353-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-47"><a href="#cb353-47" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The actual TodoRouter for that would make the above test pass looks
like:</p>
<div class="sourceCode" id="cb354"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> App <span class="op">=</span> App <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>App<span class="op">.</span><span class="at">TodoRouter</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">routes</span><span class="op">:</span>{</span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;&#39;</span><span class="op">:</span> <span class="st">&#39;index&#39;</span></span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">index</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">//...</span></span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="shared-scope">Shared scope</h2>
<p>Let’s imagine we have a Suite where we wish to check for the
existence of a new Todo item instance. This could be done by duplicating
the spec as follows:</p>
<div class="sourceCode" id="cb355"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&quot;Todo tests&quot;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">// Spec</span></span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">it</span>(<span class="st">&quot;Should be defined when we create it&quot;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// A Todo item we are testing</span></span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>(<span class="st">&quot;Get the milk&quot;</span><span class="op">,</span> <span class="st">&quot;Tuesday&quot;</span>)<span class="op">;</span></span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(todo)<span class="op">.</span><span class="fu">toBeDefined</span>()<span class="op">;</span></span>
<span id="cb355-8"><a href="#cb355-8" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span> </span>
<span id="cb355-9"><a href="#cb355-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-10"><a href="#cb355-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">it</span>(<span class="st">&quot;Should have the correct title&quot;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb355-11"><a href="#cb355-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Where we introduce code duplication</span></span>
<span id="cb355-12"><a href="#cb355-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>(<span class="st">&quot;Get the milk&quot;</span><span class="op">,</span> <span class="st">&quot;Tuesday&quot;</span>)<span class="op">;</span></span>
<span id="cb355-13"><a href="#cb355-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(todo<span class="op">.</span><span class="at">title</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="st">&quot;Get the milk&quot;</span>)<span class="op">;</span></span>
<span id="cb355-14"><a href="#cb355-14" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb355-15"><a href="#cb355-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-16"><a href="#cb355-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>As you can see, we’ve introduced duplication that should ideally be
refactored into something cleaner. We can do this using Jasmine’s Suite
(Shared) Functional Scope.</p>
<p>All of the specs within the same Suite share the same functional
scope, meaning that variables declared within the Suite itself are
available to all of the Specs in that suite. This gives us a way to work
around our duplication problem by moving the creation of our Todo
objects into the common functional scope:</p>
<div class="sourceCode" id="cb356"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&quot;Todo tests&quot;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The instance of Todo, the object we wish to test</span></span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// is now in the shared functional scope</span></span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>(<span class="st">&quot;Get the milk&quot;</span><span class="op">,</span> <span class="st">&quot;Tuesday&quot;</span>)<span class="op">;</span></span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-7"><a href="#cb356-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Spec</span></span>
<span id="cb356-8"><a href="#cb356-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&quot;should be correctly defined&quot;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb356-9"><a href="#cb356-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(todo)<span class="op">.</span><span class="fu">toBeDefined</span>()<span class="op">;</span></span>
<span id="cb356-10"><a href="#cb356-10" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb356-11"><a href="#cb356-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-12"><a href="#cb356-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&quot;should have the correct title&quot;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb356-13"><a href="#cb356-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(todo<span class="op">.</span><span class="at">title</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="st">&quot;Get the milk&quot;</span>)<span class="op">;</span></span>
<span id="cb356-14"><a href="#cb356-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb356-15"><a href="#cb356-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-16"><a href="#cb356-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>In the previous section you may have noticed that we initially
declared <code>this.todo</code> within the scope of our
<code>beforeEach()</code> call and were then able to continue using this
reference in <code>afterEach()</code>.</p>
<p>This is again down to shared function scope, which allows such
declarations to be common to all blocks (including
<code>runs()</code>).</p>
<p>Variables declared outside of the shared scope (i.e. within the local
scope <code>var todo=...</code>) will however not be shared.</p>
<h2 id="getting-set-up-1">Getting set up</h2>
<p>Now that we’ve reviewed some fundamentals, let’s go through
downloading Jasmine and getting everything set up to write tests.</p>
<p>A standalone release of Jasmine can be <a
href="https://github.com/pivotal/jasmine/releases/">downloaded</a> from
the official release page.</p>
<p>You’ll need a file called SpecRunner.html in addition to the release.
It can be downloaded from
https://github.com/pivotal/jasmine/tree/master/lib/jasmine-core/example
or as part of a download of the complete Jasmine <a
href="https://github.com/pivotal/jasmine/zipball/master">repo</a>.
Alternatively, you can <code>git clone</code> the main Jasmine
repository from https://github.com/pivotal/jasmine.git.</p>
<p>Let’s review <a
href="https://github.com/pivotal/jasmine/blob/master/lib/templates/SpecRunner.html.jst">SpecRunner.html.jst</a>:</p>
<p>It first includes both Jasmine and the necessary CSS required for
reporting:</p>
<pre><code>&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;lib/jasmine-&lt;%= jasmineVersion %&gt;/jasmine.css&quot;&gt;
&lt;script src=&quot;lib/jasmine-&lt;%= jasmineVersion %&gt;/jasmine.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;lib/jasmine-&lt;%= jasmineVersion %&gt;/jasmine-html.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;lib/jasmine-&lt;%= jasmineVersion %&gt;/boot.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>Next come the sources being tested:</p>
<pre><code>&lt;!-- include source files here... --&gt;
&lt;script src=&quot;src/Player.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;src/Song.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>Finally, some sample tests are included:</p>
<pre><code>&lt;!-- include spec files here... --&gt;
&lt;script src=&quot;spec/SpecHelper.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;spec/PlayerSpec.js&quot;&gt;&lt;/script&gt;</code></pre>
<p><strong><em>Note:</em></strong> Below this section of SpecRunner is
code responsible for running the actual tests. Given that we won’t be
covering modifying this code, I’m going to skip reviewing it. I do
however encourage you to take a look through <a
href="https://github.com/pivotal/jasmine/blob/master/lib/jasmine-core/example/spec/PlayerSpec.js">PlayerSpec.js</a>
and <a
href="https://github.com/pivotal/jasmine/blob/master/lib/jasmine-core/example/spec/SpecHelper.js">SpecHelper.js</a>.
They’re a useful basic example to go through how a minimal set of tests
might work.</p>
<p>Also note that for the purposes of introduction, some of the examples
in this section will be testing aspects of Backbone.js itself, just to
give you a feel for how Jasmine works. You generally will not need to
write testing ensuring a framework is working as expected.</p>
<h2 id="tdd-with-backbone">TDD With Backbone</h2>
<p>When developing applications with Backbone, it can be necessary to
test both individual modules of code as well as models, views,
collections, and routers. Taking a TDD approach to testing, let’s review
some specs for testing these Backbone components using the popular
Backbone <a
href="https://github.com/addyosmani/todomvc/tree/master/todo-example/backbone">Todo</a>
application.</p>
<h2 id="models-1">Models</h2>
<p>The complexity of Backbone models can vary greatly depending on what
your application is trying to achieve. In the following example, we’re
going to test default values, attributes, state changes, and validation
rules.</p>
<p>First, we begin our suite for model testing using
<code>describe()</code>:</p>
<div class="sourceCode" id="cb360"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Tests for Todo&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span></code></pre></div>
<p>Models should ideally have default values for attributes. This helps
ensure that when creating instances without a value set for any specific
attribute, a default one (e.g., an empty string) is used instead. The
idea here is to allow your application to interact with models without
any unexpected behavior.</p>
<p>In the following spec, we create a new Todo without any attributes
passed then check to find out what the value of the <code>text</code>
attribute is. As no value has been set, we expect a default value of
<code>''</code> to be returned.</p>
<div class="sourceCode" id="cb361"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;Can be created with default values for its attributes.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;text&#39;</span>))<span class="op">.</span><span class="fu">toBe</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>If testing this spec before your models have been written, you’ll
incur a failing test, as expected. What’s required for the spec to pass
is a default value for the attribute <code>text</code>. We can set this
and some other useful defaults (which we’ll be using shortly) in our
Todo model as follows:</p>
<div class="sourceCode" id="cb362"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">Todo</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">done</span><span class="op">:</span>  <span class="kw">false</span><span class="op">,</span></span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">order</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>Next, it is common to include validation logic in your models to
ensure that input passed from users or other modules in the application
are valid.</p>
<p>A Todo app may wish to validate the text input supplied in case it
contains rude words. Similarly if we’re storing the <code>done</code>
state of a Todo item using booleans, we need to validate that
truthy/falsy values are passed and not just any arbitrary string.</p>
<p>In the following spec, we take advantage of the fact that validations
which fail model.validate() trigger an “invalid” event. This allows us
to test if validations are correctly failing when invalid input is
supplied.</p>
<p>We create an errorCallback spy using Jasmine’s built in
<code>createSpy()</code> method which allows us to spy on the invalid
event as follows:</p>
<div class="sourceCode" id="cb363"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;Can contain custom validation rules, and will trigger an invalid event on failed validation.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> errorCallback <span class="op">=</span> jasmine<span class="op">.</span><span class="fu">createSpy</span>(<span class="st">&#39;-invalid event callback-&#39;</span>)<span class="op">;</span></span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a>    todo<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;invalid&#39;</span><span class="op">,</span> errorCallback)<span class="op">;</span></span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-9"><a href="#cb363-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// What would you need to set on the todo properties to</span></span>
<span id="cb363-10"><a href="#cb363-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// cause validation to fail?</span></span>
<span id="cb363-11"><a href="#cb363-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-12"><a href="#cb363-12" aria-hidden="true" tabindex="-1"></a>    todo<span class="op">.</span><span class="fu">set</span>({<span class="dt">done</span><span class="op">:</span><span class="st">&#39;a non-boolean value&#39;</span>}<span class="op">,</span> {<span class="dt">validate</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb363-13"><a href="#cb363-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-14"><a href="#cb363-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> errorArgs <span class="op">=</span> errorCallback<span class="op">.</span><span class="at">mostRecentCall</span><span class="op">.</span><span class="at">args</span><span class="op">;</span></span>
<span id="cb363-15"><a href="#cb363-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-16"><a href="#cb363-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(errorArgs)<span class="op">.</span><span class="fu">toBeDefined</span>()<span class="op">;</span></span>
<span id="cb363-17"><a href="#cb363-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(errorArgs[<span class="dv">0</span>])<span class="op">.</span><span class="fu">toBe</span>(todo)<span class="op">;</span></span>
<span id="cb363-18"><a href="#cb363-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(errorArgs[<span class="dv">1</span>])<span class="op">.</span><span class="fu">toBe</span>(<span class="st">&#39;Todo.done must be a boolean value.&#39;</span>)<span class="op">;</span></span>
<span id="cb363-19"><a href="#cb363-19" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The code to make the above failing test support validation is
relatively simple. In our model, we override the validate() method (as
recommended in the Backbone docs), checking to make sure a model both
has a ‘done’ property and that its value is a valid boolean before
allowing it to pass.</p>
<div class="sourceCode" id="cb364"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>validate<span class="op">:</span> <span class="kw">function</span>(attrs) {</span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (attrs<span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="st">&#39;done&#39;</span>) <span class="op">&amp;&amp;</span> <span class="op">!</span>_<span class="op">.</span><span class="fu">isBoolean</span>(attrs<span class="op">.</span><span class="at">done</span>)) {</span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Todo.done must be a boolean value.&#39;</span><span class="op">;</span></span>
<span id="cb364-4"><a href="#cb364-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb364-5"><a href="#cb364-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>If you would like to review the final code for our Todo model, you
can find it below:</p>
<div class="sourceCode" id="cb365"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">Todo</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb365-6"><a href="#cb365-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">done</span><span class="op">:</span>  <span class="kw">false</span><span class="op">,</span></span>
<span id="cb365-7"><a href="#cb365-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">order</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb365-8"><a href="#cb365-8" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb365-9"><a href="#cb365-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-10"><a href="#cb365-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb365-11"><a href="#cb365-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">set</span>({<span class="dt">text</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;text&#39;</span>)}<span class="op">,</span> {<span class="dt">silent</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb365-12"><a href="#cb365-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb365-13"><a href="#cb365-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-14"><a href="#cb365-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">validate</span><span class="op">:</span> <span class="kw">function</span>(attrs) {</span>
<span id="cb365-15"><a href="#cb365-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (attrs<span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="st">&#39;done&#39;</span>) <span class="op">&amp;&amp;</span> <span class="op">!</span>_<span class="op">.</span><span class="fu">isBoolean</span>(attrs<span class="op">.</span><span class="at">done</span>)) {</span>
<span id="cb365-16"><a href="#cb365-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&#39;Todo.done must be a boolean value.&#39;</span><span class="op">;</span></span>
<span id="cb365-17"><a href="#cb365-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb365-18"><a href="#cb365-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb365-19"><a href="#cb365-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-20"><a href="#cb365-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">toggle</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb365-21"><a href="#cb365-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">save</span>({<span class="dt">done</span><span class="op">:</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;done&#39;</span>)})<span class="op">;</span></span>
<span id="cb365-22"><a href="#cb365-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb365-23"><a href="#cb365-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-24"><a href="#cb365-24" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="collections-1">Collections</h2>
<p>We now need to define specs to test a Backbone collection of Todo
models (a TodoList). Collections are responsible for a number of list
tasks including managing order and filtering.</p>
<p>A few specific specs that come to mind when working with collections
are:</p>
<ul>
<li>Making sure we can add new Todo models as both objects and
arrays</li>
<li>Attribute testing to make sure attributes such as the base URL of
the collection are values we expect</li>
<li>Purposefully adding items with a status of <code>done:true</code>
and checking against how many items the collection thinks have been
completed vs. those that are remaining</li>
</ul>
<p>In this section we’re going to cover the first two of these with the
third left as an extended exercise you can try on your own.</p>
<p>Testing that Todo models can be added to a collection as objects or
arrays is relatively trivial. First, we initialize a new TodoList
collection and check to make sure its length (i.e., the number of Todo
models it contains) is 0. Next, we add new Todos, both as objects and
arrays, checking the length property of the collection at each stage to
ensure the overall count is what we expect:</p>
<div class="sourceCode" id="cb366"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Tests for TodoList&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&#39;Can add Model instances as objects and arrays.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoList</span>()<span class="op">;</span></span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(todos<span class="op">.</span><span class="at">length</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-8"><a href="#cb366-8" aria-hidden="true" tabindex="-1"></a>        todos<span class="op">.</span><span class="fu">add</span>({ <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;Clean the kitchen&#39;</span> })<span class="op">;</span></span>
<span id="cb366-9"><a href="#cb366-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-10"><a href="#cb366-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// how many todos have been added so far?</span></span>
<span id="cb366-11"><a href="#cb366-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(todos<span class="op">.</span><span class="at">length</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb366-12"><a href="#cb366-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-13"><a href="#cb366-13" aria-hidden="true" tabindex="-1"></a>        todos<span class="op">.</span><span class="fu">add</span>([</span>
<span id="cb366-14"><a href="#cb366-14" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;Do the laundry&#39;</span><span class="op">,</span> <span class="dt">done</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb366-15"><a href="#cb366-15" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;Go to the gym&#39;</span>}</span>
<span id="cb366-16"><a href="#cb366-16" aria-hidden="true" tabindex="-1"></a>        ])<span class="op">;</span></span>
<span id="cb366-17"><a href="#cb366-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-18"><a href="#cb366-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// how many are there in total now?</span></span>
<span id="cb366-19"><a href="#cb366-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(todos<span class="op">.</span><span class="at">length</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb366-20"><a href="#cb366-20" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb366-21"><a href="#cb366-21" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
<p>Similar to model attributes, it’s also quite straight-forward to test
attributes in collections. Here we have a spec that ensures the
collection url (i.e., the url reference to the collection’s location on
the server) is what we expect it to be:</p>
<div class="sourceCode" id="cb367"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;Can have a url property to define the basic url structure for all contained models.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> todos <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoList</span>()<span class="op">;</span></span>
<span id="cb367-3"><a href="#cb367-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-4"><a href="#cb367-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// what has been specified as the url base in our model?</span></span>
<span id="cb367-5"><a href="#cb367-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>(todos<span class="op">.</span><span class="at">url</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="st">&#39;/todos/&#39;</span>)<span class="op">;</span></span>
<span id="cb367-6"><a href="#cb367-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>For the third spec (which you will write as an exercise), note that
the implementation for our collection will have methods for filtering
how many Todo items are done and how many are remaining - we’ll call
these <code>done()</code> and <code>remaining()</code>. Consider writing
a spec which creates a new collection and adds one new model that has a
preset <code>done</code> state of <code>true</code> and two others that
have the default <code>done</code> state of <code>false</code>. Testing
the length of what’s returned using <code>done()</code> and
<code>remaining()</code> will tell us whether the state management in
our application is working or needs a little tweaking.</p>
<p>The final implementation for our TodoList collection can be found
below:</p>
<div class="sourceCode" id="cb368"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a> <span class="bu">window</span><span class="op">.</span><span class="at">TodoList</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">model</span><span class="op">:</span> Todo<span class="op">,</span></span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-5"><a href="#cb368-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/todos/&#39;</span><span class="op">,</span></span>
<span id="cb368-6"><a href="#cb368-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-7"><a href="#cb368-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">done</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb368-8"><a href="#cb368-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span>(todo) { <span class="cf">return</span> todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;done&#39;</span>)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb368-9"><a href="#cb368-9" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb368-10"><a href="#cb368-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-11"><a href="#cb368-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">remaining</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb368-12"><a href="#cb368-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">without</span><span class="op">.</span><span class="fu">apply</span>(<span class="kw">this</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">done</span>())<span class="op">;</span></span>
<span id="cb368-13"><a href="#cb368-13" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb368-14"><a href="#cb368-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-15"><a href="#cb368-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nextOrder</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb368-16"><a href="#cb368-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb368-17"><a href="#cb368-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb368-18"><a href="#cb368-18" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb368-19"><a href="#cb368-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-20"><a href="#cb368-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">last</span>()<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;order&#39;</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb368-21"><a href="#cb368-21" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb368-22"><a href="#cb368-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-23"><a href="#cb368-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">comparator</span><span class="op">:</span> <span class="kw">function</span>(todo) {</span>
<span id="cb368-24"><a href="#cb368-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;order&#39;</span>)<span class="op">;</span></span>
<span id="cb368-25"><a href="#cb368-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb368-26"><a href="#cb368-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-27"><a href="#cb368-27" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<h2 id="views-1">Views</h2>
<p>Before we take a look at testing Backbone views, let’s briefly review
a jQuery plugin that can assist with writing Jasmine specs for them.</p>
<p><strong>The Jasmine jQuery Plugin</strong></p>
<p>As we know our Todo application will be using jQuery for DOM
manipulation, there’s a useful jQuery plugin called <a
href="https://github.com/velesin/jasmine-jquery">jasmine-jquery</a> we
can use to help simplify BDD testing of the rendering performed by our
views.</p>
<p>The plugin provides a number of additional Jasmine <a
href="https://github.com/pivotal/jasmine/wiki/Matchers">matchers</a> to
help test jQuery-wrapped sets such as:</p>
<ul>
<li><code>toBe(jQuerySelector)</code> e.g.,
<code>expect($('&lt;div id="some-id"&gt;&lt;/div&gt;')).toBe('div#some-id')</code></li>
<li><code>toBeChecked()</code> e.g.,
<code>expect($('&lt;input type="checkbox" checked="checked"/&gt;')).toBeChecked()</code></li>
<li><code>toBeSelected()</code> e.g.,
<code>expect($('&lt;option selected="selected"&gt;&lt;/option&gt;')).toBeSelected()</code></li>
</ul>
<p>and <a href="https://github.com/velesin/jasmine-jquery">many
others</a>. The complete list of matchers supported can be found on the
project homepage. It’s useful to know that similar to the standard
Jasmine matchers, the custom matchers above can be inverted using the
.not prefix (i.e. <code>expect(x).not.toBe(y)</code>):</p>
<div class="sourceCode" id="cb369"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expect</span>(<span class="fu">$</span>(<span class="st">&#39;&lt;div&gt;I am an example&lt;/div&gt;&#39;</span>))<span class="op">.</span><span class="at">not</span><span class="op">.</span><span class="fu">toHaveText</span>(<span class="ss">/other/</span>)</span></code></pre></div>
<p>jasmine-jquery also includes a fixtures module that can be used to
load arbitrary HTML content we wish to use in our tests. Fixtures can be
used as follows:</p>
<p>Include some HTML in an external fixtures file:</p>
<p>some.fixture.html:
<code>&lt;div id="sample-fixture"&gt;some HTML content&lt;/div&gt;</code></p>
<p>Then inside our actual test we would load it as follows:</p>
<div class="sourceCode" id="cb370"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loadFixtures</span>(<span class="st">&#39;some.fixture.html&#39;</span>)</span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="st">&#39;some-fixture&#39;</span>)<span class="op">.</span><span class="fu">myTestedPlugin</span>()<span class="op">;</span></span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expect</span>(<span class="fu">$</span>(<span class="st">&#39;#some-fixture&#39;</span>))<span class="op">.</span><span class="at">to</span><span class="op">&lt;</span>the rest <span class="kw">of</span> your matcher would go here<span class="op">&gt;</span></span></code></pre></div>
<p>The jasmine-jquery plugin loads fixtures from a directory named
spec/javascripts/fixtures by default. If you wish to configure this path
you can do so by initially setting
<code>jasmine.getFixtures().fixturesPath = 'your custom path'</code>.</p>
<p>Finally, jasmine-jquery includes support for spying on jQuery events
without the need for any extra plumbing work. This can be done using the
<code>spyOnEvent()</code> and
<code>expect(eventName).toHaveBeenTriggeredOn(selector)</code>
functions. For example:</p>
<div class="sourceCode" id="cb371"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spyOnEvent</span>(<span class="fu">$</span>(<span class="st">&#39;#el&#39;</span>)<span class="op">,</span> <span class="st">&#39;click&#39;</span>)<span class="op">;</span></span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="st">&#39;#el&#39;</span>)<span class="op">.</span><span class="fu">click</span>()<span class="op">;</span></span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expect</span>(<span class="st">&#39;click&#39;</span>)<span class="op">.</span><span class="fu">toHaveBeenTriggeredOn</span>(<span class="fu">$</span>(<span class="st">&#39;#el&#39;</span>))<span class="op">;</span></span></code></pre></div>
<h3 id="view-testing">View testing</h3>
<p>In this section we will review the three dimensions of specs writing
for Backbone Views: initial setup, view rendering, and templating. The
latter two of these are the most commonly tested, however we’ll see
shortly why writing specs for the initialization of your views can also
be of benefit.</p>
<h4 id="initial-setup">Initial setup</h4>
<p>At their most basic, specs for Backbone views should validate that
they are being correctly tied to specific DOM elements and are backed by
valid data models. The reason to consider doing this is that these specs
can identify issues which will trip up more complex tests later on.
Also, they’re fairly simple to write given the overall value
offered.</p>
<p>To help ensure a consistent testing setup for our specs, we use
<code>beforeEach()</code> to append both an empty
<code>&lt;ul&gt;</code> (#todoList) to the DOM and initialize a new
instance of a TodoView using an empty Todo model.
<code>afterEach()</code> is used to remove the previous #todoList
<code>&lt;ul&gt;</code> as well as the previous instance of the
view.</p>
<div class="sourceCode" id="cb372"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Tests for TodoView&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">beforeEach</span>(<span class="kw">function</span>() {</span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">$</span>(<span class="st">&#39;body&#39;</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">&#39;&lt;ul id=&quot;todoList&quot;&gt;&lt;/ul&gt;&#39;</span>)<span class="op">;</span></span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoView</span>({ <span class="dt">model</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Todo</span>() })<span class="op">;</span></span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb372-7"><a href="#cb372-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-8"><a href="#cb372-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-9"><a href="#cb372-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">afterEach</span>(<span class="kw">function</span>() {</span>
<span id="cb372-10"><a href="#cb372-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb372-11"><a href="#cb372-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">$</span>(<span class="st">&#39;#todoList&#39;</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb372-12"><a href="#cb372-12" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb372-13"><a href="#cb372-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-14"><a href="#cb372-14" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
<p>The first spec useful to write is a check that the TodoView we’ve
created is using the correct <code>tagName</code> (element or
className). The purpose of this test is to make sure it’s been correctly
tied to a DOM element when it was created.</p>
<p>Backbone views typically create empty DOM elements once initialized,
however these elements are not attached to the visible DOM in order to
allow them to be constructed without an impact on the performance of
rendering.</p>
<div class="sourceCode" id="cb373"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;Should be tied to a DOM element when created, based off the property provided.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//what html element tag name represents this view?</span></span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="at">el</span><span class="op">.</span><span class="at">tagName</span><span class="op">.</span><span class="fu">toLowerCase</span>())<span class="op">.</span><span class="fu">toBe</span>(<span class="st">&#39;li&#39;</span>)<span class="op">;</span></span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Once again, if the TodoView has not already been written, we will
experience failing specs. Thankfully, solving this is as simple as
creating a new Backbone.View with a specific <code>tagName</code>.</p>
<div class="sourceCode" id="cb374"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todoView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tagName</span><span class="op">:</span>  <span class="st">&#39;li&#39;</span></span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>If instead of testing against the <code>tagName</code> you would
prefer to use a className instead, we can take advantage of
jasmine-jquery’s <code>toHaveClass()</code> matcher:</p>
<pre><code>it(&#39;Should have a class of &quot;todos&quot;&#39;, function(){
   expect(this.todoView.$el).toHaveClass(&#39;todos&#39;);
});</code></pre>
<p>The <code>toHaveClass()</code> matcher operates on jQuery objects and
if the plugin hadn’t been used, an exception would have been thrown. It
is of course also possible to test for the className by accessing
el.className if you don’t use jasmine-jquery.</p>
<p>You may have noticed that in <code>beforeEach()</code>, we passed our
view an initial (albeit unfilled) Todo model. Views should be backed by
a model instance which provides data. As this is quite important to our
view’s ability to function, we can write a spec to ensure a model is
defined (using the <code>toBeDefined()</code> matcher) and then test
attributes of the model to ensure defaults both exist and are the values
we expect them to be.</p>
<div class="sourceCode" id="cb376"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="fu">it</span>(<span class="st">&#39;Is backed by a model instance, which provides the data.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="at">model</span>)<span class="op">.</span><span class="fu">toBeDefined</span>()<span class="op">;</span></span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// what&#39;s the value for Todo.get(&#39;done&#39;) here?</span></span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;done&#39;</span>))<span class="op">.</span><span class="fu">toBe</span>(<span class="kw">false</span>)<span class="op">;</span> <span class="co">//or toBeFalsy()</span></span>
<span id="cb376-7"><a href="#cb376-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h4 id="view-rendering">View rendering</h4>
<p>Next we’re going to take a look at writing specs for view rendering.
Specifically, we want to test that our TodoView elements are actually
rendering as expected.</p>
<p>In smaller applications, those new to BDD might argue that visual
confirmation of view rendering could replace unit testing of views. The
reality is that when dealing with applications that might grow to a
large number of views, it makes sense to automate this process as much
as possible from the get-go. There are also aspects of rendering that
require verification beyond what is visually presented on-screen (which
we’ll see very shortly).</p>
<p>We’re going to begin testing views by writing two specs. The first
spec will check that the view’s <code>render()</code> method is
correctly returning the view instance, which is necessary for chaining.
Our second spec will check that the HTML produced is exactly what we
expect based on the properties of the model instance that’s been
associated with our TodoView.</p>
<p>Unlike some of the previous specs we’ve covered, this section will
make greater use of <code>beforeEach()</code> to both demonstrate how to
use nested suites and also ensure a consistent set of conditions for our
specs. In our first example we’re simply going to create a sample model
(based on Todo) and instantiate a TodoView with it.</p>
<div class="sourceCode" id="cb377"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;TodoView&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-3"><a href="#cb377-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beforeEach</span>(<span class="kw">function</span>() {</span>
<span id="cb377-4"><a href="#cb377-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">model</span> <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>({</span>
<span id="cb377-5"><a href="#cb377-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;My Todo&#39;</span><span class="op">,</span></span>
<span id="cb377-6"><a href="#cb377-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">order</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb377-7"><a href="#cb377-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">done</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb377-8"><a href="#cb377-8" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb377-9"><a href="#cb377-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">view</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoView</span>({<span class="dt">model</span><span class="op">:</span><span class="kw">this</span><span class="op">.</span><span class="at">model</span>})<span class="op">;</span></span>
<span id="cb377-10"><a href="#cb377-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb377-11"><a href="#cb377-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-12"><a href="#cb377-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">describe</span>(<span class="st">&#39;Rendering&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb377-13"><a href="#cb377-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-14"><a href="#cb377-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&#39;returns the view object&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb377-15"><a href="#cb377-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">expect</span>(<span class="kw">this</span><span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="fu">render</span>())<span class="op">.</span><span class="fu">toEqual</span>(<span class="kw">this</span><span class="op">.</span><span class="at">view</span>)<span class="op">;</span></span>
<span id="cb377-16"><a href="#cb377-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb377-17"><a href="#cb377-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-18"><a href="#cb377-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&#39;produces the correct HTML&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb377-19"><a href="#cb377-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb377-20"><a href="#cb377-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-21"><a href="#cb377-21" aria-hidden="true" tabindex="-1"></a>      <span class="co">// let&#39;s use jasmine-jquery&#39;s toContain() to avoid</span></span>
<span id="cb377-22"><a href="#cb377-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">// testing for the complete content of a todo&#39;s markup</span></span>
<span id="cb377-23"><a href="#cb377-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">expect</span>(<span class="kw">this</span><span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="at">el</span><span class="op">.</span><span class="at">innerHTML</span>)</span>
<span id="cb377-24"><a href="#cb377-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">toContain</span>(<span class="st">&#39;&lt;label class=&quot;todo-content&quot;&gt;My Todo&lt;/label&gt;&#39;</span>)<span class="op">;</span></span>
<span id="cb377-25"><a href="#cb377-25" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb377-26"><a href="#cb377-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-27"><a href="#cb377-27" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb377-28"><a href="#cb377-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-29"><a href="#cb377-29" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>When these specs are run, only the second one (‘produces the correct
HTML’) fails. Our first spec (‘returns the view object’), which is
testing that the TodoView instance is returned from
<code>render()</code>, passes since this is Backbone’s default behavior
and we haven’t overwritten the <code>render()</code> method with our own
version yet.</p>
<p><strong>Note:</strong> For the purposes of maintaining readability,
all template examples in this section will use a minimal version of the
following Todo view template. As it’s relatively trivial to expand this,
please feel free to refer to this sample if needed:</p>
<pre><code>&lt;div class=&quot;todo &lt;%= done ? &#39;done&#39; : &#39;&#39; %&gt;&quot;&gt;
        &lt;div class=&quot;display&quot;&gt;
          &lt;input class=&quot;check&quot; type=&quot;checkbox&quot; &lt;%= done ? &#39;checked=&quot;checked&quot;&#39; : &#39;&#39; %&gt; /&gt;
          &lt;label class=&quot;todo-content&quot;&gt;&lt;%= text %&gt;&lt;/label&gt;
          &lt;span class=&quot;todo-destroy&quot;&gt;&lt;/span&gt;
        &lt;/div&gt;
        &lt;div class=&quot;edit&quot;&gt;
          &lt;input class=&quot;todo-input&quot; type=&quot;text&quot; value=&quot;&lt;%= content %&gt;&quot; /&gt;
        &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>The second spec fails with the following message:</p>
<p><code>Expected '' to contain '&lt;label class="todo-content"&gt;My Todo&lt;/label&gt;'.</code></p>
<p>The reason for this is the default behavior for render() doesn’t
create any markup. Let’s write a replacement for render() which fixes
this:</p>
<div class="sourceCode" id="cb379"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a>render<span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> template <span class="op">=</span> <span class="st">&#39;&lt;label class=&quot;todo-content&quot;&gt;+++PLACEHOLDER+++&lt;/label&gt;&#39;</span><span class="op">;</span></span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> output <span class="op">=</span> template</span>
<span id="cb379-4"><a href="#cb379-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">replace</span>(<span class="st">&#39;+++PLACEHOLDER+++&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;text&#39;</span>))<span class="op">;</span></span>
<span id="cb379-5"><a href="#cb379-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(output)<span class="op">;</span></span>
<span id="cb379-6"><a href="#cb379-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb379-7"><a href="#cb379-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The above specifies an inline string template and replaces fields
found in the template within the “+++PLACEHOLDER+++” blocks with their
corresponding values from the associated model. As we’re also returning
the TodoView instance from the method, the first spec will still
pass.</p>
<p>It would be impossible to discuss unit testing without mentioning
fixtures. Fixtures typically contain test data (e.g., HTML) that is
loaded in when needed (either locally or from an external file) for unit
testing. So far we’ve been establishing jQuery expectations based on the
view’s el property. This works for a number of cases, however, there are
instances where it may be necessary to render markup into the document.
The most optimal way to handle this within specs is through using
fixtures (another feature brought to us by the jasmine-jquery
plugin).</p>
<p>Re-writing the last spec to use fixtures would look as follows:</p>
<div class="sourceCode" id="cb380"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;TodoView&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beforeEach</span>(<span class="kw">function</span>() {</span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setFixtures</span>(<span class="st">&#39;&lt;ul class=&quot;todos&quot;&gt;&lt;/ul&gt;&#39;</span>)<span class="op">;</span></span>
<span id="cb380-6"><a href="#cb380-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb380-7"><a href="#cb380-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-8"><a href="#cb380-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb380-9"><a href="#cb380-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-10"><a href="#cb380-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">describe</span>(<span class="st">&#39;Template&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb380-11"><a href="#cb380-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-12"><a href="#cb380-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">beforeEach</span>(<span class="kw">function</span>() {</span>
<span id="cb380-13"><a href="#cb380-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">$</span>(<span class="st">&#39;.todos&#39;</span>)<span class="op">.</span><span class="fu">append</span>(<span class="kw">this</span><span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="fu">render</span>()<span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb380-14"><a href="#cb380-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb380-15"><a href="#cb380-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-16"><a href="#cb380-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">it</span>(<span class="st">&#39;has the correct text content&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb380-17"><a href="#cb380-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">expect</span>(<span class="fu">$</span>(<span class="st">&#39;.todos&#39;</span>)<span class="op">.</span><span class="fu">find</span>(<span class="st">&#39;.todo-content&#39;</span>))</span>
<span id="cb380-18"><a href="#cb380-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">toHaveText</span>(<span class="st">&#39;My Todo&#39;</span>)<span class="op">;</span></span>
<span id="cb380-19"><a href="#cb380-19" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb380-20"><a href="#cb380-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-21"><a href="#cb380-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb380-22"><a href="#cb380-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-23"><a href="#cb380-23" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>What we’re now doing in the above spec is appending the rendered todo
item into the fixture. We then set expectations against the fixture,
which may be something desirable when a view is setup against an element
which already exists in the DOM. It would be necessary to provide both
the fixture and test the <code>el</code> property correctly picking up
the element expected when the view is instantiated.</p>
<h4 id="rendering-with-a-templating-system">Rendering with a templating
system</h4>
<p>When a user marks a Todo item as complete (done), we may wish to
provide them with visual feedback (such as a striked line through the
text) to differentiate the item from those that are remaining. This can
be done by attaching a new class to the item. Let’s begin by writing a
test:</p>
<div class="sourceCode" id="cb381"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;When a todo is done&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beforeEach</span>(<span class="kw">function</span>() {</span>
<span id="cb381-4"><a href="#cb381-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">set</span>({<span class="dt">done</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span> {<span class="dt">silent</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb381-5"><a href="#cb381-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(<span class="st">&#39;.todos&#39;</span>)<span class="op">.</span><span class="fu">append</span>(<span class="kw">this</span><span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="fu">render</span>()<span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb381-6"><a href="#cb381-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb381-7"><a href="#cb381-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-8"><a href="#cb381-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;has a done class&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb381-9"><a href="#cb381-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(<span class="fu">$</span>(<span class="st">&#39;.todos .todo-content:first-child&#39;</span>))</span>
<span id="cb381-10"><a href="#cb381-10" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">toHaveClass</span>(<span class="st">&#39;done&#39;</span>)<span class="op">;</span></span>
<span id="cb381-11"><a href="#cb381-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb381-12"><a href="#cb381-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-13"><a href="#cb381-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This will fail with the following message:</p>
<p><code>Expected '&lt;label class="todo-content"&gt;My Todo&lt;/label&gt;' to have class 'done'.</code></p>
<p>which can be fixed in the existing render() method as follows:</p>
<div class="sourceCode" id="cb382"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>render<span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> template <span class="op">=</span> <span class="st">&#39;&lt;label class=&quot;todo-content&quot;&gt;&#39;</span> <span class="op">+</span></span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;&lt;%= text %&gt;&lt;/label&gt;&#39;</span><span class="op">;</span></span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> output <span class="op">=</span> template</span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">replace</span>(<span class="st">&#39;&lt;%= text %&gt;&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;text&#39;</span>))<span class="op">;</span></span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(output)<span class="op">;</span></span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;done&#39;</span>)) {</span>
<span id="cb382-8"><a href="#cb382-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">$</span>(<span class="st">&#39;.todo-content&#39;</span>)<span class="op">.</span><span class="fu">addClass</span>(<span class="st">&#39;done&#39;</span>)<span class="op">;</span></span>
<span id="cb382-9"><a href="#cb382-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb382-10"><a href="#cb382-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb382-11"><a href="#cb382-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>However, this can get unwieldy fairly quickly. As the level of
complexity and logic in our templates increase, so do the challenges
associated with testing them. We can ease this process by taking
advantage of modern templating libraries, many of which have already
been demonstrated to work well with testing solutions such as
Jasmine.</p>
<p>JavaScript templating systems (such as <a
href="http://handlebarsjs.com/">Handlebars</a>, <a
href="http://mustache.github.com/">Mustache</a>, and Underscore’s own <a
href="http://underscorejs.org/#template">micro-templating</a>) support
conditional logic in template strings. What this effectively means is
that we can add if/else/ternery expressions inline which can then be
evaluated as needed, allowing us to build even more powerful
templates.</p>
<p>In our case, we are going to use the micro-templating found in
Underscore.js as no additional files are required to use it and we can
easily modify our existing specs to use it without a great deal of
effort.</p>
<p>Assuming our template is defined using a script tag of ID
<code>myTemplate</code>:</p>
<pre><code>&lt;script type=&quot;text/template&quot; id=&quot;myTemplate&quot;&gt;
    &lt;div class=&quot;todo &lt;%= done ? &#39;done&#39; : &#39;&#39; %&gt;&quot;&gt;
            &lt;div class=&quot;display&quot;&gt;
              &lt;input class=&quot;check&quot; type=&quot;checkbox&quot; &lt;%= done ? &#39;checked=&quot;checked&quot;&#39; : &#39;&#39; %&gt; /&gt;
              &lt;label class=&quot;todo-content&quot;&gt;&lt;%= text %&gt;&lt;/label&gt;
              &lt;span class=&quot;todo-destroy&quot;&gt;&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class=&quot;edit&quot;&gt;
              &lt;input class=&quot;todo-input&quot; type=&quot;text&quot; value=&quot;&lt;%= content %&gt;&quot; /&gt;
            &lt;/div&gt;
    &lt;/div&gt;
&lt;/script&gt;</code></pre>
<p>Our TodoView can be modified to use Underscore templating as
follows:</p>
<div class="sourceCode" id="cb384"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">tagName</span><span class="op">:</span> <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb384-4"><a href="#cb384-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>(<span class="fu">$</span>(<span class="st">&#39;#myTemplate&#39;</span>)<span class="op">.</span><span class="fu">html</span>())<span class="op">,</span></span>
<span id="cb384-5"><a href="#cb384-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-6"><a href="#cb384-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(options) {</span>
<span id="cb384-7"><a href="#cb384-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb384-8"><a href="#cb384-8" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb384-9"><a href="#cb384-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-10"><a href="#cb384-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb384-11"><a href="#cb384-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">template</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span>))<span class="op">;</span></span>
<span id="cb384-12"><a href="#cb384-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb384-13"><a href="#cb384-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb384-14"><a href="#cb384-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-15"><a href="#cb384-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb384-16"><a href="#cb384-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-17"><a href="#cb384-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>So, what’s going on here? We’re first defining our template in a
script tag with a custom script type (e.g., type=“text/template”). As
this isn’t a script type any browser understands, it’s simply ignored,
however referencing the script by an id attribute allows the template to
be kept separate to other parts of the page.</p>
<p>In our view, we’re the using the Underscore <code>_.template()</code>
method to compile our template into a function that we can easily pass
model data to later on. In the line <code>this.model.toJSON()</code> we
are simply returning a copy of the model’s attributes for JSON
stringification to the <code>template</code> method, creating a block of
HTML that can now be appended to the DOM.</p>
<p>Note: Ideally all of your template logic should exist outside of your
specs, either in individual template files or embedded using script tags
within your SpecRunner. This is generally more maintainable.</p>
<p>If you are working with much smaller templates and are not doing
this, there is however a useful trick that can be applied to
automatically create or extend templates in the Jasmine shared
functional scope for each test.</p>
<p>By creating a new directory (say, ‘templates’) in the ‘spec’ folder
and including a new script file with the following contents into
SpecRunner.html, we can manually add custom attributes representing
smaller templates we wish to use:</p>
<div class="sourceCode" id="cb385"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="fu">beforeEach</span>(<span class="kw">function</span>() {</span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">templates</span> <span class="op">=</span> _<span class="op">.</span><span class="fu">extend</span>(<span class="kw">this</span><span class="op">.</span><span class="at">templates</span> <span class="op">||</span> {}<span class="op">,</span> {</span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">todo</span><span class="op">:</span> <span class="st">&#39;&lt;label class=&quot;todo-content&quot;&gt;&#39;</span> <span class="op">+</span></span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;&lt;%= text %&gt;&#39;</span> <span class="op">+</span></span>
<span id="cb385-5"><a href="#cb385-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;&lt;/label&gt;&#39;</span></span>
<span id="cb385-6"><a href="#cb385-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb385-7"><a href="#cb385-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>To finish this off, we simply update our existing spec to reference
the template when instantiating the TodoView:</p>
<div class="sourceCode" id="cb386"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;TodoView&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beforeEach</span>(<span class="kw">function</span>() {</span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">view</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoView</span>({</span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">model</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span></span>
<span id="cb386-7"><a href="#cb386-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">templates</span><span class="op">.</span><span class="at">todo</span></span>
<span id="cb386-8"><a href="#cb386-8" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb386-9"><a href="#cb386-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb386-10"><a href="#cb386-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-11"><a href="#cb386-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb386-12"><a href="#cb386-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-13"><a href="#cb386-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The existing specs we’ve looked at would continue to pass using this
approach, leaving us free to adjust the template with some additional
conditional logic for Todos with a status of ‘done’:</p>
<div class="sourceCode" id="cb387"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">beforeEach</span>(<span class="kw">function</span>() {</span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">templates</span> <span class="op">=</span> _<span class="op">.</span><span class="fu">extend</span>(<span class="kw">this</span><span class="op">.</span><span class="at">templates</span> <span class="op">||</span> {}<span class="op">,</span> {</span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">todo</span><span class="op">:</span> <span class="st">&#39;&lt;label class=&quot;todo-content &lt;%= done ? &#39;</span>done<span class="st">&#39; : &#39;&#39; %&gt;&quot;&#39;</span> <span class="op">+</span></span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;&lt;%= text %&gt;&#39;</span> <span class="op">+</span></span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;&lt;/label&gt;&#39;</span></span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This will now also pass without any issues, however as mentioned,
this last approach probably only makes sense if you’re working with
smaller, highly dynamic templates.</p>
<h2 id="conclusions-2">Conclusions</h2>
<p>We have now covered how to write Jasmine tests for Backbone.js
models, collections, and views. While testing routing can at times be
desirable, some developers feel it can be more optimal to leave this to
third-party tools such as Selenium, so do keep this in mind.</p>
<h2 id="exercise">Exercise</h2>
<p>As an exercise, I recommend now trying the Jasmine Koans in
<code>practicals\jasmine-koans</code> and trying to fix some of the
purposefully failing tests it has to offer. This is an excellent way of
not just learning how Jasmine specs and suites work, but working through
the examples (without peeking back) will also put your Backbone skills
to the test too.</p>
<h2 id="further-reading">Further reading</h2>
<ul>
<li><a
href="http://tinnedfruit.com/2011/04/26/testing-backbone-apps-with-jasmine-sinon-3.html">Testing
Backbone Apps With SinonJS</a> by James Newbry</li>
<li><a
href="http://japhr.blogspot.com/2011/11/jasmine-backbonejs-revisited.html">Jasmine
+ Backbone Revisited</a></li>
<li><a
href="http://japhr.blogspot.com/2011/12/phantomjs-and-backbonejs-and-requirejs.html">Backbone,
PhantomJS and Jasmine</a></li>
</ul>
<h1 id="qunit">QUnit</h1>
<h2 id="introduction-3">Introduction</h2>
<p>QUnit is a powerful JavaScript test suite written by jQuery team
member <a href="http://bassistance.de/">Jörn Zaefferer</a> and used by
many large open-source projects (such as jQuery and Backbone.js) to test
their code. It’s both capable of testing standard JavaScript code in the
browser as well as code on the server-side (where environments supported
include Rhino, V8 and SpiderMonkey). This makes it a robust solution for
a large number of use-cases.</p>
<p>Quite a few Backbone.js contributors feel that QUnit is a better
introductory framework for testing if you don’t wish to start off with
Jasmine and BDD right away. As we’ll see later on in this chapter, QUnit
can also be combined with third-party solutions such as SinonJS to
produce an even more powerful testing solution supporting spies and
mocks, which some say is preferable over Jasmine.</p>
<p>My personal recommendation is that it’s worth comparing both
frameworks and opting for the solution that you feel the most
comfortable with.</p>
<h2 id="getting-setup">Getting Setup</h2>
<p>Luckily, getting QUnit setup is a fairly straight-forward process
that will take less than 5 minutes.</p>
<p>We first setup a testing environment composed of three files:</p>
<ul>
<li>An HTML <strong>structure</strong> for displaying test results</li>
<li>The <strong>qunit.js</strong> file composing the testing
framework</li>
<li>The <strong>qunit.css</strong> file for styling test results</li>
</ul>
<p>The latter two of these can be downloaded from the <a
href="http://qunitjs.com">QUnit website</a>.</p>
<p>If you would prefer, you can use a hosted version of the QUnit source
files for testing purposes. The hosted URLs can be found at <a
href="http://github.com/jquery/qunit/raw/master/qunit/"
class="uri">http://github.com/jquery/qunit/raw/master/qunit/</a>.</p>
<h4 id="sample-html-with-qunit-compatible-markup">Sample HTML with
QUnit-compatible markup:</h4>
<div class="sourceCode" id="cb388"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>QUnit Test Suite<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;qunit.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb388-7"><a href="#cb388-7" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;qunit.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb388-8"><a href="#cb388-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-9"><a href="#cb388-9" aria-hidden="true" tabindex="-1"></a>     <span class="co">&lt;!-- Your application --&gt;</span></span>
<span id="cb388-10"><a href="#cb388-10" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;app.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb388-11"><a href="#cb388-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-12"><a href="#cb388-12" aria-hidden="true" tabindex="-1"></a>     <span class="co">&lt;!-- Your tests --&gt;</span></span>
<span id="cb388-13"><a href="#cb388-13" aria-hidden="true" tabindex="-1"></a>     <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;tests.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb388-14"><a href="#cb388-14" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb388-15"><a href="#cb388-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb388-16"><a href="#cb388-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h1</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-header&quot;</span><span class="dt">&gt;</span>QUnit Test Suite<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb388-17"><a href="#cb388-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h2</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-banner&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb388-18"><a href="#cb388-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-testrunner-toolbar&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb388-19"><a href="#cb388-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h2</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-userAgent&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb388-20"><a href="#cb388-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">ol</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-tests&quot;</span><span class="dt">&gt;</span>test markup, hidden.<span class="dt">&lt;/</span><span class="kw">ol</span><span class="dt">&gt;</span></span>
<span id="cb388-21"><a href="#cb388-21" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb388-22"><a href="#cb388-22" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Let’s go through the elements above with qunit mentioned in their ID.
When QUnit is running:</p>
<ul>
<li><strong>qunit-header</strong> shows the name of the test suite</li>
<li><strong>qunit-banner</strong> shows up as red if a test fails and
green if all tests pass</li>
<li><strong>qunit-testrunner-toolbar</strong> contains additional
options for configuring the display of tests</li>
<li><strong>qunit-userAgent</strong> displays the navigator.userAgent
property</li>
<li><strong>qunit-tests</strong> is a container for our test
results</li>
</ul>
<p>When running correctly, the above test runner looks as follows:</p>
<figure>
<img src="img/7d4de12.png" alt="screenshot 1" />
<figcaption aria-hidden="true">screenshot 1</figcaption>
</figure>
<p>The numbers of the form (a, b, c) after each test name correspond to
a) failed asserts, b) passed asserts and c) total asserts. Clicking on a
test name expands it to display all of the assertions for that test
case. Assertions in green have successfully passed.</p>
<figure>
<img src="img/9df4.png" alt="screenshot 2" />
<figcaption aria-hidden="true">screenshot 2</figcaption>
</figure>
<p>If however any tests fail, the test gets highlighted (and the
qunit-banner at the top switches to red):</p>
<figure>
<img src="img/3e5545.png" alt="screenshot 3" />
<figcaption aria-hidden="true">screenshot 3</figcaption>
</figure>
<h2 id="assertions">Assertions</h2>
<p>QUnit supports a number of basic <strong>assertions</strong>, which
are used in tests to verify that the result being returned by our code
is what we expect. If an assertion fails, we know that a bug exists.
Similar to Jasmine, QUnit can be used to easily test for regressions.
Specifically, when a bug is found one can write an assertion to test the
existence of the bug, write a patch, and then commit both. If subsequent
changes to the code break the test you’ll know what was responsible and
be able to address it more easily.</p>
<p>Some of the supported QUnit assertions we’re going to look at first
are:</p>
<ul>
<li><code>ok ( state, message )</code> - passes if the first argument is
truthy</li>
<li><code>equal ( actual, expected, message )</code> - a simple
comparison assertion with type coercion</li>
<li><code>notEqual ( actual, expected, message )</code> - the opposite
of the above</li>
<li><code>expect( amount )</code> - the number of assertions expected to
run within each test</li>
<li><code>strictEqual( actual, expected, message)</code> - offers a much
stricter comparison than <code>equal()</code> and is considered the
preferred method of checking equality as it avoids stumbling on subtle
coercion bugs</li>
<li><code>deepEqual( actual, expected, message )</code> - similar to
<code>strictEqual</code>, comparing the contents (with <code>===</code>)
of the given objects, arrays and primitives.</li>
</ul>
<h4 id="basic-test-case-using-test-name-callback">Basic test case using
test( name, callback )</h4>
<p>Creating new test cases with QUnit is relatively straight-forward and
can be done using <code>test()</code>, which constructs a test where the
first argument is the <code>name</code> of the test to be displayed in
our results and the second is a <code>callback</code> function
containing all of our assertions. This is called as soon as QUnit is
running.</p>
<div class="sourceCode" id="cb389"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myString <span class="op">=</span> <span class="st">&#39;Hello Backbone.js&#39;</span><span class="op">;</span></span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;Our first QUnit test - asserting results&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-5"><a href="#cb389-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ok( boolean, message )</span></span>
<span id="cb389-6"><a href="#cb389-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ok</span>( <span class="kw">true</span><span class="op">,</span> <span class="st">&#39;the test succeeds&#39;</span>)<span class="op">;</span></span>
<span id="cb389-7"><a href="#cb389-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ok</span>( <span class="kw">false</span><span class="op">,</span> <span class="st">&#39;the test fails&#39;</span>)<span class="op">;</span></span>
<span id="cb389-8"><a href="#cb389-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-9"><a href="#cb389-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// equal( actualValue, expectedValue, message )</span></span>
<span id="cb389-10"><a href="#cb389-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( myString<span class="op">,</span> <span class="st">&#39;Hello Backbone.js&#39;</span><span class="op">,</span> <span class="st">&#39;The value expected is Hello Backbone.js!&#39;</span>)<span class="op">;</span></span>
<span id="cb389-11"><a href="#cb389-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>What we’re doing in the above is defining a variable with a specific
value and then testing to ensure the value was what we expected it to
be. This was done using the comparison assertion, <code>equal()</code>,
which expects its first argument to be a value being tested and the
second argument to be the expected value. We also used
<code>ok()</code>, which allows us to easily test against functions or
variables that evaluate to booleans.</p>
<p>Note: Optionally in our test case, we could have passed an ‘expected’
value to <code>test()</code> defining the number of assertions we expect
to run. This takes the form:
<code>test( name, [expected], test );</code> or by manually settings the
expectation at the top of the test function, like so:
<code>expect( 1 )</code>. I recommend you make a habit of always
defining how many assertions you expect. More on this later.</p>
<h4
id="comparing-the-actual-output-of-a-function-against-the-expected-output">Comparing
the actual output of a function against the expected output</h4>
<p>As testing a simple static variable is fairly trivial, we can take
this further to test actual functions. In the following example we test
the output of a function that reverses a string to ensure that the
output is correct using <code>equal()</code> and
<code>notEqual()</code>:</p>
<div class="sourceCode" id="cb390"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">reverseString</span>( str ){</span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> str<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;&#39;</span>)<span class="op">.</span><span class="fu">reverse</span>()<span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-5"><a href="#cb390-5" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;reverseString()&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb390-6"><a href="#cb390-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">5</span> )<span class="op">;</span></span>
<span id="cb390-7"><a href="#cb390-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="fu">reverseString</span>(<span class="st">&#39;hello&#39;</span>)<span class="op">,</span> <span class="st">&#39;olleh&#39;</span><span class="op">,</span> <span class="st">&#39;The value expected was olleh&#39;</span> )<span class="op">;</span></span>
<span id="cb390-8"><a href="#cb390-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="fu">reverseString</span>(<span class="st">&#39;foobar&#39;</span>)<span class="op">,</span> <span class="st">&#39;raboof&#39;</span><span class="op">,</span> <span class="st">&#39;The value expected was raboof&#39;</span> )<span class="op">;</span></span>
<span id="cb390-9"><a href="#cb390-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="fu">reverseString</span>(<span class="st">&#39;world&#39;</span>)<span class="op">,</span> <span class="st">&#39;dlrow&#39;</span><span class="op">,</span> <span class="st">&#39;The value expected was dlrow&#39;</span> )<span class="op">;</span></span>
<span id="cb390-10"><a href="#cb390-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">notEqual</span>( <span class="fu">reverseString</span>(<span class="st">&#39;world&#39;</span>)<span class="op">,</span> <span class="st">&#39;dlroo&#39;</span><span class="op">,</span> <span class="st">&#39;The value was expected to not be dlroo&#39;</span> )<span class="op">;</span></span>
<span id="cb390-11"><a href="#cb390-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="fu">reverseString</span>(<span class="st">&#39;bubble&#39;</span>)<span class="op">,</span> <span class="st">&#39;double&#39;</span><span class="op">,</span> <span class="st">&#39;The value expected was elbbub&#39;</span> )<span class="op">;</span></span>
<span id="cb390-12"><a href="#cb390-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Running these tests in the QUnit test runner (which you would see
when your HTML test page was loaded) we would find that four of the
assertions pass while the last one does not. The reason the test against
<code>'double'</code> fails is because it was purposefully written
incorrectly. In your own projects if a test fails to pass and your
assertions are correct, you’ve probably just found a bug!</p>
<h2 id="adding-structure-to-assertions">Adding structure to
assertions</h2>
<p>Housing all of our assertions in one test case can quickly become
difficult to maintain, but luckily QUnit supports structuring blocks of
assertions more cleanly. This can be done using <code>module()</code> -
a method that allows us to easily group tests together. A typical
approach to grouping might be keeping multiple tests for a specific
method as part of the same group (module).</p>
<h4 id="basic-qunit-modules">Basic QUnit Modules</h4>
<div class="sourceCode" id="cb391"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>( <span class="st">&#39;Module One&#39;</span> )<span class="op">;</span></span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;first test&#39;</span><span class="op">,</span> <span class="kw">function</span>() {} )<span class="op">;</span></span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;another test&#39;</span><span class="op">,</span> <span class="kw">function</span>() {} )<span class="op">;</span></span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-5"><a href="#cb391-5" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>( <span class="st">&#39;Module Two&#39;</span> )<span class="op">;</span></span>
<span id="cb391-6"><a href="#cb391-6" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;second test&#39;</span><span class="op">,</span> <span class="kw">function</span>() {} )<span class="op">;</span></span>
<span id="cb391-7"><a href="#cb391-7" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;another test&#39;</span><span class="op">,</span> <span class="kw">function</span>() {} )<span class="op">;</span></span>
<span id="cb391-8"><a href="#cb391-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-9"><a href="#cb391-9" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>( <span class="st">&#39;Module Three&#39;</span> )<span class="op">;</span></span>
<span id="cb391-10"><a href="#cb391-10" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;third test&#39;</span><span class="op">,</span> <span class="kw">function</span>() {} )<span class="op">;</span></span>
<span id="cb391-11"><a href="#cb391-11" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;another test&#39;</span><span class="op">,</span> <span class="kw">function</span>() {} )<span class="op">;</span></span></code></pre></div>
<p>We can take this further by introducing <code>setup()</code> and
<code>teardown()</code> callbacks to our modules, where
<code>setup()</code> is run before each test and <code>teardown()</code>
is run after each test.</p>
<h4 id="using-setup-and-teardown">Using setup() and teardown()</h4>
<div class="sourceCode" id="cb392"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>( <span class="st">&#39;Module One&#39;</span><span class="op">,</span> {</span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">setup</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// run before</span></span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">teardown</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// run after</span></span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb392-8"><a href="#cb392-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb392-9"><a href="#cb392-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-10"><a href="#cb392-10" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;first test&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb392-11"><a href="#cb392-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// run the first test</span></span>
<span id="cb392-12"><a href="#cb392-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>These callbacks can be used to define (or clear) any components we
wish to instantiate for use in one or more of our tests. As we’ll see
shortly, this is ideal for defining new instances of views, collections,
models, or routers from a project that we can then reference across
multiple tests.</p>
<h4 id="using-setup-and-teardown-for-instantiation-and-clean-up">Using
setup() and teardown() for instantiation and clean-up</h4>
<div class="sourceCode" id="cb393"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a simple model and collection modeling a store and</span></span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a><span class="co">// list of stores</span></span>
<span id="cb393-3"><a href="#cb393-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-4"><a href="#cb393-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Store <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span>
<span id="cb393-5"><a href="#cb393-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-6"><a href="#cb393-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> StoreList <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb393-7"><a href="#cb393-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> Store<span class="op">,</span></span>
<span id="cb393-8"><a href="#cb393-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">comparator</span><span class="op">:</span> <span class="kw">function</span>( Store ) { <span class="cf">return</span> Store<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;name&#39;</span>) }</span>
<span id="cb393-9"><a href="#cb393-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb393-10"><a href="#cb393-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-11"><a href="#cb393-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a group for our tests</span></span>
<span id="cb393-12"><a href="#cb393-12" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>( <span class="st">&#39;StoreList sanity check&#39;</span><span class="op">,</span> {</span>
<span id="cb393-13"><a href="#cb393-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">setup</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb393-14"><a href="#cb393-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">list</span> <span class="op">=</span> <span class="kw">new</span> StoreList<span class="op">;</span></span>
<span id="cb393-15"><a href="#cb393-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">list</span><span class="op">.</span><span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Store</span>({ <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Costcutter&#39;</span> }))<span class="op">;</span></span>
<span id="cb393-16"><a href="#cb393-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">list</span><span class="op">.</span><span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Store</span>({ <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Target&#39;</span> }))<span class="op">;</span></span>
<span id="cb393-17"><a href="#cb393-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">list</span><span class="op">.</span><span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Store</span>({ <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Walmart&#39;</span> }))<span class="op">;</span></span>
<span id="cb393-18"><a href="#cb393-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">list</span><span class="op">.</span><span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Store</span>({ <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Barnes &amp; Noble&#39;</span> }))<span class="op">;</span></span>
<span id="cb393-19"><a href="#cb393-19" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb393-20"><a href="#cb393-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">teardown</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb393-21"><a href="#cb393-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">window</span><span class="op">.</span><span class="at">errors</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb393-22"><a href="#cb393-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb393-23"><a href="#cb393-23" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb393-24"><a href="#cb393-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-25"><a href="#cb393-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Test the order of items added</span></span>
<span id="cb393-26"><a href="#cb393-26" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;test ordering&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb393-27"><a href="#cb393-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb393-28"><a href="#cb393-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> expected <span class="op">=</span> [<span class="st">&#39;Barnes &amp; Noble&#39;</span><span class="op">,</span> <span class="st">&#39;Costcutter&#39;</span><span class="op">,</span> <span class="st">&#39;Target&#39;</span><span class="op">,</span> <span class="st">&#39;Walmart&#39;</span>]<span class="op">;</span></span>
<span id="cb393-29"><a href="#cb393-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> actual <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">list</span><span class="op">.</span><span class="fu">pluck</span>(<span class="st">&#39;name&#39;</span>)<span class="op">;</span></span>
<span id="cb393-30"><a href="#cb393-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">deepEqual</span>( actual<span class="op">,</span> expected<span class="op">,</span> <span class="st">&#39;is maintained by comparator&#39;</span> )<span class="op">;</span></span>
<span id="cb393-31"><a href="#cb393-31" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Here, a list of stores is created and stored on <code>setup()</code>.
A <code>teardown()</code> callback is used to simply clear a list of
errors we might be storing within the window scope, but is otherwise not
needed.</p>
<h2 id="assertion-examples">Assertion examples</h2>
<p>Before we continue any further, let’s review some more examples of
how QUnit’s various assertions can be correctly used when writing
tests:</p>
<h3
id="equal---a-comparison-assertion.-it-passes-if-actual-expected">equal
- a comparison assertion. It passes if actual == expected</h3>
<div class="sourceCode" id="cb394"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;equal&#39;</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> actual <span class="op">=</span> <span class="dv">6</span> <span class="op">-</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( actual<span class="op">,</span> <span class="kw">true</span><span class="op">,</span>  <span class="st">&#39;passes as 1 == true&#39;</span> )<span class="op">;</span></span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( actual<span class="op">,</span> <span class="dv">1</span><span class="op">,</span>     <span class="st">&#39;passes as 1 == 1&#39;</span> )<span class="op">;</span></span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3
id="notequal---a-comparison-assertion.-it-passes-if-actual-expected">notEqual
- a comparison assertion. It passes if actual != expected</h3>
<div class="sourceCode" id="cb395"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;notEqual&#39;</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> actual <span class="op">=</span> <span class="dv">6</span> <span class="op">-</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notEqual</span>( actual<span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="st">&#39;passes as 1 != false&#39;</span> )<span class="op">;</span></span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notEqual</span>( actual<span class="op">,</span> <span class="dv">0</span><span class="op">,</span>     <span class="st">&#39;passes as 1 != 0&#39;</span> )<span class="op">;</span></span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3
id="strictequal---a-comparison-assertion.-it-passes-if-actual-expected">strictEqual
- a comparison assertion. It passes if actual === expected</h3>
<div class="sourceCode" id="cb396"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;strictEqual&#39;</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> actual <span class="op">=</span> <span class="dv">6</span> <span class="op">-</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strictEqual</span>( actual<span class="op">,</span> <span class="kw">true</span><span class="op">,</span>  <span class="st">&#39;fails as 1 !== true&#39;</span> )<span class="op">;</span></span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strictEqual</span>( actual<span class="op">,</span> <span class="dv">1</span><span class="op">,</span>     <span class="st">&#39;passes as 1 === 1&#39;</span> )<span class="op">;</span></span>
<span id="cb396-5"><a href="#cb396-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3
id="notstrictequal---a-comparison-assertion.-it-passes-if-actual-expected">notStrictEqual
- a comparison assertion. It passes if actual !== expected</h3>
<div class="sourceCode" id="cb397"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;notStrictEqual&#39;</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> actual <span class="op">=</span> <span class="dv">6</span> <span class="op">-</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notStrictEqual</span>( actual<span class="op">,</span> <span class="kw">true</span><span class="op">,</span>  <span class="st">&#39;passes as 1 !== true&#39;</span> )<span class="op">;</span></span>
<span id="cb397-4"><a href="#cb397-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notStrictEqual</span>( actual<span class="op">,</span> <span class="dv">1</span><span class="op">,</span>     <span class="st">&#39;fails as 1 === 1&#39;</span> )<span class="op">;</span></span>
<span id="cb397-5"><a href="#cb397-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3
id="deepequal---a-recursive-comparison-assertion.-unlike-strictequal-it-works-on-objects-arrays-and-primitives.">deepEqual
- a recursive comparison assertion. Unlike strictEqual(), it works on
objects, arrays and primitives.</h3>
<div class="sourceCode" id="cb398"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;deepEqual&#39;</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> actual <span class="op">=</span> {<span class="dt">q</span><span class="op">:</span> <span class="st">&#39;foo&#39;</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span>}<span class="op">;</span></span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> el <span class="op">=</span>  <span class="fu">$</span>(<span class="st">&#39;div&#39;</span>)<span class="op">;</span></span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> children <span class="op">=</span> <span class="fu">$</span>(<span class="st">&#39;div&#39;</span>)<span class="op">.</span><span class="fu">children</span>()<span class="op">;</span></span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-6"><a href="#cb398-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( actual<span class="op">,</span> {<span class="dt">q</span><span class="op">:</span> <span class="st">&#39;foo&#39;</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span>}<span class="op">,</span>   <span class="st">&#39;fails - objects are not equal using equal()&#39;</span> )<span class="op">;</span></span>
<span id="cb398-7"><a href="#cb398-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">deepEqual</span>( actual<span class="op">,</span> {<span class="dt">q</span><span class="op">:</span> <span class="st">&#39;foo&#39;</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span>}<span class="op">,</span>   <span class="st">&#39;passes - objects are equal&#39;</span> )<span class="op">;</span></span>
<span id="cb398-8"><a href="#cb398-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( el<span class="op">,</span> children<span class="op">,</span> <span class="st">&#39;fails - jQuery objects are not the same&#39;</span> )<span class="op">;</span></span>
<span id="cb398-9"><a href="#cb398-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">deepEqual</span>(el<span class="op">,</span> children<span class="op">,</span> <span class="st">&#39;fails - objects not equivalent&#39;</span> )<span class="op">;</span></span>
<span id="cb398-10"><a href="#cb398-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-11"><a href="#cb398-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3
id="notdeepequal---a-comparison-assertion.-this-returns-the-opposite-of-deepequal">notDeepEqual
- a comparison assertion. This returns the opposite of deepEqual</h3>
<div class="sourceCode" id="cb399"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;notDeepEqual&#39;</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> actual <span class="op">=</span> {<span class="dt">q</span><span class="op">:</span> <span class="st">&#39;foo&#39;</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span>}<span class="op">;</span></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notEqual</span>( actual<span class="op">,</span> {<span class="dt">q</span><span class="op">:</span> <span class="st">&#39;foo&#39;</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span>}<span class="op">,</span>   <span class="st">&#39;passes - objects are not equal&#39;</span> )<span class="op">;</span></span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notDeepEqual</span>( actual<span class="op">,</span> {<span class="dt">q</span><span class="op">:</span> <span class="st">&#39;foo&#39;</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span>}<span class="op">,</span>   <span class="st">&#39;fails - objects are equivalent&#39;</span> )<span class="op">;</span></span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3
id="raises---an-assertion-which-tests-if-a-callback-throws-any-exceptions">raises
- an assertion which tests if a callback throws any exceptions</h3>
<div class="sourceCode" id="cb400"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;raises&#39;</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">raises</span>(<span class="kw">function</span>() {</span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>( <span class="st">&#39;Oh no! It`s an error!&#39;</span> )<span class="op">;</span></span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> <span class="st">&#39;passes - an error was thrown inside our callback&#39;</span>)<span class="op">;</span></span>
<span id="cb400-5"><a href="#cb400-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="fixtures">Fixtures</h2>
<p>From time to time we may need to write tests that modify the DOM.
Managing the clean-up of such operations between tests can be a genuine
pain, but thankfully QUnit has a solution to this problem in the form of
the <code>#qunit-fixture</code> element, seen below.</p>
<h4 id="fixture-markup">Fixture markup:</h4>
<div class="sourceCode" id="cb401"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>QUnit Test<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;qunit.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb401-6"><a href="#cb401-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;qunit.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb401-7"><a href="#cb401-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;app.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb401-8"><a href="#cb401-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;tests.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb401-9"><a href="#cb401-9" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb401-10"><a href="#cb401-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb401-11"><a href="#cb401-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h1</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-header&quot;</span><span class="dt">&gt;</span>QUnit Test<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb401-12"><a href="#cb401-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h2</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-banner&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb401-13"><a href="#cb401-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-testrunner-toolbar&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb401-14"><a href="#cb401-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h2</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-userAgent&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb401-15"><a href="#cb401-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">ol</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-tests&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">ol</span><span class="dt">&gt;</span></span>
<span id="cb401-16"><a href="#cb401-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-fixture&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb401-17"><a href="#cb401-17" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb401-18"><a href="#cb401-18" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>We can either opt to place static markup in the fixture or just
insert/append any DOM elements we may need to it. QUnit will
automatically reset the <code>innerHTML</code> of the fixture after each
test to its original value. In case you’re using jQuery, it’s useful to
know that QUnit checks for its availability and will opt to use
<code>$(el).html()</code> instead, which will cleanup any jQuery event
handlers too.</p>
<h3 id="fixtures-example">Fixtures example:</h3>
<p>Let us now go through a more complete example of using fixtures. One
thing that most of us are used to doing in jQuery is working with lists
- they’re often used to define the markup for menus, grids, and a number
of other components. You may have used jQuery plugins before that
manipulated a given list in a particular way and it can be useful to
test that the final (manipulated) output of the plugin is what was
expected.</p>
<p>For the purposes of our next example, we’re going to use Ben Alman’s
<code>$.enumerate()</code> plugin, which can prepend each item in a list
by its index, optionally allowing us to set what the first number in the
list is. The code snippet for the plugin can be found below, followed by
an example of the output it generates:</p>
<div class="sourceCode" id="cb402"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a>$<span class="op">.</span><span class="at">fn</span><span class="op">.</span><span class="at">enumerate</span> <span class="op">=</span> <span class="kw">function</span>( start ) {</span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> ( <span class="kw">typeof</span> start <span class="op">!==</span> <span class="st">&#39;undefined&#39;</span> ) {</span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Since `start` value was provided, enumerate and return</span></span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// the initial jQuery object to allow chaining.</span></span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-6"><a href="#cb402-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>(i){</span>
<span id="cb402-7"><a href="#cb402-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">$</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">prepend</span>( <span class="st">&#39;&lt;b&gt;&#39;</span> <span class="op">+</span> ( i <span class="op">+</span> start ) <span class="op">+</span> <span class="st">&#39;&lt;/b&gt; &#39;</span> )<span class="op">;</span></span>
<span id="cb402-8"><a href="#cb402-8" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb402-9"><a href="#cb402-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-10"><a href="#cb402-10" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb402-11"><a href="#cb402-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Since no `start` value was provided, function as a</span></span>
<span id="cb402-12"><a href="#cb402-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// getter, returning the appropriate value from the first</span></span>
<span id="cb402-13"><a href="#cb402-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// selected element.</span></span>
<span id="cb402-14"><a href="#cb402-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-15"><a href="#cb402-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> val <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">eq</span>( <span class="dv">0</span> )<span class="op">.</span><span class="fu">children</span>( <span class="st">&#39;b&#39;</span> )<span class="op">.</span><span class="fu">eq</span>( <span class="dv">0</span> )<span class="op">.</span><span class="fu">text</span>()<span class="op">;</span></span>
<span id="cb402-16"><a href="#cb402-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">Number</span>( val )<span class="op">;</span></span>
<span id="cb402-17"><a href="#cb402-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb402-18"><a href="#cb402-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb402-19"><a href="#cb402-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-20"><a href="#cb402-20" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb402-21"><a href="#cb402-21" aria-hidden="true" tabindex="-1"></a><span class="co">    &lt;ul&gt;</span></span>
<span id="cb402-22"><a href="#cb402-22" aria-hidden="true" tabindex="-1"></a><span class="co">      &lt;li&gt;1. hello&lt;/li&gt;</span></span>
<span id="cb402-23"><a href="#cb402-23" aria-hidden="true" tabindex="-1"></a><span class="co">      &lt;li&gt;2. world&lt;/li&gt;</span></span>
<span id="cb402-24"><a href="#cb402-24" aria-hidden="true" tabindex="-1"></a><span class="co">      &lt;li&gt;3. i&lt;/li&gt;</span></span>
<span id="cb402-25"><a href="#cb402-25" aria-hidden="true" tabindex="-1"></a><span class="co">      &lt;li&gt;4. am&lt;/li&gt;</span></span>
<span id="cb402-26"><a href="#cb402-26" aria-hidden="true" tabindex="-1"></a><span class="co">      &lt;li&gt;5. foo&lt;/li&gt;</span></span>
<span id="cb402-27"><a href="#cb402-27" aria-hidden="true" tabindex="-1"></a><span class="co">    &lt;/ul&gt;</span></span>
<span id="cb402-28"><a href="#cb402-28" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<p>Let’s now write some tests for the plugin. First, we define the
markup for a list containing some sample items inside our
<code>qunit-fixture</code> element:</p>
<div class="sourceCode" id="cb403"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;qunit-fixture&quot;</span><span class="dt">&gt;</span></span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>hello<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>world<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>i<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb403-6"><a href="#cb403-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>am<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb403-7"><a href="#cb403-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>foo<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb403-8"><a href="#cb403-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb403-9"><a href="#cb403-9" aria-hidden="true" tabindex="-1"></a> <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Next, we need to think about what should be tested.
<code>$.enumerate()</code> supports a few different use cases,
including:</p>
<ul>
<li><strong>No arguments passed</strong> - i.e.,
<code>$(el).enumerate()</code></li>
<li><strong>0 passed as an argument</strong> - i.e.,
<code>$(el).enumerate(0)</code></li>
<li><strong>1 passed as an argument</strong> - i.e.,
<code>$(el).enumerate(1)</code></li>
</ul>
<p>As the text value for each list item is of the form “n. item-text”
and we only require this to test against the expected output, we can
simply access the content using <code>$(el).eq(index).text()</code> (for
more information on .eq() see <a
href="http://api.jquery.com/eq/">here</a>).</p>
<p>and finally, here are our test cases:</p>
<div class="sourceCode" id="cb404"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>(<span class="st">&#39;jQuery#enumerate&#39;</span>)<span class="op">;</span></span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;No arguments passed&#39;</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> items <span class="op">=</span> <span class="fu">$</span>(<span class="st">&#39;#qunit-fixture li&#39;</span>)<span class="op">.</span><span class="fu">enumerate</span>()<span class="op">;</span> <span class="co">// 0</span></span>
<span id="cb404-5"><a href="#cb404-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;0. hello&#39;</span><span class="op">,</span> <span class="st">&#39;first item should have index 0&#39;</span> )<span class="op">;</span></span>
<span id="cb404-6"><a href="#cb404-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;1. world&#39;</span><span class="op">,</span> <span class="st">&#39;second item should have index 1&#39;</span> )<span class="op">;</span></span>
<span id="cb404-7"><a href="#cb404-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">2</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;2. i&#39;</span><span class="op">,</span> <span class="st">&#39;third item should have index 2&#39;</span> )<span class="op">;</span></span>
<span id="cb404-8"><a href="#cb404-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">3</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;3. am&#39;</span><span class="op">,</span> <span class="st">&#39;fourth item should have index 3&#39;</span> )<span class="op">;</span></span>
<span id="cb404-9"><a href="#cb404-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">4</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;4. foo&#39;</span><span class="op">,</span> <span class="st">&#39;fifth item should have index 4&#39;</span> )<span class="op">;</span></span>
<span id="cb404-10"><a href="#cb404-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb404-11"><a href="#cb404-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-12"><a href="#cb404-12" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;0 passed as an argument&#39;</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb404-13"><a href="#cb404-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> items <span class="op">=</span> <span class="fu">$</span>(<span class="st">&#39;#qunit-fixture li&#39;</span>)<span class="op">.</span><span class="fu">enumerate</span>( <span class="dv">0</span> )<span class="op">;</span></span>
<span id="cb404-14"><a href="#cb404-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;0. hello&#39;</span><span class="op">,</span> <span class="st">&#39;first item should have index 0&#39;</span> )<span class="op">;</span></span>
<span id="cb404-15"><a href="#cb404-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;1. world&#39;</span><span class="op">,</span> <span class="st">&#39;second item should have index 1&#39;</span> )<span class="op">;</span></span>
<span id="cb404-16"><a href="#cb404-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">2</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;2. i&#39;</span><span class="op">,</span> <span class="st">&#39;third item should have index 2&#39;</span> )<span class="op">;</span></span>
<span id="cb404-17"><a href="#cb404-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">3</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;3. am&#39;</span><span class="op">,</span> <span class="st">&#39;fourth item should have index 3&#39;</span> )<span class="op">;</span></span>
<span id="cb404-18"><a href="#cb404-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">4</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;4. foo&#39;</span><span class="op">,</span> <span class="st">&#39;fifth item should have index 4&#39;</span> )<span class="op">;</span></span>
<span id="cb404-19"><a href="#cb404-19" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb404-20"><a href="#cb404-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-21"><a href="#cb404-21" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;1 passed as an argument&#39;</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb404-22"><a href="#cb404-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> items <span class="op">=</span> <span class="fu">$</span>(<span class="st">&#39;#qunit-fixture li&#39;</span>)<span class="op">.</span><span class="fu">enumerate</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb404-23"><a href="#cb404-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;1. hello&#39;</span><span class="op">,</span> <span class="st">&#39;first item should have index 1&#39;</span> )<span class="op">;</span></span>
<span id="cb404-24"><a href="#cb404-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;2. world&#39;</span><span class="op">,</span> <span class="st">&#39;second item should have index 2&#39;</span> )<span class="op">;</span></span>
<span id="cb404-25"><a href="#cb404-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">2</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;3. i&#39;</span><span class="op">,</span> <span class="st">&#39;third item should have index 3&#39;</span> )<span class="op">;</span></span>
<span id="cb404-26"><a href="#cb404-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">3</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;4. am&#39;</span><span class="op">,</span> <span class="st">&#39;fourth item should have index 4&#39;</span> )<span class="op">;</span></span>
<span id="cb404-27"><a href="#cb404-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equal</span>( items<span class="op">.</span><span class="fu">eq</span>(<span class="dv">4</span>)<span class="op">.</span><span class="fu">text</span>()<span class="op">,</span> <span class="st">&#39;5. foo&#39;</span><span class="op">,</span> <span class="st">&#39;fifth item should have index 5&#39;</span> )<span class="op">;</span></span>
<span id="cb404-28"><a href="#cb404-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="asynchronous-code">Asynchronous code</h2>
<p>As with Jasmine, the effort required to run synchronous tests with
QUnit is fairly minimal. That said, what about tests that require
asynchronous callbacks (such as expensive processes, Ajax requests, and
so on)? When we’re dealing with asynchronous code, rather than letting
QUnit control when the next test runs, we can tell it that we need it to
stop running and wait until it’s okay to continue once again.</p>
<p>Remember: running asynchronous code without any special
considerations can cause incorrect assertions to appear in other tests,
so we want to make sure we get it right.</p>
<p>Writing QUnit tests for asynchronous code is made possible using the
<code>start()</code> and <code>stop()</code> methods, which
programmatically set the start and stop points during such tests. Here’s
a simple example:</p>
<div class="sourceCode" id="cb405"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;An async test&#39;</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">stop</span>()<span class="op">;</span></span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb405-4"><a href="#cb405-4" aria-hidden="true" tabindex="-1"></a>   $<span class="op">.</span><span class="fu">ajax</span>({</span>
<span id="cb405-5"><a href="#cb405-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/test&#39;</span><span class="op">,</span></span>
<span id="cb405-6"><a href="#cb405-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dataType</span><span class="op">:</span> <span class="st">&#39;json&#39;</span><span class="op">,</span></span>
<span id="cb405-7"><a href="#cb405-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">success</span><span class="op">:</span> <span class="kw">function</span>( data ){</span>
<span id="cb405-8"><a href="#cb405-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">deepEqual</span>(data<span class="op">,</span> {</span>
<span id="cb405-9"><a href="#cb405-9" aria-hidden="true" tabindex="-1"></a>               <span class="dt">topic</span><span class="op">:</span> <span class="st">&#39;hello&#39;</span><span class="op">,</span></span>
<span id="cb405-10"><a href="#cb405-10" aria-hidden="true" tabindex="-1"></a>               <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;hi there!&#39;&#39;</span></span>
<span id="cb405-11"><a href="#cb405-11" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb405-12"><a href="#cb405-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ok</span>(<span class="kw">true</span><span class="op">,</span> <span class="st">&#39;Asynchronous test passed!&#39;</span>)<span class="op">;</span></span>
<span id="cb405-13"><a href="#cb405-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">start</span>()<span class="op">;</span></span>
<span id="cb405-14"><a href="#cb405-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb405-15"><a href="#cb405-15" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb405-16"><a href="#cb405-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>A jQuery <code>$.ajax()</code> request is used to connect to a test
resource and assert that the data returned is correct.
<code>deepEqual()</code> is used here as it allows us to compare
different data types (e.g., objects, arrays) and ensures that what is
returned is exactly what we’re expecting. We know that our Ajax request
is asynchronous and so we first call <code>stop()</code>, then run the
code making the request, and finally, at the very end of our callback,
inform QUnit that it is okay to continue running other tests.</p>
<p>Note: rather than including <code>stop()</code>, we can simply
exclude it and substitute <code>test()</code> with
<code>asyncTest()</code> if we prefer. This improves readability when
dealing with a mixture of asynchronous and synchronous tests in your
suite. While this setup should work fine for many use-cases, there is no
guarantee that the callback in our <code>$.ajax()</code> request will
actually get called. To factor this into our tests, we can use
<code>expect()</code> once again to define how many assertions we expect
to see within our test. This is a healthy safety blanket as it ensures
that if a test completes with an insufficient number of assertions, we
know something went wrong and can fix it.</p>
<h1 id="sinonjs">SinonJS</h1>
<p>Similar to the section on testing Backbone.js apps using the Jasmine
BDD framework, we’re nearly ready to take what we’ve learned and write a
number of QUnit tests for our Todo application.</p>
<p>Before we start though, you may have noticed that QUnit doesn’t
support test spies. Test spies are functions which record arguments,
exceptions, and return values for any of their calls. They’re typically
used to test callbacks and how functions may be used in the application
being tested. In testing frameworks, spies usually are anonymous
functions or wrappers around functions which already exist.</p>
<h2 id="what-is-sinonjs">What is SinonJS?</h2>
<p>In order for us to substitute support for spies in QUnit, we will be
taking advantage of a mocking framework called <a
href="http://sinonjs.org/">SinonJS</a> by Christian Johansen. We will
also be using the <a href="http://sinonjs.org/qunit/">SinonJS-QUnit
adapter</a> which provides seamless integration with QUnit (meaning
setup is minimal). Sinon.JS is completely test-framework agnostic and
should be easy to use with any testing framework, so it’s ideal for our
needs.</p>
<p>The framework supports three features we’ll be taking advantage of
for unit testing our application:</p>
<ul>
<li><strong>Anonymous spies</strong></li>
<li><strong>Spying on existing methods</strong></li>
<li><strong>A rich inspection interface</strong></li>
</ul>
<h4 id="basic-spies">Basic Spies</h4>
<p>Using <code>this.spy()</code> without any arguments creates an
anonymous spy. This is comparable to <code>jasmine.createSpy()</code>.
We can observe basic usage of a SinonJS spy in the following
example:</p>
<div class="sourceCode" id="cb406"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;should call all subscribers for a message exactly once&#39;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> message <span class="op">=</span> <span class="fu">getUniqueString</span>()<span class="op">;</span></span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> spy <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">subscribe</span>( message<span class="op">,</span> spy )<span class="op">;</span></span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">publishSync</span>( message<span class="op">,</span> <span class="st">&#39;Hello World&#39;</span> )<span class="op">;</span></span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ok</span>( spy<span class="op">.</span><span class="at">calledOnce</span><span class="op">,</span> <span class="st">&#39;the subscriber was called once&#39;</span> )<span class="op">;</span></span>
<span id="cb406-9"><a href="#cb406-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h4 id="spying-on-existing-functions">Spying On Existing Functions</h4>
<p>We can also use <code>this.spy()</code> to spy on existing functions
(like jQuery’s <code>$.ajax</code>) in the example below. When spying on
a function which already exists, the function behaves normally but we
get access to data about its calls which can be very useful for testing
purposes.</p>
<div class="sourceCode" id="cb407"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;should inspect the jQuery.getJSON usage of jQuery.ajax&#39;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">spy</span>( jQuery<span class="op">,</span> <span class="st">&#39;ajax&#39;</span> )<span class="op">;</span></span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-4"><a href="#cb407-4" aria-hidden="true" tabindex="-1"></a>    jQuery<span class="op">.</span><span class="fu">getJSON</span>( <span class="st">&#39;/todos/completed&#39;</span> )<span class="op">;</span></span>
<span id="cb407-5"><a href="#cb407-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-6"><a href="#cb407-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ok</span>( jQuery<span class="op">.</span><span class="at">ajax</span><span class="op">.</span><span class="at">calledOnce</span> )<span class="op">;</span></span>
<span id="cb407-7"><a href="#cb407-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equals</span>( jQuery<span class="op">.</span><span class="at">ajax</span><span class="op">.</span><span class="fu">getCall</span>(<span class="dv">0</span>)<span class="op">.</span><span class="at">args</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">url</span><span class="op">,</span> <span class="st">&#39;/todos/completed&#39;</span> )<span class="op">;</span></span>
<span id="cb407-8"><a href="#cb407-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equals</span>( jQuery<span class="op">.</span><span class="at">ajax</span><span class="op">.</span><span class="fu">getCall</span>(<span class="dv">0</span>)<span class="op">.</span><span class="at">args</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">dataType</span><span class="op">,</span> <span class="st">&#39;json&#39;</span> )<span class="op">;</span></span>
<span id="cb407-9"><a href="#cb407-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h4 id="inspection-interface">Inspection Interface</h4>
<p>SinonJS comes with a rich spy interface which allows us to test
whether a spy was called with a specific argument, if it was called a
specific number of times, and test against the values of arguments. A
complete list of features supported in the interface can be found on <a
href="http://sinonjs.org/docs/">SinonJS.org</a>, but let’s take a look
at some examples demonstrating some of the most commonly used ones:</p>
<p><strong>Matching arguments: test a spy was called with a specific set
of arguments:</strong></p>
<div class="sourceCode" id="cb408"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;Should call a subscriber with standard matching&#39;</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> spy <span class="op">=</span> sinon<span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb408-3"><a href="#cb408-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-4"><a href="#cb408-4" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">subscribe</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> spy )<span class="op">;</span></span>
<span id="cb408-5"><a href="#cb408-5" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">publishSync</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> { <span class="dt">id</span><span class="op">:</span> <span class="dv">45</span> } )<span class="op">;</span></span>
<span id="cb408-6"><a href="#cb408-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-7"><a href="#cb408-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertTrue</span>( spy<span class="op">.</span><span class="fu">calledWith</span>( { <span class="dt">id</span><span class="op">:</span> <span class="dv">45</span> } ) )<span class="op">;</span></span>
<span id="cb408-8"><a href="#cb408-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Stricter argument matching: test a spy was called at least
once with specific arguments and no others:</strong></p>
<div class="sourceCode" id="cb409"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;Should call a subscriber with strict matching&#39;</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> spy <span class="op">=</span> sinon<span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-4"><a href="#cb409-4" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">subscribe</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> spy )<span class="op">;</span></span>
<span id="cb409-5"><a href="#cb409-5" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">publishSync</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> <span class="st">&#39;many&#39;</span><span class="op">,</span> <span class="st">&#39;arguments&#39;</span> )<span class="op">;</span></span>
<span id="cb409-6"><a href="#cb409-6" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">publishSync</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">34</span> )<span class="op">;</span></span>
<span id="cb409-7"><a href="#cb409-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-8"><a href="#cb409-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This passes</span></span>
<span id="cb409-9"><a href="#cb409-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertTrue</span>( spy<span class="op">.</span><span class="fu">calledWith</span>(<span class="st">&#39;many&#39;</span>) )<span class="op">;</span></span>
<span id="cb409-10"><a href="#cb409-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-11"><a href="#cb409-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This however, fails</span></span>
<span id="cb409-12"><a href="#cb409-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertTrue</span>( spy<span class="op">.</span><span class="fu">calledWithExactly</span>( <span class="st">&#39;many&#39;</span> ) )<span class="op">;</span></span>
<span id="cb409-13"><a href="#cb409-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Testing call order: testing if a spy was called before or
after another spy:</strong></p>
<div class="sourceCode" id="cb410"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;Should call a subscriber and maintain call order&#39;</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> a <span class="op">=</span> sinon<span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> b <span class="op">=</span> sinon<span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb410-4"><a href="#cb410-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-5"><a href="#cb410-5" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">subscribe</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> a )<span class="op">;</span></span>
<span id="cb410-6"><a href="#cb410-6" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">subscribe</span>( <span class="st">&#39;event&#39;</span><span class="op">,</span> b )<span class="op">;</span></span>
<span id="cb410-7"><a href="#cb410-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-8"><a href="#cb410-8" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">publishSync</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> { <span class="dt">id</span><span class="op">:</span> <span class="dv">45</span> } )<span class="op">;</span></span>
<span id="cb410-9"><a href="#cb410-9" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">publishSync</span>( <span class="st">&#39;event&#39;</span><span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>] )<span class="op">;</span></span>
<span id="cb410-10"><a href="#cb410-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-11"><a href="#cb410-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertTrue</span>( a<span class="op">.</span><span class="fu">calledBefore</span>(b) )<span class="op">;</span></span>
<span id="cb410-12"><a href="#cb410-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertTrue</span>( b<span class="op">.</span><span class="fu">calledAfter</span>(a) )<span class="op">;</span></span>
<span id="cb410-13"><a href="#cb410-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Match execution counts: test a spy was called a specific
number of times:</strong></p>
<div class="sourceCode" id="cb411"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;Should call a subscriber and check call counts&#39;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> message <span class="op">=</span> <span class="fu">getUniqueString</span>()<span class="op">;</span></span>
<span id="cb411-3"><a href="#cb411-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> spy <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb411-4"><a href="#cb411-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb411-5"><a href="#cb411-5" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">subscribe</span>( message<span class="op">,</span> spy )<span class="op">;</span></span>
<span id="cb411-6"><a href="#cb411-6" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">publishSync</span>( message<span class="op">,</span> <span class="st">&#39;some payload&#39;</span> )<span class="op">;</span></span>
<span id="cb411-7"><a href="#cb411-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb411-8"><a href="#cb411-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb411-9"><a href="#cb411-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Passes if spy was called once and only once.</span></span>
<span id="cb411-10"><a href="#cb411-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ok</span>( spy<span class="op">.</span><span class="at">calledOnce</span> )<span class="op">;</span> <span class="co">// calledTwice and calledThrice are also supported</span></span>
<span id="cb411-11"><a href="#cb411-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb411-12"><a href="#cb411-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The number of recorded calls.</span></span>
<span id="cb411-13"><a href="#cb411-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( spy<span class="op">.</span><span class="at">callCount</span><span class="op">,</span> <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb411-14"><a href="#cb411-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb411-15"><a href="#cb411-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Directly checking the arguments of the call</span></span>
<span id="cb411-16"><a href="#cb411-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equals</span>( spy<span class="op">.</span><span class="fu">getCall</span>(<span class="dv">0</span>)<span class="op">.</span><span class="at">args</span>[<span class="dv">0</span>]<span class="op">,</span> message )<span class="op">;</span></span>
<span id="cb411-17"><a href="#cb411-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="stubs-and-mocks">Stubs and mocks</h2>
<p>SinonJS also supports two other powerful features: stubs and mocks.
Both stubs and mocks implement all of the features of the spy API, but
have some added functionality.</p>
<h3 id="stubs">Stubs</h3>
<p>A stub allows us to replace any existing behaviour for a specific
method with something else. They can be very useful for simulating
exceptions and are most often used to write test cases when certain
dependencies of your code-base may not yet be written.</p>
<p>Let us briefly re-explore our Backbone Todo application, which
contained a Todo model and a TodoList collection. For the purpose of
this walkthrough, we want to isolate our TodoList collection and fake
the Todo model to test how adding new models might behave.</p>
<p>We can pretend that the models have yet to be written just to
demonstrate how stubbing might be carried out. A shell collection just
containing a reference to the model to be used might look like this:</p>
<div class="sourceCode" id="cb412"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> TodoList <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Collection</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">model</span><span class="op">:</span> Todo</span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb412-4"><a href="#cb412-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-5"><a href="#cb412-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Let&#39;s assume our instance of this collection is</span></span>
<span id="cb412-6"><a href="#cb412-6" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">todoList</span><span class="op">;</span></span></code></pre></div>
<p>Assuming our collection is instantiating new models itself, it’s
necessary for us to stub the model’s constructor function for the the
test. This can be done by creating a simple stub as follows:</p>
<div class="sourceCode" id="cb413"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">todoStub</span> <span class="op">=</span> sinon<span class="op">.</span><span class="fu">stub</span>( <span class="bu">window</span><span class="op">,</span> <span class="st">&#39;Todo&#39;</span> )<span class="op">;</span></span></code></pre></div>
<p>The above creates a stub of the Todo method on the window object.
When stubbing a persistent object, it’s necessary to restore it to its
original state. This can be done in a <code>teardown()</code> as
follows:</p>
<div class="sourceCode" id="cb414"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">todoStub</span><span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span></code></pre></div>
<p>After this, we need to alter what the constructor returns, which can
be efficiently done using a plain <code>Backbone.Model</code>
constructor. While this isn’t a Todo model, it does still provide us an
actual Backbone model.</p>
<div class="sourceCode" id="cb415"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a>setup<span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">model</span> <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>({</span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Hello world&#39;</span></span>
<span id="cb415-5"><a href="#cb415-5" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb415-6"><a href="#cb415-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todoStub</span><span class="op">.</span><span class="fu">returns</span>( <span class="kw">this</span><span class="op">.</span><span class="at">model</span> )<span class="op">;</span></span>
<span id="cb415-7"><a href="#cb415-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The expectation here might be that this snippet would ensure our
TodoList collection always instantiates a stubbed Todo model, but
because a reference to the model in the collection is already present,
we need to reset the model property of our collection as follows:</p>
<div class="sourceCode" id="cb416"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">todoList</span><span class="op">.</span><span class="at">model</span> <span class="op">=</span> Todo<span class="op">;</span></span></code></pre></div>
<p>The result of this is that when our TodoList collection instantiates
new Todo models, it will return our plain Backbone model instance as
desired. This allows us to write a test for the addition of new model
literals as follows:</p>
<div class="sourceCode" id="cb417"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>( <span class="st">&#39;Should function when instantiated with model literals&#39;</span><span class="op">,</span> {</span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">setup</span><span class="op">:</span><span class="kw">function</span>() {</span>
<span id="cb417-4"><a href="#cb417-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-5"><a href="#cb417-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todoStub</span> <span class="op">=</span> sinon<span class="op">.</span><span class="fu">stub</span>(<span class="bu">window</span><span class="op">,</span> <span class="st">&#39;Todo&#39;</span>)<span class="op">;</span></span>
<span id="cb417-6"><a href="#cb417-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">model</span> <span class="op">=</span> <span class="kw">new</span> Backbone<span class="op">.</span><span class="fu">Model</span>({</span>
<span id="cb417-7"><a href="#cb417-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb417-8"><a href="#cb417-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Hello world&#39;</span></span>
<span id="cb417-9"><a href="#cb417-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb417-10"><a href="#cb417-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-11"><a href="#cb417-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todoStub</span><span class="op">.</span><span class="fu">returns</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span>)<span class="op">;</span></span>
<span id="cb417-12"><a href="#cb417-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todos</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoList</span>()<span class="op">;</span></span>
<span id="cb417-13"><a href="#cb417-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-14"><a href="#cb417-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Let&#39;s reset the relationship to use a stub</span></span>
<span id="cb417-15"><a href="#cb417-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="at">model</span> <span class="op">=</span> Todo<span class="op">;</span></span>
<span id="cb417-16"><a href="#cb417-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb417-17"><a href="#cb417-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add a model</span></span>
<span id="cb417-18"><a href="#cb417-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">add</span>({</span>
<span id="cb417-19"><a href="#cb417-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb417-20"><a href="#cb417-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Hello world&#39;</span></span>
<span id="cb417-21"><a href="#cb417-21" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb417-22"><a href="#cb417-22" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb417-23"><a href="#cb417-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-24"><a href="#cb417-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">teardown</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb417-25"><a href="#cb417-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todoStub</span><span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb417-26"><a href="#cb417-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb417-27"><a href="#cb417-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-28"><a href="#cb417-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb417-29"><a href="#cb417-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-30"><a href="#cb417-30" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;should add a model&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb417-31"><a href="#cb417-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="at">length</span><span class="op">,</span> <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb417-32"><a href="#cb417-32" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb417-33"><a href="#cb417-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-34"><a href="#cb417-34" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;should find a model by id&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb417-35"><a href="#cb417-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">get</span>(<span class="dv">5</span>)<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;id&#39;</span>)<span class="op">,</span> <span class="dv">5</span> )<span class="op">;</span></span>
<span id="cb417-36"><a href="#cb417-36" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb417-37"><a href="#cb417-37" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="mocks">Mocks</h3>
<p>Mocks are effectively the same as stubs, however they mock a complete
API and have some built-in expectations for how they should be used. The
difference between a mock and a spy is that as the expectations for
their use are pre-defined and the test will fail if any of these are not
met.</p>
<p>Here’s a snippet with sample usage of a mock based on PubSubJS. Here,
we have a <code>clearTodo()</code> method as a callback and use mocks to
verify its behavior.</p>
<div class="sourceCode" id="cb418"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;should call all subscribers when exceptions&#39;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb418-2"><a href="#cb418-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> myAPI <span class="op">=</span> { <span class="dt">clearTodo</span><span class="op">:</span> <span class="kw">function</span> () {} }<span class="op">;</span></span>
<span id="cb418-3"><a href="#cb418-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-4"><a href="#cb418-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> spy <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb418-5"><a href="#cb418-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> mock <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">mock</span>( myAPI )<span class="op">;</span></span>
<span id="cb418-6"><a href="#cb418-6" aria-hidden="true" tabindex="-1"></a>    mock<span class="op">.</span><span class="fu">expects</span>( <span class="st">&#39;clearTodo&#39;</span> )<span class="op">.</span><span class="fu">once</span>()<span class="op">.</span><span class="fu">throws</span>()<span class="op">;</span></span>
<span id="cb418-7"><a href="#cb418-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-8"><a href="#cb418-8" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">subscribe</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> myAPI<span class="op">.</span><span class="at">clearTodo</span> )<span class="op">;</span></span>
<span id="cb418-9"><a href="#cb418-9" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">subscribe</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> spy )<span class="op">;</span></span>
<span id="cb418-10"><a href="#cb418-10" aria-hidden="true" tabindex="-1"></a>    PubSub<span class="op">.</span><span class="fu">publishSync</span>( <span class="st">&#39;message&#39;</span><span class="op">,</span> <span class="kw">undefined</span> )<span class="op">;</span></span>
<span id="cb418-11"><a href="#cb418-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-12"><a href="#cb418-12" aria-hidden="true" tabindex="-1"></a>    mock<span class="op">.</span><span class="fu">verify</span>()<span class="op">;</span></span>
<span id="cb418-13"><a href="#cb418-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ok</span>( spy<span class="op">.</span><span class="at">calledOnce</span> )<span class="op">;</span></span>
<span id="cb418-14"><a href="#cb418-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="exercise-1">Exercise</h2>
<p>We can now begin writing tests for our Todo application, which are
listed and separated by component (e.g., Models, Collections, etc.).
It’s useful to pay attention to the name of the test, the logic being
tested, and most importantly the assertions being made as this will give
you some insight into how what we’ve learned can be applied to a
complete application.</p>
<p>To get the most out of this section, I recommend looking at the QUnit
Koans included in the <code>practicals/qunit-koans</code> folder - this
is a port of the Backbone.js Jasmine Koans over to QUnit.</p>
<p><em>In case you haven’t had a chance to try out one of the Koans kits
as yet, they are a set of unit tests using a specific testing framework
that both demonstrate how a set of tests for an application may be
written, but also leave some tests unfilled so that you can complete
them as an exercise.</em></p>
<h3 id="models-2">Models</h3>
<p>For our models we want to at minimum test that:</p>
<ul>
<li>New instances can be created with the expected default values</li>
<li>Attributes can be set and retrieved correctly</li>
<li>Changes to state correctly fire off custom events where needed</li>
<li>Validation rules are correctly enforced</li>
</ul>
<div class="sourceCode" id="cb419"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>( <span class="st">&#39;About Backbone.Model&#39;</span>)<span class="op">;</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;Can be created with default values for its attributes.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">3</span> )<span class="op">;</span></span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-6"><a href="#cb419-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb419-7"><a href="#cb419-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;text&#39;</span>)<span class="op">,</span> <span class="st">&#39;&#39;</span> )<span class="op">;</span></span>
<span id="cb419-8"><a href="#cb419-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;done&#39;</span>)<span class="op">,</span> <span class="kw">false</span> )<span class="op">;</span></span>
<span id="cb419-9"><a href="#cb419-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;order&#39;</span>)<span class="op">,</span> <span class="dv">0</span> )<span class="op">;</span></span>
<span id="cb419-10"><a href="#cb419-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb419-11"><a href="#cb419-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-12"><a href="#cb419-12" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;Will set attributes on the model instance when created.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb419-13"><a href="#cb419-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb419-14"><a href="#cb419-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-15"><a href="#cb419-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>( { <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;Get oil change for car.&#39;</span> } )<span class="op">;</span></span>
<span id="cb419-16"><a href="#cb419-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( todo<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;text&#39;</span>)<span class="op">,</span> <span class="st">&#39;Get oil change for car.&#39;</span> )<span class="op">;</span></span>
<span id="cb419-17"><a href="#cb419-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-18"><a href="#cb419-18" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb419-19"><a href="#cb419-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-20"><a href="#cb419-20" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;Will call a custom initialize function on the model instance when created.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb419-21"><a href="#cb419-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb419-22"><a href="#cb419-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-23"><a href="#cb419-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> toot <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({ <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;Stop monkeys from throwing their own crap!&#39;</span> })<span class="op">;</span></span>
<span id="cb419-24"><a href="#cb419-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( toot<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;text&#39;</span>)<span class="op">,</span> <span class="st">&#39;Stop monkeys from throwing their own rainbows!&#39;</span> )<span class="op">;</span></span>
<span id="cb419-25"><a href="#cb419-25" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb419-26"><a href="#cb419-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-27"><a href="#cb419-27" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;Fires a custom event when the state changes.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb419-28"><a href="#cb419-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb419-29"><a href="#cb419-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-30"><a href="#cb419-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> spy <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb419-31"><a href="#cb419-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb419-32"><a href="#cb419-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-33"><a href="#cb419-33" aria-hidden="true" tabindex="-1"></a>    todo<span class="op">.</span><span class="fu">on</span>( <span class="st">&#39;change&#39;</span><span class="op">,</span> spy )<span class="op">;</span></span>
<span id="cb419-34"><a href="#cb419-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Change the model state</span></span>
<span id="cb419-35"><a href="#cb419-35" aria-hidden="true" tabindex="-1"></a>    todo<span class="op">.</span><span class="fu">set</span>( { <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;new text&#39;</span> } )<span class="op">;</span></span>
<span id="cb419-36"><a href="#cb419-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-37"><a href="#cb419-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ok</span>( spy<span class="op">.</span><span class="at">calledOnce</span><span class="op">,</span> <span class="st">&#39;A change event callback was correctly triggered&#39;</span> )<span class="op">;</span></span>
<span id="cb419-38"><a href="#cb419-38" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb419-39"><a href="#cb419-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-40"><a href="#cb419-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-41"><a href="#cb419-41" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;Can contain custom validation rules, and will trigger an invalid event on failed validation.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb419-42"><a href="#cb419-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">3</span> )<span class="op">;</span></span>
<span id="cb419-43"><a href="#cb419-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-44"><a href="#cb419-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> errorCallback <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">spy</span>()<span class="op">;</span></span>
<span id="cb419-45"><a href="#cb419-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> todo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>()<span class="op">;</span></span>
<span id="cb419-46"><a href="#cb419-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-47"><a href="#cb419-47" aria-hidden="true" tabindex="-1"></a>    todo<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;invalid&#39;</span><span class="op">,</span> errorCallback)<span class="op">;</span></span>
<span id="cb419-48"><a href="#cb419-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Change the model state in such a way that validation will fail</span></span>
<span id="cb419-49"><a href="#cb419-49" aria-hidden="true" tabindex="-1"></a>    todo<span class="op">.</span><span class="fu">set</span>( { <span class="dt">done</span><span class="op">:</span> <span class="st">&#39;not a boolean&#39;</span> } )<span class="op">;</span></span>
<span id="cb419-50"><a href="#cb419-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-51"><a href="#cb419-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ok</span>( errorCallback<span class="op">.</span><span class="at">called</span><span class="op">,</span> <span class="st">&#39;A failed validation correctly triggered an error&#39;</span> )<span class="op">;</span></span>
<span id="cb419-52"><a href="#cb419-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">notEqual</span>( errorCallback<span class="op">.</span><span class="fu">getCall</span>(<span class="dv">0</span>)<span class="op">,</span> <span class="kw">undefined</span> )<span class="op">;</span></span>
<span id="cb419-53"><a href="#cb419-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( errorCallback<span class="op">.</span><span class="fu">getCall</span>(<span class="dv">0</span>)<span class="op">.</span><span class="at">args</span>[<span class="dv">1</span>]<span class="op">,</span> <span class="st">&#39;Todo.done must be a boolean value.&#39;</span> )<span class="op">;</span></span>
<span id="cb419-54"><a href="#cb419-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-55"><a href="#cb419-55" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="collections-2">Collections</h3>
<p>For our collection we’ll want to test that:</p>
<ul>
<li>The Collection has a Todo Model</li>
<li>Uses localStorage for syncing</li>
<li>That done(), remaining() and clear() work as expected</li>
<li>The order for Todos is numerically correct</li>
</ul>
<div class="sourceCode" id="cb420"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">module</span>(<span class="st">&#39;Test Collection&#39;</span><span class="op">,</span> {</span>
<span id="cb420-2"><a href="#cb420-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-3"><a href="#cb420-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">setup</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb420-4"><a href="#cb420-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-5"><a href="#cb420-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Define new todos</span></span>
<span id="cb420-6"><a href="#cb420-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">todoOne</span> <span class="op">=</span> <span class="kw">new</span> Todo<span class="op">;</span></span>
<span id="cb420-7"><a href="#cb420-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">todoTwo</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Todo</span>({</span>
<span id="cb420-8"><a href="#cb420-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Buy some milk&quot;</span></span>
<span id="cb420-9"><a href="#cb420-9" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb420-10"><a href="#cb420-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-11"><a href="#cb420-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Create a new collection of todos for testing</span></span>
<span id="cb420-12"><a href="#cb420-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">todos</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoList</span>([<span class="kw">this</span><span class="op">.</span><span class="at">todoOne</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">todoTwo</span>])<span class="op">;</span></span>
<span id="cb420-13"><a href="#cb420-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb420-14"><a href="#cb420-14" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb420-15"><a href="#cb420-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-16"><a href="#cb420-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test</span>(<span class="st">&#39;Has the Todo model&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb420-17"><a href="#cb420-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb420-18"><a href="#cb420-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">equal</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> Todo)<span class="op">;</span></span>
<span id="cb420-19"><a href="#cb420-19" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb420-20"><a href="#cb420-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-21"><a href="#cb420-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test</span>(<span class="st">&#39;Uses local storage&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb420-22"><a href="#cb420-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb420-23"><a href="#cb420-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">equal</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="at">localStorage</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">Store</span>(<span class="st">&#39;todos-backbone&#39;</span>))<span class="op">;</span></span>
<span id="cb420-24"><a href="#cb420-24" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb420-25"><a href="#cb420-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-26"><a href="#cb420-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// done</span></span>
<span id="cb420-27"><a href="#cb420-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">test</span>(<span class="st">&#39;returns an array of the todos that are done&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb420-28"><a href="#cb420-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb420-29"><a href="#cb420-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">todoTwo</span><span class="op">.</span><span class="at">done</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb420-30"><a href="#cb420-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">deepEqual</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">done</span>()<span class="op">,</span> [<span class="kw">this</span><span class="op">.</span><span class="at">todoTwo</span>])<span class="op">;</span></span>
<span id="cb420-31"><a href="#cb420-31" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb420-32"><a href="#cb420-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-33"><a href="#cb420-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// remaining</span></span>
<span id="cb420-34"><a href="#cb420-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">test</span>(<span class="st">&#39;returns an array of the todos that are not done&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb420-35"><a href="#cb420-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb420-36"><a href="#cb420-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">todoTwo</span><span class="op">.</span><span class="at">done</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb420-37"><a href="#cb420-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">deepEqual</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">remaining</span>()<span class="op">,</span> [<span class="kw">this</span><span class="op">.</span><span class="at">todoOne</span>])<span class="op">;</span></span>
<span id="cb420-38"><a href="#cb420-38" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb420-39"><a href="#cb420-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-40"><a href="#cb420-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// clear</span></span>
<span id="cb420-41"><a href="#cb420-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">test</span>(<span class="st">&#39;destroys the current todo from local storage&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb420-42"><a href="#cb420-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>( <span class="dv">2</span> )<span class="op">;</span></span>
<span id="cb420-43"><a href="#cb420-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">deepEqual</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="at">models</span><span class="op">,</span> [<span class="kw">this</span><span class="op">.</span><span class="at">todoOne</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">todoTwo</span>])<span class="op">;</span></span>
<span id="cb420-44"><a href="#cb420-44" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">clear</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoOne</span>)<span class="op">;</span></span>
<span id="cb420-45"><a href="#cb420-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">deepEqual</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="at">models</span><span class="op">,</span> [<span class="kw">this</span><span class="op">.</span><span class="at">todoTwo</span>])<span class="op">;</span></span>
<span id="cb420-46"><a href="#cb420-46" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb420-47"><a href="#cb420-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-48"><a href="#cb420-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Order sets the order on todos ascending numerically</span></span>
<span id="cb420-49"><a href="#cb420-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">test</span>(<span class="st">&#39;defaults to one when there arent any items in the collection&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb420-50"><a href="#cb420-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb420-51"><a href="#cb420-51" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">emptyTodos</span> <span class="op">=</span> <span class="kw">new</span> TodoApp<span class="op">.</span><span class="at">Collections</span><span class="op">.</span><span class="at">TodoList</span><span class="op">;</span></span>
<span id="cb420-52"><a href="#cb420-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">equal</span>(<span class="kw">this</span><span class="op">.</span><span class="at">emptyTodos</span><span class="op">.</span><span class="fu">order</span>()<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb420-53"><a href="#cb420-53" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb420-54"><a href="#cb420-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-55"><a href="#cb420-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">test</span>(<span class="st">&#39;Increments the order by one each time&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb420-56"><a href="#cb420-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">expect</span>( <span class="dv">2</span> )<span class="op">;</span></span>
<span id="cb420-57"><a href="#cb420-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">equal</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">order</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoOne</span>)<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb420-58"><a href="#cb420-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">equal</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">order</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoTwo</span>)<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb420-59"><a href="#cb420-59" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span></code></pre></div>
<h3 id="views-2">Views</h3>
<p>For our views we want to ensure:</p>
<ul>
<li>They are being correctly tied to a DOM element when created</li>
<li>They can render, after which the DOM representation of the view
should be visible</li>
<li>They support wiring up view methods to DOM elements</li>
</ul>
<p>One could also take this further and test that user interactions with
the view correctly result in any models that need to be changed being
updated correctly.</p>
<div class="sourceCode" id="cb421"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>( <span class="st">&#39;About Backbone.View&#39;</span><span class="op">,</span> {</span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">setup</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">$</span>(<span class="st">&#39;body&#39;</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">&#39;&lt;ul id=&quot;todoList&quot;&gt;&lt;/ul&gt;&#39;</span>)<span class="op">;</span></span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoView</span>({ <span class="dt">model</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Todo</span>() })<span class="op">;</span></span>
<span id="cb421-5"><a href="#cb421-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb421-6"><a href="#cb421-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">teardown</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb421-7"><a href="#cb421-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb421-8"><a href="#cb421-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">$</span>(<span class="st">&#39;#todoList&#39;</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb421-9"><a href="#cb421-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb421-10"><a href="#cb421-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb421-11"><a href="#cb421-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-12"><a href="#cb421-12" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;Should be tied to a DOM element when created, based off the property provided.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb421-13"><a href="#cb421-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb421-14"><a href="#cb421-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="at">el</span><span class="op">.</span><span class="at">tagName</span><span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">,</span> <span class="st">&#39;li&#39;</span> )<span class="op">;</span></span>
<span id="cb421-15"><a href="#cb421-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb421-16"><a href="#cb421-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-17"><a href="#cb421-17" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;Is backed by a model instance, which provides the data.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb421-18"><a href="#cb421-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">2</span> )<span class="op">;</span></span>
<span id="cb421-19"><a href="#cb421-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">notEqual</span>( <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="kw">undefined</span> )<span class="op">;</span></span>
<span id="cb421-20"><a href="#cb421-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;done&#39;</span>)<span class="op">,</span> <span class="kw">false</span> )<span class="op">;</span></span>
<span id="cb421-21"><a href="#cb421-21" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb421-22"><a href="#cb421-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-23"><a href="#cb421-23" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;Can render, after which the DOM representation of the view will be visible.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb421-24"><a href="#cb421-24" aria-hidden="true" tabindex="-1"></a>   <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb421-25"><a href="#cb421-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-26"><a href="#cb421-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Append the DOM representation of the view to ul#todoList</span></span>
<span id="cb421-27"><a href="#cb421-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(<span class="st">&#39;ul#todoList&#39;</span>)<span class="op">.</span><span class="fu">append</span>(<span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb421-28"><a href="#cb421-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-29"><a href="#cb421-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check the number of li items rendered to the list</span></span>
<span id="cb421-30"><a href="#cb421-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>(<span class="fu">$</span>(<span class="st">&#39;#todoList&#39;</span>)<span class="op">.</span><span class="fu">find</span>(<span class="st">&#39;li&#39;</span>)<span class="op">.</span><span class="at">length</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb421-31"><a href="#cb421-31" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb421-32"><a href="#cb421-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-33"><a href="#cb421-33" aria-hidden="true" tabindex="-1"></a><span class="fu">asyncTest</span>(<span class="st">&#39;Can wire up view methods to DOM elements.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb421-34"><a href="#cb421-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">2</span> )<span class="op">;</span></span>
<span id="cb421-35"><a href="#cb421-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> viewElt<span class="op">;</span></span>
<span id="cb421-36"><a href="#cb421-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-37"><a href="#cb421-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(<span class="st">&#39;#todoList&#39;</span>)<span class="op">.</span><span class="fu">append</span>( <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="fu">render</span>()<span class="op">.</span><span class="at">el</span> )<span class="op">;</span></span>
<span id="cb421-38"><a href="#cb421-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-39"><a href="#cb421-39" aria-hidden="true" tabindex="-1"></a>    <span class="pp">setTimeout</span>(<span class="kw">function</span>() {</span>
<span id="cb421-40"><a href="#cb421-40" aria-hidden="true" tabindex="-1"></a>        viewElt <span class="op">=</span> <span class="fu">$</span>(<span class="st">&#39;#todoList li input.check&#39;</span>)<span class="op">.</span><span class="fu">filter</span>(<span class="st">&#39;:first&#39;</span>)<span class="op">;</span></span>
<span id="cb421-41"><a href="#cb421-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-42"><a href="#cb421-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">equal</span>(viewElt<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb421-43"><a href="#cb421-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-44"><a href="#cb421-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Ensure QUnit knows we can continue</span></span>
<span id="cb421-45"><a href="#cb421-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">start</span>()<span class="op">;</span></span>
<span id="cb421-46"><a href="#cb421-46" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> <span class="dv">1000</span><span class="op">,</span> <span class="st">&#39;Expected DOM Elt to exist&#39;</span>)<span class="op">;</span></span>
<span id="cb421-47"><a href="#cb421-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-48"><a href="#cb421-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Trigger the view to toggle the &#39;done&#39; status on an item or items</span></span>
<span id="cb421-49"><a href="#cb421-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(<span class="st">&#39;#todoList li input.check&#39;</span>)<span class="op">.</span><span class="fu">click</span>()<span class="op">;</span></span>
<span id="cb421-50"><a href="#cb421-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-51"><a href="#cb421-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check the done status for the model is true</span></span>
<span id="cb421-52"><a href="#cb421-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="kw">this</span><span class="op">.</span><span class="at">todoView</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;done&#39;</span>)<span class="op">,</span> <span class="kw">true</span> )<span class="op">;</span></span>
<span id="cb421-53"><a href="#cb421-53" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="app">App</h3>
<p>It can also be useful to write tests for any application bootstrap
you may have in place. For the following module, our setup instantiates
and appends to a TodoApp view and we can test anything from local
instances of views being correctly defined to application interactions
correctly resulting in changes to instances of local collections.</p>
<div class="sourceCode" id="cb422"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="fu">module</span>( <span class="st">&#39;About Backbone Applications&#39;</span> <span class="op">,</span> {</span>
<span id="cb422-2"><a href="#cb422-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">setup</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb422-3"><a href="#cb422-3" aria-hidden="true" tabindex="-1"></a>        Backbone<span class="op">.</span><span class="at">localStorageDB</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Store</span>(<span class="st">&#39;testTodos&#39;</span>)<span class="op">;</span></span>
<span id="cb422-4"><a href="#cb422-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">$</span>(<span class="st">&#39;#qunit-fixture&#39;</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">&#39;&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;&#39;</span>)<span class="op">;</span></span>
<span id="cb422-5"><a href="#cb422-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">App</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">TodoApp</span>({ <span class="dt">appendTo</span><span class="op">:</span> <span class="fu">$</span>(<span class="st">&#39;#app&#39;</span>) })<span class="op">;</span></span>
<span id="cb422-6"><a href="#cb422-6" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb422-7"><a href="#cb422-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-8"><a href="#cb422-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">teardown</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb422-9"><a href="#cb422-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">App</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">reset</span>()<span class="op">;</span></span>
<span id="cb422-10"><a href="#cb422-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">$</span>(<span class="st">&#39;#app&#39;</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb422-11"><a href="#cb422-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb422-12"><a href="#cb422-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb422-13"><a href="#cb422-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-14"><a href="#cb422-14" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;Should bootstrap the application by initializing the Collection.&#39;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb422-15"><a href="#cb422-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>( <span class="dv">2</span> )<span class="op">;</span></span>
<span id="cb422-16"><a href="#cb422-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-17"><a href="#cb422-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The todos collection should not be undefined</span></span>
<span id="cb422-18"><a href="#cb422-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">notEqual</span>( <span class="kw">this</span><span class="op">.</span><span class="at">App</span><span class="op">.</span><span class="at">todos</span><span class="op">,</span> <span class="kw">undefined</span> )<span class="op">;</span></span>
<span id="cb422-19"><a href="#cb422-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-20"><a href="#cb422-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The initial length of our todos should however be zero</span></span>
<span id="cb422-21"><a href="#cb422-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">equal</span>( <span class="kw">this</span><span class="op">.</span><span class="at">App</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="at">length</span><span class="op">,</span> <span class="dv">0</span> )<span class="op">;</span></span>
<span id="cb422-22"><a href="#cb422-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb422-23"><a href="#cb422-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-24"><a href="#cb422-24" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>( <span class="st">&#39;Should bind Collection events to View creation.&#39;</span> <span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb422-25"><a href="#cb422-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-26"><a href="#cb422-26" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Set the value of a brand new todo within the input box</span></span>
<span id="cb422-27"><a href="#cb422-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">$</span>(<span class="st">&#39;#new-todo&#39;</span>)<span class="op">.</span><span class="fu">val</span>( <span class="st">&#39;Buy some milk&#39;</span> )<span class="op">;</span></span>
<span id="cb422-28"><a href="#cb422-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-29"><a href="#cb422-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Trigger the enter (return) key to be pressed inside #new-todo</span></span>
<span id="cb422-30"><a href="#cb422-30" aria-hidden="true" tabindex="-1"></a>      <span class="co">// causing the new item to be added to the todos collection</span></span>
<span id="cb422-31"><a href="#cb422-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">$</span>(<span class="st">&#39;#new-todo&#39;</span>)<span class="op">.</span><span class="fu">trigger</span>(<span class="kw">new</span> $<span class="op">.</span><span class="fu">Event</span>( <span class="st">&#39;keypress&#39;</span><span class="op">,</span> { <span class="dt">keyCode</span><span class="op">:</span> <span class="dv">13</span> } ))<span class="op">;</span></span>
<span id="cb422-32"><a href="#cb422-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-33"><a href="#cb422-33" aria-hidden="true" tabindex="-1"></a>      <span class="co">// The length of our collection should now be 1</span></span>
<span id="cb422-34"><a href="#cb422-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">equal</span>( <span class="kw">this</span><span class="op">.</span><span class="at">App</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="at">length</span><span class="op">,</span> <span class="dv">1</span> )<span class="op">;</span></span>
<span id="cb422-35"><a href="#cb422-35" aria-hidden="true" tabindex="-1"></a> })<span class="op">;</span></span></code></pre></div>
<h2 id="further-reading-resources">Further Reading &amp; Resources</h2>
<p>That’s it for this section on testing applications with QUnit and
SinonJS. I encourage you to try out the <a
href="https://github.com/addyosmani/backbone-koans-qunit">QUnit
Backbone.js Koans</a> and see if you can extend some of the examples.
For further reading consider looking at some of the additional resources
below:</p>
<ul>
<li><strong><a href="http://tddjs.com/">Test-driven JavaScript
Development (book)</a></strong></li>
<li><strong><a href="http://sinonjs.org/qunit/">SinonJS/QUnit
Adapter</a></strong></li>
<li><strong><a
href="http://cjohansen.no/en/javascript/using_sinon_js_with_qunit">SinonJS
and QUnit</a></strong></li>
<li><strong><a
href="http://msdn.microsoft.com/en-us/scriptjunkie/gg749824">Automating
JavaScript Testing With QUnit</a></strong></li>
<li><strong><a
href="http://benalman.com/talks/unit-testing-qunit.html">Ben Alman’s
Unit Testing With QUnit</a></strong></li>
<li><strong><a href="https://github.com/jc00ke/qunit-backbone">Another
QUnit/Backbone.js demo project</a></strong></li>
<li><strong><a
href="http://devblog.supportbee.com/2012/02/10/helpers-for-testing-backbone-js-apps-using-jasmine-and-sinon-js/">SinonJS
helpers for Backbone</a></strong></li>
</ul>
<h1 id="resources">Resources</h1>
<h2 id="books-courses">Books &amp; Courses</h2>
<ul>
<li><a href="https://peepcode.com/products/backbone-js">PeepCode:
Backbone.js Basics</a></li>
<li><a
href="http://www.codeschool.com/courses/anatomy-of-backbonejs">CodeSchool:
Anatomy Of Backbone</a></li>
<li><a href="http://recipeswithbackbone.com/">Recipes With
Backbone</a></li>
<li><a href="http://ricostacruz.com/backbone-patterns/">Backbone
Patterns</a></li>
<li><a
href="https://learn.thoughtbot.com/products/1-backbone-js-on-rails">Backbone
On Rails</a></li>
<li><a href="http://www.integralist.co.uk/posts/backbone.html">MVC In
JavaScript With Backbone</a></li>
<li><a href="http://backbonetutorials.com/">Backbone Tutorials</a></li>
<li><a
href="http://lostechies.com/derickbailey/2011/09/13/resources-for-and-how-i-learned-backbone-js/">Derick
Bailey’s Resources For Learning Backbone</a></li>
</ul>
<h2 id="extensionslibraries">Extensions/Libraries</h2>
<ul>
<li><a href="http://marionettejs.com/">MarionetteJS</a></li>
<li><a href="https://github.com/aurajs/aura">AuraJS</a></li>
<li><a href="http://thoraxjs.org">Thorax</a></li>
<li><a href="http://walmartlabs.github.com/lumbar">Lumbar</a></li>
<li><a
href="https://github.com/tbranyen/backbone.layoutmanager">Backbone
Layout Manager</a></li>
<li><a
href="https://github.com/backbone-boilerplate/backbone-boilerplate">Backbone
Boilerplate</a></li>
<li><a
href="https://github.com/theironcook/Backbone.ModelBinder">Backbone.ModelBinder</a></li>
<li><a href="https://github.com/PaulUithol/Backbone-relational">Backbone
Relational - for model relationships</a></li>
<li><a href="https://github.com/janmonschke/backbone-couchdb">Backbone
CouchDB</a></li>
<li><a href="https://github.com/n-time/backbone.validations">Backbone
Validations - HTML5 inspired validations</a></li>
</ul>
<h1 id="conclusions-3">Conclusions</h1>
<p>I hope that you’ve found this introduction to Backbone.js of value.
What you’ve hopefully learned is that while building a JavaScript-heavy
application using nothing more than a DOM manipulation library (such as
jQuery) is certainly a possible feat, it is difficult to build anything
non-trivial without any formal structure in place. Your nested pile of
jQuery callbacks and DOM elements are unlikely to scale, and they can be
very difficult to maintain as your application grows.</p>
<p>The beauty of Backbone.js is its simplicity. It’s very small given
the functionality and flexibility it provides, which is evident if you
begin to study the Backbone.js source. In the words of Jeremy Ashkenas,
“The essential premise at the heart of Backbone has always been to try
and discover the minimal set of data-structuring (Models and
Collections) and user interface (Views and URLs) primitives that are
useful when building web applications with JavaScript.” It just helps
you improve the structure of your applications, thereby helping you
better separate concerns. There isn’t anything more to it than that.</p>
<p>Backbone offers Models with key-value bindings and events,
Collections with an API of rich enumerable methods, declarative Views
with event handling and a simple way to connect an existing API to your
client-side application over a RESTful JSON interface. Use it and you
can abstract away data into sane models and your DOM manipulation into
views, binding them together using nothing more than events.</p>
<p>Almost any developer working on JavaScript applications for a while
will ultimately create a similar solution on their own if they value
architecture and maintainability. The alternative to using Backbone or
something similar is rolling your own - often a process that involves
glueing together a diverse set of libraries that weren’t built to work
together. You might use jQuery BBQ for history management and Handlebars
for templating, while writing abstracts for organizing and testing code
by yourself.</p>
<p>Contrast this with Backbone, which has <a
href="http://en.wikipedia.org/wiki/Literate_programming">literate</a> <a
href="http://backbonejs.org/docs/backbone.html">documentation</a> of the
source code, a thriving community of both users and hackers, and a large
number of questions about it asked and answered daily on sites like <a
href="http://stackoverflow.com/search?q=backbone">Stack Overflow</a>.
Rather than re-inventing the wheel, there are many advantages to
structuring your application using a solution based on the collective
knowledge and experience of an entire community.</p>
<p>In addition to helping provide sane structure to your applications,
Backbone is highly extensible. Backbone supports more custom
architecture should you require more than what is prescribed out of the
box. This is evident by the number of Backbone extensions and plugins
which have been released over the past year, including those which we
have touched upon such as MarionetteJS and Thorax.</p>
<p>These days Backbone.js powers many complex web applications, ranging
from the LinkedIn <a
href="http://touch.www.linkedin.com/mobile.html">mobile app</a> to
popular RSS readers such as <a href="http://newsblur.com">NewsBlur</a>
through to social commentary widgets such as <a
href="http://disqus.com/">Disqus</a>. This small library of simple, but
sane abstractions has helped to create a new generation of rich web
applications, and I and my collaborators hope that in time it can help
you too.</p>
<p>If you’re wondering whether it is worth using Backbone on a project,
ask yourself whether what you are building is complex enough to merit
using it. Are you hitting the limits of your ability to organize your
code? Will your application have regular changes to what is displayed in
the UI without a trip back to the server for new pages? Would you
benefit from a separation of concerns? If so, a solution like Backbone
may be able to help.</p>
<p>Google’s GMail is often cited as an example of a well-built
single-page app. If you’ve used it, you might have noticed that it
requests a large initial chunk of data, representing most of the
JavaScript, CSS and HTML most users will need. Everything extra needed
after that occurs in the background. GMail can easily switch between
your inbox to your spam folder without needing the whole page to be
re-rendered. Libraries like Backbone make it easier for web developers
to create experiences like this.</p>
<p>That said, Backbone won’t be able to help if you’re planning on
building something which isn’t worth the learning curve associated with
a library. If your application or site will still be using the server to
do the heavy lifting of constructing and serving complete pages to the
browser, you may find just using plain JavaScript or jQuery for simple
effects or interactions to be more appropriate. Spend time assessing how
suitable Backbone might be for your application and make the right
choice on a per-project basis.</p>
<p>Backbone is neither difficult to learn nor to use. However, the time
and effort you spend learning how to structure applications using it
will be well worth it. While reading this book will equip you with the
fundamentals needed to understand the library, the best way to learn is
to try building your own real-world applications. You will hopefully
find that the end product contains cleaner, better organized and more
maintainable code.</p>
<p>With that, I wish you the very best with your onward journey into the
world of Backbone and will leave you with a quote from American writer
<a href="http://en.wikipedia.org/wiki/Henry_Miller">Henry Miller</a> -
“One’s destination is never a place, but a new way of seeing
things.”</p>
<h1 id="appendix">Appendix</h1>
<h2 id="a-simple-javascript-mvc-implementation">A Simple JavaScript MVC
Implementation</h2>
<p>A comprehensive discussion of Backbone’s implementation is beyond the
scope of this book. We can, however, present a simple MVC library -
which we will call Cranium.js - that illustrates how libraries such as
Backbone implement the MVC pattern.</p>
<p>Like Backbone, we will rely on <a href="http://underscorejs.org"
title="Underscore.js">Underscore</a> for inheritance and templating.</p>
<h3 id="event-system">Event System</h3>
<p>At the heart of our JavaScript MVC implementation is an
<code>Event</code> system (object) based on the Publisher-Subscriber
Pattern which makes it possible for MVC components to communicate in an
elegant, decoupled manner. Subscribers ‘listen’ for specific events of
interest and react when Publishers broadcast these events.</p>
<p><code>Event</code> is mixed into both the View and Model components
so that instances of either of these components can publish events of
interest.</p>
<div class="sourceCode" id="cb423"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co">// cranium.js - Cranium.Events</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Cranium <span class="op">=</span> Cranium <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb423-4"><a href="#cb423-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-5"><a href="#cb423-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Set DOM selection utility</span></span>
<span id="cb423-6"><a href="#cb423-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> $ <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">jQuery</span> <span class="op">||</span> <span class="kw">this</span><span class="op">.</span><span class="at">Zepto</span> <span class="op">||</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span><span class="op">.</span><span class="fu">bind</span>(<span class="bu">document</span>)<span class="op">;</span></span>
<span id="cb423-7"><a href="#cb423-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-8"><a href="#cb423-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Mix in to any object in order to provide it with custom events.</span></span>
<span id="cb423-9"><a href="#cb423-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Events <span class="op">=</span> Cranium<span class="op">.</span><span class="at">Events</span> <span class="op">=</span> {</span>
<span id="cb423-10"><a href="#cb423-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Keeps list of events and associated listeners</span></span>
<span id="cb423-11"><a href="#cb423-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">channels</span><span class="op">:</span> {}<span class="op">,</span></span>
<span id="cb423-12"><a href="#cb423-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-13"><a href="#cb423-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Counter</span></span>
<span id="cb423-14"><a href="#cb423-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">eventNumber</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb423-15"><a href="#cb423-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-16"><a href="#cb423-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Announce events and passes data to the listeners;</span></span>
<span id="cb423-17"><a href="#cb423-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">trigger</span><span class="op">:</span> <span class="kw">function</span> (events<span class="op">,</span> data) {</span>
<span id="cb423-18"><a href="#cb423-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> topic <span class="kw">in</span> Cranium<span class="op">.</span><span class="at">Events</span><span class="op">.</span><span class="at">channels</span>){</span>
<span id="cb423-19"><a href="#cb423-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Cranium<span class="op">.</span><span class="at">Events</span><span class="op">.</span><span class="at">channels</span><span class="op">.</span><span class="fu">hasOwnProperty</span>(topic)) {</span>
<span id="cb423-20"><a href="#cb423-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (topic<span class="op">.</span><span class="fu">split</span>(<span class="st">&quot;-&quot;</span>)[<span class="dv">0</span>] <span class="op">==</span> events){</span>
<span id="cb423-21"><a href="#cb423-21" aria-hidden="true" tabindex="-1"></a>          Cranium<span class="op">.</span><span class="at">Events</span><span class="op">.</span><span class="at">channels</span>[topic](data) <span class="op">!==</span> <span class="kw">false</span> <span class="op">||</span> <span class="kw">delete</span> Cranium<span class="op">.</span><span class="at">Events</span><span class="op">.</span><span class="at">channels</span>[topic]<span class="op">;</span></span>
<span id="cb423-22"><a href="#cb423-22" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb423-23"><a href="#cb423-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb423-24"><a href="#cb423-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb423-25"><a href="#cb423-25" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb423-26"><a href="#cb423-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Registers an event type and its listener</span></span>
<span id="cb423-27"><a href="#cb423-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">on</span><span class="op">:</span> <span class="kw">function</span> (events<span class="op">,</span> callback) {</span>
<span id="cb423-28"><a href="#cb423-28" aria-hidden="true" tabindex="-1"></a>    Cranium<span class="op">.</span><span class="at">Events</span><span class="op">.</span><span class="at">channels</span>[events <span class="op">+</span> <span class="op">--</span>Cranium<span class="op">.</span><span class="at">Events</span><span class="op">.</span><span class="at">eventNumber</span>] <span class="op">=</span> callback<span class="op">;</span></span>
<span id="cb423-29"><a href="#cb423-29" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb423-30"><a href="#cb423-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Unregisters an event type and its listener</span></span>
<span id="cb423-31"><a href="#cb423-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">off</span><span class="op">:</span> <span class="kw">function</span>(topic) {</span>
<span id="cb423-32"><a href="#cb423-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> topic<span class="op">;</span></span>
<span id="cb423-33"><a href="#cb423-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (topic <span class="kw">in</span> Cranium<span class="op">.</span><span class="at">Events</span><span class="op">.</span><span class="at">channels</span>) {</span>
<span id="cb423-34"><a href="#cb423-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Cranium<span class="op">.</span><span class="at">Events</span><span class="op">.</span><span class="at">channels</span><span class="op">.</span><span class="fu">hasOwnProperty</span>(topic)) {</span>
<span id="cb423-35"><a href="#cb423-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (topic<span class="op">.</span><span class="fu">split</span>(<span class="st">&quot;-&quot;</span>)[<span class="dv">0</span>] <span class="op">==</span> events) {</span>
<span id="cb423-36"><a href="#cb423-36" aria-hidden="true" tabindex="-1"></a>          <span class="kw">delete</span> Cranium<span class="op">.</span><span class="at">Events</span><span class="op">.</span><span class="at">channels</span>[topic]<span class="op">;</span></span>
<span id="cb423-37"><a href="#cb423-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb423-38"><a href="#cb423-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb423-39"><a href="#cb423-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb423-40"><a href="#cb423-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb423-41"><a href="#cb423-41" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>The Event system makes it possible for:</p>
<ul>
<li>a View to notify its subscribers of user interaction (e.g., clicks
or input in a form), to update/re-render its presentation, etc.</li>
<li>a Model whose data has changed to notify its Subscribers to update
themselves (e.g., view to re-render to show accurate/updated data),
etc.</li>
</ul>
<h3 id="models-3">Models</h3>
<p>Models manage the (domain-specific) data for an application. They are
concerned with neither the user-interface nor presentation layers, but
instead represent structured data that an application may require. When
a model changes (e.g. when it is updated), it will typically notify its
observers (Subscribers) that a change has occurred so that they may
react accordingly.</p>
<p>Let’s see a simple implementation of the Model:</p>
<div class="sourceCode" id="cb424"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="co">// cranium.js - Cranium.Model</span></span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-3"><a href="#cb424-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Attributes represents data, model&#39;s properties.</span></span>
<span id="cb424-4"><a href="#cb424-4" aria-hidden="true" tabindex="-1"></a><span class="co">// These are to be passed at Model instantiation.</span></span>
<span id="cb424-5"><a href="#cb424-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Also we are creating id for each Model instance</span></span>
<span id="cb424-6"><a href="#cb424-6" aria-hidden="true" tabindex="-1"></a><span class="co">// so that it can identify itself (e.g. on chage</span></span>
<span id="cb424-7"><a href="#cb424-7" aria-hidden="true" tabindex="-1"></a><span class="co">// announcements)</span></span>
<span id="cb424-8"><a href="#cb424-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Model <span class="op">=</span> Cranium<span class="op">.</span><span class="at">Model</span> <span class="op">=</span> <span class="kw">function</span> (attributes) {</span>
<span id="cb424-9"><a href="#cb424-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">id</span> <span class="op">=</span> _<span class="op">.</span><span class="fu">uniqueId</span>(<span class="st">&#39;model&#39;</span>)<span class="op">;</span></span>
<span id="cb424-10"><a href="#cb424-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">attributes</span> <span class="op">=</span> attributes <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb424-11"><a href="#cb424-11" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb424-12"><a href="#cb424-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-13"><a href="#cb424-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Getter (accessor) method;</span></span>
<span id="cb424-14"><a href="#cb424-14" aria-hidden="true" tabindex="-1"></a><span class="co">// returns named data item</span></span>
<span id="cb424-15"><a href="#cb424-15" aria-hidden="true" tabindex="-1"></a>Cranium<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">get</span> <span class="op">=</span> <span class="kw">function</span>(attrName) {</span>
<span id="cb424-16"><a href="#cb424-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">attributes</span>[attrName]<span class="op">;</span></span>
<span id="cb424-17"><a href="#cb424-17" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb424-18"><a href="#cb424-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-19"><a href="#cb424-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Setter (mutator) method;</span></span>
<span id="cb424-20"><a href="#cb424-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Set/mix in into model mapped data (e.g.{name: &quot;John&quot;})</span></span>
<span id="cb424-21"><a href="#cb424-21" aria-hidden="true" tabindex="-1"></a><span class="co">// and publishes the change event</span></span>
<span id="cb424-22"><a href="#cb424-22" aria-hidden="true" tabindex="-1"></a>Cranium<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">set</span> <span class="op">=</span> <span class="kw">function</span>(attrs){</span>
<span id="cb424-23"><a href="#cb424-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (_<span class="op">.</span><span class="fu">isObject</span>(attrs)) {</span>
<span id="cb424-24"><a href="#cb424-24" aria-hidden="true" tabindex="-1"></a>      _<span class="op">.</span><span class="fu">extend</span>(<span class="kw">this</span><span class="op">.</span><span class="at">attributes</span><span class="op">,</span> attrs)<span class="op">;</span></span>
<span id="cb424-25"><a href="#cb424-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">change</span>(<span class="kw">this</span><span class="op">.</span><span class="at">attributes</span>)<span class="op">;</span></span>
<span id="cb424-26"><a href="#cb424-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb424-27"><a href="#cb424-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb424-28"><a href="#cb424-28" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb424-29"><a href="#cb424-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-30"><a href="#cb424-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns clone of the Models data object</span></span>
<span id="cb424-31"><a href="#cb424-31" aria-hidden="true" tabindex="-1"></a><span class="co">// (used for view template rendering)</span></span>
<span id="cb424-32"><a href="#cb424-32" aria-hidden="true" tabindex="-1"></a>Cranium<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">toJSON</span> <span class="op">=</span> <span class="kw">function</span>(options) {</span>
<span id="cb424-33"><a href="#cb424-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _<span class="op">.</span><span class="fu">clone</span>(<span class="kw">this</span><span class="op">.</span><span class="at">attributes</span>)<span class="op">;</span></span>
<span id="cb424-34"><a href="#cb424-34" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb424-35"><a href="#cb424-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-36"><a href="#cb424-36" aria-hidden="true" tabindex="-1"></a><span class="co">// Helper function that announces changes to the Model</span></span>
<span id="cb424-37"><a href="#cb424-37" aria-hidden="true" tabindex="-1"></a><span class="co">// and passes the new data</span></span>
<span id="cb424-38"><a href="#cb424-38" aria-hidden="true" tabindex="-1"></a>Cranium<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">change</span> <span class="op">=</span> <span class="kw">function</span>(attrs){</span>
<span id="cb424-39"><a href="#cb424-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">trigger</span>(<span class="kw">this</span><span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;update&#39;</span><span class="op">,</span> attrs)<span class="op">;</span></span>
<span id="cb424-40"><a href="#cb424-40" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb424-41"><a href="#cb424-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-42"><a href="#cb424-42" aria-hidden="true" tabindex="-1"></a><span class="co">// Mix in Event system</span></span>
<span id="cb424-43"><a href="#cb424-43" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(Cranium<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="at">prototype</span><span class="op">,</span> Cranium<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span></code></pre></div>
<h3 id="views-3">Views</h3>
<p>Views are a visual representation of models that present a filtered
view of their current state. A view typically observes a model and is
notified when the model changes, allowing the view to update itself
accordingly. Design pattern literature commonly refers to views as
‘dumb’, given that their knowledge of models and controllers in an
application is limited.</p>
<p>Let’s explore Views a little further using a simple JavaScript
example:</p>
<div class="sourceCode" id="cb425"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="co">// DOM View</span></span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> View <span class="op">=</span> Cranium<span class="op">.</span><span class="at">View</span> <span class="op">=</span> <span class="kw">function</span> (options) {</span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mix in options object (e.g. extending functionality)</span></span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a>  _<span class="op">.</span><span class="fu">extend</span>(<span class="kw">this</span><span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">id</span> <span class="op">=</span> _<span class="op">.</span><span class="fu">uniqueId</span>(<span class="st">&#39;view&#39;</span>)<span class="op">;</span></span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-8"><a href="#cb425-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Mix in Event system</span></span>
<span id="cb425-9"><a href="#cb425-9" aria-hidden="true" tabindex="-1"></a>_<span class="op">.</span><span class="fu">extend</span>(Cranium<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="at">prototype</span><span class="op">,</span> Cranium<span class="op">.</span><span class="at">Events</span>)<span class="op">;</span></span></code></pre></div>
<h3 id="controllers">Controllers</h3>
<p>Controllers are an intermediary between models and views which are
classically responsible for two tasks:</p>
<ul>
<li>they update the view when the model changes</li>
<li>they update the model when the user manipulates the view</li>
</ul>
<div class="sourceCode" id="cb426"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="co">// cranium.js - Cranium.Controller</span></span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-3"><a href="#cb426-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Controller tying together a model and view</span></span>
<span id="cb426-4"><a href="#cb426-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Controller <span class="op">=</span> Cranium<span class="op">.</span><span class="at">Controller</span> <span class="op">=</span> <span class="kw">function</span>(options){</span>
<span id="cb426-5"><a href="#cb426-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mix in options object (e.g. extending functionality)</span></span>
<span id="cb426-6"><a href="#cb426-6" aria-hidden="true" tabindex="-1"></a>  _<span class="op">.</span><span class="fu">extend</span>(<span class="kw">this</span><span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb426-7"><a href="#cb426-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">id</span> <span class="op">=</span> _<span class="op">.</span><span class="fu">uniqueId</span>(<span class="st">&#39;controller&#39;</span>)<span class="op">;</span></span>
<span id="cb426-8"><a href="#cb426-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> parts<span class="op">,</span> selector<span class="op">,</span> eventType<span class="op">;</span></span>
<span id="cb426-9"><a href="#cb426-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-10"><a href="#cb426-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Parses Events object passed during the definition of the</span></span>
<span id="cb426-11"><a href="#cb426-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// controller and maps it to the defined method to handle it;</span></span>
<span id="cb426-12"><a href="#cb426-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="kw">this</span><span class="op">.</span><span class="at">events</span>){</span>
<span id="cb426-13"><a href="#cb426-13" aria-hidden="true" tabindex="-1"></a>    _<span class="op">.</span><span class="fu">each</span>(<span class="kw">this</span><span class="op">.</span><span class="at">events</span><span class="op">,</span> <span class="kw">function</span>(method<span class="op">,</span> eventName){</span>
<span id="cb426-14"><a href="#cb426-14" aria-hidden="true" tabindex="-1"></a>      parts <span class="op">=</span> eventName<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;.&#39;</span>)<span class="op">;</span></span>
<span id="cb426-15"><a href="#cb426-15" aria-hidden="true" tabindex="-1"></a>      selector <span class="op">=</span> parts[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb426-16"><a href="#cb426-16" aria-hidden="true" tabindex="-1"></a>      eventType <span class="op">=</span> parts[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb426-17"><a href="#cb426-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">$</span>(selector)[<span class="st">&#39;on&#39;</span> <span class="op">+</span> eventType] <span class="op">=</span> <span class="kw">this</span>[method]<span class="op">;</span></span>
<span id="cb426-18"><a href="#cb426-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))<span class="op">;</span></span>
<span id="cb426-19"><a href="#cb426-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb426-20"><a href="#cb426-20" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 id="practical-usage">Practical Usage</h3>
<p>HTML template for the primer that follows:</p>
<div class="sourceCode" id="cb427"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">&quot;en&quot;</span><span class="dt">&gt;</span></span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;utf-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb427-6"><a href="#cb427-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;description&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;&quot;</span><span class="dt">&gt;</span></span>
<span id="cb427-7"><a href="#cb427-7" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb427-8"><a href="#cb427-8" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb427-9"><a href="#cb427-9" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;todo&quot;</span><span class="dt">&gt;</span></span>
<span id="cb427-10"><a href="#cb427-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb427-11"><a href="#cb427-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;todo-template&quot;</span><span class="dt">&gt;</span></span>
<span id="cb427-12"><a href="#cb427-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div<span class="op">&gt;</span></span>
<span id="cb427-13"><a href="#cb427-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>input id<span class="op">=</span><span class="st">&quot;todo_complete&quot;</span> type<span class="op">=</span><span class="st">&quot;checkbox&quot;</span> <span class="op">&lt;%=</span> completed <span class="op">%&gt;&gt;</span></span>
<span id="cb427-14"><a href="#cb427-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;%=</span> title <span class="op">%&gt;</span></span>
<span id="cb427-15"><a href="#cb427-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb427-16"><a href="#cb427-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb427-17"><a href="#cb427-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;underscore-min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb427-18"><a href="#cb427-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;cranium.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb427-19"><a href="#cb427-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;example.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb427-20"><a href="#cb427-20" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb427-21"><a href="#cb427-21" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Cranium.js usage:</p>
<div class="sourceCode" id="cb428"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a><span class="co">// example.js - usage of Cranium MVC</span></span>
<span id="cb428-3"><a href="#cb428-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-4"><a href="#cb428-4" aria-hidden="true" tabindex="-1"></a><span class="co">// And todo instance</span></span>
<span id="cb428-5"><a href="#cb428-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todo1 <span class="op">=</span> <span class="kw">new</span> Cranium<span class="op">.</span><span class="fu">Model</span>({</span>
<span id="cb428-6"><a href="#cb428-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb428-7"><a href="#cb428-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">completed</span><span class="op">:</span> <span class="st">&quot;&quot;</span></span>
<span id="cb428-8"><a href="#cb428-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb428-9"><a href="#cb428-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-10"><a href="#cb428-10" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;First todo title - nothing set: &quot;</span> <span class="op">+</span> todo1<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb428-11"><a href="#cb428-11" aria-hidden="true" tabindex="-1"></a>todo1<span class="op">.</span><span class="fu">set</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Do something&quot;</span>})<span class="op">;</span></span>
<span id="cb428-12"><a href="#cb428-12" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Its changed now: &quot;</span> <span class="op">+</span> todo1<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>))<span class="op">;</span></span>
<span id="cb428-13"><a href="#cb428-13" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;&#39;</span></span>
<span id="cb428-14"><a href="#cb428-14" aria-hidden="true" tabindex="-1"></a><span class="co">// View instance</span></span>
<span id="cb428-15"><a href="#cb428-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todoView <span class="op">=</span> <span class="kw">new</span> Cranium<span class="op">.</span><span class="fu">View</span>({</span>
<span id="cb428-16"><a href="#cb428-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// DOM element selector</span></span>
<span id="cb428-17"><a href="#cb428-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">el</span><span class="op">:</span> <span class="st">&#39;#todo&#39;</span><span class="op">,</span></span>
<span id="cb428-18"><a href="#cb428-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-19"><a href="#cb428-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Todo template; Underscore temlating used</span></span>
<span id="cb428-20"><a href="#cb428-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>(<span class="fu">$</span>(<span class="st">&#39;.todo-template&#39;</span>)<span class="op">.</span><span class="at">innerHTML</span>)<span class="op">,</span></span>
<span id="cb428-21"><a href="#cb428-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-22"><a href="#cb428-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">init</span><span class="op">:</span> <span class="kw">function</span> (model) {</span>
<span id="cb428-23"><a href="#cb428-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>( model<span class="op">.</span><span class="at">attributes</span> )<span class="op">;</span></span>
<span id="cb428-24"><a href="#cb428-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-25"><a href="#cb428-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">on</span>(model<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;update&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))<span class="op">;</span></span>
<span id="cb428-26"><a href="#cb428-26" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb428-27"><a href="#cb428-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span> (data) {</span>
<span id="cb428-28"><a href="#cb428-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;View about to render.&quot;</span>)<span class="op">;</span></span>
<span id="cb428-29"><a href="#cb428-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(<span class="kw">this</span><span class="op">.</span><span class="at">el</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">template</span>( data )<span class="op">;</span></span>
<span id="cb428-30"><a href="#cb428-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb428-31"><a href="#cb428-31" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb428-32"><a href="#cb428-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-33"><a href="#cb428-33" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todoController <span class="op">=</span> <span class="kw">new</span> Cranium<span class="op">.</span><span class="fu">Controller</span>({</span>
<span id="cb428-34"><a href="#cb428-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Specify the model to update</span></span>
<span id="cb428-35"><a href="#cb428-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">model</span><span class="op">:</span> todo1<span class="op">,</span></span>
<span id="cb428-36"><a href="#cb428-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-37"><a href="#cb428-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">// and the view to observe this model</span></span>
<span id="cb428-38"><a href="#cb428-38" aria-hidden="true" tabindex="-1"></a>  <span class="dt">view</span><span class="op">:</span>  todoView<span class="op">,</span></span>
<span id="cb428-39"><a href="#cb428-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-40"><a href="#cb428-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb428-41"><a href="#cb428-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;#todo.click&quot;</span> <span class="op">:</span> <span class="st">&quot;toggleComplete&quot;</span></span>
<span id="cb428-42"><a href="#cb428-42" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb428-43"><a href="#cb428-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-44"><a href="#cb428-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Initialize everything</span></span>
<span id="cb428-45"><a href="#cb428-45" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb428-46"><a href="#cb428-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="fu">init</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span>)<span class="op">;</span></span>
<span id="cb428-47"><a href="#cb428-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb428-48"><a href="#cb428-48" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb428-49"><a href="#cb428-49" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggles the value of the todo in the Model</span></span>
<span id="cb428-50"><a href="#cb428-50" aria-hidden="true" tabindex="-1"></a>  <span class="dt">toggleComplete</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb428-51"><a href="#cb428-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> completed <span class="op">=</span> todoController<span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>)<span class="op">;</span></span>
<span id="cb428-52"><a href="#cb428-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Todo old &#39;completed&#39; value?&quot;</span><span class="op">,</span> completed)<span class="op">;</span></span>
<span id="cb428-53"><a href="#cb428-53" aria-hidden="true" tabindex="-1"></a>    todoController<span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">set</span>({ <span class="dt">completed</span><span class="op">:</span> (<span class="op">!</span>completed) <span class="op">?</span> <span class="st">&#39;checked&#39;</span><span class="op">:</span> <span class="st">&#39;&#39;</span> })<span class="op">;</span></span>
<span id="cb428-54"><a href="#cb428-54" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Todo new &#39;completed&#39; value?&quot;</span><span class="op">,</span> todoController<span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;completed&#39;</span>))<span class="op">;</span></span>
<span id="cb428-55"><a href="#cb428-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb428-56"><a href="#cb428-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb428-57"><a href="#cb428-57" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb428-58"><a href="#cb428-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-59"><a href="#cb428-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-60"><a href="#cb428-60" aria-hidden="true" tabindex="-1"></a><span class="co">// Let&#39;s kick start things off</span></span>
<span id="cb428-61"><a href="#cb428-61" aria-hidden="true" tabindex="-1"></a>todoController<span class="op">.</span><span class="fu">initialize</span>()<span class="op">;</span></span>
<span id="cb428-62"><a href="#cb428-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-63"><a href="#cb428-63" aria-hidden="true" tabindex="-1"></a>todo1<span class="op">.</span><span class="fu">set</span>({ <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Due to this change Model will notify View and it will re-render&quot;</span>})<span class="op">;</span></span></code></pre></div>
<p>Samuel Clay, one of the authors of the first version of Backbone.js
says of cranium.js: “Unsurprisingly, it looks a whole lot like the
beginnings of Backbone. Views are dumb, so they get very little
boilerplate and setup. Models are responsible for their attributes and
announcing changes to those models.”</p>
<p>I hope you’ve found this implementation helpful in understanding how
one would go about writing their own library like Backbone from scratch,
but moreso that it encourages you to take advantage of mature existing
solutions where possible but never be afraid to explore deeper down into
what makes them tick.</p>
<h2 id="mvp">MVP</h2>
<p>Model-View-Presenter (MVP) is a derivative of the MVC design pattern
which focuses on improving presentation logic. It originated at a
company named <a
href="http://en.wikipedia.org/wiki/Taligent">Taligent</a> in the early
1990s while they were working on a model for a C++ CommonPoint
environment. Whilst both MVC and MVP target the separation of concerns
across multiple components, there are some fundamental differences
between them.</p>
<p>For the purposes of this summary we will focus on the version of MVP
most suitable for web-based architectures.</p>
<h3 id="models-views-presenters">Models, Views &amp; Presenters</h3>
<p>The P in MVP stands for presenter. It’s a component which contains
the user-interface business logic for the view. Unlike MVC, invocations
from the view are delegated to the presenter, which are decoupled from
the view and instead talk to it through an interface. This allows for
all kinds of useful things such as being able to mock views in unit
tests.</p>
<p>The most common implementation of MVP is one which uses a Passive
View (a view which is for all intents and purposes “dumb”), containing
little to no logic. MVP models are almost identical to MVC models and
handle application data. The presenter acts as a mediator which talks to
both the view and model, however both of these are isolated from each
other. They effectively bind models to views, a responsibility held by
Controllers in MVC. Presenters are at the heart of the MVP pattern and
as you can guess, incorporate the presentation logic behind views.</p>
<p>Solicited by a view, presenters perform any work to do with user
requests and pass data back to them. In this respect, they retrieve
data, manipulate it and determine how the data should be displayed in
the view. In some implementations, the presenter also interacts with a
service layer to persist data (models). Models may trigger events but
it’s the presenter’s role to subscribe to them so that it can update the
view. In this passive architecture, we have no concept of direct data
binding. Views expose setters which presenters can use to set data.</p>
<p>The benefit of this change from MVC is that it increases the
testability of your application and provides a more clean separation
between the view and the model. This isn’t however without its costs as
the lack of data binding support in the pattern can often mean having to
take care of this task separately.</p>
<p>Although a common implementation of a <a
href="http://martinfowler.com/eaaDev/PassiveScreen.html">Passive
View</a> is for the view to implement an interface, there are variations
on it, including the use of events which can decouple the View from the
Presenter a little more. As we don’t have the interface construct in
JavaScript, we’re using it more and more as a protocol than an explicit
interface here. It’s technically still an API and it’s probably fair for
us to refer to it as an interface from that perspective.</p>
<p>There is also a <a
href="http://martinfowler.com/eaaDev/SupervisingPresenter.html">Supervising
Controller</a> variation of MVP, which is closer to the MVC and <a
href="http://en.wikipedia.org/wiki/Model_View_ViewModel">MVVM -
Model-View-ViewModel</a> patterns as it provides data-binding from the
Model directly from the View. Key-value observing (KVO) plugins (such as
Derick Bailey’s Backbone.ModelBinding plugin) introduce this idea of a
Supervising Controller to Backbone.</p>
<h2 id="mvp-or-mvc">MVP or MVC?</h2>
<p>MVP is generally used most often in enterprise-level applications
where it’s necessary to reuse as much presentation logic as possible.
Applications with very complex views and a great deal of user
interaction may find that MVC doesn’t quite fit the bill here as solving
this problem may mean heavily relying on multiple controllers. In MVP,
all of this complex logic can be encapsulated in a presenter, which can
simplify maintenance greatly.</p>
<p>As MVP views are defined through an interface and the interface is
technically the only point of contact between the system and the view
(other than a presenter), this pattern also allows developers to write
presentation logic without needing to wait for designers to produce
layouts and graphics for the application.</p>
<p>Depending on the implementation, MVP may be more easy to
automatically unit test than MVC. The reason often cited for this is
that the presenter can be used as a complete mock of the user-interface
and so it can be unit tested independent of other components. In my
experience this really depends on the languages you are implementing MVP
in (there’s quite a difference between opting for MVP for a JavaScript
project over one for say, ASP.NET).</p>
<p>At the end of the day, the underlying concerns you may have with MVC
will likely hold true for MVP given that the differences between them
are mainly semantic. As long as you are cleanly separating concerns into
models, views and controllers (or presenters) you should be achieving
most of the same benefits regardless of the pattern you opt for.</p>
<h2 id="mvc-mvp-and-backbone.js">MVC, MVP and Backbone.js</h2>
<p>There are very few, if any architectural JavaScript frameworks that
claim to implement the MVC or MVP patterns in their classical form as
many JavaScript developers don’t view MVC and MVP as being mutually
exclusive (we are actually more likely to see MVP strictly implemented
when looking at web frameworks such as ASP.NET or GWT). This is because
it’s possible to have additional presenter/view logic in your
application and yet still consider it a flavor of MVC.</p>
<p>Backbone contributor <a href="http://ireneros.com/">Irene Ros</a>
subscribes to this way of thinking as when she separates Backbone views
out into their own distinct components, she needs something to actually
assemble them for her. This could either be a controller route (such as
a <code>Backbone.Router</code>) or a callback in response to data being
fetched.</p>
<p>That said, some developers do however feel that Backbone.js better
fits the description of MVP than it does MVC . Their view is that:</p>
<ul>
<li>The presenter in MVP better describes the <code>Backbone.View</code>
(the layer between View templates and the data bound to it) than a
controller does</li>
<li>The model fits <code>Backbone.Model</code> (it isn’t that different
from the classical MVC “Model”)</li>
<li>The views best represent templates (e.g. Handlebars/Mustache markup
templates)</li>
</ul>
<p>A response to this could be that the view can also just be a View (as
per MVC) because Backbone is flexible enough to let it be used for
multiple purposes. The V in MVC and the P in MVP can both be
accomplished by <code>Backbone.View</code> because they’re able to
achieve two purposes: both rendering atomic components and assembling
those components rendered by other views.</p>
<p>We’ve also seen that in Backbone the responsibility of a controller
is shared with both the Backbone.View and Backbone.Router and in the
following example we can actually see that aspects of that are certainly
true.</p>
<p>Here, our Backbone <code>TodoView</code> uses the Observer pattern to
‘subscribe’ to changes to a View’s model in the line
<code>this.listenTo(this.model, 'change',...)</code>. It also handles
templating in the <code>render()</code> method, but unlike some other
implementations, user interaction is also handled in the View (see
<code>events</code>).</p>
<div class="sourceCode" id="cb429"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="co">// The DOM element for a todo item...</span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="at">TodoView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({</span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">//... is a list tag.</span></span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">tagName</span><span class="op">:</span>  <span class="st">&#39;li&#39;</span><span class="op">,</span></span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Pass the contents of the todo template through a templating</span></span>
<span id="cb429-8"><a href="#cb429-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// function, cache it for a single todo</span></span>
<span id="cb429-9"><a href="#cb429-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> _<span class="op">.</span><span class="fu">template</span>( <span class="fu">$</span>(<span class="st">&#39;#item-template&#39;</span>)<span class="op">.</span><span class="fu">html</span>() )<span class="op">,</span></span>
<span id="cb429-10"><a href="#cb429-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-11"><a href="#cb429-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The DOM events specific to an item.</span></span>
<span id="cb429-12"><a href="#cb429-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">events</span><span class="op">:</span> {</span>
<span id="cb429-13"><a href="#cb429-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;click .toggle&#39;</span><span class="op">:</span>  <span class="st">&#39;togglecompleted&#39;</span></span>
<span id="cb429-14"><a href="#cb429-14" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb429-15"><a href="#cb429-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-16"><a href="#cb429-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The TodoView listens for changes to its model, re-rendering. Since there&#39;s</span></span>
<span id="cb429-17"><a href="#cb429-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// a one-to-one correspondence between a **Todo** and a **TodoView** in this</span></span>
<span id="cb429-18"><a href="#cb429-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// app, we set a direct reference on the model for convenience.</span></span>
<span id="cb429-19"><a href="#cb429-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb429-20"><a href="#cb429-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>( <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">render</span> )<span class="op">;</span></span>
<span id="cb429-21"><a href="#cb429-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">listenTo</span>( <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> <span class="st">&#39;destroy&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">remove</span> )<span class="op">;</span></span>
<span id="cb429-22"><a href="#cb429-22" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb429-23"><a href="#cb429-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-24"><a href="#cb429-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Re-render the titles of the todo item.</span></span>
<span id="cb429-25"><a href="#cb429-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">render</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb429-26"><a href="#cb429-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">$el</span><span class="op">.</span><span class="fu">html</span>( <span class="kw">this</span><span class="op">.</span><span class="fu">template</span>( <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">attributes</span> ) )<span class="op">;</span></span>
<span id="cb429-27"><a href="#cb429-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb429-28"><a href="#cb429-28" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb429-29"><a href="#cb429-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-30"><a href="#cb429-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle the `&quot;completed&quot;` state of the model.</span></span>
<span id="cb429-31"><a href="#cb429-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">togglecompleted</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb429-32"><a href="#cb429-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="fu">toggle</span>()<span class="op">;</span></span>
<span id="cb429-33"><a href="#cb429-33" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb429-34"><a href="#cb429-34" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Another (quite different) opinion is that Backbone more closely
resembles <a
href="http://martinfowler.com/eaaDev/uiArchs.html#ModelViewController">Smalltalk-80
MVC</a>, which we went through earlier.</p>
<p>As MarionetteJS author Derick Bailey has <a
href="http://lostechies.com/derickbailey/2011/12/23/backbone-js-is-not-an-mvc-framework/">written</a>,
it’s ultimately best not to force Backbone to fit any specific design
patterns. Design patterns should be considered flexible guides to how
applications may be structured and in this respect, Backbone doesn’t fit
either MVC nor MVP perfectly. Instead, it borrows some of the best
concepts from multiple architectural patterns and creates a flexible
library that just works well. Call it <strong>the Backbone way</strong>,
MV* or whatever helps reference its flavor of application
architecture.</p>
<p>It <em>is</em> however worth understanding where and why these
concepts originated, so I hope that my explanations of MVC and MVP have
been of help. Most structural JavaScript frameworks will adopt their own
take on classical patterns, either intentionally or by accident, but the
important thing is that they help us develop applications which are
organized, clean and can be easily maintained.</p>
<h2 id="namespacing">Namespacing</h2>
<p>When learning how to use Backbone, an important and commonly
overlooked area by tutorials is namespacing. If you already have
experience with namespacing in JavaScript, the following section will
provide some advice on how to specifically apply concepts you know to
Backbone, however I will also be covering explanations for beginners to
ensure everyone is on the same page.</p>
<h4 id="what-is-namespacing">What is namespacing?</h4>
<p>Namespacing is a way to avoid collisions with other objects or
variables in the global namespace. Using namespacing reduces the
potential of your code breaking because another script on the page is
using the same variable names that you are. As a good ‘citizen’ of the
global namespace, it’s also imperative that you do your best to minimize
the possibility of your code breaking other developer’s scripts.</p>
<p>JavaScript doesn’t really have built-in support for namespaces like
other languages, however it does have closures which can be used to
achieve a similar effect.</p>
<p>In this section we’ll be taking a look shortly at some examples of
how you can namespace your models, views, routers and other components.
The patterns we’ll be examining are:</p>
<ul>
<li>Single global variables</li>
<li>Object Literals</li>
<li>Nested namespacing</li>
</ul>
<p><strong>Single global variables</strong></p>
<p>One popular pattern for namespacing in JavaScript is opting for a
single global variable as your primary object of reference. A skeleton
implementation of this where we return an object with functions and
properties can be found below:</p>
<div class="sourceCode" id="cb430"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myApplication <span class="op">=</span> (<span class="kw">function</span>(){</span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span>(){</span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ...</span></span>
<span id="cb430-4"><a href="#cb430-4" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb430-5"><a href="#cb430-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb430-6"><a href="#cb430-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ...</span></span>
<span id="cb430-7"><a href="#cb430-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb430-8"><a href="#cb430-8" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div>
<p>You’ve probably seen this technique before. A Backbone-specific
example might look like this:</p>
<div class="sourceCode" id="cb431"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myViews <span class="op">=</span> (<span class="kw">function</span>(){</span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb431-3"><a href="#cb431-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">TodoView</span><span class="op">:</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({ <span class="op">..</span> })<span class="op">,</span></span>
<span id="cb431-4"><a href="#cb431-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">TodosView</span><span class="op">:</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({ <span class="op">..</span> })<span class="op">,</span></span>
<span id="cb431-5"><a href="#cb431-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">AboutView</span><span class="op">:</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({ <span class="op">..</span> })</span>
<span id="cb431-6"><a href="#cb431-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//etc.</span></span>
<span id="cb431-7"><a href="#cb431-7" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb431-8"><a href="#cb431-8" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div>
<p>Here we can return a set of views, but the same technique could
return an entire collection of models, views and routers depending on
how you decide to structure your application. Although this works for
certain situations, the biggest challenge with the single global
variable pattern is ensuring that no one else has used the same global
variable name as you have in the page.</p>
<p>One solution to this problem, as mentioned by Peter Michaux, is to
use prefix namespacing. It’s a simple concept at heart, but the idea is
you select a common prefix name (in this example,
<code>myApplication_</code>) and then define any methods, variables or
other objects after the prefix.</p>
<div class="sourceCode" id="cb432"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myApplication_todoView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">,</span></span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>    myApplication_todosView <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span></code></pre></div>
<p>This is effective from the perspective of trying to lower the chances
of a particular variable existing in the global scope, but remember that
a uniquely named object can have the same effect. This aside, the
biggest issue with the pattern is that it can result in a large number
of global objects once your application starts to grow.</p>
<p>For more on Peter’s views about the single global variable pattern,
read his <a
href="http://michaux.ca/articles/javascript-namespacing">excellent post
on them</a>.</p>
<p>Note: There are several other variations on the single global
variable pattern out in the wild, however having reviewed quite a few, I
felt the prefixing approach applied best to Backbone.</p>
<p><strong>Object Literals</strong></p>
<p>Object Literals have the advantage of not polluting the global
namespace but assist in organizing code and parameters logically.
They’re beneficial if you wish to create easily readable structures that
can be expanded to support deep nesting. Unlike simple global variables,
Object Literals often also take into account tests for the existence of
a variable by the same name, which helps reduce the chances of
collision.</p>
<p>This example demonstrates two ways you can check to see if a
namespace already exists before defining it. I commonly use Option
2.</p>
<div class="sourceCode" id="cb433"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Doesn&#39;t check for existence of myApplication */</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myApplication <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a><span class="co">Does check for existence. If already defined, we use that instance.</span></span>
<span id="cb433-6"><a href="#cb433-6" aria-hidden="true" tabindex="-1"></a><span class="co">Option 1:   if(!myApplication) myApplication = {};</span></span>
<span id="cb433-7"><a href="#cb433-7" aria-hidden="true" tabindex="-1"></a><span class="co">Option 2:   var myApplication = myApplication || {};</span></span>
<span id="cb433-8"><a href="#cb433-8" aria-hidden="true" tabindex="-1"></a><span class="co">We can then populate our object literal to support models, views and collections (or any data, really):</span></span>
<span id="cb433-9"><a href="#cb433-9" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb433-10"><a href="#cb433-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-11"><a href="#cb433-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myApplication <span class="op">=</span> {</span>
<span id="cb433-12"><a href="#cb433-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">models</span> <span class="op">:</span> {}<span class="op">,</span></span>
<span id="cb433-13"><a href="#cb433-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">views</span> <span class="op">:</span> {</span>
<span id="cb433-14"><a href="#cb433-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pages</span> <span class="op">:</span> {}</span>
<span id="cb433-15"><a href="#cb433-15" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb433-16"><a href="#cb433-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">collections</span> <span class="op">:</span> {}</span>
<span id="cb433-17"><a href="#cb433-17" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>One can also opt for adding properties directly to the namespace
(such as your views, in the following example):</p>
<div class="sourceCode" id="cb434"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myTodosViews <span class="op">=</span> myTodosViews <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a>myTodosViews<span class="op">.</span><span class="at">todoView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a>myTodosViews<span class="op">.</span><span class="at">todosView</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">View</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span></code></pre></div>
<p>The benefit of this pattern is that you’re able to easily encapsulate
all of your models, views, routers etc. in a way that clearly separates
them and provides a solid foundation for extending your code.</p>
<p>This pattern has a number of benefits. It’s often a good idea to
decouple the default configuration for your application into a single
area that can be easily modified without the need to search through your
entire codebase just to alter it. Here’s an example of a hypothetical
object literal that stores application configuration settings:</p>
<div class="sourceCode" id="cb435"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myConfig <span class="op">=</span> {</span>
<span id="cb435-2"><a href="#cb435-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">language</span><span class="op">:</span> <span class="st">&#39;english&#39;</span><span class="op">,</span></span>
<span id="cb435-3"><a href="#cb435-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">defaults</span><span class="op">:</span> {</span>
<span id="cb435-4"><a href="#cb435-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">enableDelegation</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb435-5"><a href="#cb435-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxTodos</span><span class="op">:</span> <span class="dv">40</span></span>
<span id="cb435-6"><a href="#cb435-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb435-7"><a href="#cb435-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">theme</span><span class="op">:</span> {</span>
<span id="cb435-8"><a href="#cb435-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">skin</span><span class="op">:</span> <span class="st">&#39;a&#39;</span><span class="op">,</span></span>
<span id="cb435-9"><a href="#cb435-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">toolbars</span><span class="op">:</span> {</span>
<span id="cb435-10"><a href="#cb435-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">index</span><span class="op">:</span> <span class="st">&#39;ui-navigation-toolbar&#39;</span><span class="op">,</span></span>
<span id="cb435-11"><a href="#cb435-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">pages</span><span class="op">:</span> <span class="st">&#39;ui-custom-toolbar&#39;</span></span>
<span id="cb435-12"><a href="#cb435-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb435-13"><a href="#cb435-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb435-14"><a href="#cb435-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note that there are really only minor syntactical differences between
the Object Literal pattern and a standard JSON data set. If for any
reason you wish to use JSON for storing your configurations instead
(e.g. for simpler storage when sending to the back-end), feel free
to.</p>
<p>For more on the Object Literal pattern, I recommend reading Rebecca
Murphey’s <a
href="http://rmurphey.com/blog/2009/10/15/using-objects-to-organize-your-code">excellent
article on the topic</a>.</p>
<p><strong>Nested namespacing</strong></p>
<p>An extension of the Object Literal pattern is nested namespacing.
It’s another common pattern used that offers a lower risk of collision
due to the fact that even if a top-level namespace already exists, it’s
unlikely the same nested children do. For example, Yahoo’s YUI uses the
nested object namespacing pattern extensively:</p>
<div class="sourceCode" id="cb436"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a>YAHOO<span class="op">.</span><span class="at">util</span><span class="op">.</span><span class="at">Dom</span><span class="op">.</span><span class="fu">getElementsByClassName</span>(<span class="st">&#39;test&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Yahoo’s YUI uses the nested object namespacing pattern regularly and
even DocumentCloud (the creators of Backbone) use the nested namespacing
pattern in their main applications. A sample implementation of nested
namespacing with Backbone may look like this:</p>
<div class="sourceCode" id="cb437"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> todoApp <span class="op">=</span>  todoApp <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a><span class="co">// perform similar check for nested children</span></span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a>todoApp<span class="op">.</span><span class="at">routers</span> <span class="op">=</span> todoApp<span class="op">.</span><span class="at">routers</span> <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb437-5"><a href="#cb437-5" aria-hidden="true" tabindex="-1"></a>todoApp<span class="op">.</span><span class="at">model</span> <span class="op">=</span> todoApp<span class="op">.</span><span class="at">model</span> <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb437-6"><a href="#cb437-6" aria-hidden="true" tabindex="-1"></a>todoApp<span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">special</span> <span class="op">=</span> todoApp<span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">special</span> <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb437-7"><a href="#cb437-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-8"><a href="#cb437-8" aria-hidden="true" tabindex="-1"></a><span class="co">// routers</span></span>
<span id="cb437-9"><a href="#cb437-9" aria-hidden="true" tabindex="-1"></a>todoApp<span class="op">.</span><span class="at">routers</span><span class="op">.</span><span class="at">Workspace</span>   <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span>
<span id="cb437-10"><a href="#cb437-10" aria-hidden="true" tabindex="-1"></a>todoApp<span class="op">.</span><span class="at">routers</span><span class="op">.</span><span class="at">TodoSearch</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Router</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span>
<span id="cb437-11"><a href="#cb437-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-12"><a href="#cb437-12" aria-hidden="true" tabindex="-1"></a><span class="co">// models</span></span>
<span id="cb437-13"><a href="#cb437-13" aria-hidden="true" tabindex="-1"></a>todoApp<span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">Todo</span>   <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span>
<span id="cb437-14"><a href="#cb437-14" aria-hidden="true" tabindex="-1"></a>todoApp<span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">Notes</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span>
<span id="cb437-15"><a href="#cb437-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-16"><a href="#cb437-16" aria-hidden="true" tabindex="-1"></a><span class="co">// special models</span></span>
<span id="cb437-17"><a href="#cb437-17" aria-hidden="true" tabindex="-1"></a>todoApp<span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">special</span><span class="op">.</span><span class="at">Admin</span> <span class="op">=</span> Backbone<span class="op">.</span><span class="at">Model</span><span class="op">.</span><span class="fu">extend</span>({})<span class="op">;</span></span></code></pre></div>
<p>This is readable, clearly organized, and is a relatively safe way of
namespacing your Backbone application. The only real caveat however is
that it requires your browser’s JavaScript engine to first locate the
todoApp object, then dig down until it gets to the function you’re
calling. However, developers such as Juriy Zaytsev (kangax) have tested
and found the performance differences between single object namespacing
vs the ‘nested’ approach to be quite negligible.</p>
<p><strong>What does DocumentCloud use?</strong></p>
<p>In case you were wondering, here is the original DocumentCloud
(remember those guys that created Backbone?) workspace that uses
namespacing in a necessary way. This approach makes sense as their
documents (and annotations and document lists) are embedded on
third-party news sites.</p>
<div class="sourceCode" id="cb438"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Provide top-level namespaces for our javascript.</span></span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a>(<span class="kw">function</span>() {</span>
<span id="cb438-4"><a href="#cb438-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="at">dc</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb438-5"><a href="#cb438-5" aria-hidden="true" tabindex="-1"></a>  dc<span class="op">.</span><span class="at">controllers</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb438-6"><a href="#cb438-6" aria-hidden="true" tabindex="-1"></a>  dc<span class="op">.</span><span class="at">model</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb438-7"><a href="#cb438-7" aria-hidden="true" tabindex="-1"></a>  dc<span class="op">.</span><span class="at">app</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb438-8"><a href="#cb438-8" aria-hidden="true" tabindex="-1"></a>  dc<span class="op">.</span><span class="at">ui</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb438-9"><a href="#cb438-9" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div>
<p>As you can see, they opt for declaring a top-level namespace on the
<code>window</code> called <code>dc</code>, a short-form name of their
app, followed by nested namespaces for the controllers, models, UI and
other pieces of their application.</p>
<p><strong>Recommendation</strong></p>
<p>Reviewing the namespace patterns above, the option that I prefer when
writing Backbone applications is nested object namespacing with the
object literal pattern.</p>
<p>Single global variables may work fine for applications that are
relatively trivial. However, larger codebases requiring both namespaces
and deep sub-namespaces require a succinct solution that’s both readable
and scalable. I feel this pattern achieves both of these objectives and
is a good choice for most Backbone development.</p>
<h2 id="backbone-dependency-details">Backbone Dependency Details</h2>
<p>The following sections provide insight into how Backbone uses
jQuery/Zepto and Underscore.js.</p>
<h3 id="dom-manipulation">DOM Manipulation</h3>
<p>Although most developers won’t need it, Backbone does support setting
a custom DOM library to be used instead of these options. From the
source:</p>
<pre><code>// For Backbone&#39;s purposes, jQuery, Zepto, Ender, or My Library (kidding) owns
// the `$` variable.
 Backbone.$ = root.jQuery || root.Zepto || root.ender || root.$;</code></pre>
<p>So, setting <code>Backbone.$ = myLibrary;</code> will allow you to
use any custom DOM-manipulation library in place of the jQuery
default.</p>
<h3 id="utilities">Utilities</h3>
<p>Underscore.js is heavily used in Backbone behind the scenes for
everything from object extension to event binding. As the entire library
is generally included, we get free access to a number of useful
utilities we can use on Collections such as filtering
<code>_.filter()</code>, sorting <code>_.sortBy()</code>, mapping
<code>_.map()</code> and so on.</p>
<p>From the source:</p>
<pre><code>// Underscore methods that we want to implement on the Collection.
// 90% of the core usefulness of Backbone Collections is actually implemented
// right here:
var methods = [&#39;forEach&#39;, &#39;each&#39;, &#39;map&#39;, &#39;collect&#39;, &#39;reduce&#39;, &#39;foldl&#39;, &#39;inject&#39;, &#39;reduceRight&#39;, &#39;foldr&#39;, &#39;find&#39;, &#39;detect&#39;, &#39;filter&#39;, &#39;select&#39;, &#39;reject&#39;, &#39;every&#39;, &#39;all&#39;, &#39;some&#39;, &#39;any&#39;, &#39;include&#39;, &#39;contains&#39;, &#39;invoke&#39;, &#39;max&#39;, &#39;min&#39;, &#39;toArray&#39;, &#39;size&#39;, &#39;first&#39;, &#39;head&#39;, &#39;take&#39;, &#39;initial&#39;, &#39;rest&#39;, &#39;tail&#39;, &#39;drop&#39;, &#39;last&#39;, &#39;without&#39;, &#39;indexOf&#39;, &#39;shuffle&#39;, &#39;lastIndexOf&#39;, &#39;isEmpty&#39;, &#39;chain&#39;];

// Mix in each Underscore method as a proxy to `Collection#models`.
_.each(methods, function(method) {
    Collection.prototype[method] = function() {
        var args = slice.call(arguments);
        args.unshift(this.models);
        return _[method].apply(_, args);
    };
});</code></pre>
<p>However, for a complete linked list of methods supported, see the <a
href="http://backbonejs.org/#Collection-Underscore-Methods">official
documentation</a>.</p>
<h3 id="restful-persistence-1">RESTful persistence</h3>
<p>Models and collections in Backbone can be “sync”ed with the server
using the <code>fetch</code>, <code>save</code> and <code>destroy</code>
methods. All of these methods delegate back to the
<code>Backbone.sync</code> function, which actually wraps jQuery/Zepto’s
<code>$.ajax</code> function, calling GET, POST and DELETE for the
respective persistence methods on Backbone models.</p>
<p>From the the source for <code>Backbone.sync</code>:</p>
<pre><code>var methodMap = {
  &#39;create&#39;: &#39;POST&#39;,
  &#39;update&#39;: &#39;PUT&#39;,
  &#39;patch&#39;:  &#39;PATCH&#39;,
  &#39;delete&#39;: &#39;DELETE&#39;,
  &#39;read&#39;:   &#39;GET&#39;
};

Backbone.sync = function(method, model, options) {
    var type = methodMap[method];

    // ... Followed by lots of Backbone.js configuration, then..

    // Make the request, allowing the user to override any Ajax options.
    var xhr = options.xhr = Backbone.ajax(_.extend(params, options));
    model.trigger(&#39;request&#39;, model, xhr, options);
    return xhr;</code></pre>
<h3 id="routing">Routing</h3>
<p>Calls to <code>Backbone.History.start</code> rely on jQuery/Zepto
binding <code>popState</code> or <code>hashchange</code> event listeners
back to the window object.</p>
<p>From the source for <code>Backbone.history.start</code>:</p>
<pre><code>      // Depending on whether we&#39;re using pushState or hashes, and whether
      // &#39;onhashchange&#39; is supported, determine how we check the URL state.
      if (this._hasPushState) {
          Backbone.$(window)
              .on(&#39;popstate&#39;, this.checkUrl);
      } else if (this._wantsHashChange &amp;&amp; (&#39;onhashchange&#39; in window) &amp;&amp; !oldIE) {
          Backbone.$(window)
              .on(&#39;hashchange&#39;, this.checkUrl);
      } else if (this._wantsHashChange) {
          this._checkUrlInterval = setInterval(this.checkUrl, this.interval);
      }
      ...</code></pre>
<p><code>Backbone.History.stop</code> similarly uses your DOM
manipulation library to unbind these event listeners.</p>
<h2 id="backbone-vs.-other-libraries-and-frameworks">Backbone Vs. Other
Libraries And Frameworks</h2>
<p>Backbone is just one of many different solutions available for
structuring your application and we’re by no means advocating it as the
be all and end all. It’s served the authors of this book well in
building many simple and complex web applications and we hope that it
can serve you equally as well. The answer to the question ‘Is Backbone
better than X?’ generally has a lot more to do with what kind of
application you’re building.</p>
<p>AngularJS and Ember.js are examples of powerful alternatives but
differ from Backbone in that there are more opinionated. For some
projects this can be useful and for others, perhaps not. The important
thing to remember is that there is no library or framework that’s going
to be the best solution for every use-case and so it’s important to
learn about the tools at your disposal and decide which one is best on a
project-by-project basis.</p>
<p>Choose the right tool for the right job. This is why we recommend
spending some time doing a little due diligence. Consider productivity,
ease of use, testability, community and documentation. If you’re looking
for more concrete comparisons between frameworks, read:</p>
<ul>
<li><a
href="http://coding.smashingmagazine.com/2012/07/27/journey-through-the-javascript-mvc-jungle/">Journey
Through The JavaScript MVC Jungle</a></li>
<li><a
href="http://blog.stevensanderson.com/2012/08/01/rich-javascript-applications-the-seven-frameworks-throne-of-js-2012/">Throne
of JS - Seven JavaScript Frameworks</a></li>
</ul>
<p>The authors behind Backbone.js, AngularJS and Ember have also
discussed some of the strengths and weaknesses of their solutions on
Quora, StackOverflow and so on:</p>
<ul>
<li><a href="http://backbonejs.org/#FAQ-why-backbone">Jeremy Ashkenas on
Why Backbone?</a></li>
<li><a
href="http://www.quora.com/Ember-js/Which-one-of-angular-js-and-ember-js-is-the-better-choice/answer/Tom-Dale">Tom
Dale on Why Ember.js vs. AngularJS</a></li>
<li><a
href="http://www.reddit.com/r/javascript/comments/17h22w/an_introduction_to_angular_for_backbone_developers/">Brian
Ford &amp; Jeremy Ashkenas on Backbone vs. Angular (discussion)</a></li>
</ul>
<p>The solution you opt for may need to support building non-trivial
features and could end up being used to maintain the app for years to
come so think about things like:</p>
<p><strong>What is the library/framework really capable of?</strong></p>
<p>Spend time reviewing both the source code of the framework and
official list of features to see how well they fit with your
requirements. There will be projects that may require modifying or
extending the underlying source and thus make sure that if this might be
the case, you’ve performed due diligence on the code.</p>
<p><strong>Has the framework been proven in production?</strong></p>
<p>Have developers actually built and deployed large applications with
it that are publicly accessible? Backbone has a strong portfolio of
these (SoundCloud, LinkedIn, Walmart) but not all libraries and
frameworks do. Ember is used in number of large apps, including the new
version of ZenDesk. AngularJS has been used to build the YouTube app for
PS3 amongst other places. It’s not only important to know that a library
or framework works in production, but also being able to look at real
world code and be inspired by what can be built with it.</p>
<p><strong>Is the framework mature?</strong></p>
<p>I generally recommend developers don’t simply “pick one and go with
it”. New projects often come with a lot of buzz surrounding their
releases but remember to take care when selecting them for use on a
production-level app. You don’t want to risk the project being canned,
going through major periods of refactoring or other breaking changes
that tend to be more carefully planned out when a framework is mature.
Mature projects also tend to have more detailed documentation available,
either as a part of their official or community-driven docs.</p>
<p><strong>Is the framework flexible or opinionated?</strong></p>
<p>Know what flavor you’re after as there are plenty of frameworks
available which provide one or the other. Opinionated frameworks lock
(or suggest) you to do things in a specific way (theirs). By design they
are limiting, but place less emphasis on the developer having to figure
out how things should work on their own.</p>
<p><strong>Have you really played with the framework?</strong></p>
<p>Write a small application without using frameworks and then attempt
to refactor your code with a framework to confirm whether it’s easy to
work with or not. As much as researching and reading up on code will
influence your decision, it’s equally as important to write actual code
using the framework to make sure you’re comfortable with the concepts it
enforces.</p>
<p><strong>Does the framework have a comprehensive set of
documentation?</strong></p>
<p>Although demo applications can be useful for reference, you’ll almost
always find yourself consulting the official framework docs to find out
what its API supports, how common tasks or components can be created
with it and what the gotchas worth noting are. Any framework worth it’s
salt should have a detailed set of documentation which will help guide
developers using it. Without this, you can find yourself heavily relying
on IRC channels, groups and self-discovery, which can be fine, but are
often overly time-consuming when compared to a great set of docs
provided upfront.</p>
<p><strong>What is the total size of the framework, factoring in
minification, gzipping and any modular building that it
supports?</strong></p>
<p>What dependencies does the framework have? Frameworks tend to only
list the total filesize of the base library itself, but don’t list the
sizes of the library’s dependencies. This can mean the difference
between opting for a library that initially looks quite small, but could
be relatively large if it say, depends on jQuery and other
libraries.</p>
<p><strong>Have you reviewed the community around the
framework?</strong></p>
<p>Is there an active community of project contributors and users who
would be able to assist if you run into issues? Have enough developers
been using the framework that there are existing reference applications,
tutorials and maybe even screencasts that you can use to learn more
about it?</p>
<hr />
<p>Where relevant, copyright Addy Osmani, 2012-2013.</p>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34317097-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
